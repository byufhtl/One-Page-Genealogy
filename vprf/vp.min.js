function setCookie(t,e){var n=new Date;n.setTime(n.getTime()+36e5);var r="expires="+n.toUTCString();document.cookie=t+"="+e+"; "+r}function getCookie(t){for(var e=t+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){for(var i=n[r];" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(e))return i.substring(e.length,i.length)}return""}function SquareNode(t,e,n,r){this.x=t,this.y=0,this.width=e,this.height=n,this.id=r}function MultiNode(t,e,n,r){this.top=e,this.bottom=n,this.children=r,this.bounds=t,this.rectangle={},this.parent=null,this.y=0}function SpacerTree(){this.nodeMap,this.node}function Vector2D(t,e){return"undefined"==typeof e?"undefined"==typeof t?(this.x=0,this.y=0):(this.x=t.x,this.y=t.y):"number"==typeof t?(this.x=t,this.y=e):(this.x=e.x-t.x,this.y=e.y-t.y),this}function Ancestor(t){this.id=t,this.niblingPercents=[],this.niblingCounts=[],this.childrenPercents=[],this.childrenCounts=[],this.parent=null,this.children=[];var e=new Date;this.createdTime=e.getTime()}function Map(){}function Tree2(){this.db=new AncestorDB,this.top=null,this.bottom=null,this.nodes=[],this.breadthFirstNodes=[],this.lookup={},this.treename=""}function AncestorDB(){this.rootId=null,this.db={}}function Node(t){this.id=t,this.parent=null,this.children=[],this.point=null,this.upperbound,this.lowerbound,this.childrenIds=[]}function TreeAlt(){this.db=new AncestorDB,this.top=null,this.bottom=null,this.height=100,this.nodes=[],this.breadthFirstNodes=[],this.treename=""}var AbstractSource=function(){function t(t,e){this.downloader=e,this.rootId=t,this.counter={},this.pendingIds={},this.requestedIds=[],this.downloadingIds={},this.setListener({gotNode:function(t){},extendRoot:function(t){},deleteId:function(t){},done:function(){}})}return t.prototype.start=function(){this.uniqueRootId=this.nextUniqueId(this.rootId),this.initDownload(this.rootId,this.uniqueRootId,null)},t.prototype.nextUniqueId=function(t){this.counter.hasOwnProperty(t)||(this.counter[t]=0);var e=this.counter[t]++;return t+":"+String(e)},t.prototype.initDownload=function(t,e,n){},t.prototype.extendRootDownload=function(t){},t.prototype.setAddToPending=function(t,e,n){this.pendingIds[e]={downloadId:t,uniqueParentId:n}},t.prototype.processRequests=function(){for(var e=Object.keys(this.downloadingIds).length,n=t.CONCURRENT_DOWNLOADS-e,r=0;n>r&&0!==this.requestedIds.length;r++){var i=this.requestedIds.shift();if(this.pendingIds.hasOwnProperty(i)){var s=this.pendingIds[i];delete this.pendingIds[i],this.downloadingIds[i]=!0,this.initDownload(s.downloadId,i,s.uniqueParentId)}else r--}},t.prototype.setListener=function(t){this.listener=t},t.prototype.pause=function(){},t.prototype.play=function(){},t.prototype.requestIds=function(t){this.requestedIds=t,this.processRequests()},t.prototype.requestRootExtend=function(t){this.extendRootDownload(t)},t.prototype.deleteId=function(t){this.requestedIds=[],this.downloader.deleteId(t);for(var e=this.counter[t],n=0;e>n;n++)this.listener.deleteId(t+":"+String(n))},t.CONCURRENT_DOWNLOADS=3,t}(),Command=function(){function t(t,e){this.type=t,this.value=e}return t.prototype.getType=function(){return this.type},t.prototype.getValue=function(){return this.value},t}(),SpaceFillerNode=function(){function t(t,e){this.id=t,this.parentId=e}return t.prototype.getId=function(){return this.id},t.prototype.getAttr=function(t){return"downloadId"===t?this.id.split(":")[0]:null},t.prototype.hasAttr=function(t){return"isSpaceFillerNode"===t?!0:"downloadId"===t?!0:!1},t.prototype.getBranchIds=function(){return[]},t.prototype.getParentId=function(){return this.parentId},t.prototype.setParentId=function(t){this.parentId=t},t}(),Box=function(){function t(t){this.type=null,this.node=t,this.attrs={}}return t.prototype.getHeight=function(){return this.h},t.prototype.setHeight=function(t){this.h=t},t.prototype.getWidth=function(){return this.w},t.prototype.setWidth=function(t){this.w=t},t.prototype.getX=function(){return this.x},t.prototype.setX=function(t){this.x=t},t.prototype.getY=function(){return this.y},t.prototype.setY=function(t){this.y=t},t.prototype.getNode=function(){return this.node},t.prototype.getType=function(){return this.type},t.prototype.setType=function(t){this.type=t},t.prototype.clearAttr=function(){this.attrs={}},t.prototype.setAttr=function(t,e){this.attrs[t]=e},t.prototype.deleteAttr=function(t){delete this.attrs[t]},t.prototype.hasAttr=function(t){return this.attrs.hasOwnProperty(t)},t.prototype.getAttr=function(t){return this.attrs[t]},t.prototype.copy=function(){var e=new t(this.getNode());e.setHeight(this.getHeight()),e.setWidth(this.getWidth()),e.setType(this.getType()),e.setX(this.getX()),e.setY(this.getY());for(var n in this.attrs)this.attrs.hasOwnProperty(n)&&e.setAttr(n,this.attrs[n]);return e},t.prototype.copyContents=function(t){t.setHeight(this.getHeight()),t.setWidth(this.getWidth()),t.setType(this.getType()),t.setX(this.getX()),t.setY(this.getY()),t.clearAttr();for(var e in this.attrs)this.attrs.hasOwnProperty(e)&&t.setAttr(e,this.attrs[e])},t.prototype.clear=function(){this.x=0,this.y=0,this.h=0,this.w=0,this.type=null,this.attrs={}},t}(),DummyNode=function(){function t(t,e){this.id=t,this.parentId=e}return t.prototype.getId=function(){return this.id},t.prototype.getAttr=function(t){return"downloadId"===t?this.id.split(":")[0]:null},t.prototype.hasAttr=function(t){return"isDummyNode"===t?!0:"downloadId"===t?!0:!1},t.prototype.getBranchIds=function(){return[]},t.prototype.getParentId=function(){return this.parentId},t.prototype.setParentId=function(t){this.parentId=t},t}(),Tree=function(){function t(){var t=this;this.started=!1,this.root=null,this.treeMap={},this.updates=[],this.sourceListener={gotNode:function(e){if(t.started||(t.started=!0,t.root=e,t.boxes=new BoxMap(t.root.getId())),t.treeMap.hasOwnProperty(e.getId())){var n=t.treeMap[e.getId()];if(!n.hasAttr("isDummyNode"))throw new Error("Repeat Key, should always receive unique keys.")}else t.updates.push(new Command("add-node",{node:e,index:Number.POSITIVE_INFINITY}));t.treeMap[e.getId()]=e,t.boxes.setId(e.getId(),new Box(e));for(var r=e.getBranchIds(),i=0;i<r.length;i++){var s=new DummyNode(r[i],e.getId());t.treeMap[s.getId()]=s,t.boxes.setId(s.getId(),new Box(s)),t.updates.push(new Command("add-node",{node:s,index:Number.POSITIVE_INFINITY}))}Object.keys(t.treeMap).length%1===0&&(t.treeListener.handleUpdate(t,t.updates),t.updates=[])},extendRoot:function(e){t.root=e,t.boxes.setRoot(e.getId()),t.updates.push(new Command("extend-root",e)),t.treeMap[e.getId()]=e,t.boxes.setId(e.getId(),new Box(e));for(var n=e.getBranchIds(),r=0;r<n.length;r++)if(t.treeMap.hasOwnProperty(n[r])){var i=t.treeMap[n[r]];i.setParentId(e.getId())}else{var i=new DummyNode(n[r],e.getId());t.treeMap[i.getId()]=i,t.boxes.setId(i.getId(),new Box(i)),t.updates.push(new Command("add-node",{node:i,index:r}))}t.treeListener.handleUpdate(t,t.updates),t.updates=[]},deleteId:function(e){var n=t.deleteAll(e);n&&(t.updates.push(new Command("delete-node",e)),t.treeListener.handleUpdate(t,t.updates),t.updates=[])},done:function(){t.treeListener.handleUpdate(t,t.updates),t.updates=[]}},this.treeListener={handleUpdate:function(t){console.log("Tree updated")}}}return t.prototype.deleteAll=function(t){if(this.treeMap.hasOwnProperty(t)){var e=this.treeMap[t];if(delete this.treeMap[t],this.boxes.removeId(t),e){for(var n=e.getBranchIds(),r=0;r<n.length;r++)this.deleteAll(n[t]);return t===this.root.getId()&&(this.boxes=null,this.root=null,this.started=!1),!0}}return!1},t.prototype.getSourceListener=function(){return this.sourceListener},t.prototype.getId=function(t){var e=this.treeMap[t];return e?e:null},t.prototype.getRoot=function(){return this.root},t.prototype.setListener=function(t){this.treeListener=t},t.prototype.asBoxMap=function(){return this.boxes},t}(),__extends=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},FSAncestryDownloaderSmart=function(t){function e(e,n){t.call(this,e,n)}return __extends(e,t),e.prototype.initDownload=function(t,e,n){var r=this;this.downloader.getId(t).then(function(t){for(var i=t.getAscBranchIds(),s=[],o=0;o<i.length&&10>o;o++){var a=i[o],h=r.nextUniqueId(a);s.push(h),r.setAddToPending(a,h,e)}delete r.downloadingIds[e],r.processRequests();var u=t.getSpouses(),c={};u.length>0&&(u[0].person?c.spouseName=u[0].person.$getDisplayName():u.length>1&&u[1].person&&(c.spouseName=u[1].person.$getDisplayName()),c.spouseCount=u.length,c.ancestrySpouses=u);var l=new FSDescNode(e,t.getPerson(),s,n,c,[]);r.listener.gotNode(l)},function(){delete r.downloadingIds[e],r.processRequests(),console.log("Download failed... "+t)})},e.prototype.extendRootDownload=function(t){var e=this;this.downloader.getId(t).then(function(n){for(var r=e.nextUniqueId(t),i=n.getAscBranchIds(),s=[],o=0;o<i.length&&4>o;o++){var a=i[o],h=e.nextUniqueId(a);s.push(h),e.setAddToPending(a,h,r)}var u=n.getSpouses(),c={};u.length>0&&(c.spouseName=u[0].person.$getDisplayName(),c.spouseCount=u.length),s.push(e.uniqueRootId);var l=new FSDescNode(r,n.getPerson(),s,null,c,[]);e.uniqueRootId=r,e.rootId=t,e.listener.extendRoot(l)})},e}(AbstractSource),FSPerson=function(){function t(t,e,n,r,i,s){this.id=t,this.person=e,this.ascBranchIds=n,this.dscBranchIds=r,this.enhanceData=i,this.spouses=s}return t.prototype.getDscBranchIds=function(){return this.dscBranchIds},t.prototype.getAscBranchIds=function(){return this.ascBranchIds},t.prototype.getPerson=function(){return this.person},t.prototype.getEnhanceData=function(){return this.enhanceData},t.prototype.getSpouses=function(){return this.spouses},t}(),__extends=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},NullSource=function(t){function e(e){var n={hasId:function(t){return!1},getId:function(t){return null},deleteId:function(t){}};t.call(this,e,n)}return __extends(e,t),e.prototype.initDownload=function(t,e,n){},e.prototype.extendRootDownload=function(t){},e}(AbstractSource),__extends=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},EmptySource=function(t){function e(e,n){t.call(this,e,n),this.isExtendingRoot=!1}return __extends(e,t),e.prototype.initDownload=function(t,e,n){var r=this;this.downloader.getId(t).then(function(t){for(var i=t.getAscBranchIds(),s=[],o=0;o<i.length;o++){var a=i[o],h=r.nextUniqueId(a);s.push(h),r.setAddToPending(a,h,e)}delete r.downloadingIds[e],r.processRequests();var u=new EmptyNode(e,s,n);r.listener.gotNode(u)},function(){delete r.downloadingIds[e],r.processRequests(),console.log("Download failed... "+t)})},e.prototype.extendRootDownload=function(t){var e=this;this.isExtendingRoot||(this.downloader.getId(t).then(function(n){for(var r=e.nextUniqueId(t),i=n.getAscBranchIds(),s=[],o=0;o<i.length&&4>o;o++){var a=i[o],h=e.nextUniqueId(a);s.push(h),e.setAddToPending(a,h,r)}s.push(e.uniqueRootId);var u=new EmptyNode(r,s,null);e.uniqueRootId=r,e.rootId=t,e.listener.extendRoot(u),e.isExtendingRoot=!1},function(){e.isExtendingRoot=!1}),this.isExtendingRoot=!0)},e}(AbstractSource),__extends=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},FSDescDownloaderWithSpouses=function(t){function e(e,n){t.call(this,e,n)}return __extends(e,t),e.prototype.initDownload=function(t,e,n){if(0===e.indexOf("f~"))return delete this.downloadingIds[e],void this.processRequests();var r=this;this.downloader.getId(t).then(function(i){for(var s=i.getDscBranchIds(),o=[],a=[],h=i.getSpouses(),u=[],c=0;c<h.length;c++){var l=h[c],d={};u.push(d);var p=l.childIds;d.person=l.person,d.childIds=l.childIds,d.uniqueChildIds=[],l.person&&!function(t,e){e.personPromise=function(){return r.downloader.getId(t.person.id)}}(l,d);for(var g=0;g<p.length;g++){var f=p[g],m=r.nextUniqueId(f);o.push(m),r.setAddToPending(f,m,e),d.uniqueChildIds.push(m)}if(0===p.length&&s.length>0){var y="f~"+t,m=r.nextUniqueId(y);o.push(m),d.uniqueChildIds.push(m),a.push(new SpaceFillerNode(m,e))}}delete r.downloadingIds[e],r.processRequests();var v=new FSDescNode(e,i.getPerson(),o,n,i.getEnhanceData(),u);r.listener.gotNode(v);for(var c=0;c<a.length;c++)r.listener.gotNode(a[c])},function(){delete r.downloadingIds[e],r.processRequests(),console.log("Download failed... "+t)})},e}(AbstractSource),EmptyDownloader=function(){function t(){this.cache={},this.pending={},this.enhancements={},this.idCount=0}return t.prototype.hasId=function(t){return this.cache.hasOwnProperty(t)||this.pending.hasOwnProperty(t)},t.prototype.getId=function(t){if(this.pending.hasOwnProperty(t))return this.pending[t];var e=$.Deferred(),n=this;return this.cache.hasOwnProperty(t)?(e.resolve(this.cache[t]),e.promise()):(setTimeout(function(){for(var r=[],i=[],s=5*Math.random(),o=Math.min(5*Math.random(),2),a=0;o>a;a++)i.push("a"+ ++n.idCount);for(var a=0;s>a;a++)r.push("a"+ ++n.idCount);var h=new FSPerson(t,null,i,r,{gender:"Male",name:t},[]);n.cache[t]=h,delete n.pending[t],e.resolve(h)},1e3*Math.random()),e.promise())},t.prototype.enhanceDownload=function(t,e){this.enhancements[t]=e},t.prototype.deleteId=function(t){if(this.pending.hasOwnProperty(t)&&(this.pending[t].reject(),delete this.pending[t]),this.cache.hasOwnProperty(t)){var e=this.cache[t];delete this.cache[t];for(var n=e.getAscBranchIds(),r=e.getDscBranchIds(),i=0;i<n.length;i++)this.deleteId(n[i]);for(var i=0;i<r.length;i++)this.deleteId(r[i])}this.enhancements.hasOwnProperty(t)&&delete this.enhancements[t]},t}(),FSDescNode=function(){function t(t,e,n,r,i,s){this.id=t,this.person=e,this.branchIds=n,this.parentId=r,this.data=i,this.spouses=s,this.urlPromise=null,this.data||(this.data={})}return t.prototype.getId=function(){return this.id},t.prototype.getAttr=function(t){return this.getAndHasAttribute(!1,t)?this.getAndHasAttribute(!0,t):this.data[t]},t.prototype.hasAttr=function(t){var e=this.getAndHasAttribute(!1,t);return e?e:this.data.hasOwnProperty(t)},t.prototype.getAndHasAttribute=function(t,e){var n=null;if(this.person){switch(e){case"name":n=this.person.$getDisplayName();break;case"gender":n=this.person.$getDisplayGender();break;case"lifespan":n=this.person.$getDisplayLifeSpan();break;case"birthdate":n=this.person.$getDisplayBirthDate();break;case"birthplace":n=this.person.$getDisplayBirthPlace();break;case"deathdate":n=this.person.$getDisplayDeathDate();break;case"deathplace":n=this.person.$getDisplayDeathPlace();break;case"url":n="https://familysearch.org/tree/#view=ancestor&person="+this.person.id;break;case"downloadId":n=this.person.id;break;case"spouseName":if(this.spouses.length>0){n=null;for(var r=0;r<this.spouses.length;r++)if(this.spouses[r]&&this.spouses[r].person&&this.spouses[r].person.$getDisplayName()){n=this.spouses[r].person.$getDisplayName();break}}break;case"spouseCount":return this.spouses.length;case"spouses":return this.spouses;case"profilePicturePromise":null!==this.urlPromise?n=this.urlPromise:(this.urlPromise=PictureRequestHandler.getSingleton().requestPicture(this.person,StringUtils.getURLString()+this.getGenderImageUrl()),n=this.urlPromise)}if(null!==n&&"undefined"!=typeof n)return t?n:!0}return t?null:!1},t.prototype.getGenderImageUrl=function(){var t=this.person.$getDisplayGender();return"Male"===t?"images/manSilhouetteRight.png":"Female"===t?"images/womanSilhouette.png":"images/manSilhouetteRight.png"},t.prototype.getBranchIds=function(){return this.branchIds},t.prototype.getParentId=function(){return this.parentId},t.prototype.setParentId=function(t){this.parentId=t},t}(),PictureRequestHandler=function(){function t(){this.queue=[],this.pendingRequests=0}return t.getSingleton=function(){return t.handler||(t.handler=new t),t.handler},t.prototype.requestPicture=function(t,e){var n=$.Deferred();return this.queue.push({person:t,defer:n,fallback:e}),this.processQueue(),n.promise()},t.prototype.processQueue=function(){if(this.pendingRequests<t.MAX_REQUESTS)for(var e=this.pendingRequests;e<t.MAX_REQUESTS;e++)if(this.queue.length>0){var n=this.queue.shift();!function(t,e,n){t.$getPersonPortraitUrl().then(function(t){t&&n&&(t+="&default="+encodeURIComponent(n)),e.resolve(t)},function(){e.reject()})}(n.person,n.defer,n.fallback)}},t.MAX_REQUESTS=3,t}(),FamilySearchSourceFactory=function(){function t(){this.fsDownloader=new FSDownloader}return t.prototype.makeAscSource=function(t,e){return new FSAncestryDownloaderSmart(t,this.fsDownloader)},t.prototype.makeDscSource=function(t,e){return e&&e.spouseViewEnabled?new FSDescDownloaderWithSpouses(t,this.fsDownloader):new FSDescDownloaderSmart(t,this.fsDownloader)},t.prototype.validSourceId=function(t){var e=$.Deferred();return FamilySearch.getPerson(t).then(function(t){t&&e.resolve(!0),e.resolve(!1)},function(){e.resolve(!1)}),e.promise()},t}(),EmptySourceFactory=function(){function t(){this.downloader=new EmptyDownloader}return t.prototype.makeAscSource=function(t,e){return new EmptySource(t,new EmptyDownloader)},t.prototype.makeDscSource=function(t,e){return new NullSource(t)},t.prototype.validSourceId=function(t){var e=$.Deferred();return e.resolve(!0),e.promise()},t}(),FSDownloader=function(){function t(){this.cache={},this.pending={},this.enhancements={}}return t.prototype.hasId=function(t){return this.cache.hasOwnProperty(t)||this.pending.hasOwnProperty(t)},t.prototype.getId=function(t){if(this.pending.hasOwnProperty(t))return this.pending[t];var e=$.Deferred(),n=this;return this.cache.hasOwnProperty(t)?(e.resolve(this.cache[t]),e.promise()):(FamilySearch.getPersonWithRelationships(t,{persons:!0}).then(function(r){r||n.handleFailed(t,e);for(var i,s,o={},a=[],h=[],u=r.getPrimaryPerson(),c=r.getSpouses(),l=[],d=0;d<c.length;d++){var p=c[d];if(p){var g=r.getSpouseRelationship(p.id),f=g.$getMarriageFact(),m=Number.NEGATIVE_INFINITY;f&&f.$getNormalizedDate()&&(m=new Date(f.$getNormalizedDate()).getTime()),l.push({id:p.id,person:p,children:r.getChildrenOf(p.id),childIds:r.getChildIdsOf(p.id),dateTimestamp:m})}}r.getChildIdsOf(null).length>0&&l.push({id:null,person:null,children:r.getChildrenOf(null),childIds:r.getChildIdsOf(null),dateTimestamp:Number.NEGATIVE_INFINITY});var y=r.getChildren(),v={};for(d=0;d<y.length;d++){var b=y[d];v[b.id]=b}l.sort(function(t,e){return t.dateTimestamp===e.dateTimestamp?0:t.dateTimestamp>e.dateTimestamp?1:-1});for(var d=0;d<l.length;d++)l[d].childIds.sort(function(t,e){var n=v[t],r=v[e],i=new Date,s=new Date;return n&&n.$getBirth()&&r.$getDisplayBirthDate()&&(i=new Date(n.$getDisplayBirthDate())),r&&r.$getBirth()&&r.$getDisplayBirthDate()&&(s=new Date(r.$getDisplayBirthDate())),i.getTime()==s.getTime()?0:i.getTime()>s.getTime()?1:-1});for(var a=[],d=0;d<l.length;d++)for(var w=l[d].childIds,A=0;A<w.length;A++)a.push(w[A]);var P=r.getParentRelationships();for(d=0,s=P.length;s>d;d++)i=P[d],i.$getFatherId()&&h.push(i.$getFatherId()),i.$getMotherId()&&h.push(i.$getMotherId());if(n.enhancements.hasOwnProperty(t)){o=n.enhancements[t];var x=o.dscBranchIds||[],C=o.ascBranchIds||[];h=h.concat(C),a=a.concat(x)}var I=new FSPerson(t,u,h,a,o,l);n.cache[t]=I,delete n.pending[t],e.resolve(I)},function(){n.handleFailed(t,e)}),e.promise())},t.prototype.enhanceDownload=function(t,e){this.enhancements[t]=e},t.prototype.handleFailed=function(t,e){if(this.enhancements.hasOwnProperty(t)){var n=this.enhancements[t],r=n.dscBranchIds||[],i=n.ascBranchIds||[],s=new FSPerson(t,null,i,r,n,[]);this.cache[t]=s,delete this.pending[t],e.resolve(s)}else delete this.pending[t],e.reject()},t.prototype.deleteId=function(t){if(this.pending.hasOwnProperty(t)&&(this.pending[t].reject(),delete this.pending[t]),this.cache.hasOwnProperty(t)){var e=this.cache[t];delete this.cache[t];for(var n=e.getAscBranchIds(),r=e.getDscBranchIds(),i=0;i<n.length;i++)this.deleteId(n[i]);for(var i=0;i<r.length;i++)this.deleteId(r[i])}this.enhancements.hasOwnProperty(t)&&delete this.enhancements[t]},t}(),EmptyNode=function(){function t(t,e,n){this.id=t,this.branchIds=e,this.parentId=n}return t.prototype.getId=function(){return this.id},t.prototype.getAttr=function(t){return this.getAndHasAttribute(!0,t)},t.prototype.hasAttr=function(t){return this.getAndHasAttribute(!1,t)},t.prototype.getAndHasAttribute=function(t,e){var n=null;switch(e){case"name":n=this.id;break;case"gender":n="Male";break;case"downloadId":n=this.id.split(":")[0];break;case"extendRootId":n="~"+this.id.split(":")[0]}return null!==n&&void 0!==n?t?n:!0:t?null:!1},t.prototype.getBranchIds=function(){return this.branchIds},t.prototype.getParentId=function(){return this.parentId},t.prototype.setParentId=function(t){this.parentId=t},t}(),__extends=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},FSDescDownloaderSmart=function(t){function e(e,n){t.call(this,e,n)}return __extends(e,t),e.prototype.initDownload=function(t,e,n){if(0===e.indexOf("f~"))return delete this.downloadingIds[e],void this.processRequests();var r=this;this.downloader.getId(t).then(function(t){for(var i=(t.getDscBranchIds(),[]),s=[],o=t.getSpouses(),a=[],h=0;h<o.length;h++){var u=o[h],c={};a.push(c);var l=u.childIds;c.person=u.person,c.childIds=u.childIds,c.uniqueChildIds=[],u.person&&!function(t,e){e.personPromise=function(){return r.downloader.getId(t.person.id)}}(u,c);for(var d=0;d<l.length;d++){var p=l[d],g=r.nextUniqueId(p);i.push(g),r.setAddToPending(p,g,e),c.uniqueChildIds.push(g)}}delete r.downloadingIds[e],r.processRequests();var f=new FSDescNode(e,t.getPerson(),i,n,t.getEnhanceData(),a);r.listener.gotNode(f);for(var h=0;h<s.length;h++)r.listener.gotNode(s[h])},function(){delete r.downloadingIds[e],r.processRequests(),console.log("Download failed... "+t)})},e}(AbstractSource),AbstractSource=function(){function t(t,e){this.downloader=e,this.rootId=t,this.counter={},this.pendingIds={},this.requestedIds=[],this.downloadingIds={},this.setListener({gotNode:function(t){},extendRoot:function(t){},deleteId:function(t){},done:function(){}})}return t.prototype.start=function(){this.uniqueRootId=this.nextUniqueId(this.rootId),this.initDownload(this.rootId,this.uniqueRootId,null)},t.prototype.nextUniqueId=function(t){this.counter.hasOwnProperty(t)||(this.counter[t]=0);var e=this.counter[t]++;return t+":"+String(e)},t.prototype.initDownload=function(t,e,n){},t.prototype.extendRootDownload=function(t){},t.prototype.setAddToPending=function(t,e,n){this.pendingIds[e]={downloadId:t,uniqueParentId:n}},t.prototype.processRequests=function(){for(var e=Object.keys(this.downloadingIds).length,n=t.CONCURRENT_DOWNLOADS-e,r=0;n>r&&0!==this.requestedIds.length;r++){var i=this.requestedIds.shift();if(this.pendingIds.hasOwnProperty(i)){var s=this.pendingIds[i];delete this.pendingIds[i],this.downloadingIds[i]=!0,this.initDownload(s.downloadId,i,s.uniqueParentId)}else r--}},t.prototype.setListener=function(t){this.listener=t},t.prototype.pause=function(){},t.prototype.play=function(){},t.prototype.requestIds=function(t){this.requestedIds=t,this.processRequests()},t.prototype.requestRootExtend=function(t){this.extendRootDownload(t)},t.prototype.deleteId=function(t){this.requestedIds=[],this.downloader.deleteId(t);for(var e=this.counter[t],n=0;e>n;n++)this.listener.deleteId(t+":"+String(n))},t.CONCURRENT_DOWNLOADS=3,t}(),C=function(){function t(){this.spouseViewEnabled=!0,this.optionManager=new OptionManager}return t.prototype.initialize=function(t){var e=null;if(!t.rootId)throw"rootId required";e=t.rootId,t.sourceFactory||(t.sourceFactory=new EmptySourceFactory);var n=t.settings||{},r={};n.initBoxStyle&&(r.initBoxStyle=n.initBoxStyle),n.hasOwnProperty("spouseViewEnabled")&&(this.spouseViewEnabled=n.spouseViewEnabled),this.optionManager.handleOptionSetting("setSettings",{settings:n}),this.sourceFactory=t.sourceFactory,this.highlightPaths=t.highlightPaths||[],this.scaleFactor=1,this.ascSource=this.sourceFactory.makeAscSource(e,{spouseViewEnabled:this.spouseViewEnabled}),this.dscSource=this.sourceFactory.makeDscSource(e,{spouseViewEnabled:this.spouseViewEnabled});var i=this,s=null;this.ascController={refresh:function(t){if(i.viewManager.refreshAsc(t),t&&s!==t.getRoot()){var e=t.getId(t.getRoot());e&&(i.optionManager.handleOptionSetting("newRoot",{box:e}),s=t.getRoot())}i.optionManager.handleOptionSetting("refreshLowHangingFruit",{boxes:t})}},this.dscController={refresh:function(t){i.dscGraphicObject=i.viewManager.refreshDsc(t),i.dscGraphicObject.setListener(i),i.optionManager.handleOptionSetting("refreshLowHangingFruit",{boxes:t})}},this.viewManager=new MainViewManager,this.viewManager.getGraphicObject().setListener(this),this.viewManager.setScale(this.scaleFactor),this.hourglass=new HourglassFacade(this.ascController,this.dscController,this.ascSource,this.dscSource,new Point(200,200),r),this.hourglass.handle({type:"setSpouseView",enabled:this.spouseViewEnabled}),this.handleResize(200,200),this.hourglass.handle({type:"setHighlightPath",path:this.highlightPaths}),this.optionManager.setListener(this),this.ascSource.start(),this.dscSource.start()},t.prototype.translate=function(t,e){this.hourglass.handle({type:"translate",before:t,after:e})},t.prototype.scale=function(t,e){this.scaleFactor*=t;var n=e.getX()*t-e.getX(),r=e.getY()*t-e.getY();this.hourglass.handle({type:"translate",before:e,after:new Point(e.getX()+n,e.getY()+r),preventRefresh:!0}),this.viewManager.setScale(this.scaleFactor),this.handleResize(this.width,this.height)},t.prototype.click=function(t){},t.prototype.clickPt=function(t){var e=this.hourglass.handle({type:"getClosestBox",pt:t});this.optionManager.handleOptionSetting("openModal",{box:e,pt:t})},t.prototype.rotate=function(t,e,n){},t.prototype.requestIds=function(t,e,n,r){this.ascSource.requestIds(t),this.dscSource.requestIds(n),e&&this.ascSource.requestRootExtend(e),r&&this.dscSource.requestRootExtend(r)},t.prototype.handleResize=function(t,e){this.width=t,this.height=e,this.viewManager.setSize(t,e),e*=this.scaleFactor,t*=this.scaleFactor,this.hourglass.handle({type:"resize",height:e,width:t})},t.prototype.setNewRootUnchecked=function(t){this.ascSource=this.sourceFactory.makeAscSource(t,{spouseViewEnabled:this.spouseViewEnabled}),this.dscSource=this.sourceFactory.makeDscSource(t,{spouseViewEnabled:this.spouseViewEnabled});var e=this.hourglass.handle({type:"getBoxStyle"});this.hourglass.clear();var n=new Point(this.width*this.scaleFactor/2,this.height*this.scaleFactor/2);this.hourglass=new HourglassFacade(this.ascController,this.dscController,this.ascSource,this.dscSource,n,{initBoxStyle:e}),this.hourglass.handle({type:"setSpouseView",enabled:this.spouseViewEnabled}),this.handleResize(this.width,this.height),this.hourglass.handle({type:"setHighlightPath",path:this.highlightPaths});var r=window;r.stop(),this.ascSource.start(),this.dscSource.start()},t.prototype.handleOption=function(t,e){if("resize"===t)this.handleResize(e.width,e.height);else if("changeBoxStyle"===t){var n={type:"changeBoxStyle",boxStyle:e.boxStyle};HistoryStorageManager.getSingleton().setSetting("initBoxStyle",e.boxStyle),e.transitionTime&&(n.transitionTime=e.transitionTime),this.hourglass.handle(n)}else if("rotate"===t)this.viewManager.rotate(e.value);else if("setPidRoot"===t){var r=this;this.sourceFactory.validSourceId(e.pid).then(function(t){t?r.setNewRootUnchecked(e.pid):alert("Unable to find requested Person Id")})}else if("deleteId"===t)e.type="setNewAnchor",this.hourglass.handle(e),this.ascSource.deleteId(e.id),this.dscSource.deleteId(e.id);else if("extendRoot"===t)this.ascSource.requestRootExtend(e.newRootId);else if("resetView"===t)this.viewManager=new MainViewManager,this.viewManager.getGraphicObject().setListener(this),this.handleResize(this.width,this.height),this.viewManager.setScale(this.scaleFactor),this.dscGraphicObject.setListener(this);else if("setSpouseView"===t){var r=this,i=this.hourglass.handle({type:"getRootDownloadId"});this.spouseViewEnabled=e.enabled,HistoryStorageManager.getSingleton().setSetting("spouseViewEnabled",e.enabled),this.sourceFactory.validSourceId(i).then(function(t){t&&r.setNewRootUnchecked(i)})}},t}(),LowHangingFruitManager=function(){function t(t){this.timeSinceLast=Number.NEGATIVE_INFINITY}return t.prototype.handleOptionSetting=function(t,e){"refreshLowHangingFruit"===t&&this.refreshLowHangingFruit(e.boxes)},t.prototype.setListener=function(t){this.listener=t},t.prototype.refreshLowHangingFruit=function(e){Date.now()-this.timeSinceLast>t.REFRESH_INTERVAL&&(this.timeSinceLast=Date.now(),this.realRefreshLowHangingFruit(e))},t.prototype.realRefreshLowHangingFruit=function(t){if(t){var e=t.getRoot(),n=[];for(n.push(e);n.length>0;){var r=t.getId(n.shift()),i=r.getNode(),s=i.getBranchIds();if(!i.hasAttr("isSpaceFillerNode")&&!i.hasAttr("isDummyNode")){if(r.hasAttr("spouseIds"))for(var o=r.getAttr("spouseIds"),a=0;a<o.length;a++){var h=t.getId(o[a]);h&&this.requestAddToFruit(r)}this.requestAddToFruit(r);for(var a=0;a<s.length;a++){var u=t.getId(s[a]);u&&n.push(s[a])}}}}},t.prototype.requestAddToFruit=function(t){},t.REFRESH_INTERVAL=15e3,t}(),DynDescSpacer=function(){function t(){this.tree=new TreeAlt,this.screenOffset=1,this.viewHeight=1,this.viewWidth=1,this.representationHeight=100,this.representationWidth=100,this.anchorId=null,this.anchorPt=null,this.recalcuateGeometry()}return t.prototype.applyStyle=function(t,e,n){for(var r=!1,i=0;i<n.length;i++){var s=n[i];if("add-node"===s.getType()){var o=s.getValue(),a=o.node;this.tree.add(a.getParentId(),a.getId(),o.index),r=!0}if("delete-node"===s.getType()){var h=s.getValue();this.tree.remove(h),r=!0}if("extend-root"===s.getType()){var a=s.getValue();this.tree.extendRoot(a.getId()),r=!0}}var u=new BoxMap(t.getRoot());this.anchorId||this.setAnchor(t.getRoot(),new Point(1,1)),r&&this.tree.setIdToPoint(this.anchorId,this.anchorPt);for(var c=this.tree.getNodes(),i=0;i<c.length;i++){var l=c[i],d=t.getId(l.getId()),p=this.treeToWorld(new Point(l.getPoint().x,l.getPoint().y));d.setX(p.getX()),d.setY(p.getY()),u.setId(l.getId(),t.getId(l.getId()))}return u},t.prototype.recalcuateGeometry=function(){this.viewHeight=this.worldHeight/this.representationHeight,this.viewWidth=this.worldWidth/this.representationWidth,this.tree.setTopAndBottom(-1,this.viewHeight+this.screenOffset)},t.prototype.setViewHeight=function(t){this.worldHeight=t,this.recalcuateGeometry()},t.prototype.setViewWidth=function(t){this.worldWidth=t,this.recalcuateGeometry()},t.prototype.setOffScreenBound=function(t){this.screenOffset=t,this.recalcuateGeometry()},t.prototype.setRepresentationWidth=function(t){this.representationWidth=t,this.recalcuateGeometry()},t.prototype.setRepresentationHeight=function(t){this.representationHeight=t,this.recalcuateGeometry()},t.prototype.getClosestId=function(t){var e=this.tree.getClosestNode(this.worldToTree(t));return e.getId()},t.prototype.setIdToPoint=function(t,e){this.setAnchor(t,e),this.tree.setIdToPoint(t,this.worldToTree(e))},t.prototype.translate=function(t,e){this.tree.translate(this.worldToTree(t),this.worldToTree(e));var n=this.tree.getClosestNode(this.worldToTree(e));if(n){var r=n.getPoint(),i=new Point(r.x,r.y);this.setAnchor(n.getId(),this.treeToWorld(i))}},t.prototype.getAnchor=function(){return{id:this.anchorId,pt:this.treeToWorld(this.anchorPt)}},t.prototype.setAnchor=function(t,e){this.anchorId=t,this.anchorPt=this.worldToTree(e)},t.prototype.getRootPt=function(){var t=this.tree.getNodes();if(0===t.length)return null;var e=t[0].getPoint();return new Point(e.x,e.y)},t.prototype.treeToWorld=function(t){return new Point(t.getX()*this.representationWidth,t.getY()*this.representationHeight)},t.prototype.worldToTree=function(t){return new Point(t.getX()/this.representationWidth,t.getY()/this.representationHeight)},t}(),HourglassFacade=function(){function t(t,e,n,r,i,s){this.ascParentController=t,this.dscParentController=e,this.initPoint=i,this.ascSource=n,
this.dscSource=r,this.anchor=null,this.treeWithAnchor=null,this.rootPt=null,this.ascBoxes=null,this.dscBoxes=null,this.width=1,this.height=1,this.ascInit=!1,this.dscInit=!1,this.transitionStartTime=0,this.transitionEndTime=0,this.inTransition=!1;var o=this;this.ascController={refresh:function(t){if(o.ascBoxes=t,!o.ascInit){o.ascInit=!0;var e=o.asc.handle({type:"setRootToPoint",pt:o.mirrorPt(o.initPoint)});o.treeWithAnchor||(o.treeWithAnchor="asc",o.anchor=o.mirrorPt(e.pt),o.anchorId=e.id)}o.centerOnAnchor(),o.ascBoxes=o.asc.runPipeline(),o.dscBoxes=o.dsc.runPipeline(),o.ascParentController.refresh(o.ascBoxes),o.dscParentController.refresh(o.dscBoxes)}},this.dscController={refresh:function(t){if(o.dscBoxes=t,!o.dscInit){o.dscInit=!0;var e=o.dsc.handle({type:"setRootToPoint",pt:o.dummyPt(o.initPoint)});o.treeWithAnchor||(o.treeWithAnchor="dsc",o.anchor=o.dummyPt(e.pt),o.anchorId=e.id)}o.centerOnAnchor(),o.ascBoxes=o.asc.runPipeline(),o.dscBoxes=o.dsc.runPipeline(),o.ascParentController.refresh(o.ascBoxes),o.dscParentController.refresh(o.dscBoxes)}},this.asc=new P(this.ascController,s),this.dsc=new P(this.dscController,s);var a=new Tree,h=new Tree;n.setListener(a.getSourceListener()),r.setListener(h.getSourceListener()),a.setListener(this.asc),h.setListener(this.dsc)}return t.prototype.clear=function(){this.ascBoxes=null,this.dscBoxes=null,this.ascParentController.refresh(this.ascBoxes),this.dscParentController.refresh(this.dscBoxes),this.ascParentController={refresh:function(t){}},this.dscParentController={refresh:function(t){}}},t.prototype.handle=function(t){function e(){setTimeout(function(){var t=(Date.now()-m.transitionStartTime)/(m.transitionEndTime-m.transitionStartTime);if(1>t){var n=1/(1+Math.exp(-10*(t-.5)));m.asc.handle({type:"continueTransition",transitionPercent:n}),m.dsc.handle({type:"continueTransition",transitionPercent:n}),e()}else m.asc.handle({type:"endTransition"}),m.dsc.handle({type:"endTransition"}),m.inTransition=!1;m.ascBoxes=m.asc.runPipeline(),m.dscBoxes=m.dsc.runPipeline(),m.centerOnAnchor(),m.ascBoxes=m.asc.runPipeline(),m.dscBoxes=m.dsc.runPipeline(),m.dscParentController.refresh(m.dscBoxes),m.ascParentController.refresh(m.ascBoxes)},1e3/30)}if(t.type){if("getRootDownloadId"===t.type){var n=null;if(this.ascBoxes){var r=this.ascBoxes.getId(this.ascBoxes.getRoot());if(r){var i=r.getNode();i&&i.hasAttr("downloadId")&&(n=i.getAttr("downloadId"))}}if(this.dscBoxes){var s=this.dscBoxes.getId(this.dscBoxes.getRoot());if(s){var o=s.getNode();o&&o.hasAttr("downloadId")&&(n=o.getAttr("downloadId"))}}return n}if("getClosestBox"===t.type){var a=t.pt,h=this.getMasterSlave(a),u=null;return u="asc"===h.type?this.getClosestBox(this.ascBoxes,this.mirrorPt(a)):this.getClosestBox(this.dscBoxes,this.dummyPt(a))}if("setSpouseView"===t.type)this.asc.handle(t),this.dsc.handle(t),this.centerOnAnchor(),this.ascBoxes=this.asc.runPipeline(),this.dscBoxes=this.dsc.runPipeline(),this.ascParentController.refresh(this.ascBoxes),this.dscParentController.refresh(this.dscBoxes);else{if("getBoxStyle"===t.type)return this.dsc.handle(t);if("setHighlightPath"===t.type)this.asc.handle(t),this.dsc.handle(t),this.centerOnAnchor(),this.ascBoxes=this.asc.runPipeline(),this.dscBoxes=this.dsc.runPipeline(),this.ascParentController.refresh(this.ascBoxes),this.dscParentController.refresh(this.dscBoxes);else if("setNewAnchor"===t.type){var h=this.getMasterSlave(t.pt),u=t.box,c=null;c="asc"===h.type?this.ascBoxes.getId(u.getNode().getParentId()):this.dscBoxes.getId(u.getNode().getParentId()),this.anchor=h.masterMap(new Point(c.getX(),c.getY())),this.anchorId=c.getNode().getId(),this.treeWithAnchor=h.type}else if("translateClosest"===t.type){var l=t.dx,d=t.dy,a=t.pt,p=a,g=new Point(a.getX()+l,a.getY()+d),h=this.getMasterSlave(p),f=h.master.handle({type:"translate",before:h.masterMap(p),after:h.masterMap(g)});this.anchor=h.masterMap(f.pt),this.anchorId=f.id,this.treeWithAnchor=h.type,this.centerOnAnchor(),"asc"===h.type?(this.ascBoxes=h.master.runPipeline(),this.dscBoxes=h.slave.runPipeline(),this.dscParentController.refresh(this.dscBoxes),this.ascParentController.refresh(this.ascBoxes)):(this.ascBoxes=h.slave.runPipeline(),this.dscBoxes=h.master.runPipeline(),this.dscParentController.refresh(this.dscBoxes),this.ascParentController.refresh(this.ascBoxes))}else if("translate"===t.type){var p=t.before,g=t.after,h=this.getMasterSlave(p),f=h.master.handle({type:"translate",before:h.masterMap(p),after:h.masterMap(g)});this.anchor=h.masterMap(f.pt),this.anchorId=f.id,this.treeWithAnchor=h.type,this.centerOnAnchor(),t.preventRefresh||(this.ascBoxes=this.asc.runPipeline(),this.dscBoxes=this.dsc.runPipeline(),this.ascParentController.refresh(this.ascBoxes),this.dscParentController.refresh(this.dscBoxes))}else if("resize"===t.type)this.width=t.width,this.height=t.height,this.asc.handle(t),this.dsc.handle(t),this.centerOnAnchor(),this.ascBoxes=this.asc.runPipeline(),this.dscBoxes=this.dsc.runPipeline(),this.ascParentController.refresh(this.ascBoxes),this.dscParentController.refresh(this.dscBoxes);else if("changeBoxStyle"===t.type){if(t.transitionTime&&!this.inTransition){this.inTransition=!0,this.transitionStartTime=Date.now(),this.transitionEndTime=this.transitionStartTime+t.transitionTime,this.asc.handle({type:"startTransition",boxStyle:t.boxStyle}),this.dsc.handle({type:"startTransition",boxStyle:t.boxStyle});var m=this;e()}else this.asc.handle(t),this.dsc.handle(t);this.centerOnAnchor(),this.ascBoxes=this.asc.runPipeline(),this.dscBoxes=this.dsc.runPipeline(),this.dscParentController.refresh(this.dscBoxes),this.ascParentController.refresh(this.ascBoxes)}}}},t.prototype.centerOnAnchor=function(){if(null!==this.treeWithAnchor){var t=this.getMasterSlaveByType(this.treeWithAnchor),e=t.master.handle({type:"setIdToPoint",id:this.anchorId,pt:t.masterMap(this.anchor)});this.anchor=t.masterMap(e.pt),this.rootPt=t.masterMap(t.master.handle({type:"getRootPt"})),t.slave.handle({type:"setRootToPoint",pt:t.slaveMap(this.rootPt)})}},t.prototype.getMasterSlaveByType=function(t){var e={master:null,slave:null,masterMap:null,slaveMap:null,type:null},n=this,r=function(t){return n.mirrorPt(t)},i=function(t){return n.dummyPt(t)};return"asc"===t&&this.ascInit||!this.dscInit?(e.master=this.asc,e.slave=this.dsc,e.masterMap=r,e.slaveMap=i,e.type="asc"):"dsc"===t&&(e.master=this.dsc,e.slave=this.asc,e.masterMap=i,e.slaveMap=r,e.type="dsc"),e},t.prototype.getMasterSlave=function(t){var e={master:null,slave:null,masterMap:null,slaveMap:null,type:null},n=this,r=function(t){return n.mirrorPt(t)},i=function(t){return n.dummyPt(t)};return t.getX()>this.rootPt.getX()&&this.ascInit||!this.dscInit?(e.master=this.asc,e.slave=this.dsc,e.masterMap=r,e.slaveMap=i,e.type="asc"):(e.master=this.dsc,e.slave=this.asc,e.masterMap=i,e.slaveMap=r,e.type="dsc"),e},t.prototype.getClosestBox=function(t,e){if(!t)return null;var n=null,r=Number.POSITIVE_INFINITY,i=t.getRoot(),s=[];for(s.push(i);s.length>0;){var o=t.getId(s.shift()),a=o.getNode(),h=a.getBranchIds(),a=o.getNode();if(!a.hasAttr("isSpaceFillerNode")&&!a.hasAttr("isDummyNode")){var u=Point.distanceSqr(new Point(o.getX(),o.getY()),e);if(r>u&&(r=u,n=o),o.hasAttr("spouseIds"))for(var c=o.getAttr("spouseIds"),l=0;l<c.length;l++){var d=t.getId(c[l]);if(d){var u=Point.distanceSqr(new Point(d.getX(),d.getY()),e);r>u&&(r=u,n=d)}}for(var l=0;l<h.length;l++){var p=t.getId(h[l]);p&&s.push(h[l])}}}return n},t.prototype.mirrorPt=function(t){return new Point(this.width-t.getX(),t.getY())},t.prototype.dummyPt=function(t){return t},t}(),ExtrasBoxStyler=function(){function t(){}return t.prototype.applyStyle=function(t,e,n){var r=[];for(r.push(t.getRoot());r.length>0;){var i=t.getId(r.shift());if(i){var s=i.getNode(),o=s.getBranchIds();if(s.hasAttr("spouses")){var a=s.getAttr("spouses"),h=[];if(a.length>1&&o.length>0){for(var u=0;u<a.length;u++){var c=a[u],l=c.uniqueChildIds,d=t.getId(l[0]),p=t.getId(l[l.length-1]),g=i.getY();d&&p&&(g=(d.getY()+p.getY())/2);var f="s"+u+"~"+s.getId(),m={};if(null==c.person){m.name="Missing Spouse";var y="none";s.hasAttr("gender")&&(y="Male"===s.getAttr("gender")?"Female":"Male"),m.gender=y}c.personPromise&&(m.personPromise=c.personPromise);var v=new FSDescNode(f,c.person,[],"",m,[]);h.push(f);var b=new Box(v),w=i.getType()+"ForSpouse";b.setType(w),b.setHeight(ViewFactoryFacade.getHeight(w)),b.setWidth(ViewFactoryFacade.getWidth(w));var A=i.getX()-(i.getWidth()-b.getWidth())/2;b.setX(A),b.setY(g),t.setId(v.getId(),b)}i.setAttr("spouseIds",h)}}for(var u=0;u<o.length;u++){var P=t.getId(o[u]);P&&r.push(o[u])}}}return t},t}(),OptionManager=function(){function t(){var t=this;this.initHistory=!1,this.historyMap={},this.modalManager=new ModalManager,this.modalManager.setListener(this),this.lowHangingFruitManager=new LowHangingFruitManager({}),this.lowHangingFruitManager.setListener(this),this.sidebarManager=new SidebarManager({qualityOptions:[{text:"High Quality - Slow (SVG)",name:"svg"},{text:"Low Quality - Fast (Canvas)",name:"canvas"}],boxOptions:[{text:"Simple Box",name:"compactSimpleNameBox"},{text:"Detailed Box",name:"spouseNameBox"}]}),this.sidebarManager.setListener(this),this.count=1,this.countExtender=0,this.types=["spouseNameBox","compactSimpleNameBox"],$(window).resize(function(){t.updateBounds(),t.sidebarManager.handleOptionSetting("resize",null)}),$("#pid-button").click(function(){t.listener.handleOption("setPidRoot",{pid:$("#pid-input").val()})}),$("#cycle-style-button").click(function(){t.updateBoxStyle(1e3)}),$("#toggle-view-button").click(function(){var e=document.getElementById("vp-chart"),n=document.getElementById("outer-content"),r=e.nodeName.toLowerCase();if(n.innerHTML="","svg"===r){var i=document.createElement("canvas");i.setAttribute("id","vp-chart"),i.setAttribute("class","vp-chart"),n.appendChild(i)}else if("canvas"===r){var s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("id","vp-chart"),s.setAttribute("class","vp-chart"),n.appendChild(s)}t.listener.handleOption("resetView",{})}),t.spouseViewEnabled=!0,$("#toggle-spouse-view").click(function(){t.spouseViewEnabled=!t.spouseViewEnabled,t.setSpouseViewText(t.spouseViewEnabled),t.listener.handleOption("setSpouseView",{enabled:t.spouseViewEnabled})})}return t.prototype.setSpouseViewText=function(t){var e=$("#toggle-spouse-view");t?$(e).text("Hide Advanced Descendancy"):$(e).text("Show Advanced Descendancy")},t.prototype.handleOptionSetting=function(t,e){if("openModal"===t)this.modalManager.handleOptionSetting(t,e);else if("setSettings"==t){var n=e.settings;n.hasOwnProperty("spouseViewEnabled")&&(this.spouseViewEnabled=n.spouseViewEnabled,this.setSpouseViewText(n.spouseViewEnabled)),this.sidebarManager.handleOptionSetting("setSettings",e)}else if("newRoot"==t){var r=null,i=this;if(!this.initHistory){this.initHistory=!0;for(var s=HistoryStorageManager.getSingleton().getHistory(),o=0;o<s.length;o++){var a=s[o];r=a.id,this.createSimpleHistory(a.displayText,a.id)}$("#vp-clear-history").click(function(){HistoryStorageManager.getSingleton().clearHistory(),i.clearHistory()}),$("#vp-return-home").click(function(){var t=HistoryStorageManager.getSingleton().getUserId();i.listener.handleOption("setPidRoot",{pid:t})})}r!==e.box.getNode().getAttr("downloadId")&&this.createHistory(e.box)}else"refreshLowHangingFruit"===t&&this.lowHangingFruitManager.handleOptionSetting(t,e)},t.prototype.setListener=function(t){this.listener=t,this.updateBounds()},t.prototype.handleOption=function(t,e){if("setPidRoot"===t&&this.listener.handleOption(t,e),"deleteId"===t&&this.listener.handleOption(t,e),"sidebar-resize"===t){this.updateBounds();var n=this;setTimeout(function(){n.updateBounds()},e.transitionTime+100)}"changeBoxStyle"===t&&this.updateBoxStyleSelect(e.boxStyle,e.transitionTime),"changeViewManager"===t&&this.changeView(e.viewManager)},t.prototype.clearHistory=function(){$("#vp-root-history").find(".sidebar-brand").nextAll().remove()},t.prototype.createHistory=function(t){var e=t.getNode(),n=e.getId();e.hasAttr("name")&&(n=e.getAttr("name")),HistoryStorageManager.getSingleton().addToHistory(n,e.getAttr("downloadId")),this.createSimpleHistory(n,e.getAttr("downloadId"))},t.prototype.createSimpleHistory=function(t,e){var n=$("<div>").text(t).html(),r=null;if(this.historyMap.hasOwnProperty(e))r=this.historyMap[e],$("#vp-root-history").find(".sidebar-brand").after(r);else{r=$('<li><a href="#">'+n+"</a></li>"),$("#vp-root-history").find(".sidebar-brand").after(r);var i=this;r.click(function(){i.listener.handleOption("setPidRoot",{pid:e})})}this.historyMap[e]=r},t.prototype.updateBounds=function(){var t=$("#outer-content").height(),e=$("#outer-content").width();this.listener.handleOption("resize",{height:t,width:e})},t.prototype.updateBoxStyle=function(t){this.count=(this.count+1)%this.types.length;var e={boxStyle:this.types[this.count]};t&&(e.transitionTime=t),this.listener.handleOption("changeBoxStyle",e)},t.prototype.updateBoxStyleSelect=function(t,e){var n={boxStyle:t};e&&(n.transitionTime=e),this.listener.handleOption("changeBoxStyle",n)},t.prototype.changeView=function(t){var e=document.getElementById("vp-chart"),n=document.getElementById("outer-content"),r=e.nodeName.toLowerCase();if(r!==t){if(r=t,n.innerHTML="","canvas"===r){var i=document.createElement("canvas");i.setAttribute("id","vp-chart"),i.setAttribute("class","vp-chart"),n.appendChild(i)}else if("svg"===r){var s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("id","vp-chart"),s.setAttribute("class","vp-chart"),n.appendChild(s)}this.listener.handleOption("resetView",{})}},t}(),PathStyler=function(){function t(){this.highlightIds={}}return t.prototype.applyStyle=function(t,e,n){if(0===Object.keys(this.highlightIds).length)return t;var r=[];for(r.push(t.getRoot());r.length>0;){var i=t.getId(r.shift());if(i){var s=i.getNode(),o=s.getBranchIds(),a=s.getAttr("downloadId");this.highlightIds.hasOwnProperty(a)?i.setAttr("highlight",this.highlightIds[a]):i.deleteAttr("highlight");for(var h=0;h<o.length;h++){var u=t.getId(o[h]);u&&r.push(o[h])}}}return t},t.prototype.setHighlights=function(t){this.highlightIds={};for(var e=0;e<t.length;e++)for(var n=0;n<t[e].length;n++)n+1<t[e].length&&(this.addToMap(t[e][n],t[e][n+1]),this.addToMap(t[e][n+1],t[e][n]))},t.prototype.addToMap=function(t,e){this.highlightIds[t]?this.highlightIds[t][e]=!0:(this.highlightIds[t]={},this.highlightIds[t][e]=!0)},t}(),SidebarManager=function(){function t(t){this.initialize(t)}return t.prototype.initialize=function(e){var n=this,r=e.qualityOptions||[],i=e.qualityDefault||0,s=e.boxOptions||[];this.boxOptions=s;var o=e.boxDefault||0;if(r.length>0){var a=$("#vp-quality-selection"),h=$("<div>").text(r[i].text).html();a.find(".btn-select").html(h+' <span class="caret"></span>');for(var u=a.find(".dropdown-menu"),c=0;c<r.length;c++)!function(t){h=$("<div>").text(t.text).html();var e=$('<li><a href="#">'+h+"</a></li>");e.find("a").click(function(){n.listener.handleOption("changeViewManager",{viewManager:t.name})}),u.append(e)}(r[c])}if(s.length>0){var l=$("#vp-box-selection"),h=$("<div>").text(s[o].text).html();l.find(".btn-select").html(h+' <span class="caret"></span>');for(var u=l.find(".dropdown-menu"),c=0;c<s.length;c++)!function(t){h=$("<div>").text(t.text).html();var e=$('<li><a href="#">'+h+"</a></li>");e.find("a").click(function(){n.listener.handleOption("changeBoxStyle",{boxStyle:t.name,transitionTime:1e3})}),u.append(e)}(s[c])}$(".body-wrapper .dropdown-menu li a").click(function(){var t=$(this).text();$(this).parents(".btn-group").find(".dropdown-toggle").html(t+' <span class="caret"></span>')}),$("#logout-btn").click(function(){window.location.replace("logout")}),$("#vp-pid-search").click(function(){var t=$("#vp-pid-search-input").val().toUpperCase();n.listener.handleOption("setPidRoot",{pid:t})}),this.right=!0,this.left=!0,this.width=0,this.bodyWrapper=$(".body-wrapper");var n=this;$("#right-toggle").click(function(){n.handleRightClick(),n.listener.handleOption("sidebar-resize",{transitionTime:500})}),$("#left-toggle").click(function(){n.handleLeftClick(),n.listener.handleOption("sidebar-resize",{transitionTime:500})}),this.windowResize(),this.width<=t.THRESHOLD_WIDTH&&(this.right=!1,this.left=!0,this.updateSidebars(),this.windowResize())},t.prototype.setBoxStyleButton=function(t){for(var e="",n=0;n<this.boxOptions.length;n++){var r=this.boxOptions[n];if(r.name===t){e=r.text;break}}if(e){var i=$("#vp-box-selection"),s=$("<div>").text(e).html();i.find(".btn-select").html(s+' <span class="caret"></span>')}},t.prototype.handleRightClick=function(){this.right=!this.right,this.right&&this.left&&this.width<=t.THRESHOLD_WIDTH&&(this.left=!1),this.updateSidebars()},t.prototype.handleLeftClick=function(){this.left=!this.left,this.right&&this.left&&this.width<=t.THRESHOLD_WIDTH&&(this.right=!1),this.updateSidebars()},t.prototype.updateSidebars=function(){this.right?this.bodyWrapper.addClass("right"):this.bodyWrapper.removeClass("right"),this.left?this.bodyWrapper.addClass("left"):this.bodyWrapper.removeClass("left")},t.prototype.windowResize=function(){var t=this.width;this.width=this.bodyWrapper.width(),this.width<=768&&t>768&&this.right&&this.left&&(this.right=!1,this.updateSidebars())},t.prototype.handleOptionSetting=function(t,e){if("resize"===t&&this.windowResize(),"setSettings"===t){var n=e.settings;n.initBoxStyle&&this.setBoxStyleButton(n.initBoxStyle)}},t.prototype.setListener=function(t){this.listener=t},t.THRESHOLD_WIDTH=768,t}(),P=function(){function t(t,e){this.controller=t;var n=e.initBoxStyle||"compactSimpleNameBox";this.dynDescSpacer=new DynDescSpacer,this.dimensionBoxStyler=new DimensionBoxStyler,this.pathStyler=new PathStyler,this.extrasStyler=new ExtrasBoxStyler,this.stylingPipeline=[],this.stylingPipeline.push(this.dynDescSpacer),this.stylingPipeline.push(this.dimensionBoxStyler),this.stylingPipeline.push(this.pathStyler),this.stylingPipeline.push(this.extrasStyler),this.dynDescSpacer.setRepresentationHeight(ViewFactoryFacade.getHeight(n)),this.dynDescSpacer.setRepresentationWidth(ViewFactoryFacade.getWidth(n)),this.dimensionBoxStyler.setType(n),this.dynDescSpacer.setViewWidth(1e3),this.dynDescSpacer.setViewHeight(500),this.inTransition=!1,this.prevBoxStyle=n,this.nextBoxStyle=null,this.transitionPercent=0,this.prevWidth=ViewFactoryFacade.getWidth(n),this.prevHeigth=ViewFactoryFacade.getHeight(n)}return t.prototype.handle=function(t){if(t.type){if("translate"===t.type){var e=t.before,n=t.after;return this.dynDescSpacer.translate(e,n),this.dynDescSpacer.getAnchor()}if("getBoxStyle"===t.type)return this.prevBoxStyle;if("getRootPt"===t.type){var r=this.dynDescSpacer.getRootPt();return null===r?null:this.dynDescSpacer.treeToWorld(r)}if("setRootToPoint"===t.type){var r=t.pt;return this.dynDescSpacer.setIdToPoint(this.getRootId(),r),this.dynDescSpacer.getAnchor()}if("setIdToPoint"===t.type){var r=t.pt,i=t.id;return this.dynDescSpacer.setIdToPoint(i,r),this.dynDescSpacer.getAnchor()}if("getClosestId"===t.type){var i=this.dynDescSpacer.getClosestId(t.pt);return i}if("setHighlightPath"===t.type)this.pathStyler.setHighlights(t.path);else if("resize"===t.type)this.dynDescSpacer.setViewHeight(t.height),this.dynDescSpacer.setViewWidth(t.width);else if("changeBoxStyle"===t.type){if(this.inTransition)return;this.dynDescSpacer.setRepresentationHeight(ViewFactoryFacade.getHeight(t.boxStyle)),this.dynDescSpacer.setRepresentationWidth(ViewFactoryFacade.getWidth(t.boxStyle)),this.dimensionBoxStyler.setType(t.boxStyle)}else if("startTransition"===t.type)this.transitionStart(t.boxStyle);else if("continueTransition"===t.type)this.transitionPercent=t.transitionPercent;else if("endTransition"===t.type)this.transitionEnd();else if("setSpouseView"===t.type){var s=this.stylingPipeline.indexOf(this.extrasStyler);t.enabled?-1===s&&this.stylingPipeline.push(this.extrasStyler):s>-1&&this.stylingPipeline.splice(s,1)}}},t.prototype.handleUpdate=function(t,e){this.tree=t,this.updates=e;var n=this.runPipeline();this.controller.refresh(n)},t.prototype.runPipeline=function(){if(!this.tree)return null;this.transitionContinue();for(var t=this.tree.asBoxMap(),e=0;e<this.stylingPipeline.length;e++)t=this.stylingPipeline[e].applyStyle(t,this.tree,this.updates);return this.updates=[],t},t.prototype.transitionStart=function(t){this.inTransition=!0,this.nextBoxStyle=t,this.nextWidth=ViewFactoryFacade.getWidth(t),this.nextHeight=ViewFactoryFacade.getHeight(t),this.transitionPercent=0},t.prototype.getRootId=function(){return this.tree&&this.tree.getRoot()?this.tree.getRoot().getId():null},t.prototype.transitionContinue=function(){if(this.inTransition){var t=Math.min(this.transitionPercent,1),e=(1-t)*this.prevWidth+t*this.nextWidth,n=(1-t)*this.prevHeigth+t*this.nextHeight;this.dynDescSpacer.setRepresentationWidth(e),this.dynDescSpacer.setRepresentationHeight(n),this.dimensionBoxStyler.setWidth(e),this.dimensionBoxStyler.setHeight(n)}},t.prototype.transitionEnd=function(){this.inTransition=!1,this.prevBoxStyle=this.nextBoxStyle,this.prevWidth=this.nextWidth,this.prevHeigth=this.nextHeight,this.dynDescSpacer.setRepresentationWidth(this.prevWidth),this.dynDescSpacer.setRepresentationHeight(this.prevHeigth),this.dimensionBoxStyler.setType(this.prevBoxStyle)},t}(),BoxMap=function(){function t(t){this.rootId=t,this.map={}}return t.prototype.getRoot=function(){return this.rootId},t.prototype.setRoot=function(t){this.rootId=t},t.prototype.getId=function(t){return this.map[t]},t.prototype.setId=function(t,e){this.map[t]=e},t.prototype.removeId=function(t){delete this.map[t]},t.prototype.copy=function(){var e=new t(this.rootId);for(var n in this.map)this.map.hasOwnProperty(n)&&e.setId(n,this.map[n].copy());return e},t}(),ModalManager=function(){function t(){this.personModal=$("#vp-person-modal")}return t.prototype.showModal=function(t,e){this.lastSettings={},this.lastSettings.box=t,this.lastSettings.pt=e;var n=t.getNode(),r=this,i=this.personModal.find(".modal-back").hide();i.hide(),i.off();var s=this.personModal.find(".modal-body").first();if(s.empty(),n.hasAttr("name")&&this.personModal.find(".modal-title").text(n.getAttr("name")),n.hasAttr("profilePicturePromise")){var o=$('<img class="img-rounded">');s.append(o),n.getAttr("profilePicturePromise").then(function(t){t&&(o.css("max-height","100px"),o.css("max-width","100px"),o.attr("src",t))})}if(n.hasAttr("downloadId")&&this.createRow("Id:",s,document.createTextNode(n.getAttr("downloadId"))),n.hasAttr("gender")&&this.createRow("Gender:",s,document.createTextNode(n.getAttr("gender"))),n.hasAttr("lifespan")&&this.createRow("Lifespan:",s,document.createTextNode(n.getAttr("lifespan"))),n.hasAttr("birthdate")&&this.createRow("Date of Birth:",s,document.createTextNode(n.getAttr("birthdate"))),n.hasAttr("birthplace")&&this.createRow("Place of Birth:",s,document.createTextNode(n.getAttr("birthplace"))),n.hasAttr("deathdate")&&this.createRow("Date of Death:",s,document.createTextNode(n.getAttr("deathdate"))),n.hasAttr("deathplace")&&this.createRow("Place of Death:",s,document.createTextNode(n.getAttr("deathplace"))),n.hasAttr("url")){var a=$('<a target="_blank" href="#">See on Family Search</a></p>');this.createRow("Link:",s,a),a.click(function(t){t.preventDefault();var e=n.getAttr("url");e=FamilySearch.getRedirectUrl({uri:e}),window.open(e,"_blank")})}if(n.hasAttr("spouses")&&n.getAttr("spouses").length>0){var h=n.getAttr("spouses");this.addSpouses(h,s)}else if(n.hasAttr("ancestrySpouses")&&n.getAttr("ancestrySpouses").length>0){var h=n.getAttr("ancestrySpouses");this.addSpouses(h,s)}else if(n.hasAttr("personPromise")){var r=this;n.getAttr("personPromise")().then(function(t){var e=t.getSpouses();r.addSpouses(e,s)})}var u=$("#modal-set-as-root");u.off(),u.click(function(){r.listener.handleOption("setPidRoot",{pid:n.getAttr("downloadId")}),r.personModal.modal("hide")});var c=$("#modal-delete-id");c.off(),c.click(function(){var i=n.getId().split(":")[0];n.hasAttr("downloadId")&&(i=n.getAttr("downloadId")),r.listener.handleOption("deleteId",{box:t,id:i,pt:e}),r.personModal.modal("hide")}),this.personModal.modal("show")},t.prototype.handleOptionSetting=function(t,e){"openModal"===t&&this.showModal(e.box,e.pt)},t.prototype.setListener=function(t){this.listener=t},t.prototype.resetLastSettings=function(){this.lastSettings&&this.showModal(this.lastSettings.box,this.lastSettings.pt)},t.prototype.addSpouses=function(t,e){for(var n=this,r=0,i=0;i<t.length;i++){var s=t[i];if(s.person){var o="";0===r&&(r++,o="Spouse:");var a=$('<a href="#"></a>'),h=s.person.$getDisplayName();h||(h="Name missing on FamilySearch"),a.text(h),this.createRow(o,e,a),function(t){a.click(function(e){e.preventDefault(),n.createSpouseArea(t.person)})}(s)}}},t.prototype.createSpouseArea=function(t){var e=this,n=this.personModal.find(".modal-body").first();n.empty();var r=new FSDescNode("modal-node",t,[],"no-parent-id",{},[]),i=this.personModal.find(".modal-back");if(i.show(),i.click(function(){e.resetLastSettings()}),r.hasAttr("name")&&this.personModal.find(".modal-title").text(r.getAttr("name")),r.hasAttr("profilePicturePromise")){var s=$('<img class="img-rounded">');n.append(s),r.getAttr("profilePicturePromise").then(function(t){t&&(s.css("max-height","100px"),s.css("max-width","100px"),s.attr("src",t))})}if(r.hasAttr("downloadId")&&this.createRow("Id:",n,document.createTextNode(r.getAttr("downloadId"))),r.hasAttr("gender")&&this.createRow("Gender:",n,document.createTextNode(r.getAttr("gender"))),r.hasAttr("lifespan")&&this.createRow("Lifespan:",n,document.createTextNode(r.getAttr("lifespan"))),r.hasAttr("birthdate")&&this.createRow("Date of Birth:",n,document.createTextNode(r.getAttr("birthdate"))),r.hasAttr("birthplace")&&this.createRow("Place of Birth:",n,document.createTextNode(r.getAttr("birthplace"))),r.hasAttr("deathdate")&&this.createRow("Date of Death:",n,document.createTextNode(r.getAttr("deathdate"))),r.hasAttr("deathplace")&&this.createRow("Place of Death:",n,document.createTextNode(r.getAttr("deathplace"))),r.hasAttr("url")){var o=$('<a target="_blank" href="#">See on Family Search</a></p>');this.createRow("Link:",n,o),o.click(function(t){t.preventDefault();var e=r.getAttr("url");e=FamilySearch.getRedirectUrl({uri:e}),window.open(e,"_blank")})}var a=$("#modal-set-as-root");a.off(),a.click(function(){e.listener.handleOption("setPidRoot",{pid:r.getAttr("downloadId")}),e.personModal.modal("hide")})},t.prototype.createRow=function(t,e,n){var r=$('<div class="row"><div class="col-xs-3"><p class="text-right"></p></div><div class="col-xs-9"><p class="text-left"></p></div></div>');r.find(".text-right").text(t),r.find(".text-left").append(n),e.append(r)},t}(),DimensionBoxStyler=function(){function t(){}return t.prototype.applyStyle=function(t,e,n){var r=[];for(r.push(t.getRoot());r.length>0;){var i=t.getId(r.shift());if(i){var s=i.getNode(),o=s.getBranchIds();i.setType(this.type),i.setHeight(this.height),i.setWidth(this.width);for(var a=0;a<o.length;a++){var h=t.getId(o[a]);h&&r.push(o[a])}}}return t},t.prototype.setType=function(t){this.type=t,this.height=ViewFactoryFacade.getHeight(this.type),this.width=ViewFactoryFacade.getWidth(this.type)},t.prototype.setWidth=function(t){this.width=t},t.prototype.setHeight=function(t){this.height=t},t}(),HistoryStorageManager=function(){function t(){}return t.getSingleton=function(){return t.handler||(t.handler=new t),this.handler},t.prototype.getHistory=function(){if(!this.userId)return[];if("undefined"!=typeof Storage){var t=localStorage.getItem(this.userId+"-history");return t?JSON.parse(t):[]}return[]},t.prototype.addToHistory=function(t,e){if(this.userId){for(var n=this.getHistory(),r=-1,i=0;i<n.length;i++){var s=n[i];s.id===e&&(r=i)}-1!==r&&n.splice(r,1),n.push({displayText:t,id:e}),"undefined"!=typeof Storage&&localStorage.setItem(this.userId+"-history",JSON.stringify(n))}},t.prototype.getSettings=function(){if(this.userId){if("undefined"!=typeof Storage){var t=localStorage.getItem(this.userId+"-settings");return t?JSON.parse(t):{}}return{}}},t.prototype.setSettings=function(t){this.userId&&"undefined"!=typeof Storage&&localStorage.setItem(this.userId+"-settings",JSON.stringify(t))},t.prototype.setSetting=function(t,e){if(this.userId){var n=this.getSettings();n[t]=e,this.setSettings(n)}},t.prototype.clearHistory=function(){"undefined"!=typeof Storage&&localStorage.removeItem(this.userId+"-history")},t.prototype.getUserId=function(){return this.userId},t.prototype.setUserId=function(t){this.userId=t},t}();!function(t,e,n,r){"use strict";function i(t,e,n){return setTimeout(c(t,n),e)}function s(t,e,n){return Array.isArray(t)?(o(t,n[e],n),!0):!1}function o(t,e,n){var i;if(t)if(t.forEach)t.forEach(e,n);else if(t.length!==r)for(i=0;i<t.length;)e.call(n,t[i],i,t),i++;else for(i in t)t.hasOwnProperty(i)&&e.call(n,t[i],i,t)}function a(t,e,n){for(var i=Object.keys(e),s=0;s<i.length;)(!n||n&&t[i[s]]===r)&&(t[i[s]]=e[i[s]]),s++;return t}function h(t,e){return a(t,e,!0)}function u(t,e,n){var r,i=e.prototype;r=t.prototype=Object.create(i),r.constructor=t,r._super=i,n&&a(r,n)}function c(t,e){return function(){return t.apply(e,arguments)}}function l(t,e){return typeof t==ht?t.apply(e?e[0]||r:r,e):t}function d(t,e){return t===r?e:t}function p(t,e,n){o(y(e),function(e){t.addEventListener(e,n,!1)})}function g(t,e,n){o(y(e),function(e){t.removeEventListener(e,n,!1)})}function f(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function m(t,e){return t.indexOf(e)>-1}function y(t){return t.trim().split(/\s+/g)}function v(t,e,n){if(t.indexOf&&!n)return t.indexOf(e);for(var r=0;r<t.length;){if(n&&t[r][n]==e||!n&&t[r]===e)return r;r++}return-1}function b(t){return Array.prototype.slice.call(t,0)}function w(t,e,n){for(var r=[],i=[],s=0;s<t.length;){var o=e?t[s][e]:t[s];v(i,o)<0&&r.push(t[s]),i[s]=o,s++}return n&&(r=e?r.sort(function(t,n){return t[e]>n[e]}):r.sort()),r}function A(t,e){for(var n,i,s=e[0].toUpperCase()+e.slice(1),o=0;o<ot.length;){if(n=ot[o],i=n?n+s:e,i in t)return i;o++}return r}function P(){return dt++}function x(t){var e=t.ownerDocument;return e.defaultView||e.parentWindow}function C(t,e){var n=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){l(t.options.enable,[t])&&n.handler(e)},this.init()}function I(t){var e,n=t.options.inputClass;return new(e=n?n:ft?O:mt?W:gt?j:U)(t,S)}function S(t,e,n){var r=n.pointers.length,i=n.changedPointers.length,s=e&Pt&&r-i===0,o=e&(Ct|It)&&r-i===0;n.isFirst=!!s,n.isFinal=!!o,s&&(t.session={}),n.eventType=e,T(t,n),t.emit("hammer.input",n),t.recognize(n),t.session.prevInput=n}function T(t,e){var n=t.session,r=e.pointers,i=r.length;n.firstInput||(n.firstInput=R(e)),i>1&&!n.firstMultiple?n.firstMultiple=R(e):1===i&&(n.firstMultiple=!1);var s=n.firstInput,o=n.firstMultiple,a=o?o.center:s.center,h=e.center=$(r);e.timeStamp=lt(),e.deltaTime=e.timeStamp-s.timeStamp,e.angle=B(a,h),e.distance=F(a,h),N(n,e),e.offsetDirection=E(e.deltaX,e.deltaY),e.scale=o?H(o.pointers,r):1,e.rotation=o?k(o.pointers,r):0,M(n,e);var u=t.element;f(e.srcEvent.target,u)&&(u=e.srcEvent.target),e.target=u}function N(t,e){var n=e.center,r=t.offsetDelta||{},i=t.prevDelta||{},s=t.prevInput||{};(e.eventType===Pt||s.eventType===Ct)&&(i=t.prevDelta={x:s.deltaX||0,y:s.deltaY||0},r=t.offsetDelta={x:n.x,y:n.y}),e.deltaX=i.x+(n.x-r.x),e.deltaY=i.y+(n.y-r.y)}function M(t,e){var n,i,s,o,a=t.lastInterval||e,h=e.timeStamp-a.timeStamp;if(e.eventType!=It&&(h>At||a.velocity===r)){var u=a.deltaX-e.deltaX,c=a.deltaY-e.deltaY,l=D(h,u,c);i=l.x,s=l.y,n=ct(l.x)>ct(l.y)?l.x:l.y,o=E(u,c),t.lastInterval=e}else n=a.velocity,i=a.velocityX,s=a.velocityY,o=a.direction;e.velocity=n,e.velocityX=i,e.velocityY=s,e.direction=o}function R(t){for(var e=[],n=0;n<t.pointers.length;)e[n]={clientX:ut(t.pointers[n].clientX),clientY:ut(t.pointers[n].clientY)},n++;return{timeStamp:lt(),pointers:e,center:$(e),deltaX:t.deltaX,deltaY:t.deltaY}}function $(t){var e=t.length;if(1===e)return{x:ut(t[0].clientX),y:ut(t[0].clientY)};for(var n=0,r=0,i=0;e>i;)n+=t[i].clientX,
r+=t[i].clientY,i++;return{x:ut(n/e),y:ut(r/e)}}function D(t,e,n){return{x:e/t||0,y:n/t||0}}function E(t,e){return t===e?St:ct(t)>=ct(e)?t>0?Tt:Nt:e>0?Mt:Rt}function F(t,e,n){n||(n=Ft);var r=e[n[0]]-t[n[0]],i=e[n[1]]-t[n[1]];return Math.sqrt(r*r+i*i)}function B(t,e,n){n||(n=Ft);var r=e[n[0]]-t[n[0]],i=e[n[1]]-t[n[1]];return 180*Math.atan2(i,r)/Math.PI}function k(t,e){return B(e[1],e[0],Bt)-B(t[1],t[0],Bt)}function H(t,e){return F(e[0],e[1],Bt)/F(t[0],t[1],Bt)}function U(){this.evEl=Ht,this.evWin=Ut,this.allow=!0,this.pressed=!1,C.apply(this,arguments)}function O(){this.evEl=Yt,this.evWin=jt,C.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function W(){this.evTarget=Lt,this.targetIds={},C.apply(this,arguments)}function Y(t,e){var n=b(t.touches),r=this.targetIds;if(e&(Pt|xt)&&1===n.length)return r[n[0].identifier]=!0,[n,n];var i,s=b(t.targetTouches),o=b(t.changedTouches),a=[];if(e===Pt)for(i=0;i<s.length;)r[s[i].identifier]=!0,i++;for(i=0;i<o.length;)r[o[i].identifier]&&a.push(o[i]),e&(Ct|It)&&delete r[o[i].identifier],i++;return a.length?[w(s.concat(a),"identifier",!0),a]:void 0}function j(){C.apply(this,arguments);var t=c(this.handler,this);this.touch=new W(this.manager,t),this.mouse=new U(this.manager,t)}function q(t,e){this.manager=t,this.set(e)}function L(t){if(m(t,Qt))return Qt;var e=m(t,Zt),n=m(t,Jt);return e&&n?Zt+" "+Jt:e||n?e?Zt:Jt:m(t,Gt)?Gt:zt}function X(t){this.id=P(),this.manager=null,this.options=h(t||{},this.defaults),this.options.enable=d(this.options.enable,!0),this.state=Kt,this.simultaneous={},this.requireFail=[]}function _(t){return t&ie?"cancel":t&ne?"end":t&ee?"move":t&te?"start":""}function V(t){return t==Rt?"down":t==Mt?"up":t==Tt?"left":t==Nt?"right":""}function z(t,e){var n=e.manager;return n?n.get(t):t}function G(){X.apply(this,arguments)}function Q(){G.apply(this,arguments),this.pX=null,this.pY=null}function Z(){G.apply(this,arguments)}function J(){X.apply(this,arguments),this._timer=null,this._input=null}function K(){G.apply(this,arguments)}function tt(){G.apply(this,arguments)}function et(){X.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function nt(t,e){return e=e||{},e.recognizers=d(e.recognizers,nt.defaults.preset),new rt(t,e)}function rt(t,e){e=e||{},this.options=h(e,nt.defaults),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.element=t,this.input=I(this),this.touchAction=new q(this,this.options.touchAction),it(this,!0),o(e.recognizers,function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])},this)}function it(t,e){var n=t.element;o(t.options.cssProps,function(t,r){n.style[A(n.style,r)]=e?t:""})}function st(t,n){var r=e.createEvent("Event");r.initEvent(t,!0,!0),r.gesture=n,n.target.dispatchEvent(r)}var ot=["","webkit","moz","MS","ms","o"],at=e.createElement("div"),ht="function",ut=Math.round,ct=Math.abs,lt=Date.now,dt=1,pt=/mobile|tablet|ip(ad|hone|od)|android/i,gt="ontouchstart"in t,ft=A(t,"PointerEvent")!==r,mt=gt&&pt.test(navigator.userAgent),yt="touch",vt="pen",bt="mouse",wt="kinect",At=25,Pt=1,xt=2,Ct=4,It=8,St=1,Tt=2,Nt=4,Mt=8,Rt=16,$t=Tt|Nt,Dt=Mt|Rt,Et=$t|Dt,Ft=["x","y"],Bt=["clientX","clientY"];C.prototype={handler:function(){},init:function(){this.evEl&&p(this.element,this.evEl,this.domHandler),this.evTarget&&p(this.target,this.evTarget,this.domHandler),this.evWin&&p(x(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&g(this.element,this.evEl,this.domHandler),this.evTarget&&g(this.target,this.evTarget,this.domHandler),this.evWin&&g(x(this.element),this.evWin,this.domHandler)}};var kt={mousedown:Pt,mousemove:xt,mouseup:Ct},Ht="mousedown",Ut="mousemove mouseup";u(U,C,{handler:function(t){var e=kt[t.type];e&Pt&&0===t.button&&(this.pressed=!0),e&xt&&1!==t.which&&(e=Ct),this.pressed&&this.allow&&(e&Ct&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:bt,srcEvent:t}))}});var Ot={pointerdown:Pt,pointermove:xt,pointerup:Ct,pointercancel:It,pointerout:It},Wt={2:yt,3:vt,4:bt,5:wt},Yt="pointerdown",jt="pointermove pointerup pointercancel";t.MSPointerEvent&&(Yt="MSPointerDown",jt="MSPointerMove MSPointerUp MSPointerCancel"),u(O,C,{handler:function(t){var e=this.store,n=!1,r=t.type.toLowerCase().replace("ms",""),i=Ot[r],s=Wt[t.pointerType]||t.pointerType,o=s==yt;i&Pt&&(0===t.button||o)?e.push(t):i&(Ct|It)&&(n=!0);var a=v(e,t.pointerId,"pointerId");0>a||(e[a]=t,this.callback(this.manager,i,{pointers:e,changedPointers:[t],pointerType:s,srcEvent:t}),n&&e.splice(a,1))}});var qt={touchstart:Pt,touchmove:xt,touchend:Ct,touchcancel:It},Lt="touchstart touchmove touchend touchcancel";u(W,C,{handler:function(t){var e=qt[t.type],n=Y.call(this,t,e);n&&this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:yt,srcEvent:t})}}),u(j,C,{handler:function(t,e,n){var r=n.pointerType==yt,i=n.pointerType==bt;if(r)this.mouse.allow=!1;else if(i&&!this.mouse.allow)return;e&(Ct|It)&&(this.mouse.allow=!0),this.callback(t,e,n)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Xt=A(at.style,"touchAction"),_t=Xt!==r,Vt="compute",zt="auto",Gt="manipulation",Qt="none",Zt="pan-x",Jt="pan-y";q.prototype={set:function(t){t==Vt&&(t=this.compute()),_t&&(this.manager.element.style[Xt]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return o(this.manager.recognizers,function(e){l(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))}),L(t.join(" "))},preventDefaults:function(t){if(!_t){var e=t.srcEvent,n=t.offsetDirection;if(this.manager.session.prevented)return void e.preventDefault();var r=this.actions,i=m(r,Qt),s=m(r,Jt),o=m(r,Zt);return i||s&&n&$t||o&&n&Dt?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var Kt=1,te=2,ee=4,ne=8,re=ne,ie=16,se=32;X.prototype={defaults:{},set:function(t){return a(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(s(t,"recognizeWith",this))return this;var e=this.simultaneous;return t=z(t,this),e[t.id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return s(t,"dropRecognizeWith",this)?this:(t=z(t,this),delete this.simultaneous[t.id],this)},requireFailure:function(t){if(s(t,"requireFailure",this))return this;var e=this.requireFail;return t=z(t,this),-1===v(e,t)&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(s(t,"dropRequireFailure",this))return this;t=z(t,this);var e=v(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){function e(e){n.manager.emit(n.options.event+(e?_(r):""),t)}var n=this,r=this.state;ne>r&&e(!0),e(),r>=ne&&e(!0)},tryEmit:function(t){return this.canEmit()?this.emit(t):void(this.state=se)},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(se|Kt)))return!1;t++}return!0},recognize:function(t){var e=a({},t);return l(this.options.enable,[this,e])?(this.state&(re|ie|se)&&(this.state=Kt),this.state=this.process(e),void(this.state&(te|ee|ne|ie)&&this.tryEmit(e))):(this.reset(),void(this.state=se))},process:function(){},getTouchAction:function(){},reset:function(){}},u(G,X,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,n=t.eventType,r=e&(te|ee),i=this.attrTest(t);return r&&(n&It||!i)?e|ie:r||i?n&Ct?e|ne:e&te?e|ee:te:se}}),u(Q,G,{defaults:{event:"pan",threshold:10,pointers:1,direction:Et},getTouchAction:function(){var t=this.options.direction,e=[];return t&$t&&e.push(Jt),t&Dt&&e.push(Zt),e},directionTest:function(t){var e=this.options,n=!0,r=t.distance,i=t.direction,s=t.deltaX,o=t.deltaY;return i&e.direction||(e.direction&$t?(i=0===s?St:0>s?Tt:Nt,n=s!=this.pX,r=Math.abs(t.deltaX)):(i=0===o?St:0>o?Mt:Rt,n=o!=this.pY,r=Math.abs(t.deltaY))),t.direction=i,n&&r>e.threshold&&i&e.direction},attrTest:function(t){return G.prototype.attrTest.call(this,t)&&(this.state&te||!(this.state&te)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=V(t.direction);e&&this.manager.emit(this.options.event+e,t),this._super.emit.call(this,t)}}),u(Z,G,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Qt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&te)},emit:function(t){if(this._super.emit.call(this,t),1!==t.scale){var e=t.scale<1?"in":"out";this.manager.emit(this.options.event+e,t)}}}),u(J,X,{defaults:{event:"press",pointers:1,time:500,threshold:5},getTouchAction:function(){return[zt]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,r=t.distance<e.threshold,s=t.deltaTime>e.time;if(this._input=t,!r||!n||t.eventType&(Ct|It)&&!s)this.reset();else if(t.eventType&Pt)this.reset(),this._timer=i(function(){this.state=re,this.tryEmit()},e.time,this);else if(t.eventType&Ct)return re;return se},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===re&&(t&&t.eventType&Ct?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=lt(),this.manager.emit(this.options.event,this._input)))}}),u(K,G,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Qt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&te)}}),u(tt,G,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:$t|Dt,pointers:1},getTouchAction:function(){return Q.prototype.getTouchAction.call(this)},attrTest:function(t){var e,n=this.options.direction;return n&($t|Dt)?e=t.velocity:n&$t?e=t.velocityX:n&Dt&&(e=t.velocityY),this._super.attrTest.call(this,t)&&n&t.direction&&t.distance>this.options.threshold&&ct(e)>this.options.velocity&&t.eventType&Ct},emit:function(t){var e=V(t.direction);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),u(et,X,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return[Gt]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,r=t.distance<e.threshold,s=t.deltaTime<e.time;if(this.reset(),t.eventType&Pt&&0===this.count)return this.failTimeout();if(r&&s&&n){if(t.eventType!=Ct)return this.failTimeout();var o=this.pTime?t.timeStamp-this.pTime<e.interval:!0,a=!this.pCenter||F(this.pCenter,t.center)<e.posThreshold;this.pTime=t.timeStamp,this.pCenter=t.center,a&&o?this.count+=1:this.count=1,this._input=t;var h=this.count%e.taps;if(0===h)return this.hasRequireFailures()?(this._timer=i(function(){this.state=re,this.tryEmit()},e.interval,this),te):re}return se},failTimeout:function(){return this._timer=i(function(){this.state=se},this.options.interval,this),se},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==re&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),nt.VERSION="2.0.3",nt.defaults={domEvents:!1,touchAction:Vt,enable:!0,inputTarget:null,inputClass:null,preset:[[K,{enable:!1}],[Z,{enable:!1},["rotate"]],[tt,{direction:$t}],[Q,{direction:$t},["swipe"]],[et],[et,{event:"doubletap",taps:2},["tap"]],[J]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var oe=1,ae=2;rt.prototype={set:function(t){return a(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?ae:oe},recognize:function(t){var e=this.session;if(!e.stopped){this.touchAction.preventDefaults(t);var n,r=this.recognizers,i=e.curRecognizer;(!i||i&&i.state&re)&&(i=e.curRecognizer=null);for(var s=0;s<r.length;)n=r[s],e.stopped===ae||i&&n!=i&&!n.canRecognizeWith(i)?n.reset():n.recognize(t),!i&&n.state&(te|ee|ne)&&(i=e.curRecognizer=n),s++}},get:function(t){if(t instanceof X)return t;for(var e=this.recognizers,n=0;n<e.length;n++)if(e[n].options.event==t)return e[n];return null},add:function(t){if(s(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(s(t,"remove",this))return this;var e=this.recognizers;return t=this.get(t),e.splice(v(e,t),1),this.touchAction.update(),this},on:function(t,e){var n=this.handlers;return o(y(t),function(t){n[t]=n[t]||[],n[t].push(e)}),this},off:function(t,e){var n=this.handlers;return o(y(t),function(t){e?n[t].splice(v(n[t],e),1):delete n[t]}),this},emit:function(t,e){this.options.domEvents&&st(t,e);var n=this.handlers[t]&&this.handlers[t].slice();if(n&&n.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var r=0;r<n.length;)n[r](e),r++}},destroy:function(){this.element&&it(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},a(nt,{INPUT_START:Pt,INPUT_MOVE:xt,INPUT_END:Ct,INPUT_CANCEL:It,STATE_POSSIBLE:Kt,STATE_BEGAN:te,STATE_CHANGED:ee,STATE_ENDED:ne,STATE_RECOGNIZED:re,STATE_CANCELLED:ie,STATE_FAILED:se,DIRECTION_NONE:St,DIRECTION_LEFT:Tt,DIRECTION_RIGHT:Nt,DIRECTION_UP:Mt,DIRECTION_DOWN:Rt,DIRECTION_HORIZONTAL:$t,DIRECTION_VERTICAL:Dt,DIRECTION_ALL:Et,Manager:rt,Input:C,TouchAction:q,TouchInput:W,MouseInput:U,PointerEventInput:O,TouchMouseInput:j,Recognizer:X,AttrRecognizer:G,Tap:et,Pan:Q,Swipe:tt,Pinch:Z,Rotate:K,Press:J,on:p,off:g,each:o,merge:h,extend:a,inherit:u,bindFn:c,prefixed:A}),typeof define==ht&&define.amd?define(function(){return nt}):"undefined"!=typeof module&&module.exports?module.exports=nt:t[n]=nt}(window,document,"Hammer"),FamilySearch.init({app_key:"NQ3Q-PBD8-LL9N-RCLZ-MZCZ-X7P8-7SMX-RD6N",environment:"production",auth_callback:"http://localhost:8000/auth/login/return/",http_function:$.ajax,deferred_function:$.Deferred,save_access_token:!0,auto_expire:!0}),!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t:t(jQuery)}(function(t){function e(e){var o=e||window.event,a=h.call(arguments,1),u=0,l=0,d=0,p=0,g=0,f=0;if(e=t.event.fix(o),e.type="mousewheel","detail"in o&&(d=-1*o.detail),"wheelDelta"in o&&(d=o.wheelDelta),"wheelDeltaY"in o&&(d=o.wheelDeltaY),"wheelDeltaX"in o&&(l=-1*o.wheelDeltaX),"axis"in o&&o.axis===o.HORIZONTAL_AXIS&&(l=-1*d,d=0),u=0===d?l:d,"deltaY"in o&&(d=-1*o.deltaY,u=d),"deltaX"in o&&(l=o.deltaX,0===d&&(u=-1*l)),0!==d||0!==l){if(1===o.deltaMode){var m=t.data(this,"mousewheel-line-height");u*=m,d*=m,l*=m}else if(2===o.deltaMode){var y=t.data(this,"mousewheel-page-height");u*=y,d*=y,l*=y}if(p=Math.max(Math.abs(d),Math.abs(l)),(!s||s>p)&&(s=p,r(o,p)&&(s/=40)),r(o,p)&&(u/=40,l/=40,d/=40),u=Math[u>=1?"floor":"ceil"](u/s),l=Math[l>=1?"floor":"ceil"](l/s),d=Math[d>=1?"floor":"ceil"](d/s),c.settings.normalizeOffset&&this.getBoundingClientRect){var v=this.getBoundingClientRect();g=e.clientX-v.left,f=e.clientY-v.top}return e.deltaX=l,e.deltaY=d,e.deltaFactor=s,e.offsetX=g,e.offsetY=f,e.deltaMode=0,a.unshift(e,u,l,d),i&&clearTimeout(i),i=setTimeout(n,200),(t.event.dispatch||t.event.handle).apply(this,a)}}function n(){s=null}function r(t,e){return c.settings.adjustOldDeltas&&"mousewheel"===t.type&&e%120===0}var i,s,o=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],a="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],h=Array.prototype.slice;if(t.event.fixHooks)for(var u=o.length;u;)t.event.fixHooks[o[--u]]=t.event.mouseHooks;var c=t.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var n=a.length;n;)this.addEventListener(a[--n],e,!1);else this.onmousewheel=e;t.data(this,"mousewheel-line-height",c.getLineHeight(this)),t.data(this,"mousewheel-page-height",c.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var n=a.length;n;)this.removeEventListener(a[--n],e,!1);else this.onmousewheel=null;t.removeData(this,"mousewheel-line-height"),t.removeData(this,"mousewheel-page-height")},getLineHeight:function(e){var n=t(e),r=n["offsetParent"in t.fn?"offsetParent":"parent"]();return r.length||(r=t("body")),parseInt(r.css("fontSize"),10)||parseInt(n.css("fontSize"),10)||16},getPageHeight:function(e){return t(e).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};t.fn.extend({mousewheel:function(t){return t?this.bind("mousewheel",t):this.trigger("mousewheel")},unmousewheel:function(t){return this.unbind("mousewheel",t)}})}),function(){for(var t=0,e=["ms","moz","webkit","o"],n=0;n<e.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[e[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[n]+"CancelAnimationFrame"]||window[e[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,n){var r=(new Date).getTime(),i=Math.max(0,16-(r-t)),s=window.setTimeout(function(){e(r+i)},i);return t=r+i,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}(),SquareNode.prototype.getTopBorder=function(){return[{x1:this.x,x2:this.x+this.width,y:0}]},SquareNode.prototype.getBottomBorder=function(){return[{x1:this.x,x2:this.x+this.width,y:this.height}]},SquareNode.prototype.getParentBounds=function(){return{top:0,bottom:this.height}},SquareNode.prototype.getRectangles=function(t){return[{x:this.x,y:this.y+t,width:this.width,height:this.height,id:this.id}]},SquareNode.prototype.isSquare=function(){return!0},MultiNode.prototype.getTopBorder=function(){return this.top},MultiNode.prototype.getBottomBorder=function(){return this.bottom},MultiNode.prototype.getParentBounds=function(){return this.bounds},MultiNode.prototype.getRectangles=function(t){void 0===t&&(t=this.y);for(var e=[],n=[],r=0;r<this.children.length;r++)n=this.children[r].getRectangles(t+this.y),e=e.concat(n);if(this.parent){var i=this.parent.getRectangles(t+this.y);e=e.concat(i)}return e},MultiNode.prototype.isSquare=function(){return!1},MultiNode.generate=function(t,e,n){var r;if(1==e.length)return MultiNode.mergeOneChild(t,e[0]);var i=MultiNode.mergeChildrenTopToBottom(e.slice(n,e.length));return r=MultiNode.mergeChildrenBottomToTop(e.slice(0,n)),i.bounds=e[n].getParentBounds(),MultiNode.mergeParentWithChildren(t,r,i)},MultiNode.mergeOneChild=function(t,e){var n=MultiNode.compareBorders2(e.getBottomBorder(),t.getTopBorder(),Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY);if(n==Number.NEGATIVE_INFINITY){var r=(e.getParentBounds().bottom+e.getParentBounds().top)/2,i=r-t.height/2;mergedTop=MultiNode.mergeList(e.getTopBorder(),t.getTopBorder(),0,i,1),mergedBtm=MultiNode.mergeList(t.getBottomBorder(),e.getBottomBorder(),i,0,-1),t.y=i,e.y=0}else mergedTop=MultiNode.mergeList(e.getTopBorder(),t.getTopBorder(),0,n,1),mergedBtm=MultiNode.mergeList(t.getBottomBorder(),e.getBottomBorder(),n,0,-1),t.y=n,e.y=0;var s=new MultiNode({top:t.y,bottom:t.y+t.height},mergedTop,mergedBtm,[e]);return s.parent=t,s},MultiNode.mergeParentWithChildren=function(t,e,n,r){var i,s,o=MultiNode.compareBorders2(e.getBottomBorder(),t.getTopBorder(),Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY),a=MultiNode.compareBorders2(t.getBottomBorder(),n.getTopBorder(),Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY),h=MultiNode.compareBorders2(e.getBottomBorder(),n.getTopBorder(),e.getParentBounds().bottom,n.getParentBounds().top);if(o==Number.NEGATIVE_INFINITY)if(a==Number.NEGATIVE_INFINITY){var u=(h-(e.getParentBounds().bottom-n.getParentBounds().top),n.getParentBounds().top+h),c=e.getParentBounds().bottom,l=(u+c)/2-t.height/2;i=MultiNode.mergeList(e.getTopBorder(),t.getTopBorder(),0,l,1),s=MultiNode.mergeList(t.getBottomBorder(),e.getBottomBorder(),l,0,-1),i=MultiNode.mergeList(i,n.getTopBorder(),0,h,-1),s=MultiNode.mergeList(n.getBottomBorder(),s,h,0,1),t.y=l,e.y=0,n.y=h}else i=MultiNode.mergeList(t.getTopBorder(),n.getTopBorder(),0,a,1),s=MultiNode.mergeList(n.getBottomBorder(),t.getBottomBorder(),a,0,-1),i=MultiNode.mergeList(e.getTopBorder(),i,0,h-a,1),s=MultiNode.mergeList(s,e.getBottomBorder(),h-a,0,-1),t.y=h-a,e.y=0,n.y=h;else{var d=0,p=0;a!=Number.NEGATIVE_INFINITY&&(spare=o+a-h,spare>0?d=spare:p=-spare/2),a==Number.NEGATIVE_INFINITY&&(p=Math.max(o,h-t.height/2)-o),i=MultiNode.mergeList(e.getTopBorder(),t.getTopBorder(),0,o+p,1),s=MultiNode.mergeList(t.getBottomBorder(),e.getBottomBorder(),o+p,0,-1),i=MultiNode.mergeList(i,n.getTopBorder(),0,h+d,-1),s=MultiNode.mergeList(n.getBottomBorder(),s,h+d,0,1),t.y=o+p,e.y=0,n.y=h+d}var g=new MultiNode({top:t.y,bottom:t.y+t.height},i,s,[e,n]);return g.parent=t,g},MultiNode.mergeChildrenBottomToTop=function(t){var e=MultiNode.mergeChildrenTopToBottom(t),n=t[t.length-1].getParentBounds();return n.top+=t[t.length-1].y,n.bottom+=t[t.length-1].y,e.bounds=n,e},MultiNode.mergeChildrenTopToBottom=function(t){var e=t[0];e.y=0;var n=e.getTopBorder(),r=e.getBottomBorder();compareSum=0,compareSum2=0;for(var i=1;i<t.length;i++){var s=t[i],o=MultiNode.compareBorders2(r,s.getTopBorder(),e.getParentBounds().bottom+compareSum,s.getParentBounds().top);compareSum=o,s.y=compareSum,mergedTop=MultiNode.mergeList(n,s.getTopBorder(),0,compareSum,1),mergedBtm=MultiNode.mergeList(s.getBottomBorder(),r,compareSum,0,-1),e=s,n=mergedTop,r=mergedBtm}largestBtm=Number.NEGATIVE_INFINITY;for(var i=0;i<r.length;i++)r[i].y>largestBtm&&(largestBtm=r[i].y);smallestTop=Number.POSITIVE_INFINITY;for(var i=0;i<n.length;i++)n[i].y<smallestTop&&(smallestTop=n[i].y);var a=t[0].getParentBounds();return a.top+=t[0].y,a.bottom+=t[0].y,new MultiNode(a,n,r,t)},MultiNode.compareBorders2=function(t,e,n,r){var i,s=0,o=0;for(i=Number.NEGATIVE_INFINITY;s<t.length&&o<e.length;){var a=t[s],h=e[o];if(h.x1<a.x2&&h.x2>a.x1){var u=a.y-h.y;u>i&&(i=u)}a.x2<=h.x2&&s++,h.x2<=a.x2&&o++}return Math.max(i,n-r)},MultiNode.mergeList=function(t,e,n,r,i){for(var s=0;s<t.length;s++)t[s].y+=n;e.sort(function(t,e){return t.y==e.y?0:t.y>e.y?i:-i});for(var s=0;s<e.length;s++){var o=e[s];t=MultiNode.addLine(t,o.x1,o.x2,o.y+r)}return t},MultiNode.addLine=function(t,e,n,r){if(e>=n)return void console.log("invalid line");for(var i=!1,s=[],o=0;o<t.length;o++){var a=t[o];if(0>=n-e){i=!0;break}if(e<=a.x2&&n>=a.x1){if(e<a.x1&&s.push({x1:e,x2:a.x1,y:r}),!(n>a.x2)){i=!0;break}e=a.x2}}return!i&&n-e>0&&s.push({x1:e,x2:n,y:r}),s=s.concat(t),s.sort(function(t,e){return t.x1==e.x1?0:t.x1>e.x1?1:-1}),s},!function(t,e){"object"==typeof module&&"object"==typeof module.exports?module.exports=e():"function"==typeof define&&define.amd?define(e):t.FamilySearch=e()}(this,function(){function t(t,e,r){n[t]={deps:3===arguments.length?e:[],fn:3===arguments.length?r:e}}function e(t){var i=n[t],s=[],o=i.fn;if("function"==typeof o){for(var a=0,h=i.deps.length;h>a;a++){var u=i.deps[a],c=r[u];void 0===c&&(c=e(u),r[u]=c),s.push(c)}o=i.fn.apply(this,s)}return o}var n={},r={};return t("globals",{clientId:null,environment:null,httpWrapper:null,deferredWrapper:null,setTimeout:null,clearTimeout:null,redirectUri:null,autoSignin:!1,autoExpire:!1,accessToken:null,saveAccessToken:!1,logging:!1,accessTokenCookie:"FS_ACCESS_TOKEN",authCodePollDelay:50,defaultThrottleRetryAfter:500,maxHttpRequestRetries:2,maxAccessTokenInactivityTime:354e4,maxAccessTokenCreationTime:8634e4,apiServer:{sandbox:"https://sandbox.familysearch.org",staging:"https://stage.familysearch.org",beta:"https://beta.familysearch.org",production:"https://familysearch.org"},oauthServer:{sandbox:"https://sandbox.familysearch.org/cis-web/oauth2/v3",staging:"https://identbeta.familysearch.org/cis-web/oauth2/v3",beta:"https://identbeta.familysearch.org/cis-web/oauth2/v3",production:"https://ident.familysearch.org/cis-web/oauth2/v3"},authoritiesServer:{sandbox:"https://sandbox.familysearch.org",staging:"https://stage.familysearch.org",beta:"https://apibeta.familysearch.org",production:"https://api.familysearch.org"},discoveryUrl:"/.well-known/app-meta"}),t("helpers",["globals"],function(t){function e(t,e){for(var n in t)if(t.hasOwnProperty(n)&&e[n]!==t[n])return!1;return!0}function n(t,e){return a.isAbsoluteUrl(e)?e:t+("/"!==e.charAt(0)?"/":"")+e}function r(e,n,r){return r&&t.clearTimeout(r),t.setTimeout(function(){e()},n)}function i(t){u=r(a.eraseAccessToken,t,u)}function s(t){c=r(a.eraseAccessToken,t,c)}function o(){t.clearTimeout(u),u=null,t.clearTimeout(c),c=null}var a={};Object.create||(Object.create=function(){function t(){}return function(e){if(1!==arguments.length)throw new Error("Object.create implementation only accepts one parameter.");return t.prototype=e,new t}}()),"function"!=typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"==typeof"".__proto__?function(t){return t.__proto__}:function(t){return t.constructor.prototype}),a.isArray=function(t){return Array.isArray?Array.isArray(t):"[object Array]"==Object.prototype.toString.call(t)},a.isNumber=function(t){return"[object Number]"==Object.prototype.toString.call(t)},a.isNumeric=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},a.isString=function(t){return"[object String]"==Object.prototype.toString.call(t)},a.isFunction=function(t){return"function"!=typeof/./?"function"==typeof t:"[object Function]"==Object.prototype.toString.call(t)},a.isObject=function(t){return t===Object(t)},a.isUndefined=function(t){return void 0===t};var h=a.forEach=function(t,e,n){if(null!=t)if(Array.prototype.forEach&&t.forEach===Array.prototype.forEach)t.forEach(e,n);else if(t.length===+t.length){for(var r=0,i=t.length;i>r;r++)if(e.call(n,t[r],r,t)==={})return}else for(var s in t)if(t.hasOwnProperty(s)&&e.call(n,t[s],s,t)==={})return};a.keys=Object.keys||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e},a.filter=function(t,n,r){var i=[],s=a.isFunction(n);return h(t,function(t){(s?n.call(r,t):e(n,t))&&i.push(t)}),i},a.map=function(t,e,n){var r=[];return h(t,function(t,i,s){r.push(e.call(n,t,i,s))}),r},a.contains=function(t,e){if(null==t)return!1;if(t.indexOf&&t.indexOf===Array.prototype.indexOf)return-1!==t.indexOf(e);var n=!1;return h(t,function(t){t===e&&(n=!0)}),n},a.indexOf=function(t,e){if(Array.prototype.indexOf===t.indexOf)return t.indexOf(e);for(var n=0,r=t.length;r>n;n++)if(t[n]===e)return n;return-1},a.uniq=function(t){var e=[];return h(t,function(t){a.contains(e,t)||e.push(t)}),e},a.find=function(t,n,r){var i,s=a.isFunction(n);if(t)for(var o=0,h=t.length;h>o;o++){var u=t[o];if(s?n.call(r,u):e(n,u)){i=u;break}}return i},a.findIndex=function(t,n,r){var i=-1,s=a.isFunction(n);if(t)for(var o=0,h=t.length;h>o;o++){var u=t[o];if(s?n.call(r,u):e(n,u)){i=o;break}}return i},a.compose=function(){var t=arguments;return function(){for(var e=arguments,n=t.length-1;n>=0;n--)t[n]&&(e=[t[n].apply(this,e)]);return e[0]}},a.flatten=function(t){var e=[];return h(t,function(t){a.isArray(t)&&Array.prototype.push.apply(e,t)}),e},a.flatMap=a.compose(a.flatten,a.map),a.union=function(){return a.uniq(a.flatten(arguments))},a.findOrFirst=function(t,e){if(!a.isUndefined(t)){var n=a.find(t,e);return a.isUndefined(n)?t[0]:n}return void 0},a.extend=function(t){return t=t||{},h(Array.prototype.slice.call(arguments,1),function(e){e&&h(e,function(e,n){t[n]=e})}),t},a.appFieldRejector=function(t){return!(a.isString(t)&&"_"===t.charAt(0))},a.deletePropertiesPartial=function(t,e){for(var n in t)!t.hasOwnProperty(n)||e&&!e(n)||delete t[n]},a.clonePartial=function(t,e){var n;if(null==t||"object"!=typeof t)return t;if(t instanceof Date)return n=new Date,n.setTime(t.getTime()),n;if(t instanceof Array){n=[];for(var r=0,i=t.length;i>r;r++)(!e||e(r))&&n.push(a.clonePartial(t[r],e));return n}if(t instanceof Object){n=Object.create(Object.getPrototypeOf(t));for(var s in t)!t.hasOwnProperty(s)||e&&!e(s)||(n[s]=a.clonePartial(t[s],e));return n}throw new Error("Unable to copy obj")},a.partialRight=function(t){var e=Array.prototype.slice.call(arguments,1);return function(){return t.apply(this,Array.prototype.slice.call(arguments).concat(e))}},a.partial=function(t){var e=Array.prototype.slice.call(arguments,1);return function(){return t.apply(this,e.concat(Array.prototype.slice.call(arguments)))}},a.maybe=function(t){return null!=t?t:{}},a.objectExtender=function(t,e){return function(n){return n&&(e?h(e(n),function(e){a.extend(e,a.isFunction(t)?t(n,e):t)}):a.extend(n,a.isFunction(t)?t(n,n):t)),n}},a.constructorSetter=function(t,e,n){var r;return n?(r=a.constructorSetter(t,e),function(t){if(a.isObject(t)){var e=n(t);a.isArray(e)?a.forEach(e,function(t){r(t)}):a.isObject(e)&&r(e)}return t}):e?(r=a.constructorSetter(t),function(t){return a.isObject(t)&&(a.isArray(t[e])?t[e]=a.map(t[e],function(t){return r(t)}):a.isObject(t[e])&&(t[e]=r(t[e]))),t}):function(e){var n=Object.create(t.prototype);return a.extend(n,e),n}},a.wrapFunctions=function(t,e,n){return h(n,function(n){t[n]=function(){return e[n].apply(e,arguments)}}),t},a.extendHttpPromise=function(t,e){return a.wrapFunctions(t,e,["getResponseHeader","getAllResponseHeaders","getStatusCode","getRequest"])},a.chainHttpPromises=function(){var t=arguments[0],e={};return h(Array.prototype.slice.call(arguments,1),function(n){t=t.then(function(){var t=n.apply(null,arguments);return t&&t.then&&a.extendHttpPromise(e,t),t})}),a.extendHttpPromise(t,e),t},a.removeEmptyProperties=function(t){return h(t,function(e,n){(null==e||""===e)&&delete t[n]}),t},a.getLastUrlSegment=function(t){return t&&(t=t.replace(/^.*\//,"").replace(/\?.*$/,"")),t},a.getResponseEntityId=function(t,e){return e.getResponseHeader("X-ENTITY-ID")},a.getResponseLocation=function(t,e){return a.removeAccessToken(e.getResponseHeader("Location"))},a.handleRedirect=function(e,n){var r=t.deferredWrapper(),i=function(){200===e.getStatusCode()||204===e.getStatusCode()?r.resolve(n(e)):r.reject(arguments)};return e.then(i,i),a.extendHttpPromise(r.promise,e)},a.isAbsoluteUrl=function(t){return/^https?:\/\//.test(t)},a.isOAuthServerUrl=function(e){return 0===e.indexOf(t.oauthServer[t.environment])},a.getAPIServerUrl=function(e){return n(t.apiServer[t.environment],e)},a.isAuthoritiesServerUrl=function(t){return-1!==t.indexOf("/authorities/v1/")},a.getAuthoritiesServerUrl=function(e){return n(t.authoritiesServer[t.environment],e)},a.encodeQueryString=function(t){var e=[];return h(t,function(t,n){n=encodeURIComponent(n);var r;r=a.isArray(t)?a.map(t,function(t){return n+"="+encodeURIComponent(t)}).join("&"):null!=t?n+"="+encodeURIComponent(t):n,e.push(r)}),e.join("&")},a.appendQueryParameters=function(t,e){var n=a.encodeQueryString(e);return 0===n.length?t:t+(t.indexOf("?")>=0?"&":"?")+n},a.decodeQueryString=function(t){var e={};if(t){var n=t.indexOf("?");if(-1!==n){var r=t.substring(n+1).split("&");h(r,function(t){var n=t.split("=",2);if(n&&n[0]){var r=decodeURIComponent(n[0]),i=null!=n[1]?decodeURIComponent(n[1]):n[1];null==e[r]||a.isArray(e[r])||(e[r]=[e[r]]),null!=e[r]?e[r].push(i):e[r]=i}})}}return e},a.removeQueryString=function(t){if(t){var e=t.indexOf("?");-1!==e&&(t=t.substring(0,e))}return t},a.appendAccessToken=function(e){if(e){var n=a.decodeQueryString(e);e=a.removeQueryString(e),n.access_token=t.accessToken,e=a.appendQueryParameters(e,n)}return e},a.removeAccessToken=function(t){if(t){var e=a.decodeQueryString(t);t=a.removeQueryString(t),delete e.access_token,t=a.appendQueryParameters(t,e)}return t},a.populateUriTemplate=function(t,e){for(var n=t.split(/[{}]/),r=!1,i=0,s=n.length;s>i;i++)if(i%2===1){var o=e[n[i]];n[i]=r?encodeURIComponent(o):encodeURI(o)}else-1!==n[i].indexOf("?")&&(r=!0);return n.join("")},a.getUrlFromDiscoveryResource=function(t,e,n){var r="",i=t.links[e];if(i.href)r=a.removeAccessToken(i.href);else if(i.template){var s=i.template.replace(/{\?[^}]*}/,"");r=a.populateUriTemplate(s,n||{})}return r;
},a.attributionNeeded=function(t){return!(t.attribution&&t.attribution.changeMessage&&!t.attribution.contributor)},a.log=function(){t.debug&&console.log.apply(null,arguments)},a.nextTick=function(e){t.setTimeout(function(){e()},0)},a.refPromise=function(e){return e&&a.isFunction(e.then)?e:{then:function(n){var r=t.deferredWrapper();return a.nextTick(function(){r.resolve(n(e))}),r.promise}}},a.promiseAll=function(e){var n=t.deferredWrapper(),r=0,i=a.isArray(e)?[]:{};return h(e,function(t,e){r++,a.refPromise(t).then(function(t){i.hasOwnProperty(e)||(i[e]=t,--r||n.resolve(i))},function(){i.hasOwnProperty(e)||n.reject.apply(n,arguments)})}),0===r&&n.resolve(i),n.promise},a.createCookie=function(t,e,n){var r="",i="https"===document.location.protocol&&"localhost"!==document.location.hostname;if(n){var s=new Date;s.setTime(s.getTime()+86400*n),r="; expires="+s.toUTCString()}document.cookie=t+"="+e+r+"; path=/"+(i?"; secure":"")},a.readCookie=function(t){for(var e=t+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){for(var i=n[r];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(e))return i.substring(e.length,i.length)}return null},a.eraseCookie=function(t){a.createCookie(t,"",-1)};var u=null,c=null;return a.readAccessToken=function(){var e=(new Date).getTime(),n=a.readCookie(t.accessTokenCookie);if(n){var r=n.split("|",3);if(3===r.length){var o=e-parseInt(r[0],10),h=e-parseInt(r[1],10);o<t.maxAccessTokenInactivityTime&&h<t.maxAccessTokenCreationTime&&(t.accessToken=r[2],t.autoExpire&&(i(t.maxAccessTokenInactivityTime-o),s(t.maxAccessTokenCreationTime-h)))}}},a.setAccessToken=function(e){if(t.accessToken=e,t.autoExpire&&(i(t.maxAccessTokenInactivityTime),s(t.maxAccessTokenCreationTime)),t.saveAccessToken){var n=(new Date).getTime(),r=n+"|"+n+"|"+e;a.createCookie(t.accessTokenCookie,r,0)}},a.refreshAccessToken=function(){var e=(new Date).getTime();if(t.autoExpire&&i(t.maxAccessTokenInactivityTime),t.saveAccessToken){var n=a.readCookie(t.accessTokenCookie);if(n){var r=n.split("|",3);3===r.length&&(n=e+"|"+r[1]+"|"+r[2],a.createCookie(t.accessTokenCookie,n,0))}}},a.eraseAccessToken=function(e){t.accessToken=null,t.autoExpire&&o(),t.saveAccessToken&&a.eraseCookie(t.accessTokenCookie),t.expireCallback&&!e&&t.expireCallback()},a}),t("angularjs-wrappers",["globals","helpers"],function(t,e){var n={};return n.httpWrapper=function(n){return function(r,i,s,o,a){var h=e.extend({method:r,url:i,responseType:"json",data:o,transformRequest:function(t){return t}},a);h.headers=e.extend({},s,a.headers),"multipart/form-data"===h.headers["Content-Type"]&&(h.headers["Content-Type"]=void 0);var u=n(h),c=t.deferredWrapper(),l=c.promise,d=null,p=null;return u.then(function(t){d=t.status,p=t.headers,c.resolve(t.data)},function(t){d=t.status,p=t.headers,c.reject(t)}),l.getStatusCode=function(){return d},l.getResponseHeader=function(t){return p(t)},l.getAllResponseHeaders=function(){return p()},l.getRequest=function(){return h},l}},n.deferredWrapper=function(t){return function(){var e=t();return{promise:e.promise,resolve:e.resolve,reject:e.reject}}},n}),t("jquery-wrappers",["globals","helpers"],function(t,e){var n={};return n.httpWrapper=function(n){return function(r,i,s,o,a){a=e.extend({url:i,type:r,dataType:"json",data:o,processData:!1},a),a.headers=e.extend({},s,a.headers),"multipart/form-data"===a.headers["Content-Type"]&&(a.contentType=!1,delete a.headers["Content-Type"]);var h=n(a),u=t.deferredWrapper(),c=u.promise,l=null;return h.then(function(t,e,n){l=n.status,u.resolve(t)},function(t,e,n){l=t.status,l>=200&&299>=l&&!t.responseText?u.resolve(null):u.reject(t,e,n)}),e.wrapFunctions(c,h,["getResponseHeader","getAllResponseHeaders"]),c.getStatusCode=function(){return l},c.getRequest=function(){return a},c}},n.deferredWrapper=function(t){return function(){var e=t();return{promise:e.promise(),resolve:e.resolve,reject:e.reject}}},n}),t("plumbing",["globals","helpers"],function(t,e){function n(t){var e,r,i,s,o,a,h,u="";for(e in t)if(t.hasOwnProperty(e))if(r=t[e],r instanceof Array)for(h=0;h<r.length;++h)o=r[h],i=e+"["+h+"]",a={},a[i]=o,u+=n(a)+"&";else if(r instanceof Object)for(s in r)r.hasOwnProperty(s)&&(o=r[s],i=e+"["+s+"]",a={},a[i]=o,u+=n(a)+"&");else void 0!==r&&null!==r&&(u+=encodeURIComponent(e)+"="+encodeURIComponent(r)+"&");return u.length?u.substr(0,u.length-1):u}function r(t,r){if(t&&e.isObject(t)&&"[object FormData]"!==String(t)){if(t=e.clonePartial(t,function(t){return!(e.isString(t)&&("$"===t.charAt(0)||"_"===t.charAt(0)))}),"application/x-www-form-urlencoded"===r)return n(t);if(r&&-1!==r.indexOf("json"))return JSON.stringify(t)}return t}var i=0,s={};return s.getTotalProcessingTime=function(){return i},s.setTotalProcessingTime=function(t){i=t},s.getUrl=function(n,r,i){return t.discoveryPromise.then(function(t){var s="";return s=e.isAbsoluteUrl(r)?r:e.getUrlFromDiscoveryResource(t,n,i)})},s.get=function(t,n,r,i,o){return s.http("GET",e.appendQueryParameters(t,n),e.extend({Accept:"application/x-gedcomx-v1+json"},r),null,i,o)},s.post=function(t,n,r,i,o){return s.http("POST",t,e.extend({"Content-Type":"application/x-gedcomx-v1+json"},r),n,i,o)},s.put=function(t,n,r,i,o){return s.http("PUT",t,e.extend({"Content-Type":"application/x-gedcomx-v1+json"},r),n,i,o)},s.del=function(t,n,r,i){return s.http("DELETE",t,e.extend({"Content-Type":"application/x-gedcomx-v1+json"},n),null,r,i)},s.http=function(n,o,a,h,u,c,l){var d=t.deferredWrapper(),p=d.promise,g=e.getAPIServerUrl(o);a=a||{};var f;return f=t.accessToken||!t.autoSignin||e.isOAuthServerUrl(g)||o===t.discoveryUrl?e.refPromise(t.accessToken):t.getAccessToken(),f.then(function(){var f=e.isAuthoritiesServerUrl(g)?"sessionId":"access_token";if(t.accessToken&&-1===g.indexOf(f+"=")){var m={};m[f]=t.accessToken,g=e.appendQueryParameters(g,m)}null==l&&(l=t.maxHttpRequestRetries);var y=t.httpWrapper(n,g,a,r(h,a["Content-Type"]),u||{});e.extendHttpPromise(p,y),y.then(function(t){"GET"===n&&204===y.getStatusCode()&&(t={}),e.refreshAccessToken();var r=y.getResponseHeader("X-PROCESSING-TIME");r&&(i+=parseInt(r,10)),c&&(t=c(t,y)),d.resolve(t)},function(){var r=y.getStatusCode();if(e.log("http failure",r,l,y.getAllResponseHeaders()),401===r&&e.eraseAccessToken(),"GET"===n&&r>=500&&l>0||429===r){var i=y.getResponseHeader("Retry-After"),g=i?parseInt(i,10):t.defaultThrottleRetryAfter;t.setTimeout(function(){y=s.http(n,o,a,h,u,c,l-1),e.extendHttpPromise(p,y),y.then(function(t){d.resolve(t)},function(){d.reject.apply(d,arguments)})},g)}else d.reject.apply(d,arguments)})},function(){d.reject.apply(d,arguments)}),p},s}),t("init",["angularjs-wrappers","globals","helpers","jquery-wrappers","plumbing"],function(t,e,n,r,i){var s={};return s.init=function(s){if(s=s||{},!s.client_id&&!s.app_key)throw"client_id must be set";if(e.clientId=s.client_id||s.app_key,!s.environment)throw"environment must be set";if(e.environment=s.environment,!s.http_function&&!window.jQuery)throw"http must be set; e.g., jQuery.ajax";var o=s.http_function||window.jQuery.ajax;if(e.httpWrapper=o.defaults?t.httpWrapper(o):r.httpWrapper(o),!s.deferred_function&&!window.jQuery)throw"deferred_function must be set; e.g., jQuery.Deferred";var a=s.deferred_function||window.jQuery.Deferred,h=a();h.resolve(),e.deferredWrapper=n.isFunction(h.promise)?r.deferredWrapper(a):t.deferredWrapper(a);var u=s.timeout_function;if(u?(e.setTimeout=function(t,e){return u(t,e)},e.clearTimeout=function(t){u.cancel(t)}):(e.setTimeout=function(t,e){return setTimeout(t,e)},e.clearTimeout=function(t){clearTimeout(t)}),!s.redirect_uri&&!s.auth_callback)throw"redirect_uri must be set";e.redirectUri=s.redirect_uri||s.auth_callback,e.autoSignin=s.auto_signin,e.autoExpire=s.auto_expire,e.expireCallback=s.expire_callback,s.save_access_token&&(e.saveAccessToken=!0,n.readAccessToken()),s.access_token&&(e.accessToken=s.access_token),e.debug=s.debug,e.discoveryPromise=i.get(e.discoveryUrl),e.discoveryPromise.then(function(t){e.discoveryResource=t})},s}),t("authentication",["globals","helpers","plumbing"],function(t,e,n){function r(t,n){t.then(function(t){var r=t.access_token;r?(e.setAccessToken(r),n.resolve(r)):n.reject(t.error)},function(){n.reject.apply(n,arguments)})}function i(t,n){var r=e.isUndefined(window.screenX)?window.screenLeft:window.screenX,i=e.isUndefined(window.screenY)?window.screenTop:window.screenY,s=e.isUndefined(window.outerWidth)?document.documentElement.clientWidth:window.outerWidth,o=e.isUndefined(window.outerHeight)?document.documentElement.clientHeight-22:window.outerHeight,a=n.width||780,h=700|n.height;parseInt(r+(s-a)/2,10),parseInt(i+(o-h)/2.5,10);return window.open(e.appendQueryParameters(t,n),"_blank")}function s(t,n){var r=e.decodeQueryString(t);r.code?n.resolve(r.code):n.reject(r.error)}function o(e){var n=t.deferredWrapper();if(e){var r=setInterval(function(){try{e.location.hostname===window.location.hostname&&(s(e.location.href,n),clearInterval(r),e.close())}catch(t){}},t.authCodePollDelay);window.FamilySearchOauthReceiver=function(t){s(t,n),clearInterval(r)}}else n.reject("Popup blocked");return n.promise}var a={};return a.getAuthCode=function(){return n.getUrl("http://oauth.net/core/2.0/endpoint/authorize").then(function(e){var n=i(e,{response_type:"code",client_id:t.clientId,redirect_uri:t.redirectUri});return o(n)})},t.getAccessToken=a.getAccessToken=function(i){var s=t.deferredWrapper();if(t.accessToken)e.nextTick(function(){s.resolve(t.accessToken)});else{var o;o=i?e.refPromise(i):a.getAuthCode(),o.then(function(e){n.getUrl("http://oauth.net/core/2.0/endpoint/token").then(function(i){var o=n.post(i,{grant_type:"authorization_code",code:e,client_id:t.clientId},{"Content-Type":"application/x-www-form-urlencoded"});r(o,s)})},function(){s.reject.apply(s,arguments)})}return s.promise},a.getAccessTokenForMobile=function(i,s){var o=t.deferredWrapper();return t.accessToken?e.nextTick(function(){o.resolve(t.accessToken)}):n.getUrl("http://oauth.net/core/2.0/endpoint/token").then(function(e){var a=n.post(e,{grant_type:"password",client_id:t.clientId,username:i,password:s},{"Content-Type":"application/x-www-form-urlencoded"});r(a,o)}),o.promise},a.hasAccessToken=function(){return!!t.accessToken},a.invalidateAccessToken=function(){return e.eraseAccessToken(!0),e.chainHttpPromises(n.getUrl("http://oauth.net/core/2.0/endpoint/token"),function(t){return n.del(t)})},a}),t("authorities",["helpers","plumbing"],function(t,e){var n=t.maybe,r={},i=r.Date=function(){},s=r.constructFormalDate=function(t,e){var n,r="",i="",s="",o="",a="+",h=0;"about"===t[h]?(e||(r="A"),h++):"before"===t[h]?(e||(r="A/"),h++):"after"===t[h]&&(e||(r="A",i="/"),h++),t[h].length<=2&&(s=(1===t[h].length?"0":"")+t[h],h++);var u=["january","february","march","april","may","june","july","august","september","october","november","december"].indexOf(t[h])+1;return u>0&&(o=(10>u?"0":"")+u.toString(),h++),n=t[h],h++,h<t.length&&"bc"===t[h]&&(a="-"),r+a+n+(o?"-":"")+o+(s?"-":"")+s+i};r.Date.prototype={constructor:i,$getFormalDate:function(){var t="";if(this.normalized){var e=this.normalized.trim().toLowerCase().split(" "),n=e.indexOf("/");n>=0&&(e=e.slice(0,n)),"from"===e[0]?(n=e.indexOf("to"),t=s(e.slice(1,n),!0)+"/"+s(e.slice(n+1),!0)):t=s(e,!1)}return t}};var o=r.Place=function(){};return r.Place.prototype={constructor:o,$getNormalizedPlace:function(){return n(this.normalized)[0]}},r.getDate=function(r,s){var o={date:r,dataFormat:"application/json"};return e.get(t.getAuthoritiesServerUrl("/authorities/v1/date"),o,{Accept:"application/json"},s,t.compose(t.objectExtender({getDate:function(){return n(n(this.dates).date)[0]}}),t.constructorSetter(i,"date",function(t){return t.dates})))},r.getPlaceSearch=function(r,i){var s={place:r,view:"simple",dataFormat:"application/json"};return e.get(t.getAuthoritiesServerUrl("/authorities/v1/place"),s,{Accept:"application/json"},i,t.compose(t.objectExtender({getPlaces:function(){return n(this.places).place}}),t.constructorSetter(o,"place",function(t){return t.places})))},r}),t("user",["globals","helpers","plumbing"],function(t,e,n){var r=e.maybe,i={},s=i.User=function(){};i.User.prototype={constructor:s};var o=i.Agent=function(){};return i.Agent.prototype={constructor:o,$getName:function(){return r(r(this.names)[0]).value},$getAccountName:function(){return r(r(this.accounts)[0]).accountName},$getEmail:function(){var t=r(r(this.emails)[0]).resource;return t?t.replace(/^mailto:/,""):t},$getPhoneNumber:function(){return r(r(this.phones)[0]).resource},$getAddress:function(){return r(r(this.addresses)[0]).value}},i.getCurrentUser=function(t,i){return e.chainHttpPromises(n.getUrl("current-user"),function(o){return n.get(o,t,{},i,e.compose(e.objectExtender({getUser:function(){return r(this.users)[0]}}),e.constructorSetter(s,"users")))})},i.getAgent=function(t,i,s){return e.chainHttpPromises(n.getUrl("agent-template",t,{uid:t}),function(t){return n.get(t,i,{},s,e.compose(e.objectExtender({getAgent:function(){return r(this.agents)[0]}}),e.constructorSetter(o,"agents")))})},i.getMultiAgent=function(t,n,r){var s={};return e.forEach(t,function(t){s[t]=i.getAgent(t,n,r)}),e.promiseAll(s)},i}),t("changeHistory",["helpers","plumbing","user"],function(t,e,n){var r=t.maybe,i={},s=i.Change=function(){};i.Change.prototype={constructor:s,$getAgentName:function(){return r(r(this.contributors)[0]).name},$getChangeReason:function(){return r(r(this.changeInfo)[0]).reason},$getAgentUrl:function(){return t.removeAccessToken(r(r(this.links).agent).href)},$getAgent:function(){return n.getAgent(this.$getAgentUrl())},$restore:function(t){return i.restoreChange(this.id,t)}};var o=t.compose(t.objectExtender({getChanges:function(){return this.entries||[]}}),t.constructorSetter(s,"entries"));return i.getPersonChanges=function(n,r,i){return t.chainHttpPromises(e.getUrl("person-changes-template",n,{pid:n}),function(t){return e.get(t,r,{Accept:"application/x-gedcomx-atom+json"},i,o)})},i.getChildAndParentsChanges=function(n,r,i){return t.chainHttpPromises(e.getUrl("child-and-parents-relationship-changes-template",n,{caprid:n}),function(t){return e.get(t,r,{Accept:"application/x-gedcomx-atom+json"},i,o)})},i.getCoupleChanges=function(n,r,i){return t.chainHttpPromises(e.getUrl("couple-relationship-changes-template",n,{crid:n}),function(t){return e.get(t,r,{Accept:"application/x-gedcomx-atom+json"},i,o)})},i.restoreChange=function(n,r){return t.chainHttpPromises(e.getUrl("change-restore-template",n,{chid:n}),function(t){return e.post(t,null,{"Content-Type":void 0},r,function(){return n})})},i}),t("attribution",["helpers","plumbing","user"],function(t,e,n){var r=t.maybe,i={},s=i.Attribution=function(t){t&&(this.changeMessage=t)};return i.Attribution.prototype={constructor:s,$getAgentId:function(){return r(this.contributor).resourceId},$getAgentUrl:function(){return t.removeAccessToken(r(this.contributor).resource)},$getAgent:function(){return n.getAgent(this.$getAgentUrl()||this.$getAgentId())}},i}),t("discussions",["attribution","globals","helpers","plumbing","user"],function(t,e,n,r,i){var s=n.maybe,o={},a=o.Discussion=function(t){t&&(this.title=t.title,this.details=t.details)};o.Discussion.prototype={constructor:a,$getDiscussionUrl:function(){return n.removeAccessToken(s(s(this.links).discussion).href)},$getCommentsUrl:function(){return n.removeAccessToken(s(s(this.links).comments).href)},$getComments:function(){return o.getDiscussionComments(this.$getCommentsUrl())},$getAgentId:function(){return s(this.contributor).resourceId},$getAgentUrl:function(){return n.removeAccessToken(s(this.contributor).resource)},$getAgent:function(){return i.getAgent(this.$getAgentUrl()||this.$getAgentId())},$save:function(t,e,i){var s=this,a=n.chainHttpPromises(s.id?r.getUrl("discussion-template",null,{did:s.id}):r.getUrl("discussions"),function(t){return r.post(t,{discussions:[s]},{"Content-Type":"application/x-fs-v1+json"},i,function(t,e){return s.id||e.getResponseHeader("X-ENTITY-ID")})}),h=a.then(function(t){return n.extendHttpPromise(h,a),e?o.getDiscussion(t,{},i).then(function(e){return n.deletePropertiesPartial(s,n.appFieldRejector),n.extend(s,e.getDiscussion()),t}):t});return h},$delete:function(t,e){return o.deleteDiscussion(this.$getDiscussionUrl()||this.id,t,e)}};var h=o.DiscussionRef=function(t){t&&(this.$personId=t.$personId,t.discussion&&this.$setDiscussion(t.discussion))};o.DiscussionRef.prototype={constructor:h,$getDiscussionRefUrl:function(){return n.removeAccessToken(s(s(this.links)["discussion-reference"]).href)},$getDiscussionUrl:function(){return n.removeAccessToken(this.resource)},$getDiscussion:function(){return o.getDiscussion(this.$getDiscussionUrl()||this.resourceId)},$setDiscussion:function(t){return t instanceof a?(this.resource=t.$getDiscussionUrl(),this.resourceId=t.id):n.isAbsoluteUrl(t)?this.resource=n.removeAccessToken(t):this.resourceId=t,this},$save:function(e,i){var s=this;return n.chainHttpPromises(r.getUrl("person-discussion-references-template",null,{pid:s.$personId}),function(n){!s.resource&&s.resourceId&&(s.resource=s.resourceId);var o={persons:[{id:s.$personId,"discussion-references":[{resource:s.resource}]}]};e&&(o.persons[0].attribution=new t.Attribution(e));var a={"Content-Type":"application/x-fs-v1+json"};return r.post(n,o,a,i,function(t,e){return s.$getDiscussionRefUrl()||(s.links={"discussion-reference":{href:e.getResponseHeader("Location"),title:"Discussion Reference"}}),s.$getDiscussionRefUrl()})})},$delete:function(t,e){return o.deleteDiscussionRef(this.$getDiscussionRefUrl()||this.$personId,this.id,t,e)}};var u=o.Comment=function(t){t&&(this.text=t.text,this.$discussionId=t.$discussionId,this.$memoryId=t.$memoryId)};return o.Comment.prototype={constructor:u,$getCommentUrl:function(){return n.removeAccessToken(s(s(this.links).comment).href)},$getAgentId:function(){return s(this.contributor).resourceId},$getAgentUrl:function(){return n.removeAccessToken(s(this.contributor).resource)},$getAgent:function(){return i.getAgent(this.$getAgentUrl()||this.$getAgentId())},$save:function(t,e){var i=this,s=this.$memoryId?"memory-comments-template":"discussion-comments-template";return n.chainHttpPromises(r.getUrl(s,null,{did:i.$discussionId,mid:i.$memoryId}),function(t){var n={discussions:[{comments:[i]}]};return r.post(t,n,{"Content-Type":"application/x-fs-v1+json"},e,function(t,e){return i.id||(i.id=e.getResponseHeader("X-ENTITY-ID")),i.$getCommentUrl()||(i.links={comment:{href:e.getResponseHeader("Location")}}),i.id})})},$delete:function(t,e){return this.$discussionId?o.deleteDiscussionComment(this.$getCommentUrl()||this.$discussionId,this.id,t,e):o.deleteMemoryComment(this.$getCommentUrl()||this.$memoryId,this.id,t,e)}},o.getDiscussion=function(t,e,i){return n.chainHttpPromises(r.getUrl("discussion-template",t,{did:t}),function(t){return r.get(t,e,{Accept:"application/x-fs-v1+json"},i,n.compose(n.objectExtender({getDiscussion:function(){return s(s(this).discussions)[0]}}),n.constructorSetter(a,"discussions")))})},o.getMultiDiscussion=function(t,e,r){var i={};return n.forEach(t,function(t){var n,s;t instanceof h?(s=t.$getDiscussionUrl(),n=t.resourceId):(s=t,n=t),i[n]=o.getDiscussion(s,e,r)}),n.promiseAll(i)},o.getPersonDiscussionRefs=function(e,i,o){return n.chainHttpPromises(r.getUrl("person-discussion-references-template",e,{pid:e}),function(e){return r.get(e,i,{Accept:"application/x-fs-v1+json"},o,n.compose(n.objectExtender({getDiscussionRefs:function(){return s(s(s(this).persons)[0])["discussion-references"]||[]}}),n.constructorSetter(h,"discussion-references",function(t){return s(s(t).persons)[0]}),n.objectExtender(function(t){return{$personId:s(s(s(t).persons)[0]).id}},function(t){return s(s(s(t).persons)[0])["discussion-references"]}),n.constructorSetter(t.Attribution,"attribution",function(t){return s(s(s(t).persons)[0])["discussion-references"]})))})},o.commentsResponseMapper=n.compose(n.objectExtender({getComments:function(){return s(s(s(this).discussions)[0]).comments||[]}}),n.constructorSetter(u,"comments",function(t){return s(s(t).discussions)[0]})),o.getDiscussionComments=function(t,e,i){return n.chainHttpPromises(r.getUrl("discussion-comments-template",t,{did:t}),function(t){return r.get(t,e,{Accept:"application/x-fs-v1+json"},i,n.compose(o.commentsResponseMapper,n.objectExtender(function(t){return{$discussionId:s(s(s(t).discussions)[0]).id}},function(t){return s(s(s(t).discussions)[0]).comments})))})},o.deleteDiscussion=function(t,e,i){return n.chainHttpPromises(r.getUrl("discussion-template",t,{did:t}),function(e){return r.del(e,{"Content-Type":"application/x-fs-v1+json"},i,function(){return t})})},o.deleteDiscussionRef=function(t,e,i,s){return n.chainHttpPromises(r.getUrl("person-discussion-reference-template",t,{pid:t,drid:e}),function(e){var n={"Content-Type":"application/x-fs-v1+json"};return i&&(n["X-Reason"]=i),r.del(e,n,s,function(){return t})})},o.deleteDiscussionComment=function(t,e,i,s){return n.chainHttpPromises(r.getUrl("discussion-comment-template",t,{did:t,cmid:e}),function(e){return r.del(e,{"Content-Type":"application/x-fs-v1+json"},s,function(){return t})})},o.deleteMemoryComment=function(t,e,i,s){return n.chainHttpPromises(r.getUrl("memory-comment-template",t,{mid:t,cmid:e}),function(e){return r.del(e,{},s,function(){return t})})},o}),t("fact",["attribution","authorities","helpers"],function(t,e,n){var r=n.maybe,i={},s=i.Fact=function(t){t&&(t.type&&this.$setType(t.type),t.date&&this.$setDate(t.date),t.formalDate&&this.$setFormalDate(t.formalDate),t.place&&this.$setPlace(t.place),t.normalizedPlace&&this.$setNormalizedPlace(t.normalizedPlace),t.changeMessage&&this.$setChangeMessage(t.changeMessage))};return i.Fact.prototype={constructor:s,$getDate:function(){return r(this.date).original},$getNormalizedDate:function(){return r(r(r(this.date).normalized)[0]).value},$getFormalDate:function(){return r(this.date).formal},$getPlace:function(){return r(this.place).original},$getNormalizedPlace:function(){return r(r(r(this.place).normalized)[0]).value},$getNormalizedPlaceId:function(){var t=r(this.place).description;return t&&"#"===t.charAt(0)?t.substr(1):""},$isCustomNonEvent:function(){if(this.qualifiers){var t=n.find(this.qualifiers,{name:"http://familysearch.org/v1/Event"});return!!t&&"false"===t.value}return!1},$setType:function(t){return this.$changed=!0,this.type=t,this},$setCustomNonEvent:function(t){var e;return t?(this.qualifiers||(this.qualifiers=[]),e=n.findIndex(this.qualifiers,{name:"http://familysearch.org/v1/Event"}),0>e&&(e=this.qualifiers.push({name:"http://familysearch.org/v1/Event"})-1),this.qualifiers[e].value="false"):this.qualifiers&&(e=n.findIndex(this.qualifiers,{name:"http://familysearch.org/v1/Event"}),e>=0&&this.qualifiers.splice(e,1),0===this.qualifiers.length&&delete this.qualifiers),this.$changed=!0,this},$setDate:function(t){this.$changed=!0;var r;return n.isString(t)?r=t:t instanceof e.Date?(r=t.original,this.$setFormalDate(t.$getFormalDate()),this.$setNormalizedDate(t.normalized)):n.isObject(t)&&(r=t.original,this.$setFormalDate(t.formal),this.$setNormalizedDate(t.normalized)),r?(this.date||(this.date={}),this.date.original=r):delete this.date,this},$setFormalDate:function(t){return this.$changed=!0,t?(this.date||(this.date={}),this.date.formal=t):this.date&&delete this.date.formal,this},$setNormalizedDate:function(t){return this.$changed=!0,t?(this.date||(this.date={}),this.date.normalized=[{value:t}]):this.date&&delete this.date.normalized,this},$setPlace:function(t){this.$changed=!0;var r;return n.isString(t)||null==t?r=t:t instanceof e.Place?(r=t.original,this.$setNormalizedPlace(t.$getNormalizedPlace())):n.isObject(t)&&(r=t.original,this.$setNormalizedPlace(t.normalized)),r?(this.place||(this.place={}),this.place.original=r):delete this.place,this},$setNormalizedPlace:function(t){return this.$changed=!0,t?(this.place||(this.place={}),this.place.normalized=[{value:t}]):this.place&&delete this.place.normalized,this},$setChangeMessage:function(e){return this.attribution=new t.Attribution(e),this}},i}),t("name",["attribution","helpers"],function(t,e){function n(t,n){var r=n||0;for(e.isArray(t.nameForms)||(t.nameForms=[]);r>=t.nameForms.length;)t.nameForms.push({});return t.nameForms[r]}var r=e.maybe,i={},s=i.Name=function(t){t&&(e.isString(t)?this.$setFullText(t):(t.type&&this.$setType(t.type),t.givenName&&this.$setGivenName(t.givenName),t.surname&&this.$setSurname(t.surname),t.prefix&&this.$setPrefix(t.prefix),t.suffix&&this.$setSuffix(t.suffix),t.fullText&&this.$setFullText(t.fullText),this.$setPreferred(!!t.preferred),t.changeMessage&&this.$setChangeMessage(t.changeMessage)))};return i.Name.prototype={constructor:s,$getNameFormsCount:function(){return this.nameForms?this.nameForms.length:0},$getNameForm:function(t){return r(this.nameForms)[t||0]},$getFullText:function(t){return r(this.$getNameForm(t)).fullText},$getLang:function(t){return r(this.$getNameForm(t)).lang},$getNamePart:function(t,n){return r(e.find(r(this.$getNameForm(n)).parts,{type:t})).value},$getGivenName:function(t){return this.$getNamePart("http://gedcomx.org/Given",t)},$getSurname:function(t){return this.$getNamePart("http://gedcomx.org/Surname",t)},$getPrefix:function(t){return this.$getNamePart("http://gedcomx.org/Prefix",t)},$getSuffix:function(t){return this.$getNamePart("http://gedcomx.org/Suffix",t)},$setType:function(t){return this.$changed=!0,t?this.type=t:delete this.type,this},$setPreferred:function(t){return this.$changed=!0,this.preferred=t,this},$setFullText:function(t,e){this.$changed=!0;var r=n(this,e);return t?r.fullText=t:delete r.fullText,this},$setNamePart:function(t,r,i){this.$changed=!0;var s=n(this,i);e.isArray(s.parts)||(s.parts=[]);var o=e.find(s.parts,{type:r});return t?(o||(o={type:r},s.parts.push(o)),o.value=t):o&&s.parts.splice(s.parts.indexOf(o),1),this},$setGivenName:function(t,e){return this.$setNamePart(t,"http://gedcomx.org/Given",e)},$setSurname:function(t,e){return this.$setNamePart(t,"http://gedcomx.org/Surname",e)},$setPrefix:function(t,e){return this.$setNamePart(t,"http://gedcomx.org/Prefix",e)},$setSuffix:function(t,e){return this.$setNamePart(t,"http://gedcomx.org/Suffix",e)},$setChangeMessage:function(e){return this.attribution=new t.Attribution(e),this}},i}),t("memories",["attribution","discussions","globals","helpers","name","plumbing"],function(t,e,n,r,i,s){var o=r.maybe,a={},h=a.Memory=function(t){t&&(t.title&&this.$setTitle(t.title),t.description&&this.$setDescription(t.description),t.filename&&this.$setArtifactFilename(t.filename),t.$data&&(this.$data=t.$data))};a.Memory.prototype={constructor:h,$getTitle:function(){return o(o(this.titles)[0]).value},$getDescription:function(){return o(o(this.description)[0]).value},$getIconUrl:function(){return r.appendAccessToken(o(o(this.links)["image-icon"]).href)},$getThumbnailUrl:function(){return r.appendAccessToken(o(o(this.links)["image-thumbnail"]).href)},$getImageUrl:function(){return r.appendAccessToken(o(o(this.links).image).href)},$getMemoryArtifactUrl:function(){return r.appendAccessToken(r.removeAccessToken(this.about))},$getMemoryUrl:function(){return r.removeAccessToken(o(o(this.links).description).href)},$getArtifactFilename:function(){return o(o(this.artifactMetadata)[0]).filename},$getArtifactType:function(){return o(o(this.artifactMetadata)[0]).artifactType},$getArtifactHeight:function(){return o(o(this.artifactMetadata)[0]).height},$getArtifactWidth:function(){return o(o(this.artifactMetadata)[0]).width},$getCommentsUrl:function(){return r.removeAccessToken(o(o(this.links).comments).href)},$getComments:function(){return a.getMemoryComments(this.$getCommentsUrl()||this.id)},$setTitle:function(t){return this.titles=[{value:t}],this},$setDescription:function(t){return this.description=[{value:t}],this},$setArtifactFilename:function(t){return r.isArray(this.artifactMetadata)&&this.artifactMetadata.length||(this.artifactMetadata=[{}]),this.artifactMetadata[0].filename=t,this},$save:function(t,e,n){var i=this,o=r.chainHttpPromises(i.id?s.getUrl("memory-template",null,{mid:i.id}):s.getUrl("memories"),function(t){if(i.id)return s.post(t,{sourceDescriptions:[i]},{},n,function(){return i.id});var e={};return i.$getTitle()&&(e.title=i.$getTitle()),i.$getDescription()&&(e.description=i.$getDescription()),i.$getArtifactFilename()&&(e.filename=i.$getArtifactFilename()),s.post(r.appendQueryParameters(t,e),i.$data,{"Content-Type":r.isString(i.$data)?"text/plain":"multipart/form-data"},n,r.getResponseEntityId)}),h=o.then(function(t){return r.extendHttpPromise(h,o),e?a.getMemory(t,{},n).then(function(e){return r.deletePropertiesPartial(i,r.appFieldRejector),r.extend(i,e.getMemory()),t}):t});return h},$delete:function(t,e){return a.deleteMemory(this.$getMemoryUrl()||this.id,t,e)}};var u=a.MemoryPersona=function(t){t&&(this.$memoryId=t.$memoryId,t.name&&this.$setName(t.name),t.memoryArtifactRef&&this.$setMemoryArtifactRef(t.memoryArtifactRef))};a.MemoryPersona.prototype={constructor:u,$getMemoryPersonaUrl:function(){return r.removeAccessToken(o(o(this.links).persona).href)},$getMemoryArtifactRef:function(){return o(this.media)[0]},$getName:function(){return o(this.names)[0]},$getDisplayName:function(){return o(this.display).name},$getMemoryUrl:function(){return r.removeAccessToken(o(this.$getMemoryArtifactRef()).description)},$getMemory:function(){return a.getMemory(this.$getMemoryUrl()||this.$memoryId)},$setName:function(t){return t instanceof i.Name||(t=new i.Name(t)),this.names=[t],this},$setMemoryArtifactRef:function(t){return this.media=[t],this},$save:function(t,e,i){var o=this,h=r.chainHttpPromises(s.getUrl(o.id?"memory-persona-template":"memory-personas-template",null,{mid:o.$memoryId,pid:o.id}),function(t){if(!o.$getMemoryArtifactRef()){var e=r.getUrlFromDiscoveryResource(n.discoveryResource,"memory-template",{mid:o.$memoryId});o.$setMemoryArtifactRef(new l({description:e}))}return s.post(t,{persons:[o]},{},i,function(t,e){return o.$getMemoryPersonaUrl()||r.removeAccessToken(e.getResponseHeader("Location"))})}),u=h.then(function(t){return r.extendHttpPromise(u,h),e?a.getMemoryPersona(t,null,{},i).then(function(e){return r.deletePropertiesPartial(o,r.appFieldRejector),r.extend(o,e.getMemoryPersona()),t}):t});return u},$delete:function(t,e){return a.deleteMemoryPersona(this.$getMemoryPersonaUrl()||this.$memoryId,this.id,t,e)}};var c=a.MemoryPersonaRef=function(t){t&&(this.$personId=t.$personId,t.memoryPersona&&this.$setMemoryPersona(t.memoryPersona))};a.MemoryPersonaRef.prototype={constructor:c,$getMemoryPersonaRefUrl:function(){return r.removeAccessToken(o(o(this.links)["evidence-reference"]).href)},$getMemoryPersonaUrl:function(){return r.removeAccessToken(this.resource)},$getMemoryPersona:function(){return a.getMemoryPersona(this.$getMemoryPersonaUrl())},$getMemoryUrl:function(){return r.removeAccessToken(o(o(this.links).memory).href)},$getMemory:function(){return a.getMemory(this.$getMemoryUrl())},$setMemoryPersona:function(t){return t instanceof u&&(t=t.$getMemoryPersonaUrl()),this.resource=r.removeAccessToken(t),this},$save:function(t,e){var n=this;return r.chainHttpPromises(s.getUrl("person-memory-persona-references-template",null,{pid:n.$personId}),function(t){return s.post(t,{persons:[{evidence:[n]}]},{},e,function(t,e){return n.id||(n.id=e.getResponseHeader("X-ENTITY-ID")),n.$getMemoryPersonaRefUrl()||(n.links={"evidence-reference":{href:e.getResponseHeader("Location")}}),n.$getMemoryPersonaRefUrl()})})},$delete:function(t,e){return a.deleteMemoryPersonaRef(this.$getMemoryPersonaRefUrl()||this.$personId,this.id,t,e)}};var l=a.MemoryArtifactRef=function(t){t&&(this.description=t.description,t.qualifierName&&this.$setQualifierName(t.qualifierName),t.qualifierValue&&this.$setQualifierValue(t.qualifierValue))};a.MemoryArtifactRef.prototype={constructor:l,$getQualifierName:function(){return o(o(this.qualifiers)[0]).name},$getQualifierValue:function(){return o(o(this.qualifiers)[0]).value},$setQualifierName:function(t){return r.isArray(this.qualifiers)&&this.qualifiers.length||(this.qualifiers=[{}]),
this.qualifiers[0].name=t,this},$setQualifierValue:function(t){return r.isArray(this.qualifiers)&&this.qualifiers.length||(this.qualifiers=[{}]),this.qualifiers[0].value=t,this}},a.getPersonMemoriesQuery=function(e,n,i){return r.chainHttpPromises(s.getUrl("person-memories-query",e,{pid:e}),function(e){return s.get(e,n,{},i,r.compose(r.objectExtender({getMemories:function(){return this.sourceDescriptions||[]}}),r.constructorSetter(h,"sourceDescriptions"),r.constructorSetter(t.Attribution,"attribution",function(t){return t.sourceDescriptions})))})},a.getUserMemoriesQuery=function(e,n,i){return r.chainHttpPromises(s.getUrl("user-memories-query",e,{cisUserId:e}),function(e){return s.get(e,n,{},i,r.compose(r.objectExtender({getMemories:function(){return this.sourceDescriptions||[]}}),r.constructorSetter(h,"sourceDescriptions"),r.constructorSetter(t.Attribution,"attribution",function(t){return t.sourceDescriptions})))})},a.getMemory=function(e,n,i){return r.chainHttpPromises(s.getUrl("memory-template",e,{mid:e}),function(e){return s.get(e,n,{},i,r.compose(r.objectExtender({getMemory:function(){return o(this.sourceDescriptions)[0]}}),r.constructorSetter(h,"sourceDescriptions"),r.constructorSetter(t.Attribution,"attribution",function(t){return t.sourceDescriptions})))})},a.getMemoryComments=function(t,n,i){return r.chainHttpPromises(s.getUrl("memory-comments-template",t,{mid:t}),function(t){return s.get(t,n,{Accept:"application/x-fs-v1+json"},i,r.compose(e.commentsResponseMapper,r.objectExtender(function(t){return{$memoryId:o(o(o(t).sourceDescriptions)[0]).id}},function(t){return o(o(o(t).discussions)[0]).comments})))})};var d=r.compose(r.constructorSetter(u,"persons"),r.constructorSetter(i.Name,"names",function(t){return o(t).persons}),r.constructorSetter(l,"media",function(t){return o(t).persons}),r.objectExtender(function(t){return{$memoryId:o(o(t.sourceDescriptions)[0]).id}},function(t){return o(t).persons}));return a.getMemoryPersonas=function(t,e,n){return r.chainHttpPromises(s.getUrl("memory-personas-template",t,{mid:t}),function(t){return s.get(t,e,{},n,r.compose(r.objectExtender({getMemoryPersonas:function(){return this&&this.persons?this.persons:[]}}),d))})},a.getMemoryPersona=function(t,e,n,i){return r.chainHttpPromises(s.getUrl("memory-persona-template",t,{mid:t,pid:e}),function(t){return s.get(t,n,{},i,r.compose(r.objectExtender({getMemoryPersona:function(){return o(this.persons)[0]}}),d))})},a.getMemoryPersonaRefs=function(t,e,n){return r.chainHttpPromises(s.getUrl("person-memory-persona-references-template",t,{pid:t}),function(t){return s.get(t,e,{},n,r.compose(r.objectExtender({getMemoryPersonaRefs:function(){return o(o(this.persons)[0]).evidence||[]}}),r.constructorSetter(c,"evidence",function(t){return o(o(t).persons)[0]}),r.objectExtender(function(t){return{$personId:o(o(o(t).persons)[0]).id}},function(t){return o(o(o(t).persons)[0]).evidence})))})},a.getPersonPortraitUrl=function(t,e,n){return s.getUrl("person-portrait-template",t,{pid:t}).then(function(t){if(e&&e.followRedirect){e=r.extend({},e),delete e.followRedirect;var i=s.get(t,e,{},n);return r.handleRedirect(i,function(t){return 204===t.getStatusCode()?"":r.appendAccessToken(t.getResponseHeader("Content-Location"))})}return r.appendAccessToken(t)})},a.deleteMemory=function(t,e,n){return r.chainHttpPromises(s.getUrl("memory-template",t,{mid:t}),function(e){return s.del(e,{},n,function(){return t})})},a.deleteMemoryPersona=function(t,e,n,i){return r.chainHttpPromises(s.getUrl("memory-persona-template",t,{mid:t,pid:e}),function(e){return s.del(e,{},i,function(){return t})})},a.deleteMemoryPersonaRef=function(t,e,n,i){return r.chainHttpPromises(s.getUrl("person-memory-persona-reference-template",t,{pid:t,erid:e}),function(e){return s.del(e,{},i,function(){return t})})},a}),t("notes",["attribution","helpers","plumbing"],function(t,e,n){function r(t){if(t){if(t.persons)return t.persons;if(t.childAndParentsRelationships)return t.childAndParentsRelationships;if(t.relationships)return t.relationships}return{}}function i(i,s,a){return n.get(i,s,{Accept:"application/x-fs-v1+json"},a,e.compose(e.objectExtender({getNote:function(){return o(o(r(this)[0]).notes)[0]}}),e.constructorSetter(h,"notes",function(t){return r(t)[0]}),e.constructorSetter(t.Attribution,"attribution",function(t){return o(r(t)[0]).notes}),e.objectExtender(function(t){var e=t.persons?"$personId":t.childAndParentsRelationships?"$childAndParentsId":"$coupleId",n={};return n[e]=o(r(t)[0]).id,n},function(t){return o(r(t)[0]).notes})))}function s(t,n,r,i,s){var o={};return e.isArray(t)?e.forEach(t,function(t){o[t]=s(t,null,r,i)}):e.forEach(n,function(e){o[e]=s(t,e,r,i)}),o}var o=e.maybe,a={},h=a.Note=function(t){t&&(this.subject=t.subject,this.text=t.text,this.$personId=t.$personId,this.$childAndParentsId=t.$childAndParentsId,this.$coupleId=t.$coupleId)};return a.Note.prototype={constructor:h,$getNoteUrl:function(){return e.removeAccessToken(o(o(this.links).note).href)},$save:function(r,i,s){var o,h,u=this,c={};u.$personId?(o=u.id?"person-note-template":"person-notes-template",h="persons"):u.$coupleId?(o=u.id?"couple-relationship-note-template":"couple-relationship-notes-template",h="relationships"):u.$childAndParentsId&&(o=u.id?"child-and-parents-relationship-note-template":"child-and-parents-relationship-notes-template",h="childAndParentsRelationships",c["Content-Type"]="application/x-fs-v1+json");var l=e.chainHttpPromises(n.getUrl(o,null,{pid:u.$personId,crid:u.$coupleId,caprid:u.$childAndParentsId,nid:u.id}),function(i){var o={};return o[h]=[{notes:[u]}],r&&(o[h][0].attribution=new t.Attribution(r)),n.post(i,o,c,s,function(t,n){return{id:u.id||n.getResponseHeader("X-ENTITY-ID"),location:u.$getNoteUrl()||e.removeAccessToken(n.getResponseHeader("Location"))}})}),d=l.then(function(t){return e.extendHttpPromise(d,l),i?a.getPersonNote(t.location,null,{},s).then(function(n){return e.deletePropertiesPartial(u,e.appFieldRejector),e.extend(u,n.getNote()),t.id}):t.id});return d},$delete:function(t,e){return this.$personId?a.deletePersonNote(this.$getNoteUrl()||this.$personId,this.id,t,e):this.$coupleId?a.deleteCoupleNote(this.$getNoteUrl()||this.$coupleId,this.id,t,e):a.deleteChildAndParentsNote(this.$getNoteUrl()||this.$childAndParentsId,this.id,t,e)}},a.getPersonNote=function(t,r,s,o){return e.chainHttpPromises(n.getUrl("person-note-template",t,{pid:t,nid:r}),function(t){return i(t,s,o)})},a.getMultiPersonNote=function(t,n,r,i){var o=s(t,n,r,i,a.getPersonNote);return e.promiseAll(o)},a.getCoupleNote=function(t,r,s,o){return e.chainHttpPromises(n.getUrl("couple-relationship-note-template",t,{crid:t,nid:r}),function(t){return i(t,s,o)})},a.getMultiCoupleNote=function(t,n,r,i){var o=s(t,n,r,i,a.getCoupleNote);return e.promiseAll(o)},a.getChildAndParentsNote=function(t,r,s,o){return e.chainHttpPromises(n.getUrl("child-and-parents-relationship-note-template",t,{caprid:t,nid:r}),function(t){return i(t,s,o)})},a.getMultiChildAndParentsNote=function(t,n,r,i){var o=s(t,n,r,i,a.getChildAndParentsNote);return e.promiseAll(o)},a.getPersonNotes=function(r,i,s){return e.chainHttpPromises(n.getUrl("person-notes-template",r,{pid:r}),function(r){return n.get(r,i,{},s,e.compose(e.objectExtender({getNotes:function(){return o(o(o(this).persons)[0]).notes||[]}}),e.constructorSetter(h,"notes",function(t){return o(o(t).persons)[0]}),e.objectExtender(function(t){return{$personId:o(o(o(t).persons)[0]).id}},function(t){return o(o(o(t).persons)[0]).notes}),e.constructorSetter(t.Attribution,"attribution",function(t){return o(o(o(t).persons)[0]).notes})))})},a.getCoupleNotes=function(r,i,s){return e.chainHttpPromises(n.getUrl("couple-relationship-notes-template",r,{crid:r}),function(r){return n.get(r,i,{},s,e.compose(e.objectExtender({getNotes:function(){return o(o(this.relationships)[0]).notes||[]}}),e.constructorSetter(h,"notes",function(t){return o(o(t).relationships)[0]}),e.objectExtender(function(t){return{$coupleId:o(o(o(t).relationships)[0]).id}},function(t){return o(o(o(t).relationships)[0]).notes}),e.constructorSetter(t.Attribution,"attribution",function(t){return o(o(o(t).relationships)[0]).notes})))})},a.getChildAndParentsNotes=function(r,i,s){return e.chainHttpPromises(n.getUrl("child-and-parents-relationship-notes-template",r,{caprid:r}),function(r){return n.get(r,i,{Accept:"application/x-fs-v1+json"},s,e.compose(e.objectExtender({getNotes:function(){return o(o(this.childAndParentsRelationships)[0]).notes||[]}}),e.constructorSetter(h,"notes",function(t){return o(o(t).childAndParentsRelationships)[0]}),e.objectExtender(function(t){return{$childAndParentsId:o(o(o(t).childAndParentsRelationships)[0]).id}},function(t){return o(o(o(t).childAndParentsRelationships)[0]).notes}),e.constructorSetter(t.Attribution,"attribution",function(t){return o(o(o(t).childAndParentsRelationships)[0]).notes})))})},a.deletePersonNote=function(t,r,i,s){return e.chainHttpPromises(n.getUrl("person-note-template",t,{pid:t,nid:r}),function(e){var r={"Content-Type":"application/x-fs-v1+json"};return i&&(r["X-Reason"]=i),n.del(e,r,s,function(){return t})})},a.deleteCoupleNote=function(t,r,i,s){return e.chainHttpPromises(n.getUrl("couple-relationship-note-template",t,{crid:t,nid:r}),function(e){var r={};return i&&(r["X-Reason"]=i),n.del(e,r,s,function(){return t})})},a.deleteChildAndParentsNote=function(t,r,i,s){return e.chainHttpPromises(n.getUrl("child-and-parents-relationship-note-template",t,{caprid:t,nid:r}),function(e){var r={"Content-Type":"application/x-fs-v1+json"};return i&&(r["X-Reason"]=i),n.del(e,r,s,function(){return t})})},a}),t("sources",["attribution","globals","helpers","plumbing"],function(t,e,n,r){function i(r,i,o){return n.compose(n.objectExtender(n.removeEmptyProperties({getSourceRefs:function(){return s(s(this[r])[0]).sources||[]},getSourceDescriptions:o?function(){return this.sourceDescriptions||[]}:null,getSourceDescription:o?function(t){return n.find(this.sourceDescriptions,{id:t})}:null})),n.constructorSetter(h,"sources",function(t){return s(s(t)[r])[0]}),n.constructorSetter(t.Attribution,"attribution",function(t){return s(s(s(t)[r])[0]).sources}),n.objectExtender(function(t,o){var a;if(n.isAbsoluteUrl(o.description))a={$sourceDescriptionId:n.getLastUrlSegment(o.description)};else{var h="#"===o.description.charAt(0)?o.description.substr(1):o.description;a={$sourceDescriptionId:h,description:n.getUrlFromDiscoveryResource(e.discoveryResource,"source-description-template",{sdid:h})}}return a[i]=s(s(s(t)[r])[0]).id,a},function(t){return s(s(s(t)[r])[0]).sources}),o?n.constructorSetter(a,"sourceDescriptions"):null,o?n.constructorSetter(t.Attribution,"attribution",function(t){return t.sourceDescriptions}):null)}var s=n.maybe,o={},a=o.SourceDescription=function(t){t&&(this.about=t.about,t.citation&&this.$setCitation(t.citation),t.title&&this.$setTitle(t.title),t.text&&this.$setText(t.text))};o.SourceDescription.prototype={constructor:a,$getCitation:function(){return s(s(this.citations)[0]).value},$getTitle:function(){return s(s(this.titles)[0]).value},$getText:function(){return s(s(this.notes)[0]).text},$getSourceDescriptionUrl:function(){return n.removeAccessToken(s(s(this.links).description).href)},$getSourceRefsQuery:function(){return o.getSourceRefsQuery(this.id)},$setCitation:function(t){return this.citations=[{value:t}],this},$setTitle:function(t){return this.titles=[{value:t}],this},$setText:function(t){return this.notes=[{text:t}],this},$save:function(e,i,s){var a=this;e&&(a.attribution=new t.Attribution(e));var h=n.chainHttpPromises(a.id?r.getUrl("source-description-template",null,{sdid:a.id}):r.getUrl("source-descriptions"),function(t){return r.post(t,{sourceDescriptions:[a]},{},s,function(t,e){return a.id||e.getResponseHeader("X-ENTITY-ID")})}),u=h.then(function(t){return n.extendHttpPromise(u,h),i?o.getSourceDescription(t,{},s).then(function(e){return n.deletePropertiesPartial(a,n.appFieldRejector),n.extend(a,e.getSourceDescription()),t}):t});return u},$delete:function(t,e){return o.deleteSourceDescription(this.id,t,e)}};var h=o.SourceRef=function(t){t&&(this.$personId=t.$personId,this.$coupleId=t.$coupleId,this.$childAndParentsId=t.$childAndParentsId,t.sourceDescription&&this.$setSourceDescription(t.sourceDescription),t.tags&&this.$setTags(t.tags))};return o.SourceRef.prototype={constructor:h,$getSourceRefUrl:function(){return n.removeAccessToken(s(s(this.links)["source-reference"]).href)},$getSourceDescriptionUrl:function(){return n.removeAccessToken(this.description)},$getSourceDescription:function(){return o.getSourceDescription(this.$getSourceDescriptionUrl())},$getTags:function(){return n.map(this.tags,function(t){return t.resource})},$setSourceDescription:function(t){return t instanceof a?(this.$sourceDescriptionId=t.id,this.description=t.$getSourceDescriptionUrl()):n.isAbsoluteUrl(t)?(delete this.$sourceDescriptionId,this.description=this.$sourceDescriptionUrl):(this.$sourceDescriptionId=t,delete this.description),this},$setTags:function(t){return this.tags=n.map(t,function(t){return{resource:t}}),this},$addTag:function(t){return n.isArray(this.tags)||(this.tags=[]),this.tags.push({resource:t}),this},$removeTag:function(t){return t=n.find(this.tags,{resource:t}),t&&this.tags.splice(n.indexOf(this.tags,t),1),this},$save:function(i,s){var o=this;i&&(o.attribution=new t.Attribution(i));var a,h,u={};return o.$personId?(a="person-source-references-template",h="persons"):o.$coupleId?(a="couple-relationship-source-references-template",h="relationships"):o.$childAndParentsId&&(a="child-and-parents-relationship-source-references-template",a="child-and-parents-relationship-source-references-template",h="childAndParentsRelationships",u["Content-Type"]="application/x-fs-v1+json"),n.chainHttpPromises(r.getUrl(a,null,{pid:o.$personId,crid:o.$coupleId,caprid:o.$childAndParentsId,srid:o.id}),function(t){!o.description&&o.$sourceDescriptionId&&(o.description=n.getUrlFromDiscoveryResource(e.discoveryResource,"source-description-template",{sdid:o.$sourceDescriptionId})),o.description=n.removeAccessToken(o.description);var i={};return i[h]=[{sources:[o]}],r.post(t,i,u,s,function(t,e){return o.id||(o.id=e.getResponseHeader("X-ENTITY-ID")),o.$getSourceRefUrl()||(o.links={"source-reference":{href:n.removeAccessToken(e.getResponseHeader("Location"))}}),o.id})})},$delete:function(t,e){return this.$personId?o.deletePersonSourceRef(this.$getSourceRefUrl()||this.$personID,this.id,t,e):this.$coupleId?o.deleteCoupleSourceRef(this.$getSourceRefUrl()||this.$coupleId,this.id,t,e):o.deleteChildAndParentsSourceRef(this.$getSourceRefUrl()||this.$childAndParentsId,this.id,t,e)}},o.getSourceDescription=function(e,i,o){return e instanceof h&&(e=e.$getSourceDescriptionUrl()||e.$sourceDescriptionId),n.chainHttpPromises(r.getUrl("source-description-template",e,{sdid:e}),function(e){return r.get(e,i,{},o,n.compose(n.objectExtender({getSourceDescription:function(){return s(this.sourceDescriptions)[0]}}),n.constructorSetter(a,"sourceDescriptions"),n.constructorSetter(t.Attribution,"attribution",function(t){return t.sourceDescriptions})))})},o.getMultiSourceDescription=function(t,e,r){var i={};return n.forEach(t,function(t){var n,s;t instanceof h?(n=t.$sourceDescriptionId||t.$getSourceDescriptionUrl(),s=t.$getSourceDescriptionUrl()||t.$sourceDescriptionId):(n=t,s=t),i[n]=o.getSourceDescription(s,e,r)}),n.promiseAll(i)},o.getSourceRefsQuery=function(e,i,o){return n.chainHttpPromises(r.getUrl("source-references-query"),function(a){return a=n.appendQueryParameters(a,{source:e}),r.get(a,i,{Accept:"application/x-fs-v1+json"},o,n.compose(n.objectExtender({getPersonSourceRefs:function(){return n.flatMap(s(this.persons),function(t){return t.sources})}}),n.objectExtender({getCoupleSourceRefs:function(){return n.flatMap(s(this.relationships),function(t){return t.sources})}}),n.objectExtender({getChildAndParentsSourceRefs:function(){return n.flatMap(s(this.childAndParentsRelationships),function(t){return t.sources})}}),n.constructorSetter(h,"sources",function(t){return n.union(s(t).persons,s(t).relationships,s(t).childAndParentsRelationships)}),n.constructorSetter(t.Attribution,"attribution",function(t){var e=n.union(s(t).persons,s(t).relationships,s(t).childAndParentsRelationships);return n.flatMap(e,function(t){return t.sources})}),n.objectExtender(function(t,r){var i=n.find(s(t).persons,function(t){return!!n.find(s(t).sources,{id:r.id})});return{$personId:i.id,$sourceDescriptionId:e}},function(t){return n.flatMap(s(t).persons,function(t){return t.sources})}),n.objectExtender(function(t,r){var i=n.find(s(t).relationships,function(t){return!!n.find(s(t).sources,{id:r.id})});return{$coupleId:i.id,$sourceDescriptionId:e}},function(t){return n.flatMap(s(t).relationships,function(t){return t.sources})}),n.objectExtender(function(t,r){var i=n.find(s(t).childAndParentsRelationships,function(t){return!!n.find(s(t).sources,{id:r.id})});return{$childAndParentsId:i.id,$sourceDescriptionId:e}},function(t){return n.flatMap(s(t).childAndParentsRelationships,function(t){return t.sources})})))})},o.getPersonSourceRefs=function(t,e,s){return n.chainHttpPromises(r.getUrl("person-source-references-template",t,{pid:t}),function(t){return r.get(t,e,{},s,i("persons","$personId",!1))})},o.getPersonSourcesQuery=function(t,e,s){return n.chainHttpPromises(r.getUrl("person-sources-query-template",t,{pid:t}),function(t){return r.get(t,e,{},s,i("persons","$personId",!0))})},o.getCoupleSourceRefs=function(t,e,s){return n.chainHttpPromises(r.getUrl("couple-relationship-source-references-template",t,{crid:t}),function(t){return r.get(t,e,{},s,i("relationships","$coupleId",!1))})},o.getCoupleSourcesQuery=function(t,e,s){return n.chainHttpPromises(r.getUrl("couple-relationship-sources-query-template",t,{crid:t}),function(t){return r.get(t,e,{},s,i("relationships","$coupleId",!0))})},o.getChildAndParentsSourceRefs=function(t,e,s){return n.chainHttpPromises(r.getUrl("child-and-parents-relationship-source-references-template",t,{caprid:t}),function(t){return r.get(t,e,{Accept:"application/x-fs-v1+json"},s,i("childAndParentsRelationships","$childAndParentsId",!1))})},o.getChildAndParentsSourcesQuery=function(t,e,s){return n.chainHttpPromises(r.getUrl("child-and-parents-relationship-sources-template",t,{caprid:t}),function(t){return r.get(t,e,{Accept:"application/x-fs-v1+json"},s,i("childAndParentsRelationships","$childAndParentsId",!0))})},o.deleteSourceDescription=function(t,e,i){var s=o.getSourceRefsQuery(t,{},i).then(function(a){var h=n.union(n.map(a.getPersonSourceRefs(),function(t){return o.deletePersonSourceRef(t.$getSourceRefUrl(),null,e,i)}),n.map(a.getCoupleSourceRefs(),function(t){return o.deleteCoupleSourceRef(t.$getSourceRefUrl(),null,e,i)}),n.map(a.getChildAndParentsSourceRefs(),function(t){return o.deleteChildAndParentsSourceRef(t.$getSourceRefUrl(),null,e,i)}));return n.promiseAll(h).then(function(){var o=n.chainHttpPromises(r.getUrl("source-description-template",null,{sdid:t}),function(n){return r.del(n,e?{"X-Reason":e}:{},i,function(){return t})});return n.extendHttpPromise(s,o),o})});return s},o.deletePersonSourceRef=function(t,e,i,s){return n.chainHttpPromises(r.getUrl("person-source-reference-template",t,{pid:t,srid:e}),function(e){return r.del(e,i?{"X-Reason":i}:{},s,function(){return t})})},o.deleteCoupleSourceRef=function(t,e,i,s){return n.chainHttpPromises(r.getUrl("couple-relationship-source-reference-template",t,{crid:t,srid:e}),function(e){return r.del(e,i?{"X-Reason":i}:{},s,function(){return t})})},o.deleteChildAndParentsSourceRef=function(t,e,i,s){return n.chainHttpPromises(r.getUrl("child-and-parents-relationship-source-reference-template",t,{caprid:t,srid:e}),function(e){var n={"Content-Type":"application/x-fs-v1+json"};return i&&(n["X-Reason"]=i),r.del(e,n,s,function(){return t})})},o}),t("parentsAndChildren",["attribution","changeHistory","fact","globals","helpers","notes","plumbing","sources"],function(t,e,n,r,i,s,o,a){var h=i.maybe,u={},c=u.ChildAndParents=function(t){t&&(t.father&&this.$setFather(t.father),t.mother&&this.$setMother(t.mother),t.child&&this.$setChild(t.child),t.fatherFacts&&this.$setFatherFacts(t.fatherFacts),t.motherFacts&&this.$setMotherFacts(t.motherFacts))};u.setMember=function(t,e){this[t]||(this[t]={}),e instanceof r.Person?(this[t].resource=e.$getPersonUrl(),delete this[t].resourceId):i.isAbsoluteUrl(e)?(this[t].resource=e,delete this[t].resourceId):(this[t].resourceId=e,delete this[t].resource)},u.deleteMember=function(t,e){this.$deletedMembers||(this.$deletedMembers={}),this.$deletedMembers[t]=e,delete this[t]},u.setFacts=function(t,e,n){i.isArray(this[t])&&i.forEach(this[t],function(e){u.deleteFact.call(this,t,e,n)},this),this[t]=[],i.forEach(e,function(e){u.addFact.call(this,t,e)},this)},u.addFact=function(t,e){i.isArray(this[t])||(this[t]=[]),e instanceof n.Fact||(e=new n.Fact(e)),this[t].push(e)},u.deleteFact=function(t,e,r){e instanceof n.Fact||(e=i.find(this[t],{id:e}));var s=i.indexOf(this[t],e);if(s>=0){var o=i.removeAccessToken(h(h(h(e).links).conclusion).href);o&&(this.$deletedFacts||(this.$deletedFacts={}),this.$deletedFacts[o]=r),this[t].splice(s,1)}},u.ChildAndParents.prototype={constructor:c,$getChildAndParentsUrl:function(){return i.removeAccessToken(h(h(this.links).relationship).href)},$getFatherFacts:function(){return this.fatherFacts||[]},$getMotherFacts:function(){return this.motherFacts||[]},$getFatherId:function(){return h(this.father).resourceId},$getFatherUrl:function(){return i.removeAccessToken(h(this.father).resource)},$getFather:function(){return r.getPerson(this.$getFatherUrl()||this.$getFatherId())},$getMotherId:function(){return h(this.mother).resourceId},$getMotherUrl:function(){return i.removeAccessToken(h(this.mother).resource)},$getMother:function(){return r.getPerson(this.$getMotherUrl()||this.$getMotherId())},$getChildId:function(){return h(this.child).resourceId},$getChildUrl:function(){return i.removeAccessToken(h(this.child).resource)},$getChild:function(){return r.getPerson(this.$getChildUrl()||this.$getChildId())},$getNotes:function(){return s.getChildAndParentsNotes(i.removeAccessToken(h(h(this.links).notes).href))},$getSourceRefs:function(){return a.getChildAndParentsSourceRefs(this.id)},$getSources:function(){return a.getChildAndParentsSourcesQuery(this.id)},$getChanges:function(){return e.getChildAndParentsChanges(i.removeAccessToken(h(this.links["change-history"]).href))},$setFather:function(t){return u.setMember.call(this,"father",t),this.$fatherChanged=!0,this},$setMother:function(t){return u.setMember.call(this,"mother",t),this.$motherChanged=!0,this},$setChild:function(t){return u.setMember.call(this,"child",t),this},$deleteFather:function(t){return u.deleteMember.call(this,"father",t),this},$deleteMother:function(t){return u.deleteMember.call(this,"mother",t),this},$setFatherFacts:function(t,e){return u.setFacts.call(this,"fatherFacts",t,e),this},$addFatherFact:function(t){return u.addFact.call(this,"fatherFacts",t),this},$deleteFatherFact:function(t,e){return u.deleteFact.call(this,"fatherFacts",t,e),this},$setMotherFacts:function(t,e){return u.setFacts.call(this,"motherFacts",t,e),this},$addMotherFact:function(t){return u.addFact.call(this,"motherFacts",t),this},$deleteMotherFact:function(t,e){return u.deleteFact.call(this,"motherFacts",t,e),this},$save:function(e,n,r){var s=new c,a=!1,h=this.id;(!this.id||this.$fatherChanged)&&(s.father=this.father,a=!0),(!this.id||this.$motherChanged)&&(s.mother=this.mother,a=!0),this.id||(s.child=this.child,a=!0),e&&(s.attribution=new t.Attribution(e)),i.forEach(["fatherFacts","motherFacts"],function(t){i.forEach(this[t],function(e){h&&e.id&&!e.$changed||(u.addFact.call(s,t,e),a=!0)})},this);var l=[];a&&l.push(i.chainHttpPromises(h?o.getUrl("child-and-parents-relationship-template",null,{caprid:h}):o.getUrl("relationships"),function(t){return i.forEach(["father","mother","child"],function(t){s[t]&&!s[t].resource&&s[t].resourceId&&(s[t].resource=s[t].resourceId)}),o.post(t,{childAndParentsRelationships:[s]},{"Content-Type":"application/x-fs-v1+json"},r,i.getResponseEntityId)})),i.forEach(["father","mother"],function(t){if(this.id&&this.$deletedMembers&&this.$deletedMembers.hasOwnProperty(t)&&!this[t]){var n=this.$deletedMembers[t]||e;l.push(i.chainHttpPromises(o.getUrl("child-and-parents-relationship-parent-template",null,{caprid:h,role:t}),function(t){var e={"Content-Type":"application/x-fs-v1+json"};return n&&(e["X-Reason"]=n),o.del(t,e,r)}))}},this),h&&this.$deletedFacts&&i.forEach(this.$deletedFacts,function(t,n){t=t||e;var i={"Content-Type":"application/x-fs-v1+json"};t&&(i["X-Reason"]=t),l.push(o.del(n,i,r))});var d=this,p=i.promiseAll(l).then(function(t){var e=h?h:t[0];return i.extendHttpPromise(p,l[0]),n?u.getChildAndParents(e,{},r).then(function(t){return i.deletePropertiesPartial(d,i.appFieldRejector),i.extend(d,t.getRelationship()),e}):e});return p},$delete:function(t,e){return u.deleteChildAndParents(this.$getChildAndParentsUrl()||this.id,t,e)}},u.getChildAndParents=function(e,s,a){return i.chainHttpPromises(o.getUrl("child-and-parents-relationship-template",e,{caprid:e}),function(e){return o.get(e,s,{Accept:"application/x-fs-v1+json"},a,i.compose(i.constructorSetter(c,"childAndParentsRelationships"),i.objectExtender(l),i.constructorSetter(n.Fact,"motherFacts",function(t){return h(t).childAndParentsRelationships}),i.constructorSetter(n.Fact,"fatherFacts",function(t){return h(t).childAndParentsRelationships}),i.constructorSetter(t.Attribution,"attribution",function(t){return i.flatMap(t.childAndParentsRelationships,function(t){return i.union(t.motherFacts,t.fatherFacts)})}),r.personMapper()))})};var l={getRelationship:function(){return h(this.childAndParentsRelationships)[0]},getPerson:function(t){return i.find(this.persons,{id:t})}};return u.deleteChildAndParents=function(t,e,n){return i.chainHttpPromises(o.getUrl("child-and-parents-relationship-template",t,{caprid:t}),function(r){var i={"Content-Type":"application/x-fs-v1+json"};return e&&(i["X-Reason"]=e),o.del(r,i,n,function(){return t})})},u}),t("pedigree",["globals","helpers","plumbing"],function(t,e,n){function r(t){return{getPersons:function(){return this.persons},exists:function(n){return!!s(e.find(this.persons,i(t,n))).id},getPerson:function(n){return e.find(this.persons,i(t,n))}}}function i(t,e){return function(n){return n.display[t]==e}}var s=e.maybe,o={};return o.getAncestry=function(o,a,h){return e.chainHttpPromises(n.getUrl("ancestry-query"),function(u){return n.get(u,e.extend({person:o},a),{},h,e.compose(e.objectExtender(r("ascendancyNumber")),a&&a.descendants?e.objectExtender({getDescendant:function(t){return e.find(this.persons,i("descendancyNumber",t))},existsDescendant:function(t){return!!s(e.find(this.persons,i("descendancyNumber",t))).id}}):null,t.personMapper(),e.objectExtender({$getAscendancyNumber:function(){return this.display.ascendancyNumber}},function(t){return s(t).persons}),a&&a.descendants?e.objectExtender({$getDescendancyNumber:function(){return this.display.descendancyNumber}},function(t){return s(t).persons}):null))})},o.getDescendancy=function(i,o,a){return e.chainHttpPromises(n.getUrl("descendancy-query"),function(h){return n.get(h,e.extend({person:i},o),{},a,e.compose(e.objectExtender(r("descendancyNumber")),t.personMapper(),e.objectExtender({$getDescendancyNumber:function(){return this.display.descendancyNumber}},function(t){return s(t).persons})))})},o}),t("searchAndMatch",["globals","helpers","plumbing"],function(t,e,n){function r(t){return t=t.replace(/[:"]/g,"").trim(),t.indexOf(" ")>=0?'"'+t+'"':t}function i(t){return e.map(e.filter(e.keys(t),function(t){return!u[t]}),function(e){return e+":"+r(t[e])}).join(" ")}function s(){return e.compose(e.objectExtender(c),e.constructorSetter(h,"entries"),t.personMapper(function(t){return e.map(o(t).entries,function(t){return o(t.content).gedcomx})}))}var o=e.maybe,a={},h=a.SearchResult=function(){};a.SearchResult.prototype={constructor:h,$getPerson:function(t){return e.find(o(o(this.content).gedcomx).persons,{id:t})},$getPrimaryPerson:function(){return this.$getPerson(this.id)},$getFullPrimaryPerson:function(){return t.getPerson(this.id)},$getFatherIds:function(){var t=this.id,n=this;return e.uniq(e.map(e.filter(o(o(this.content).gedcomx).relationships,function(e){return"http://gedcomx.org/ParentChild"===e.type&&e.person2.resourceId===t&&e.person1&&"http://gedcomx.org/Male"===o(n.$getPerson(e.person1.resourceId).gender).type}),function(t){return t.person1.resourceId}))},$getFathers:function(){return e.map(this.$getFatherIds(),this.$getPerson,this)},$getMotherIds:function(){var t=this.id,n=this;return e.uniq(e.map(e.filter(o(o(this.content).gedcomx).relationships,function(e){return"http://gedcomx.org/ParentChild"===e.type&&e.person2.resourceId===t&&e.person1&&"http://gedcomx.org/Male"!==o(n.$getPerson(e.person1.resourceId).gender).type}),function(t){return t.person1.resourceId}))},$getMothers:function(){return e.map(this.$getMotherIds(),this.$getPerson,this)},$getSpouseIds:function(){var t=this.id;return e.uniq(e.map(e.filter(o(o(this.content).gedcomx).relationships,function(e){return"http://gedcomx.org/Couple"===e.type&&(e.person1.resourceId===t||e.person2.resourceId===t)}),function(e){return e.person1.resourceId===t?e.person2.resourceId:e.person1.resourceId}))},$getSpouses:function(){return e.map(this.$getSpouseIds(),this.$getPerson,this)},$getChildIds:function(){var t=this.id;return e.uniq(e.map(e.filter(o(o(this.content).gedcomx).relationships,function(e){return"http://gedcomx.org/ParentChild"===e.type&&e.person1.resourceId===t&&e.person2}),function(t){return t.person2.resourceId}))},$getChildren:function(){return e.map(this.$getChildIds(),this.$getPerson,this)}};var u={start:!0,count:!0,context:!0},c={getSearchResults:function(){return this.entries||[]},getResultsCount:function(){return this.results||0},getIndex:function(){return this.index||0}};return a.getPersonSearch=function(t,r){return e.chainHttpPromises(n.getUrl("person-search"),function(o){return n.get(o,e.removeEmptyProperties({q:i(t),start:t.start,count:t.count,context:t.context}),{Accept:"application/x-gedcomx-atom+json"},r,e.compose(s(),function(t,e){return t.getContext=function(){return e.getResponseHeader("X-FS-Page-Context")},t}))})},a.getPersonMatches=function(t,r,i){return e.chainHttpPromises(n.getUrl("person-matches-template",t,{pid:t}),function(t){return n.get(t,r,{Accept:"application/x-gedcomx-atom+json"},i,s())})},a.getPersonMatchesQuery=function(t,r){return e.chainHttpPromises(n.getUrl("person-matches-query"),function(o){return n.get(o,e.removeEmptyProperties({q:i(t),start:t.start,count:t.count}),{Accept:"application/x-gedcomx-atom+json"},r,s())})},a}),t("spouses",["attribution","changeHistory","fact","globals","helpers","parentsAndChildren","plumbing","notes","sources"],function(t,e,n,r,i,s,o,a,h){var u=i.maybe,c={},l=c.Couple=function(t){t&&(t.husband&&this.$setHusband(t.husband),t.wife&&this.$setWife(t.wife),t.facts&&this.$setFacts(t.facts))};c.Couple.prototype={constructor:l,$getCoupleUrl:function(){return i.removeAccessToken(u(u(this.links).relationship).href)},$getFacts:function(){return this.facts||[]},$getMarriageFact:function(){return i.find(this.facts,{type:"http://gedcomx.org/Marriage"})},$getHusbandId:function(){return u(this.person1).resourceId},$getHusbandUrl:function(){return i.removeAccessToken(u(this.person1).resource)},$getHusband:function(){return r.getPerson(this.$getHusbandUrl()||this.$getHusbandId())},$getWifeId:function(){return u(this.person2).resourceId},$getWifeUrl:function(){return i.removeAccessToken(u(this.person2).resource)},$getWife:function(){return r.getPerson(this.$getWifeUrl()||this.$getWifeId())},$getSpouseId:function(t){return u(this.person1).resourceId===t?u(this.person2).resourceId:u(this.person1).resourceId},$getSpouseUrl:function(t){return i.removeAccessToken(u(this.person1).resourceId===t?u(this.person2).resource:u(this.person1).resource)},$getSpouse:function(t){
return r.getPerson(this.$getSpouseUrl(t)||this.$getSpouseId(t))},$getNotes:function(){return a.getCoupleNotes(i.removeAccessToken(u(u(this.links).notes).href))},$getSourceRefs:function(){return h.getCoupleSourceRefs(this.id)},$getSources:function(){return h.getCoupleSourcesQuery(this.id)},$getChanges:function(){return e.getCoupleChanges(i.removeAccessToken(u(this.links["change-history"]).href))},$setHusband:function(t){return s.setMember.call(this,"person1",t),this.$husbandChanged=!0,this},$setWife:function(t){return s.setMember.call(this,"person2",t),this.$wifeChanged=!0,this},$setFacts:function(t,e){return s.setFacts.call(this,"facts",t,e),this},$addFact:function(t){return s.addFact.call(this,"facts",t),this},$deleteFact:function(t,e){return s.deleteFact.call(this,"facts",t,e),this},$save:function(e,n,r){var a=new l,h=!1,u=this.id;(!this.id||this.$husbandChanged||this.$wifeChanged)&&(a.person1=this.person1,a.person2=this.person2,h=!0),e&&(a.attribution=new t.Attribution(e)),i.forEach(this.facts,function(t){u&&t.id&&!t.$changed||(s.addFact.call(a,"facts",t),h=!0)});var d=[];h&&(u||(a.type="http://gedcomx.org/Couple"),d.push(i.chainHttpPromises(u?o.getUrl("couple-relationship-template",null,{crid:u}):o.getUrl("relationships"),function(t){return i.forEach(["person1","person2"],function(t){a[t]&&!a[t].resource&&a[t].resourceId&&(a[t].resource=a[t].resourceId)}),o.post(t,{relationships:[a]},{},r,i.getResponseEntityId)}))),u&&this.$deletedFacts&&i.forEach(this.$deletedFacts,function(t,n){t=t||e,d.push(o.del(n,t?{"X-Reason":t}:{},r))});var p=this,g=i.promiseAll(d).then(function(t){var e=u?u:t[0];return i.extendHttpPromise(g,d[0]),n?c.getCouple(e,{},r).then(function(t){return i.deletePropertiesPartial(p,i.appFieldRejector),i.extend(p,t.getRelationship()),e}):e});return g},$delete:function(t,e){return c.deleteCouple(this.$getCoupleUrl()||this.id,t,e)}},c.getCouple=function(e,s,a){return i.chainHttpPromises(o.getUrl("couple-relationship-template",e,{crid:e}),function(e){return o.get(e,s,{},a,i.compose(i.constructorSetter(l,"relationships"),i.objectExtender(d),i.constructorSetter(n.Fact,"facts",function(t){return u(t).relationships}),i.constructorSetter(t.Attribution,"attribution",function(t){return i.flatMap(t.relationships,function(t){return t.facts})}),r.personMapper()))})};var d={getRelationship:function(){return u(this.relationships)[0]},getPerson:function(t){return i.find(this.persons,{id:t})}};return c.deleteCouple=function(t,e,n){return i.chainHttpPromises(o.getUrl("couple-relationship-template",t,{crid:t}),function(r){return o.del(r,e?{"X-Reason":e}:{},n,function(){return t})})},c}),t("person",["attribution","changeHistory","discussions","fact","globals","helpers","memories","name","notes","parentsAndChildren","pedigree","plumbing","searchAndMatch","sources","spouses","user"],function(t,e,n,r,i,s,o,a,h,u,c,l,d,p,g,f){function m(t){return t?" "+t:""}var y=s.maybe,v={},b=i.Person=v.Person=function(t){t&&(t.gender&&this.$setGender(t.gender),t.names&&this.$setNames(t.names),t.facts&&this.$setFacts(t.facts))};v.Person.prototype={constructor:b,$getFacts:function(t){return(t?s.filter(this.facts,{type:t}):this.facts)||[]},$getFact:function(t){return s.find(this.facts,{type:t})},$getBirth:function(){return this.$getFact("http://gedcomx.org/Birth")},$getBirthDate:function(){var t=this.$getBirth();return t?t.$getDate():""},$getBirthPlace:function(){var t=this.$getBirth();return t?t.$getPlace():""},$getChristening:function(){return this.$getFact("http://gedcomx.org/Christening")},$getChristeningDate:function(){var t=this.$getChristening();return t?t.$getDate():""},$getChristeningPlace:function(){var t=this.$getChristening();return t?t.$getPlace():""},$getDeath:function(){return this.$getFact("http://gedcomx.org/Death")},$getDeathDate:function(){var t=this.$getDeath();return t?t.$getDate():""},$getDeathPlace:function(){var t=this.$getDeath();return t?t.$getPlace():""},$getBurial:function(){return this.$getFact("http://gedcomx.org/Burial")},$getBurialDate:function(){var t=this.$getBurial();return t?t.$getDate():""},$getBurialPlace:function(){var t=this.$getBurial();return t?t.$getPlace():""},$getDisplayBirthDate:function(){return y(this.display).birthDate},$getDisplayBirthPlace:function(){return y(this.display).birthPlace},$getDisplayDeathDate:function(){return y(this.display).deathDate},$getDisplayDeathPlace:function(){return y(this.display).deathPlace},$getDisplayGender:function(){return y(this.display).gender},$getDisplayLifeSpan:function(){return y(this.display).lifespan},$getDisplayName:function(){return y(this.display).name},$getNames:function(t){return(t?s.filter(this.names,{type:t}):this.names)||[]},$getPreferredName:function(){return s.findOrFirst(this.names,{preferred:!0})},$getGivenName:function(){var t=this.$getPreferredName();return t&&(t=t.$getGivenName()),t},$getSurname:function(){var t=this.$getPreferredName();return t&&(t=t.$getSurname()),t},$getPersistentIdentifier:function(){return y(y(this.identifiers)["http://gedcomx.org/Persistent"])[0]},$getPersonUrl:function(){return s.removeAccessToken(y(y(this.links).person).href)},$getChanges:function(t){return e.getPersonChanges(s.removeAccessToken(this.links["change-history"].href),t)},$getDiscussionRefs:function(){return n.getPersonDiscussionRefs(s.removeAccessToken(this.links["discussion-references"].href))},$getMemoryPersonaRefs:function(){return o.getMemoryPersonaRefs(s.removeAccessToken(this.links["evidence-references"].href))},$getNotes:function(){return h.getPersonNotes(s.removeAccessToken(this.links.notes.href))},$getSourceRefs:function(){return p.getPersonSourceRefs(this.id)},$getSources:function(){return p.getPersonSourcesQuery(this.id)},$getSpouses:function(){return v.getSpouses(this.id)},$getParents:function(){return v.getParents(this.id)},$getChildren:function(){return v.getChildren(this.id)},$getMatches:function(){return d.getPersonMatches(this.id)},$getAncestry:function(t){return c.getAncestry(this.id,t)},$getDescendancy:function(t){return c.getDescendancy(this.id,t)},$getPersonPortraitUrl:function(t){return o.getPersonPortraitUrl(this.id,t)},$setNames:function(t,e){return s.isArray(this.names)&&s.forEach(this.names,function(t){this.$deleteName(t,e)},this),this.names=[],s.forEach(t,function(t){this.$addName(t)},this),this},$addName:function(t){return s.isArray(this.names)||(this.names=[]),t instanceof a.Name||(t=new a.Name(t)),this.names.push(t),this},$deleteName:function(t,e){t instanceof a.Name||(t=s.find(this.names,{id:t}));var n=s.indexOf(this.names,t);return n>=0&&(this.$deletedConclusions||(this.$deletedConclusions={}),this.$deletedConclusions[t.id]=e,this.names.splice(n,1)),this},$setFacts:function(t,e){return s.isArray(this.facts)&&s.forEach(this.facts,function(t){this.$deleteFact(t,e)},this),this.facts=[],s.forEach(t,function(t){this.$addFact(t)},this),this},$addFact:function(t){return s.isArray(this.facts)||(this.facts=[]),t instanceof r.Fact||(t=new r.Fact(t)),this.facts.push(t),this},$deleteFact:function(t,e){t instanceof r.Fact||(t=s.find(this.facts,{id:t}));var n=s.indexOf(this.facts,t);return n>=0&&(this.$deletedConclusions||(this.$deletedConclusions={}),this.$deletedConclusions[t.id]=e,this.facts.splice(n,1)),this},$setGender:function(e,n){return this.gender||(this.gender={}),this.gender.$changed=!0,this.gender.type=e,n&&(this.gender.attribution=new t.Attribution(n)),this},$save:function(e,n,r){var i=new b,o=!1;this.id&&(i.id=this.id),this.id||(this.gender||this.$setGender("http://gedcomx.org/Unknown"),s.isArray(this.names)&&0!==this.names.length||this.$addName({fullText:"Unknown",givenName:"Unknown"}),s.find(this.names,{preferred:!0})||this.names[0].$setPreferred(!0),1!==this.names.length||this.names[0].type||this.names[0].$setType("http://gedcomx.org/BirthName")),e&&(i.attribution=new t.Attribution(e)),!this.gender||this.gender.id&&!this.gender.$changed||(i.gender=this.gender,o=!0),s.forEach(this.names,function(t){(!t.id||t.$changed)&&(t.$getFullText()||t.$setFullText((m(t.$getPrefix())+m(t.$getGivenName())+m(t.$getSurname())+m(t.$getSuffix())).trim()),i.$addName(t),o=!0)}),s.forEach(this.facts,function(t){(!t.id||t.$changed)&&(i.$addFact(t),o=!0)});var a=[];o&&a.push(s.chainHttpPromises(i.id?l.getUrl("person-template",null,{pid:i.id}):l.getUrl("persons"),function(t){return l.post(t,{persons:[i]},{},r,s.getResponseEntityId)})),this.id&&this.$deletedConclusions&&s.forEach(this.$deletedConclusions,function(t,n){t=t||e,a.push(s.chainHttpPromises(l.getUrl("person-conclusion-template",null,{pid:i.id,cid:n}),function(e){return l.del(e,t?{"X-Reason":t}:{},r)}))});var h=this,u=s.promiseAll(a).then(function(t){var e=i.id?i.id:t[0];return s.extendHttpPromise(u,a[0]),n?v.getPerson(e,{},r).then(function(t){return s.deletePropertiesPartial(h,s.appFieldRejector),s.extend(h,t.getPerson()),e}):e});return u},$delete:function(t,e){return v.deletePerson(this.$getPersonUrl()||this.id,t,e)}},i.getPerson=v.getPerson=function(t,e,n){return s.chainHttpPromises(l.getUrl("person-template",t,{pid:t}),function(t){return l.get(t,e,{},n,s.compose(s.objectExtender({getPerson:function(){return this.persons[0]}}),v.personMapper(),function(t,e){return t.persons[0].$isReadOnly=function(){var t=e.getResponseHeader("Allow");return!!t&&t.indexOf("POST")<0},t}))})},i.personMapper=v.personMapper=function(e){var n=function(t){return s.flatMap(e?e(t):[t],function(t){return t.persons})};return s.compose(s.constructorSetter(b,"persons",e),s.constructorSetter(a.Name,"names",n),s.constructorSetter(r.Fact,"facts",n),s.constructorSetter(t.Attribution,"attribution",function(t){return s.flatMap(n(t),function(t){return s.union([t],t.names,t.facts,t.gender?[t.gender]:[])})}))},v.getMultiPerson=function(t,e,n){var r={};return s.forEach(t,function(t){r[t]=v.getPerson(t,e,n)}),s.promiseAll(r)},v.getPersonWithRelationships=function(e,n,i){return s.chainHttpPromises(l.getUrl("person-with-relationships-query"),function(o){return l.get(o,s.extend({person:e},n),{},i,s.compose(s.objectExtender({getPrimaryId:function(){return e}}),s.constructorSetter(r.Fact,"fatherFacts",function(t){return t.childAndParentsRelationships}),s.constructorSetter(r.Fact,"motherFacts",function(t){return t.childAndParentsRelationships}),s.constructorSetter(t.Attribution,"attribution",function(t){return s.flatMap(t.childAndParentsRelationships,function(t){return s.union(t.fatherFacts,t.motherFacts)})}),s.constructorSetter(r.Fact,"facts",function(t){return t.relationships}),s.constructorSetter(t.Attribution,"attribution",function(t){return s.flatMap(t.relationships,function(t){return t.facts})}),s.constructorSetter(u.ChildAndParents,"childAndParentsRelationships"),s.constructorSetter(g.Couple,"relationships"),s.objectExtender(w),v.personMapper()))})};var w={getPerson:function(t){return s.find(this.persons,{id:t})},getPrimaryPerson:function(){return this.getPerson(this.getPrimaryId())},getParentRelationships:function(){var t=this.getPrimaryId();return s.filter(this.childAndParentsRelationships,function(e){return y(e.child).resourceId===t})},getSpouseRelationships:function(){return s.filter(this.relationships,function(t){return"http://gedcomx.org/Couple"===t.type})},getSpouseRelationship:function(t){var e=this.getPrimaryId();return s.find(this.relationships,function(n){return"http://gedcomx.org/Couple"===n.type&&(e===n.$getHusbandId()?n.$getWifeId():n.$getHusbandId())===t})},getChildRelationships:function(){var t=this.getPrimaryId();return s.filter(this.childAndParentsRelationships,function(e){return y(e.father).resourceId===t||y(e.mother).resourceId===t})},getChildRelationshipsOf:function(t){var e=this.getPrimaryId();return s.filter(this.childAndParentsRelationships,function(n){return!(y(n.father).resourceId!==e&&y(n.mother).resourceId!==e||y(n.father).resourceId!=t&&y(n.mother).resourceId!=t)})},getFatherIds:function(){return s.uniq(s.map(s.filter(this.getParentRelationships(),function(t){return!!t.$getFatherId()}),function(t){return t.$getFatherId()},this))},getFathers:function(){return s.map(this.getFatherIds(),this.getPerson,this)},getMotherIds:function(){return s.uniq(s.map(s.filter(this.getParentRelationships(),function(t){return!!t.$getMotherId()}),function(t){return t.$getMotherId()},this))},getMothers:function(){return s.map(this.getMotherIds(),this.getPerson,this)},getSpouseIds:function(){return s.uniq(s.map(s.filter(this.getSpouseRelationships(),function(t){return t.$getHusbandId()&&t.$getWifeId()}),function(t){return this.getPrimaryId()===t.$getHusbandId()?t.$getWifeId():t.$getHusbandId()},this))},getSpouses:function(){return s.map(this.getSpouseIds(),this.getPerson,this)},getChildIds:function(){return s.uniq(s.map(this.getChildRelationships(),function(t){return t.$getChildId()},this))},getChildren:function(){return s.map(this.getChildIds(),this.getPerson,this)},getChildIdsOf:function(t){return s.uniq(s.map(this.getChildRelationshipsOf(t),function(t){return t.$getChildId()},this))},getChildrenOf:function(t){return s.map(this.getChildIdsOf(t),this.getPerson,this)}},A=s.compose(s.constructorSetter(g.Couple,"relationships"),s.constructorSetter(u.ChildAndParents,"childAndParentsRelationships"),s.objectExtender({getCoupleRelationships:function(){return s.filter(y(this).relationships,{type:"http://gedcomx.org/Couple"})||[]},getChildAndParentsRelationships:function(){return y(this).childAndParentsRelationships||[]},getPerson:function(t){return s.find(this.persons,{id:t})}}),s.constructorSetter(r.Fact,"facts",function(t){return t.relationships}),s.constructorSetter(r.Fact,"fatherFacts",function(t){return t.childAndParentsRelationships}),s.constructorSetter(r.Fact,"motherFacts",function(t){return t.childAndParentsRelationships}),s.constructorSetter(t.Attribution,"attribution",function(t){return s.union(s.flatMap(t.relationships,function(t){return t.facts}),s.flatMap(t.childAndParentsRelationships,function(t){return s.union(t.fatherFacts,t.motherFacts)}))}),v.personMapper());return v.getSpouses=function(t,e,n){return s.chainHttpPromises(l.getUrl("spouses-template",t,{pid:t}),function(t){return l.get(t,e,{},n,A)})},v.getParents=function(t,e,n){return s.chainHttpPromises(l.getUrl("parents-template",t,{pid:t}),function(t){return l.get(t,e,{},n,A)})},v.getChildren=function(t,e,n){return s.chainHttpPromises(l.getUrl("children-template",t,{pid:t}),function(t){return l.get(t,e,{},n,A)})},v.deletePerson=function(t,e,n){return s.chainHttpPromises(l.getUrl("person-template",t,{pid:t}),function(r){return l.del(r,e?{"X-Reason":e}:{},n,function(){return t})})},v.getPreferredSpouse=function(t,e,n){return s.chainHttpPromises(f.getCurrentUser(),function(e){var n=e.getUser().treeUserId;return l.getUrl("preferred-spouse-relationship-template",null,{uid:n,pid:t})},function(t){var r=l.get(t+".json",e,{},n);return s.handleRedirect(r,function(t){if(200===t.getStatusCode()){var e=t.getResponseHeader("Content-Location");return e.indexOf("child-and-parents-relationships")>=0?null:s.getLastUrlSegment(e)}return void 0})})},v.setPreferredSpouse=function(t,e,n){var r,i=[];return null===e?i.push(v.getChildren(t),function(t){var e=s.find(t.getChildAndParentsRelationships(),function(t){return!t.$getFatherId()||!t.$getMotherId()});return l.getUrl("child-and-parents-relationship-template",null,{caprid:e.id})}):i.push(l.getUrl("couple-relationship-template",e,{crid:e})),i.push(function(t){return r=t,f.getCurrentUser()},function(e){var n=e.getUser().treeUserId;return l.getUrl("preferred-spouse-relationship-template",null,{uid:n,pid:t})},function(e){return l.put(e,null,{Location:r},n,function(){return t})}),s.chainHttpPromises.apply(this,i)},v.deletePreferredSpouse=function(t,e){return s.chainHttpPromises(f.getCurrentUser(),function(e){var n=e.getUser().treeUserId;return l.getUrl("preferred-spouse-relationship-template",null,{uid:n,pid:t})},function(n){return l.del(n,{},e,function(){return t})})},v.getPreferredParents=function(t,e,n){return s.chainHttpPromises(f.getCurrentUser(),function(e){var n=e.getUser().treeUserId;return l.getUrl("preferred-parent-relationship-template",null,{uid:n,pid:t})},function(t){var r=l.get(t+".json",e,{Accept:"application/x-fs-v1+json"},n);return s.handleRedirect(r,function(t){return 200===t.getStatusCode()?s.getLastUrlSegment(t.getResponseHeader("Content-Location")):void 0})})},v.setPreferredParents=function(t,e,n){var r;return s.chainHttpPromises(l.getUrl("child-and-parents-relationship-template",e,{caprid:e}),function(t){return r=t,f.getCurrentUser()},function(e){var n=e.getUser().treeUserId;return l.getUrl("preferred-parent-relationship-template",null,{uid:n,pid:t})},function(e){return l.put(e,null,{Location:r},n,function(){return t})})},v.deletePreferredParents=function(t,e){return s.chainHttpPromises(f.getCurrentUser(),function(e){var n=e.getUser().treeUserId;return l.getUrl("preferred-parent-relationship-template",null,{uid:n,pid:t})},function(n){return l.del(n,{},e,function(){return t})})},v}),t("sourceBox",["attribution","helpers","plumbing","sources","user"],function(t,e,n,r,i){var s=e.maybe,o={},a=o.Collection=function(t){t&&(this.title=t.title)};return o.Collection.prototype={constructor:a,$getCollectionUrl:function(){return e.removeAccessToken(s(s(this.links).self).href)},$getSourceDescriptions:function(t){return o.getCollectionSourceDescriptions(e.removeAccessToken(this.links["source-descriptions"].href),t)},$save:function(t,r){var i=this,s=e.chainHttpPromises(i.id?n.getUrl("user-collection-template",null,{udcid:i.id}):n.getUrl("user-collections"),function(t){return n.post(t,{collections:[i]},{},r,function(t,e){return i.id||e.getResponseHeader("X-ENTITY-ID")})}),a=s.then(function(n){return e.extendHttpPromise(a,s),t?o.getCollection(n,{},r).then(function(t){return e.deletePropertiesPartial(i,e.appFieldRejector),e.extend(i,t.getCollection()),n}):n});return a},$delete:function(t){return o.deleteCollection(this.$getCollectionUrl()||this.id,t)}},o.getCollectionsForUser=function(r,i,s){return e.chainHttpPromises(n.getUrl("user-collections-for-user-template",r,{uid:r}),function(r){return n.get(r,{},{Accept:"application/x-fs-v1+json"},s,e.compose(e.objectExtender({getCollections:function(){return this.collections||[]}}),e.constructorSetter(a,"collections"),e.constructorSetter(t.Attribution,"attribution",function(t){return t.collections})))})},o.getCollection=function(r,i,o){return e.chainHttpPromises(n.getUrl("user-collection-template",r,{udcid:r}),function(r){return n.get(r,i,{Accept:"application/x-fs-v1+json"},o,e.compose(e.objectExtender({getCollection:function(){return s(this.collections)[0]}}),e.constructorSetter(a,"collections"),e.constructorSetter(t.Attribution,"attribution",function(t){return t.collections})))})},o.getCollectionSourceDescriptions=function(i,s,o){return e.chainHttpPromises(n.getUrl("user-collection-source-descriptions-template",i,{udcid:i}),function(i){return n.get(i,s,{Accept:"application/x-fs-v1+json"},o,e.compose(e.objectExtender({getSourceDescriptions:function(){return this.sourceDescriptions||[]}}),e.constructorSetter(r.SourceDescription,"sourceDescriptions"),e.constructorSetter(t.Attribution,"attribution",function(t){return t.sourceDescriptions})))})},o.getCollectionSourceDescriptionsForUser=function(i,s,o){return e.chainHttpPromises(n.getUrl("user-collections-source-descriptions-for-user-template",i,{uid:i}),function(i){return n.get(i,s,{Accept:"application/x-fs-v1+json"},o,e.compose(e.objectExtender({getSourceDescriptions:function(){return this.sourceDescriptions||[]}}),e.constructorSetter(r.SourceDescription,"sourceDescriptions"),e.constructorSetter(t.Attribution,"attribution",function(t){return t.sourceDescriptions})))})},o.moveSourceDescriptionsToCollection=function(t,i,s){return e.chainHttpPromises(n.getUrl("user-collection-source-descriptions-template",t,{udcid:t}),function(o){var a=e.map(i,function(t){return{id:t instanceof r.SourceDescription?t.id:t}});return n.post(o,{sourceDescriptions:a},{},s,function(){return t})})},o.removeSourceDescriptionsFromCollections=function(t,s){return e.chainHttpPromises(i.getCurrentUser(),function(t){var e=t.getUser().treeUserId;return n.getUrl("user-collections-source-descriptions-for-user-template",null,{uid:e})},function(i){var o=e.map(t,function(t){return t instanceof r.SourceDescription?t.id:t});return n.del(e.appendQueryParameters(i,{id:o}),{},s,function(){return t})})},o.deleteCollection=function(t,r){return e.chainHttpPromises(n.getUrl("user-collection-template",t,{udcid:t}),function(e){return n.del(e,{},r,function(){return t})})},o}),t("utilities",["globals","helpers"],function(t,e){var n={};return n.getRedirectUrl=function(t){return e.appendAccessToken(e.appendQueryParameters(e.getAPIServerUrl("/platform/redirect"),t))},n}),t("FamilySearch",["init","authentication","authorities","changeHistory","discussions","fact","helpers","memories","name","notes","parentsAndChildren","pedigree","person","plumbing","searchAndMatch","sourceBox","sources","spouses","user","utilities"],function(t,e,n,r,i,s,o,a,h,u,c,l,d,p,g,f,m,y,v,b){return{init:t.init,getAuthCode:e.getAuthCode,getAccessToken:e.getAccessToken,getAccessTokenForMobile:e.getAccessTokenForMobile,hasAccessToken:e.hasAccessToken,invalidateAccessToken:e.invalidateAccessToken,Date:n.Date,Place:n.Place,getDate:n.getDate,getPlaceSearch:n.getPlaceSearch,Change:r.Change,getPersonChanges:r.getPersonChanges,getChildAndParentsChanges:r.getChildAndParentsChanges,getCoupleChanges:r.getCoupleChanges,restoreChange:r.restoreChange,Discussion:i.Discussion,DiscussionRef:i.DiscussionRef,Comment:i.Comment,getPersonDiscussionRefs:i.getPersonDiscussionRefs,getDiscussion:i.getDiscussion,getMultiDiscussion:i.getMultiDiscussion,getDiscussionComments:i.getDiscussionComments,deleteDiscussion:i.deleteDiscussion,deleteDiscussionRef:i.deleteDiscussionRef,deleteDiscussionComment:i.deleteDiscussionComment,deleteMemoryComment:i.deleteMemoryComment,Fact:s.Fact,Memory:a.Memory,MemoryPersona:a.MemoryPersona,MemoryPersonaRef:a.MemoryPersonaRef,MemoryArtifactRef:a.MemoryArtifactRef,getMemoryPersonaRefs:a.getMemoryPersonaRefs,getMemory:a.getMemory,getMemoryComments:a.getMemoryComments,getMemoryPersonas:a.getMemoryPersonas,getMemoryPersona:a.getMemoryPersona,getPersonPortraitUrl:a.getPersonPortraitUrl,getPersonMemoriesQuery:a.getPersonMemoriesQuery,getUserMemoriesQuery:a.getUserMemoriesQuery,deleteMemory:a.deleteMemory,deleteMemoryPersona:a.deleteMemoryPersona,deleteMemoryPersonaRef:a.deleteMemoryPersonaRef,Name:h.Name,Note:u.Note,getPersonNotes:u.getPersonNotes,getPersonNote:u.getPersonNote,getMultiPersonNote:u.getMultiPersonNote,getCoupleNotes:u.getCoupleNotes,getCoupleNote:u.getCoupleNote,getMultiCoupleNote:u.getMultiCoupleNote,getChildAndParentsNotes:u.getChildAndParentsNotes,getChildAndParentsNote:u.getChildAndParentsNote,getMultiChildAndParentsNote:u.getMultiChildAndParentsNote,deletePersonNote:u.deletePersonNote,deleteCoupleNote:u.deleteCoupleNote,deleteChildAndParentsNote:u.deleteChildAndParentsNote,ChildAndParents:c.ChildAndParents,deleteChildAndParents:c.deleteChildAndParents,getChildAndParents:c.getChildAndParents,getAncestry:l.getAncestry,getDescendancy:l.getDescendancy,Person:d.Person,deletePerson:d.deletePerson,getPerson:d.getPerson,getMultiPerson:d.getMultiPerson,getPersonWithRelationships:d.getPersonWithRelationships,getSpouses:d.getSpouses,getParents:d.getParents,getChildren:d.getChildren,getPreferredSpouse:d.getPreferredSpouse,setPreferredSpouse:d.setPreferredSpouse,deletePreferredSpouse:d.deletePreferredSpouse,getPreferredParents:d.getPreferredParents,setPreferredParents:d.setPreferredParents,deletePreferredParents:d.deletePreferredParents,get:p.get,post:p.post,put:p.put,del:p.del,http:p.http,getTotalProcessingTime:p.getTotalProcessingTime,setTotalProcessingTime:p.setTotalProcessingTime,SearchResult:g.SearchResult,getPersonSearch:g.getPersonSearch,getPersonMatches:g.getPersonMatches,getPersonMatchesQuery:g.getPersonMatchesQuery,Collection:f.Collection,getCollectionsForUser:f.getCollectionsForUser,getCollection:f.getCollection,getCollectionSourceDescriptions:f.getCollectionSourceDescriptions,getCollectionSourceDescriptionsForUser:f.getCollectionSourceDescriptionsForUser,moveSourceDescriptionsToCollection:f.moveSourceDescriptionsToCollection,removeSourceDescriptionsFromCollections:f.removeSourceDescriptionsFromCollections,deleteCollection:f.deleteCollection,SourceDescription:m.SourceDescription,SourceRef:m.SourceRef,getPersonSourceRefs:m.getPersonSourceRefs,getPersonSourcesQuery:m.getPersonSourcesQuery,getSourceDescription:m.getSourceDescription,getMultiSourceDescription:m.getMultiSourceDescription,getCoupleSourceRefs:m.getCoupleSourceRefs,getCoupleSourcesQuery:m.getCoupleSourcesQuery,getChildAndParentsSourceRefs:m.getChildAndParentsSourceRefs,getChildAndParentsSourcesQuery:m.getChildAndParentsSourcesQuery,getSourceRefsQuery:m.getSourceRefsQuery,deleteSourceDescription:m.deleteSourceDescription,deletePersonSourceRef:m.deletePersonSourceRef,deleteCoupleSourceRef:m.deleteCoupleSourceRef,deleteChildAndParentsSourceRef:m.deleteChildAndParentsSourceRef,Couple:y.Couple,deleteCouple:y.deleteCouple,getCouple:y.getCouple,Agent:v.Agent,User:v.User,getCurrentUser:v.getCurrentUser,getAgent:v.getAgent,getMultiAgent:v.getMultiAgent,getRedirectUrl:b.getRedirectUrl}}),e("FamilySearch")}),SpacerTree.prototype.build=function(t,e){var n=this.dfsBuild(t[e]),r=n.getRectangles(),i=this.listToMap(r);return this.node=n,this.nodeMap=i,i},SpacerTree.prototype.dfsBuild=function(t){var e=new SquareNode(t.x,t.width,t.height,t.id);if(0==t.children.length)return e;for(var n=[],r=0;r<t.children.length;r++){var i=t.children[r];n.push(this.dfsBuild(i))}return MultiNode.generate(e,n,Math.floor(n.length/2))},SpacerTree.prototype.listToMap=function(t){for(var e={},n=0;n<t.length;n++)e[t[n].id]=t[n];return e},Vector2D.ZERO=new Vector2D,Vector2D.X_AXIS=new Vector2D(1,0),Vector2D.Y_AXIS=new Vector2D(0,1),Vector2D.distance=function(t,e,n,r){var i=t-n,s=e-r;return Math.sqrt(i*i+s*s)},Vector2D.prototype.getCopy=function(){return new Vector2D(this.x,this.y)},Vector2D.prototype.copyValues=function(t,e){return"undefined"==typeof e?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),this},Vector2D.prototype.add=function(t,e){return"undefined"==typeof e?(this.x+=t.x,this.y+=t.y):(this.x+=t,this.y+=e),this},Vector2D.prototype.getAddedCopy=function(t,e){return"undefined"==typeof e?new Vector2D(this.x+t.x,this.y+t.y):new Vector2D(this.x+t,this.y+e)},Vector2D.prototype.subtract=function(t,e){return"undefined"==typeof e?(this.x-=t.x,this.y-=t.y):(this.x-=t,this.y-=e),this},Vector2D.prototype.getSubtractedCopy=function(t,e){return"undefined"==typeof e?new Vector2D(this.x-t.x,this.y-t.y):new Vector2D(this.x-t,this.y-e)},Vector2D.prototype.distanceTo=function(t){var e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)},Vector2D.prototype.distanceSquaredTo=function(t){var e=this.x-t.x,n=this.y-t.y;return e*e+n*n},Vector2D.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},Vector2D.prototype.length=function(){return this.x*this.x+this.y*this.y},Vector2D.prototype.invert=function(){return this.x*=-1,this.y*=-1,this},Vector2D.prototype.getInvertedCopy=function(){return new Vector2D(-1*this.x,-1*this.y)},Vector2D.prototype.scale=function(t){return this.x*=t,this.y*=t,this},Vector2D.prototype.getScaledCopy=function(t){return new Vector2D(this.x*t,this.y*t)},Vector2D.prototype.limit=function(t){var e=this.length();if(e>t){var n=t/e;return this.scale(n)}return this},Vector2D.prototype.getLimitedCopy=function(t){var e=this.length();if(e>t){var n=t/e;return this.getScaledCopy(n)}return this.getCopy()},Vector2D.prototype.normalize=function(){return this.limit(1)},Vector2D.prototype.getNormalized=function(){return this.getLimitedCopy(1)},Vector2D.prototype.setLength=function(t){var e=t/this.length();return this.scale(e)},Vector2D.prototype.getCopyOfLength=function(t){var e=t/this.length();return this.getScaledCopy(e)},Vector2D.prototype.print=function(){return"("+this.x+","+this.y+")"},CanvasRenderingContext2D.prototype.roundRect=function(t,e,n,r,i){return 2*i>n&&(i=n/2),2*i>r&&(i=r/2),this.beginPath(),this.moveTo(t+i,e),this.arcTo(t+n,e,t+n,e+r,i),this.arcTo(t+n,e+r,t,e+r,i),this.arcTo(t,e+r,t,e,i),this.arcTo(t,e,t+n,e,i),this.closePath(),this},Ancestor.prototype.setChildRelativeValues=function(t,e,n){for(;n>=this.childrenCounts.length;)this.childrenCounts.push(0),this.childrenPercents.push(0);this.childrenCounts[n]=e,this.childrenPercents[n]=t},Ancestor.prototype.setNiblingRelativeValues=function(t,e,n){for(;n>=this.niblingCounts.length;)this.niblingCounts.push(0),this.niblingPercents.push(0);this.niblingCounts[n]=e,this.niblingPercents[n]=t},Ancestor.prototype.getChildRelativePercent=function(t){return 0>t?this.childrenPercents[0]:t>=this.childrenPercents.length?this.childrenPercents[this.childrenPercents.length-1]:this.childrenPercents[t]},Ancestor.prototype.getNiblingRelativePercent=function(t){return 0>t?this.niblingPercents[0]:t>=this.niblingPercents.length?this.niblingPercents[this.niblingPercents.length-1]:this.niblingPercents[t]},Ancestor.prototype.getFocusChildCount=function(t){return 0>t?1:t>=this.childrenCounts.length?this.childrenCounts[this.childrenCounts.length-1]:this.childrenCounts[t]},Ancestor.prototype.getFocusNiblingCount=function(t){return 0>t?1:t>=this.niblingCounts.length?this.niblingCounts[this.niblingCounts.length-1]:this.niblingCounts[t]},Ancestor.prototype.getFcc=function(t,e){var n=this.getFocusChildCount(t)-1,r=this.getFocusChildCount(t+1)-1,i=n*e+r*(1-e);return i},Ancestor.prototype.getFccTimed=function(t,e){var n=this.getFocusChildCount(t)-1,r=this.getFocusChildCount(t+1)-1,i=n*e+r*(1-e);return i},Ancestor.prototype.getFnc=function(t,e){var n=this.getFocusNiblingCount(t)-1,r=this.getFocusNiblingCount(t+1)-1,i=n*e+r*(1-e);return i},Ancestor.prototype.getFcrp=function(t,e){var n=this.getFocusChildCount(t)-1,r=this.getChildRelativePercent(t),i=this.getFocusChildCount(t+1)-1,s=this.getChildRelativePercent(t+1),o=n*e+i*(1-e);if(0==o)return 0;var a=(r*n*e+s*i*(1-e))/o;return a},Ancestor.prototype.getFnrp=function(t,e){var n=this.getFocusNiblingCount(t)-1,r=this.getNiblingRelativePercent(t),i=this.getFocusNiblingCount(t+1)-1,s=this.getNiblingRelativePercent(t+1),o=n*e+i*(1-e);if(0==o)return 0;var a=(r*n*e+s*i*(1-e))/o;return a},Ancestor.prototype.getId=function(){return this.id},Ancestor.prototype.getChildRank=function(t){for(var e=0;e<this.children.length;e++)if(this.children[e].getId()==t)return e;return-1},Ancestor.prototype.getChildren=function(){return this.children},Ancestor.prototype.getParent=function(){return this.parent},Ancestor.prototype.setParent=function(t){this.parent=t},Ancestor.prototype.getGenerationCount=function(){return this.childrenCounts.length},Ancestor.prototype.trimValuesTo=function(t){t<=this.childrenCounts.length&&(this.childrenCounts=this.childrenCounts.slice(0,t)),t<=this.niblingCounts.length&&(this.niblingCounts=this.niblingCounts.slice(0,t)),t<=this.childrenPercents.length&&(this.childrenPercents=this.childrenPercents.slice(0,t)),t<=this.niblingPercents.length&&(this.niblingPercents=this.niblingPercents.slice(0,t))},Map.scaleToTree=function(t,e,n){return new Vector2D(t.x/e,t.y/n)},Map.scaleFromTree=function(t,e,n){return new Vector2D(t.x*e,t.y*n)},Tree2.prototype.clear=function(){this.db=new AncestorDB,this.nodes=[],this.breadthFirstNodes=[]},Tree2.prototype.isEmpty=function(){return 0==this.db.size()},Tree2.prototype.contains=function(t){return this.db.contains(t)},Tree2.prototype.getNodes=function(){return this.nodes},Tree2.prototype.getBreadthFirstNodes=function(){if(0==this.breadthFirstNodes.length){if(0==this.nodes.length)return this.breadthFirstNodes;var t=[];for(t.push(this.nodes[0].getId());t.length>0;){var e=this.lookup[t.shift()];this.breadthFirstNodes.push(e);for(var n=0;n<e.getChildren().length;n++)t.push(e.getChildren()[n].getId())}}return this.breadthFirstNodes},Tree2.prototype.setTopAndBottom=function(t,e){this.top=t,this.bottom=e,this.nodes.length>0&&this.setIdToPoint(this.nodes[0].getId(),this.nodes[0].getPoint());
},Tree2.prototype.addToNodes=function(t){return this.lookup[t.id]=t,this.nodes.push(t),t},Tree2.prototype.assignPointWithId=function(t,e,n,r){if(this.nodes=[],this.breadthFirstNodes=[],this.db.contains(t)){for(var i=this.db.get(t);null!=i.getParent();){var s=i.getParent(),o=i.getFnrp(n,r),a=i.getFnc(n,r),h=s.getFcrp(n+1,r),u=(o-h)*a,c=e.x+1,l=e.y-u;e=new Vector2D(c,l),n++,i=s}var d=new Node(i.getId());d.setPoint(e),d=this.addToNodes(d),this.addChildrenWithPoint(i,d,n,r)}},Tree2.prototype.addChildrenWithPoint=function(t,e,n,r){var i=this.getBounds(t,e.getPoint(),n,r);if(!(-2>=n)&&i.high>=this.top&&i.low<=this.bottom)for(var s=[],o=0;o<t.getChildren().length;o++){var a=t.getChildren()[o],h=e.getPoint(),u=t.getFcc(n,r),c=t.getFcrp(n,r),l=a.getFnrp(n-1,r),d=u*(c-l),p=new Node(a.getId()),g=h.x-1,f=h.y-d;p.setPoint(new Vector2D(g,f)),p=this.addToNodes(p),s[o]=p,p.setParent(e),e.addChild(p),this.addChildrenWithPoint(a,p,n-1,r)}},Tree2.prototype.getBounds=function(t,e,n,r){var i=t.getFcc(n,r),s=t.getFcrp(n,r),o=e.y-i*s,a=o+i;return{low:o,high:a}},Tree2.prototype.getClosestNode=function(t){for(var e=Number.MAX_VALUE,n=null,r=0;r<this.nodes.length;r++){var i=this.distanceSquared(this.nodes[r].getPoint(),t);e>i&&(e=i,n=this.nodes[r])}return n},Tree2.prototype.getGeneration=function(t){return Math.floor(t)},Tree2.prototype.getPercent=function(t){return 1-(t-this.getGeneration(t))},Tree2.prototype.translate=function(t,e){var n=e.x-t.x,r=e.y-t.y,i=this.getClosestNode(t);if(null==i)return[];var s=i.getPoint(),s={x:s.x+n,y:s.y+r},o=this.getGeneration(s.x),a=this.getPercent(s.x);return this.assignPointWithId(i.getId(),s,o-1,a),this.nodes},Tree2.prototype.setIdToPoint=function(t,e){var n=this.getGeneration(e.x),r=this.getPercent(e.x);return this.assignPointWithId(t,{x:e.x,y:e.y},n-1,r),this.nodes},Tree2.prototype.distanceSquared=function(t,e){return(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)},Tree2.prototype.getNode=function(t){return this.db.get(t)},Tree2.prototype.add=function(t,e,n){var r=this.db.addChild(t,e,n);if(!r)return console.log("unable to add"),this.nodes;for(var i=null,s=0;s<this.nodes.length;s++)if(this.nodes[s].getId()==t){i=this.nodes[s];break}return null!=i&&this.setIdToPoint(t,i.getPoint()),this.nodes},Tree2.prototype.remove=function(t){if(!this.db.contains(t))return void console.log("database does not have id to remove");var e=this.db.get(t),n=e.getParent();if(null==n)return this.db=new AncestorDB,this.nodes=[],void(this.breadthFirstNodes=[]);var r=n.getChildRank(t),i=this.db.removeChild(n.getId(),r);if(!i)return nodes;for(var s=null,o=0;o<this.nodes.length;o++)if(this.nodes[o].getId()==n.getId()){s=nodes[o];break}return null!=s&&setIdToPoint(n.getId(),s.getPoint()),this.nodes},AncestorDB.prototype.get=function(t){return this.db[t]},AncestorDB.prototype.getDB=function(){return this.db},AncestorDB.prototype.contains=function(t){return this.db.hasOwnProperty(t)},AncestorDB.prototype.size=function(){return Object.keys(this.db).length},AncestorDB.prototype.extendRoot=function(t){if(!this.rootId)throw"Cannot extend root, not yet set";var e=this.db[this.rootId],n=new Ancestor(t);e.setParent(n),n.getChildren().push(e),this.db[t]=n,this.rootId=t,this.updateChanges(e)},AncestorDB.prototype.addChild=function(t,e,n){if(this.db.length>0&&!(t in this.db))return console.log("Can't have more than one root"),!1;if(this.contains(e))return console.log("ChildId is already in the database "+e),!1;var r=new Ancestor(e);if(r.setChildRelativeValues(.5,1,0),this.db[e]=r,!this.db.hasOwnProperty(t))return this.rootId=e,!0;var i=this.db[t];return n>i.getChildren().length&&(n=i.getChildren().length),0>n&&(n=0),i.getChildren().length>0?i.getChildren().splice(n,0,r):i.getChildren().push(r),r.setParent(i),this.updateChanges(r),!0},AncestorDB.prototype.removeChild=function(t,e){if(!this.contains(t))return console.log("Parent does not exist to removeChild"),!1;var n=this.db[t];if(0==n.getChildren().length)return!1;e>n.getChildren().length-1&&(e=n.getChildren().length-1),0>e&&(e=0);var r=n.getChildren()[e],i=r.getGenerationCount();n.getChildren().splice(e,1);var s=[];for(s.push(r);0!=s.length;){for(var o=s.shift(),a=0;a<o.getChildren().length;a++)s.push(o.getChildren()[a]);delete this.db[o.getId()]}return this.trimParents(n,i),this.updateChanges(n),!0},AncestorDB.prototype.updateChanges=function(t){for(;null!=t;){for(var e=0,n=0;n<t.getChildren().length;n++){var r=t.getChildren()[n];r.getGenerationCount()>e&&(e=r.getGenerationCount())}for(var n=1;e>=n;n++)this.processParents(n,t);t=t.getParent()}},AncestorDB.prototype.trimParents=function(t,e){if(null!=t){for(var n=0,r=0;r<t.getChildren().length;r++){var i=t.getChildren()[r];i.getGenerationCount()>n&&(n=i.getGenerationCount())}if(e>n){for(t.trimValuesTo(n+1),r=0;r<t.getChildren().length;r++){var i=t.getChildren()[r];i.trimValuesTo(n)}this.trimParents(t.getParent(),e+1)}}},AncestorDB.prototype.processParents=function(t,e){if(null!=e){for(var n=0,r=0;r<e.getChildren().length;r++){var i=e.getChildren()[r];n+=i.getFocusChildCount(t-1)}for(var s=0,r=0;r<e.getChildren().length;r++){var i=e.getChildren()[r],o=.5;n>0?(o=(s+(i.getFocusChildCount(t-1)-1)*i.getChildRelativePercent(t-1))/Math.max(n-1,1),i.setNiblingRelativeValues(o,n,t-1)):i.setNiblingRelativeValues(o,1,t-1),s+=i.getFocusChildCount(t-1)}var a=e.getChildren()[0],h=e.getChildren()[e.getChildren().length-1],u=(a.getNiblingRelativePercent(t-1)+h.getNiblingRelativePercent(t-1))/2;e.setChildRelativeValues(u,n,t),this.processParents(t+1,e.getParent())}},Node.prototype.setParent=function(t){this.parent=t},Node.prototype.getParent=function(){return this.parent},Node.prototype.addChild=function(t){this.children.push(t)},Node.prototype.getChildren=function(){return this.children},Node.prototype.getChildrenId=function(){return this.childrenIds},Node.prototype.clearChildren=function(){this.children=[],this.childrenIds=[]},Node.prototype.setPoint=function(t){this.point={x:t.x,y:t.y}},Node.prototype.getPoint=function(){return this.point},Node.prototype.getId=function(){return this.id},Node.prototype.setId=function(t){this.id=t},TreeAlt.prototype.clear=function(){this.db=new AncestorDB,this.nodes=[],this.breadthFirstNodes=[]},TreeAlt.prototype.isEmpty=function(){return 0==this.db.size()},TreeAlt.prototype.contains=function(t){return this.db.contains(t)},TreeAlt.prototype.getNodes=function(){return this.nodes},TreeAlt.prototype.setTopAndBottom=function(t,e){this.top=t,this.bottom=e,this.height=e-t-2,this.nodes.length>0&&this.setIdToPoint(this.nodes[0].getId(),this.nodes[0].getPoint())},TreeAlt.prototype.addToNodes=function(t){return this.nodes.push(t),t},TreeAlt.prototype.assignPointWithId=function(t,e,n,r){if(this.nodes=[],this.breadthFirstNodes=[],this.db.contains(t)){for(var i=this.db.get(t);null!=i.getParent();){var s=i.getParent(),o=(this.getPersonFNRP(i,e.y,this.height,n,r),i.getFnc(n,r),this.getParentFCRP(i,e.y,this.height,n,r),e.x+1),a=this.getParentY(s,i,e.y,this.height,n,r);e=new Vector2D(o,a),n++,i=s}var h=new Node(i.getId());h.setPoint(e),h=this.addToNodes(h),this.addChildrenWithPoint(i,h,n,r)}},TreeAlt.prototype.addChildrenWithPoint=function(t,e,n,r){var i=this.getBounds(t,e.getPoint(),n,r);if(!(-2>=n)&&i.high>=this.top&&i.low<=this.bottom)for(var s=[],o=0;o<t.getChildren().length;o++){var a=t.getChildren()[o],h=e.getPoint(),u=new Node(a.getId()),c=h.x-1,l=this.getChildY(t,a,h.y,this.height,n,r);u.setPoint(new Vector2D(c,l)),u=this.addToNodes(u),s[o]=u,u.setParent(e),e.addChild(u),this.addChildrenWithPoint(a,u,n-1,r)}},TreeAlt.prototype.getChildY=function(t,e,n,r,i,s){var o=e.getFcc(i-1,s),a=e.getFcrp(i-1,s),h=e.getFnc(i-1,s),u=e.getFnrp(i-1,s),c=r,l=n,d=o,p=a,g=h,f=u,m=c*((-(1-l/c)*g+l+g*f-d*p+d)/(d+c));return m},TreeAlt.prototype.getParentY=function(t,e,n,r,i,s){var o=e.getFcc(i,s),a=e.getFcrp(i,s),h=e.getFnc(i,s),u=e.getFnrp(i,s),c=n,l=r,d=o,p=a,g=h,f=u,m=(d*((p-1)*l+c)+l*(-g*f+g+c))/(g+l);return m},TreeAlt.prototype.getPersonFCRP=function(t,e){return t/e},TreeAlt.prototype.getParentFCRP=function(t,e,n,r,i){var s=this.getPersonFNRP(t,e,n,r,i),o=t.getFnc(r,i),a=(e+o*(1-s))/(o+n);return a},TreeAlt.prototype.getPersonFNRP=function(t,e,n,r,i){var s=t.getFcc(r,i),o=t.getFcrp(r,i),a=t.getFnc(r,i),h=t.getFnrp(r,i),u=e/n,c=h+s/a*(u-o);return c},TreeAlt.prototype.getBounds=function(t,e,n,r){var i=t.getFcc(n,r),s=this.getPersonFCRP(e.y,this.height),o=e.y-i*s,a=o+i;return{low:o,high:a}},TreeAlt.prototype.getClosestNode=function(t){for(var e=Number.MAX_VALUE,n=null,r=0;r<this.nodes.length;r++){var i=this.distanceSquared(this.nodes[r].getPoint(),t);e>i&&(e=i,n=this.nodes[r])}return n},TreeAlt.prototype.distanceSquared=function(t,e){return(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)},TreeAlt.prototype.getGeneration=function(t){return Math.floor(t)},TreeAlt.prototype.getPercent=function(t){return 1-(t-this.getGeneration(t))},TreeAlt.prototype.translate=function(t,e){var n=e.x-t.x,r=e.y-t.y,i=this.getClosestNode(t);if(null==i)return[];var s=i.getPoint();s={x:s.x+n,y:s.y+r};var o=this.getGeneration(s.x),a=this.getPercent(s.x);return this.assignPointWithId(i.getId(),s,o-1,a),this.nodes},TreeAlt.prototype.setIdToPoint=function(t,e){var n=this.getGeneration(e.x),r=this.getPercent(e.x);return this.assignPointWithId(t,{x:e.x,y:e.y},n-1,r),this.nodes},TreeAlt.prototype.getNode=function(t){return this.db.get(t)},TreeAlt.prototype.extendRoot=function(t){if(this.db.extendRoot(t),this.nodes.length>0){var e=this.nodes[0];this.setIdToPoint(e.getId(),e.getPoint())}},TreeAlt.prototype.add=function(t,e,n){var r=this.db.addChild(t,e,n);if(!r)return console.log("unable to add"),this.nodes;for(var i=null,s=0;s<this.nodes.length;s++)if(this.nodes[s].getId()==t){i=this.nodes[s];break}return null!=i&&this.setIdToPoint(t,i.getPoint()),this.nodes},TreeAlt.prototype.remove=function(t){if(!this.db.contains(t))return void console.log("Tree does not have id to remove: "+t);var e=this.db.get(t),n=e.getParent();if(null==n)return this.db=new AncestorDB,this.nodes=[],void(this.breadthFirstNodes=[]);var r=n.getChildRank(t),i=this.db.removeChild(n.getId(),r);if(!i)return this.nodes;for(var s=null,o=0;o<this.nodes.length;o++)if(this.nodes[o].getId()==n.getId()){s=this.nodes[o];break}return null!=s&&this.setIdToPoint(n.getId(),s.getPoint()),this.nodes};var DDTree=function(){function t(){this.db=new DDAncestorDB,this.top=0,this.bottom=0,this.nodes=[]}return t.prototype.getNodes=function(){return this.nodes},t.prototype.setTopAndBottom=function(t,e){this.top=t,this.bottom=e},t.prototype.add=function(t,e,n){this.db.addChild(t,e,n,1);for(var r=null,i=0;i<this.nodes.length;i++)if(this.nodes[i].getId()==t){r=this.nodes[i];break}return null!=r&&this.setIdToPoint(t,r.getPoint()),this.nodes},t.prototype.setIdToPoint=function(t,e){var n=this.getGeneration(e.getX()-.5),r=this.getPercent(e.getX()-.5);return this.assignPointWithId(t,new Point(e.getX(),e.getY()),n,r),this.nodes},t.prototype.getClosestNode=function(t){for(var e=Number.MAX_VALUE,n=null,r=0;r<this.nodes.length;r++){var i=this.nodes[r],s=this.distanceSquared(this.nodes[r].getPoint(),t);e>s&&(e=s,n=i)}return n},t.prototype.translate=function(t,e){var n=e.getX()-t.getX(),r=e.getY()-t.getY(),i=this.getClosestNode(t);if(null===i)return[];var s=i.getPoint();return s=new Point(s.getX()+n,s.getY()+r),this.setIdToPoint(i.getId(),s),this.nodes},t.prototype.distanceSquared=function(t,e){return(t.getX()-e.getX())*(t.getX()-e.getX())+(t.getY()-e.getY())*(t.getY()-e.getY())},t.prototype.getGeneration=function(t){return Math.floor(t)},t.prototype.getPercent=function(t){return 1-(t-this.getGeneration(t))},t.prototype.assignPointWithId=function(t,e,n,r){if(this.nodes=[],this.db.contains(t)){for(var i=this.db.get(t);null!==i.getParent();){var s=i.getParent(),o=i.getFnrp(n,r),a=i.getFnc(n,r),h=s.getFcrp(n+1,r),u=(o-h)*a,c=e.getX()+1,l=e.getY()-u;e=new Point(c,l),n++,i=s}var d=new DDNode;d.setId(i.getId()),d.setPoint(e),this.nodes.push(d),this.addChildrenWithPoint(i,d,n,r)}},t.prototype.addChildrenWithPoint=function(t,e,n,r){var i=this.getBounds(t,e.getPoint(),n,r);if(!(-1>=n)&&i.high>=this.top&&i.low<=this.bottom)for(var s=0;s<t.getChildren().length;s++){var o=t.getChildren()[s],a=e.getPoint(),h=t.getFcc(n,r),u=t.getFcrp(n,r),c=o.getFnrp(n-1,r),l=h*(u-c),d=a.getX()-1,p=a.getY()-l,g=new DDNode;g.setId(o.getId()),g.setPoint(new Point(d,p)),this.nodes.push(g),g.setParent(e),e.addChild(g),this.addChildrenWithPoint(o,g,n-1,r)}},t.prototype.getBounds=function(t,e,n,r){var i=t.getFcc(n,r),s=t.getFcrp(n,r),o=e.getY()-i*s,a=o+i;return{low:o,high:a}},t}(),DDNode=function(){function t(){this.children=[]}return t.prototype.setParent=function(t){this.parent=t},t.prototype.getParent=function(){return this.parent},t.prototype.addChild=function(t){this.children.push(t)},t.prototype.getChildren=function(){return this.children},t.prototype.getId=function(){return this.id},t.prototype.setId=function(t){this.id=t},t.prototype.getPoint=function(){return this.pt},t.prototype.setPoint=function(t){this.pt=t},t}(),DDAncestorDB=function(){function t(){this.hasRoot=!1,this.db={}}return t.prototype.get=function(t){return this.db[t]},t.prototype.contains=function(t){return this.db.hasOwnProperty(t)},t.prototype.addChild=function(t,e,n,r){if(this.hasRoot&&!this.db.hasOwnProperty(t))throw"Cannot set a second root";if(this.db.hasOwnProperty(e))throw"Child id is already in the database "+e;var i=new DDAncestor;if(i.setId(e),i.setChildRelativeValues(0,r,0),this.db[e]=i,this.db.hasOwnProperty(t)){var s=this.db[t];n>s.getChildren().length&&(n=s.getChildren().length),0>n&&(n=0),s.getChildren().length>0?s.getChildren().splice(n,0,i):s.getChildren().push(i),i.setParent(s),this.updateChanges(i)}},t.prototype.updateChanges=function(t){for(;null!=t;){for(var e=0,n=0;n<t.getChildren().length;n++){var r=t.getChildren()[n];r.getGenerationCount()>e&&(e=r.getGenerationCount());for(var n=1;e>=n;n++)this.processParents(t,n)}t=t.getParent()}},t.prototype.processParents=function(t,e){if(t){for(var n=0,r=0;r<t.getChildren().length;r++){var i=t.getChildren()[r];n+=i.getFocusChildCount(e-1)}for(var s=0,r=0;r<t.getChildren().length;r++){var i=t.getChildren()[r],o=.5;n>0?(o=(s+i.getFocusChildCount(e-1)*i.getChildRelativePercent(e-1))/Math.max(n,1),i.setNiblingRelativeValues(o,n,e-1)):i.setNiblingRelativeValues(o,i.getFocusChildCount(e-1),e-1),s+=i.getFocusChildCount(e-1)}var a=t.getChildren()[0],h=t.getChildren()[t.getChildren().length-1],u=(a.getNiblingRelativePercent(e-1)+h.getNiblingRelativePercent(e-1))/2;t.setChildRelativeValues(u,n,e),this.processParents(t.getParent(),e+1)}},t}(),DDAncestor=function(){function t(){this.children=[],this.parent=null,this.id=null,this.niblingPercents=[],this.niblingCounts=[],this.childrenPercents=[],this.childrenCounts=[]}return t.prototype.getChildren=function(){return this.children},t.prototype.addChild=function(t){this.children.push(t)},t.prototype.getParent=function(){return this.parent},t.prototype.setParent=function(t){this.parent=t},t.prototype.getId=function(){return this.id},t.prototype.setId=function(t){this.id=t},t.prototype.setChildRelativeValues=function(t,e,n){for(;n>=this.childrenCounts.length;)this.childrenCounts.push(0),this.childrenPercents.push(0);this.childrenCounts[n]=e,this.childrenPercents[n]=t},t.prototype.setNiblingRelativeValues=function(t,e,n){for(;n>=this.niblingCounts.length;)this.niblingCounts.push(0),this.niblingPercents.push(0);this.niblingCounts[n]=e,this.niblingPercents[n]=t},t.prototype.getChildRelativePercent=function(t){return 0>t?this.childrenPercents[0]:t>=this.childrenPercents.length?this.childrenPercents[this.childrenPercents.length-1]:this.childrenPercents[t]},t.prototype.getNiblingRelativePercent=function(t){return 0>t?this.niblingPercents[0]:t>=this.niblingPercents.length?this.niblingPercents[this.niblingPercents.length-1]:this.niblingPercents[t]},t.prototype.getFocusChildCount=function(t){return 0>t?1:t>=this.childrenCounts.length?this.childrenCounts[this.childrenCounts.length-1]:this.childrenCounts[t]},t.prototype.getFocusNiblingCount=function(t){return 0>t?1:t>=this.niblingCounts.length?this.niblingCounts[this.niblingCounts.length-1]:this.niblingCounts[t]},t.prototype.getFcc=function(t,e){var n=this.getFocusChildCount(t),r=this.getFocusChildCount(t+1),i=n*e+r*(1-e);return i},t.prototype.getFnc=function(t,e){var n=this.getFocusNiblingCount(t),r=this.getFocusNiblingCount(t+1),i=n*e+r*(1-e);return i},t.prototype.getFcrp=function(t,e){var n=this.getFocusChildCount(t),r=this.getChildRelativePercent(t),i=this.getFocusChildCount(t+1),s=this.getChildRelativePercent(t+1),o=n*e+i*(1-e),a=(r*n*e+s*i*(1-e))/o;return 0===o?a:a},t.prototype.getFnrp=function(t,e){var n=this.getFocusNiblingCount(t),r=this.getNiblingRelativePercent(t),i=this.getFocusNiblingCount(t+1),s=this.getNiblingRelativePercent(t+1),o=n*e+i*(1-e),a=(r*n*e+s*i*(1-e))/o;return 0===o?a:a},t.prototype.trimToLargestChild=function(t){t<=this.childrenCounts.length&&(this.childrenCounts=this.childrenCounts.slice(0,t)),t<=this.niblingCounts.length&&(this.niblingCounts=this.niblingCounts.slice(0,t)),t<=this.childrenPercents.length&&(this.childrenPercents=this.childrenPercents.slice(0,t)),t<=this.niblingPercents.length&&(this.niblingPercents=this.niblingPercents.slice(0,t))},t.prototype.getGenerationCount=function(){return this.childrenCounts.length},t}(),GraphicObject=function(){function t(){this.listener={translate:function(t,e){},scale:function(t,e){},click:function(t){},clickPt:function(t){},rotate:function(t,e,n){},requestIds:function(t,e,n,r){}}}return t.prototype.setListener=function(t){this.listener=t},t.prototype.fireTranslate=function(t,e){this.listener.translate(t,e)},t.prototype.fireClick=function(t){this.listener.click(t)},t.prototype.fireClickPt=function(t){this.listener.clickPt(t)},t.prototype.fireScale=function(t,e){this.listener.scale(t,e)},t.prototype.fireRotate=function(t,e,n){this.listener.rotate(t,e,n)},t.prototype.fireRequestIds=function(t,e,n,r){this.listener.requestIds(t,e,n,r)},t}(),ViewFactoryFacade=function(){function t(){}return t.init=function(){t.initialized||(t.factories={},t.factories.svg=BoxStyleFactory,t.factories.canvas=CanvasElementFactory,t.initialized=!0)},t.setSetting=function(e){t.setting=e},t.getFactory=function(e){return t.factories[e]},t.getWidth=function(e){return t.init(),t.getFactory(this.setting).getWidth(e)},t.getHeight=function(e){return t.init(),t.getFactory(this.setting).getHeight(e)},t.initialized=!1,t}(),MainViewManager=function(){function t(){function t(t){r.glidePt1=null,r.glidePt2=null,c=t,r.ptList.push(t),r.triggerRefresh()}function e(t){r.glidePt1=null,r.glidePt2=null,l=c,c=t,r.ptList.push(t),r.triggerRefresh()}function n(t,e,n){e*=15,n*=15,r.glidePt2=new Point(t.x,t.y),r.glidePt1=new Point(t.x+e,t.y+n),r.ptList=[],l=null,c=null,r.triggerRefresh()}this.svg=document.getElementById("vp-chart"),this.svgTouch=document.getElementById("vp-touch"),this.svgTouch||(this.svgTouch=this.svg),this.pendingHeight=null,this.pendingWidth=null,this.setHeight=null,this.setWidth=null;var r=this;this.scale=1,this.rotation=0,this.width=100,this.height=100,this.scaledWidth=100,this.scaledHeight=100,this.boundingRect=this.svg.getBoundingClientRect(),this.change=!0,this.refreshTriggered=!1,this.graphicObject=new GraphicObject,this.modalManager=new ModalManager,$(this.svgTouch).unmousewheel(),$(this.svgTouch).mousewheel(function(t){var e=i(r.svg,t),n=0;n=t.deltaY>0?.9:10/9,r.graphicObject.fireScale(n,r.viewToWorld(new Point(e.x,e.y)))});var i=function(t,e){var n=r.boundingRect;return{x:e.clientX-n.left,y:e.clientY-n.top}},s=function(t,e){return r.boundingRect||(r.boundingRect=t.getBoundingClientRect()),{x:e.x-r.boundingRect.left,y:e.y-r.boundingRect.top}},o=new Hammer(this.svgTouch),a=o.add(new Hammer.Pan({direction:Hammer.DIRECTION_ALL,threshold:0})),h=new Hammer.Pinch;o.add([a,h]),o.on("panmove",function(t){t.preventDefault(),t.srcEvent&&t.srcEvent.preventDefault(),e(s(this.svgTouch,t.center))}),o.on("panend pancancel",function(t){n(s(this.svg,t.center),t.velocityX,t.velocityY)}),o.on("panstart",function(e){e.preventDefault(),e.srcEvent&&e.srcEvent.preventDefault(),t(s(this.svgTouch,e.center))}),o.on("tap",function(t){t.preventDefault();var e=s(this.svgTouch,t.center);r.graphicObject.fireClickPt(r.viewToWorld(new Point(e.x,e.y)))});var u=1;o.on("pinchstart",function(t){u=1}),o.on("pinch",function(t){var e=s(this.svgTouch,t.center),n=u/t.scale;u=t.scale,r.graphicObject.fireScale(n,r.viewToWorld(new Point(e.x,e.y)))}),o.on("pinchend",function(t){});var c=null,l=null;this.ptList=[],this.glidePt1=null,this.glidePt2=null;var d=this.svg.nodeName.toLowerCase();"svg"===d?(ViewFactoryFacade.setSetting(d),this.ascSvgManager=new SVGManager("vp-chart"),this.svgManager=new SVGManager("vp-chart")):"canvas"===d&&(ViewFactoryFacade.setSetting(d),this.ascSvgManager=new CanvasManager("vp-chart"),this.svgManager=new CanvasManager("vp-chart")),this.ascSvgManager.setReflection(!0)}return t.prototype.getClosestBoxInBoxmap=function(t,e){var n=null,r=Number.POSITIVE_INFINITY,i=e.getRoot(),s=[];for(s.push(i);s.length>0;){var o=e.getId(s.shift()),a=o.getNode(),h=a.getBranchIds(),u=o.getX(),c=o.getY(),l=this.distanceSquared(t,new Point(u,c));r>l&&(r=l,n=o);for(var d=0;d<h.length;d++){var p=e.getId(h[d]);p&&s.push(h[d])}}return n},t.prototype.getClosestBox=function(t){var e=this.getClosestBoxInBoxmap(t,this.ascBoxes),n=this.getClosestBoxInBoxmap(t,this.dscBoxes),r=this.distanceSquared(t,new Point(e.getX(),e.getY())),i=this.distanceSquared(t,new Point(n.getX(),n.getY()));return r>i?n:e},t.prototype.distanceSquared=function(t,e){return(t.getX()-e.getX())*(t.getX()-e.getX())+(t.getY()-e.getY())*(t.getY()-e.getY())},t.prototype.refresh=function(t){return this.svgManager.refresh(t)},t.prototype.refreshAsc=function(t){return this.ascBoxes=t,this.triggerRefresh(),this.graphicObject},t.prototype.refreshDsc=function(t){return this.dscBoxes=t,this.triggerRefresh(),this.graphicObject},t.prototype.triggerRefresh=function(){var t=this;this.refreshTriggered?this.refreshTriggered=!0:window.requestAnimationFrame(function(e){t.realRefresh(),this.refreshTriggered=!1})},t.prototype.realRefresh=function(){if(this.ptList.length>1){var t=this.ptList[0],e=this.ptList[this.ptList.length-1],n=new Point(t.x,t.y),r=new Point(e.x,e.y);this.graphicObject.fireTranslate(this.viewToWorld(n),this.viewToWorld(r)),this.ptList=[],this.ptList.push(e)}if(this.glidePt1&&this.glidePt2){var i={x:this.glidePt1.getX()-this.glidePt2.getX(),y:this.glidePt1.getY()-this.glidePt2.getY()};Math.abs(i.x)<.1&&Math.abs(i.y)<.1?(this.glidePt1=null,this.glidePt2=null):(this.glidePt2=this.glidePt1,this.glidePt1=new Point(this.glidePt1.getX()+.85*i.x,this.glidePt1.getY()+.85*i.y),this.graphicObject.fireTranslate(this.viewToWorld(this.glidePt1),this.viewToWorld(this.glidePt2)))}this.realSetSize(),this.ascSvgManager.clean(),this.svgManager.clean(),this.ascSvgManager.refresh(this.ascBoxes);var s=this.svgManager.refresh(this.dscBoxes);this.graphicObject=s,this.graphicObject.fireRequestIds(this.ascSvgManager.getRequestIds(),this.ascSvgManager.getRequestExtendRootId(),this.svgManager.getRequestIds(),this.svgManager.getRequestExtendRootId())},t.prototype.setTranslation=function(t,e){this.svgManager.setTranslation(t,e)},t.prototype.setScale=function(t){this.scale=t,this.ascSvgManager.setScale(t),this.svgManager.setScale(t)},t.prototype.setSize=function(t,e){this.pendingHeight=e,this.pendingWidth=t},t.prototype.realSetSize=function(){(this.setHeight!==this.pendingHeight||this.setWidth!==this.pendingWidth||null===this.setHeight||null===this.setWidth)&&(this.setWidth=this.pendingWidth,this.setHeight=this.pendingHeight,this.svg.width=this.setWidth,this.svg.height=this.setHeight,this.boundingRect=this.svg.getBoundingClientRect(),this.width=this.boundingRect.right-this.boundingRect.left,this.height=this.boundingRect.bottom-this.boundingRect.top,this.scaledWidth=this.width*this.scale,this.scaledHeight=this.height*this.scale,this.ascSvgManager.setSize(this.width,this.height),this.svgManager.setSize(this.width,this.height))},t.prototype.rotate=function(t){this.rotation+=t,this.rotation%=2*Math.PI,this.ascSvgManager.rotate(t),this.svgManager.rotate(t)},t.prototype.setReflection=function(t){},t.prototype.viewToWorld=function(t){return t=this.scalePt(t,this.scale),t=this.rotatePt(t,-this.rotation)},t.prototype.worldToView=function(t){return t=this.scalePt(t,1/this.scale),t=this.rotatePt(t,this.rotation)},t.prototype.translate=function(t,e,n){return new Point(t.getX()+e,t.getY()+n)},t.prototype.rotatePt=function(t,e){var n=Math.sin(e),r=Math.cos(e);return new Point(r*t.getX()-n*t.getY(),n*t.getX()+r*t.getY())},t.prototype.scalePt=function(t,e){return new Point(t.getX()*e,t.getY()*e)},t.prototype.getGraphicObject=function(){return this.svgManager.getGraphicObject()},t.prototype.getRequestIds=function(){return this.svgManager.getRequestIds().concat(this.ascSvgManager.getRequestIds())},t.prototype.getRequestExtendRootId=function(){return null},t.prototype.clean=function(){},t}(),CanvasManager=function(){function t(t){this.graphicObject=new GraphicObject,this.refreshTriggered=!1,this.reflect=!1,this.requestIds=[],this.requestExtendRootId=null;var e=document.getElementById(t);this.svgRoot=e,this.bufferCtx=this.svgRoot.getContext("2d"),this.elementManager=new CanvasElementManager(this.bufferCtx);this.boundingRect=null,this.elements={},this.scale=1,this.translationX=0,this.translationY=0,this.rotation=0,this.boundingRect=e.getBoundingClientRect(),this.width=this.boundingRect.right-this.boundingRect.left,this.height=this.boundingRect.bottom-this.boundingRect.top}return t.prototype.clean=function(){this.bufferCtx.clearRect(0,0,this.svgRoot.width,this.svgRoot.height)},t.prototype.refresh=function(t){return this.lastBoxes=t,this.bufferCtx.setTransform(1,0,0,1,0,0),this.drawLine2(t),this.drawHighlight(t),this.drawBoxes(t),this.lastBoxes=t,this.graphicObject},t.prototype.getGraphicObject=function(){return this.graphicObject},t.prototype.drawBoxes=function(t){if(this.bufferCtx.setTransform(1,0,0,1,0,0),!t)return void this.elementManager.clearUnusedElement();var e=t.getRoot(),n=[],r=this.viewToWorld(new Point(0,0)),i=this.viewToWorld(new Point(this.width,this.height));this.elementManager.setReflect(this.reflect),this.elementManager.setBounds(r.getX(),r.getY(),i.getX(),i.getY()),this.requestIds=[];var n=[];for(n.push(e);n.length>0;){var s=t.getId(n.shift()),o=s.getNode(),a=o.getBranchIds();if(s.hasAttr("spouseIds"))for(var h=s.getAttr("spouseIds"),u=0;u<h.length;u++){var c=t.getId(h[u]);if(c){var l=new Point(c.getX(),c.getY());this.reflect&&(l=this.reflectPt(l)),l=new Point(l.getX()/this.scale,l.getY()/this.scale),c.setAttr("point",l),c.setAttr("scale",1/this.scale),this.elementManager.requestElement(c)}}(o.hasAttr("isDummyNode")||o.hasAttr("hightlight"))&&this.elementManager.inBounds(s)&&this.requestIds.push(s.getNode().getId());var d=new Point(s.getX(),s.getY());this.reflect&&(d=this.reflectPt(d)),d=new Point(d.getX()/this.scale,d.getY()/this.scale),s.setAttr("point",d),s.setAttr("scale",1/this.scale),this.elementManager.requestElement(s);for(var u=0;u<a.length;u++){var p=t.getId(a[u]);p&&n.push(a[u])}}this.elementManager.clearUnusedElement();var g=this.viewToWorld(new Point(this.width/2,this.height/2));this.requestIds.sort(function(e,n){var r=t.getId(e),i=t.getId(n),s=0,o=0;return r.hasAttr("highlight")||(s=(g.getX()-r.getX())*(g.getX()-r.getX())+(g.getY()-r.getY())*(g.getY()-r.getY())),i.hasAttr("highlight")||(o=(g.getX()-i.getX())*(g.getX()-i.getX())+(g.getY()-i.getY())*(g.getY()-i.getY())),s-o})},t.prototype.toCenterPoint=function(t){return t},t.prototype.drawLine2=function(t){if(t){this.reflect?this.bufferCtx.setTransform(-1/this.scale,0,0,1/this.scale,this.width,0):this.bufferCtx.setTransform(1/this.scale,0,0,1/this.scale,0,0);var e=this.bufferCtx;e.beginPath();var n=t.getRoot(),r=[];r.push(n);var i=t.getId(n),s=i.getNode();for(this.elementManager.inBounds(i)&&s.hasAttr("extendRootId")?this.requestExtendRootId=s.getAttr("extendRootId"):this.requestExtendRootId=null;r.length>0;){for(var o=t.getId(r.shift()),a=o.getNode(),h=a.getBranchIds(),u=o.getX(),c=o.getY(),l=[],d=0;d<h.length;d++){var p=t.getId(h[d]);p&&l.push(h[d])}if(h=l,0===h.length)e.moveTo(u,c),e.lineTo(u-o.getWidth()/2,o.getY());else if(1==h.length){var g=this.toCenterPoint(t.getId(h[0]));e.moveTo(u,c),e.lineTo(g.getX(),g.getY())}else{var g=this.toCenterPoint(t.getId(h[0])),f=this.toCenterPoint(t.getId(h[1])),m=this.toCenterPoint(t.getId(h[h.length-1])),y=this.toCenterPoint(t.getId(h[h.length-2])),v=(g.getX()+u)/2,b=5,w=Math.min(f.getY()-g.getY(),c-g.getY(),b),A=v,P=g.getY()+w;e.moveTo(u,c),e.lineTo(v,c);for(var x=1;x<h.length-1;x++){var C=this.toCenterPoint(t.getId(h[x]));e.moveTo(C.getX(),C.getY()),e.lineTo(v,C.getY())}var I=b,S=Math.min(m.getY()-y.getY(),m.getY()-c,I),T=v,N=m.getY()-S;e.moveTo(g.getX(),g.getY()),e.lineTo(v-b,g.getY()),e.quadraticCurveTo(v,g.getY(),A,P),e.lineTo(T,N),e.quadraticCurveTo(T,N+S,T-I,N+S),e.lineTo(m.getX(),m.getY())}for(var d=0;d<h.length;d++){var p=t.getId(h[d]);p&&r.push(h[d])}}this.bufferCtx.strokeStyle="#000000",this.bufferCtx.lineWidth="1",e.stroke()}},t.prototype.drawHighlight=function(t){if(t){this.reflect?this.bufferCtx.setTransform(-1/this.scale,0,0,1/this.scale,this.width,0):this.bufferCtx.setTransform(1/this.scale,0,0,1/this.scale,0,0);var e=this.bufferCtx;e.beginPath();var n=t.getRoot(),r=[];for(r.push(n);r.length>0;){for(var i=t.getId(r.shift()),s=i.getNode(),o=s.getBranchIds(),a=i.getX(),h=i.getY(),u=[],c=0;c<o.length;c++){var l=t.getId(o[c]);l&&u.push(o[c])}if(o=u,i.hasAttr("highlight"))if(o.length<1);else if(1==o.length){var d=t.getId(o[0]);if(d.hasAttr("highlight")){var p=d.getAttr("highlight");if(p.hasOwnProperty(s.getAttr("downloadId"))){var g=this.toCenterPoint(t.getId(o[0]));e.moveTo(a,h),e.lineTo(g.getX(),g.getY())}}}else{for(var g=this.toCenterPoint(t.getId(o[0])),f=this.toCenterPoint(t.getId(o[1])),m=this.toCenterPoint(t.getId(o[o.length-1])),y=this.toCenterPoint(t.getId(o[o.length-2])),v=(g.getX()+a)/2,b=!1,w=!1,A=[],P=0;P<o.length;P++){var x=t.getId(o[P]);if(x.hasAttr("highlight")&&x.getAttr("highlight").hasOwnProperty(s.getAttr("downloadId"))){0===P&&(b=!0),P===o.length-1&&(w=!0);var C=this.toCenterPoint(x);A.push(C.getY())}}if(A.length>0){var c=0,I=A.length,S=!1;if(b){var T=5,N=Math.min(f.getY()-g.getY(),h-g.getY(),T),M=v,R=g.getY()+N;e.moveTo(g.getX(),g.getY()),e.lineTo(v-T,g.getY()),e.quadraticCurveTo(v,g.getY(),M,R),c++}else h<A[0]?(e.moveTo(a,h),e.lineTo(v,h),S=!0):(e.moveTo(g.getX(),A[0]),e.lineTo(v,A[0]),c++);if(w){var $=5,D=Math.min(m.getY()-y.getY(),m.getY()-h,$),E=v,F=m.getY()-D;e.lineTo(E,F),e.quadraticCurveTo(E,F+D,E-$,F+D),e.lineTo(m.getX(),m.getY()),I--}else h>A[A.length-1]?(e.lineTo(v,h),e.lineTo(a,h),S=!0):(e.lineTo(v,A[A.length-1]),e.lineTo(g.getX(),A[A.length-1]),I--);for(S||(e.moveTo(a,h),e.lineTo(v,h));I>c;c++)e.moveTo(g.getX(),A[c]),e.lineTo(v,A[c])}}for(var c=0;c<o.length;c++){var l=t.getId(o[c]);l&&r.push(o[c])}}this.bufferCtx.strokeStyle="#FF0000",this.bufferCtx.lineWidth="3",this.bufferCtx.stroke()}},t.prototype.getRequestIds=function(){return this.requestIds},t.prototype.getRequestExtendRootId=function(){return this.requestExtendRootId},t.prototype.setTranslation=function(t,e){this.refresh(this.lastBoxes)},t.prototype.setScale=function(t){this.scale=t,this.scaledWidth=this.width*this.scale,this.scaledHeight=this.height*this.scale},t.prototype.setSize=function(t,e){this.width=t,this.height=e,this.scaledWidth=this.width*this.scale,this.scaledHeight=this.height*this.scale,this.boundingRect=this.svgRoot.getBoundingClientRect(),this.refresh(this.lastBoxes)},t.prototype.setReflection=function(t){this.reflect=t},t.prototype.viewToWorld=function(t){return t=this.scalePt(t,this.scale),t=this.rotatePt(t,-this.rotation)},t.prototype.worldToView=function(t){return t=this.scalePt(t,1/this.scale),t=this.rotatePt(t,this.rotation)},t.prototype.translate=function(t,e,n){return new Point(t.getX()+e,t.getY()+n)},t.prototype.rotatePt=function(t,e){
var n=Math.sin(e),r=Math.cos(e);return new Point(r*t.getX()-n*t.getY(),n*t.getX()+r*t.getY())},t.prototype.scalePt=function(t,e){return new Point(t.getX()*e,t.getY()*e)},t.prototype.reflectPt=function(t){return new Point(this.width*this.scale-t.getX(),t.getY())},t.prototype.rotate=function(t){this.rotation+=t,this.rotation%=2*Math.PI,this.refresh(this.lastBoxes)},t}(),CanvasImage=function(){function t(){this.buffer=document.createElement("canvas"),this.bufferCtx=this.buffer.getContext("2d"),this.changed=!0,this.sizeChanged=!0,this.unscaledWidth=this.getRenderWidth(),this.unscaledHeight=this.getRenderHeight(),this.width=this.unscaledWidth,this.height=this.unscaledHeight,this.xscale=1,this.yscale=1,this.tx=0,this.ty=0,this.data={},this.data.timestamp=Date.now(),this.refreshed=!0}return t.prototype.setScale=function(t,e){var n=t*this.unscaledWidth,r=e*this.unscaledHeight;n!==this.width?(this.changed=!0,this.sizeChanged=!0):r!==this.height&&(this.changed=!0,this.sizeChanged=!0),this.width=n,this.height=r,this.xscale=t,this.yscale=e},t.prototype.setRotation=function(t){},t.prototype.setTranslation=function(t,e){this.tx=t,this.ty=e},t.prototype.refresh=function(){var t=!1;if(this.sizeChanged&&(this.buffer.width=this.width,this.buffer.height=this.height,this.bufferCtx.setTransform(this.xscale,0,0,this.yscale,0,0),this.dataChanged=!0,t=!0),this.dataChanged&&this.data.hasOwnProperty("timestamp")){this.bufferCtx.clearRect(0,0,this.buffer.width,this.buffer.height);var e=15*Math.abs((1e3-this.data.timestamp%2e3)/1e3)+5;this.bufferCtx.lineWidth=3,this.bufferCtx.fillStyle="none",this.bufferCtx.strokeStyle="black",this.bufferCtx.beginPath(),this.bufferCtx.arc(25,25,e,0,2*Math.PI),this.bufferCtx.stroke(),t=!0}return this.sizeChanged=!1,this.dataChanged=!1,this.changed=!1,this.refreshed=this.refreshed||t,t=this.refreshed},t.prototype.render=function(t){t.drawImage(this.buffer,this.tx,this.ty,this.unscaledWidth,this.unscaledHeight)},t.prototype.update=function(t){this.data.timestamp!==t.timestamp&&(this.data=t,this.dataChanged=!0)},t.prototype.getHeight=function(){return 50},t.prototype.getWidth=function(){return 50},t.prototype.getRenderHeight=function(){return 50},t.prototype.getRenderWidth=function(){return 50},t.prototype.getType=function(){return"_image"},t.prototype.getNewElement=function(){return null},t}(),ImageLoading=function(){function t(){this.buffer=document.createElement("canvas"),this.bufferCtx=this.buffer.getContext("2d"),this.changed=!0,this.sizeChanged=!0,this.unscaledWidth=this.getRenderWidth(),this.unscaledHeight=this.getRenderHeight(),this.width=this.unscaledWidth,this.height=this.unscaledHeight,this.xscale=1,this.yscale=1,this.tx=0,this.ty=0,this.data={},this.refreshed=!0}return t.prototype.setScale=function(t,e){var n=t*this.unscaledWidth,r=e*this.unscaledHeight;n!==this.width?(this.changed=!0,this.sizeChanged=!0):r!==this.height&&(this.changed=!0,this.sizeChanged=!0),this.width=n,this.height=r,this.xscale=t,this.yscale=e},t.prototype.setRotation=function(t){},t.prototype.setTranslation=function(t,e){this.tx=t,this.ty=e},t.prototype.refresh=function(){var t=!1;if(this.sizeChanged&&(this.buffer.width=this.width,this.buffer.height=this.height,this.bufferCtx.scale(this.xscale,this.yscale),this.dataChanged=!0,t=!0),this.dataChanged&&this.data.hasOwnProperty("timestamp")){this.bufferCtx.clearRect(0,0,this.buffer.width,this.buffer.height);var e=15*Math.abs((1e3-this.data.timestamp%2e3)/1e3)+5;this.bufferCtx.lineWidth=3,this.bufferCtx.fillStyle="none",this.bufferCtx.strokeStyle="black",this.bufferCtx.beginPath(),this.bufferCtx.arc(25,25,e,0,2*Math.PI),this.bufferCtx.stroke(),t=!0}return this.sizeChanged=!1,this.dataChanged=!1,this.changed=!1,this.refreshed=this.refreshed||t,t=this.refreshed},t.prototype.render=function(t){t.drawImage(this.buffer,this.tx,this.ty,this.unscaledWidth,this.unscaledHeight)},t.prototype.update=function(t){this.data.timestamp!==t.timestamp&&(this.data=t,this.dataChanged=!0)},t.prototype.getHeight=function(){return 50},t.prototype.getWidth=function(){return 50},t.prototype.getRenderHeight=function(){return 50},t.prototype.getRenderWidth=function(){return 50},t.prototype.getType=function(){return"_image"},t.prototype.getNewElement=function(){return null},t}(),SimpleCanvasBox=function(){function t(t){this.buffer=document.createElement("canvas"),this.bufferCtx=this.buffer.getContext("2d"),this.sizeChanged=!0,this.childrenChange=!0,this.refreshed=!0,this.unscaledWidth=this.getRenderWidth(),this.unscaledHeight=this.getRenderHeight(),this.width=this.unscaledWidth,this.height=this.unscaledHeight,this.xscale=1,this.yscale=1,this.tx=0,this.ty=0,this.canvasBoxElement=new CanvasBoxElement,this.canvasElements=[],this.canvasElements.push(this.canvasBoxElement),this.translations=[],this.translations.push({x:0,y:0})}return t.prototype.setScale=function(t,e){for(var n=0;n<this.canvasElements.length;n++)this.canvasElements[n].setScale(t,e);var r=t*this.unscaledWidth,i=e*this.unscaledHeight;r!==this.width?this.sizeChanged=!0:i!==this.height&&(this.sizeChanged=!0),this.width=r,this.height=i,this.xscale=t,this.yscale=e},t.prototype.setRotation=function(t){},t.prototype.setTranslation=function(t,e){this.tx=t,this.ty=e},t.prototype.refresh=function(){var t=!1;this.sizeChanged&&(this.buffer.width=this.width,this.buffer.height=this.height,this.bufferCtx.scale(this.xscale,this.yscale),t=!0);for(var e=0;e<this.canvasElements.length;e++)t=this.canvasElements[e].refresh()||t;return this.sizeChanged=!1,this.refreshed=this.refreshed||t,t=this.refreshed},t.prototype.render=function(t){if(this.refreshed){this.bufferCtx.clearRect(0,0,this.buffer.width,this.buffer.height);for(var e=0;e<this.canvasElements.length;e++){var n=this.translations[e];this.canvasElements[e].setTranslation(n.x,n.y),this.canvasElements[e].render(this.bufferCtx)}}t.drawImage(this.buffer,this.tx,this.ty,this.unscaledWidth,this.unscaledHeight),this.refreshed=!1},t.prototype.update=function(t){this.canvasBoxElement.update(t)},t.prototype.getRenderHeight=function(){return 90},t.prototype.getRenderWidth=function(){return 260},t.prototype.getHeight=function(){return 70},t.prototype.getWidth=function(){return 270},t.prototype.getType=function(){return"simpleNameBox"},t.prototype.getNewElement=function(){return null},t}(),CanvasElementFactory=function(){function t(){}return t.init=function(){if(!t.initialized){var e=[];e.push(new CanvasBoxElement),e.push(new CanvasCompactSimpleNameBox),t.boxes={};for(var n=0;n<e.length;n++){var r=e[n];t.boxes[r.getType()]=r,0===n&&(t["default"]=r.getType())}t.initialized=!0}},t.getWidth=function(e){return t.init(),this.getStoredElement(e).getWidth()},t.getHeight=function(e){return t.init(),this.getStoredElement(e).getHeight()},t.getNewBoxStyle=function(e){return t.init(),this.getStoredElement(e).getNewElement()},t.getStoredElement=function(e){return t.boxes.hasOwnProperty(e)?t.boxes[e]:t.boxes[this["default"]]},t.getType=function(t){return this.getStoredElement(t).getType()},t.initialized=!1,t["default"]="",t}(),CanvasElementManager=function(){function t(t){this.elementMap={},this.currentMap={},this.newElementMap={},this.orderElements=[],this.elementCount=0,this.elementContainer=t,this.bounds={x:0,y:0,w:0,h:0},this.reflect=!1,this.loadingImage=new ImageLoading}return t.prototype.setReflect=function(t){this.reflect=t},t.prototype.requestElement=function(t){if(!t.hasAttr("hidden")||!t.getAttr("hidden")){var e=t.getNode().getId();if(this.inBounds(t)){this.reflect&&t.setAttr("reflect",this.reflect);var n=null;this.elementMap.hasOwnProperty(t.getNode().getId())?(n=this.elementMap[e],this.currentMap[e]=n,delete this.elementMap[e]):(n=this.getNewElement(t),this.currentMap[e]=n),CanvasElementFactory.getType(t.getType())!==n.getType()&&(n=this.getNewElement(t),this.currentMap[e]=n),n.update({box:t,fullname:t.getNode().getAttr("name"),gender:t.getNode().getAttr("gender")});var r=t.getAttr("scale"),i=t.getAttr("point");n.setScale(r,r),n.setTranslation(i.getX(),i.getY()),this.orderElements.push(n)}}},t.prototype.clearUnusedElement=function(){for(var t=0;t<this.orderElements.length;t++)this.orderElements[t].refresh(),this.orderElements[t].render(this.elementContainer);for(var e in this.elementMap)this.elementMap.hasOwnProperty(e)&&delete this.elementMap[e];this.elementMap=this.currentMap,this.currentMap={},this.orderElements=[]},t.prototype.setBounds=function(t,e,n,r){this.bounds={x:t,y:e,w:n,h:r}},t.prototype.getNewElement=function(t){return CanvasElementFactory.getNewBoxStyle(t.getType())},t.prototype.inBounds=function(t){var e=!0,n=this.bounds,r=Math.min(n.x,n.w),i=Math.max(n.x,n.w),s=Math.min(n.y,n.h),o=Math.max(n.y,n.h);return t.getX()-t.getWidth()/2>i&&(e=!1),t.getX()+t.getWidth()/2<r&&(e=!1),t.getY()-t.getHeight()/2>o&&(e=!1),t.getY()+t.getHeight()/2<s&&(e=!1),e},t}(),CanvasBoxElement=function(){function t(){this.buffer=document.createElement("canvas"),this.bufferCtx=this.buffer.getContext("2d"),this.dataChanged=!0,this.sizeChanged=!0,this.refreshed=!0,this.unscaledWidth=this.getRenderWidth(),this.unscaledHeight=this.getRenderHeight(),this.width=this.unscaledWidth,this.height=this.unscaledHeight,this.xscale=1,this.yscale=1,this.tx=0,this.ty=0,this.data={}}return t.prototype.setScale=function(t,e){var n=t*this.unscaledWidth,r=e*this.unscaledHeight;n!==this.width?this.sizeChanged=!0:r!==this.height&&(this.sizeChanged=!0),this.width=n,this.height=r,this.xscale=t,this.yscale=e},t.prototype.setRotation=function(t){},t.prototype.setTranslation=function(t,e){this.tx=t,this.ty=e},t.prototype.refresh=function(){var t=!1;if(this.sizeChanged&&(this.buffer.width=this.width,this.buffer.height=this.height,this.bufferCtx.setTransform(this.xscale,0,0,this.yscale,0,0),this.dataChanged=!0,t=!0),this.dataChanged){this.bufferCtx.clearRect(0,0,this.buffer.width,this.buffer.height),this.bufferCtx.lineWidth=3,this.bufferCtx.fillStyle="#CFCFC4",this.bufferCtx.strokeStyle="#bcbcae";var e=!1,n=null;if(this.data&&this.data.box&&this.data.box.getNode("isDummyNode")&&(n=this.data.box.getNode(),e=!0),e&&n.hasAttr("gender")){var r=n.getAttr("gender");"Male"===r?(this.bufferCtx.fillStyle="#8DEEEE",this.bufferCtx.strokeStyle="#2EE0E0"):"Female"===r&&(this.bufferCtx.fillStyle="#FFD1DC",this.bufferCtx.strokeStyle="#FFA3B9")}var i=.9*this.getWidth(),s=.9*this.getHeight(),o=(this.getWidth()-i)/2+(this.getRenderWidth()-this.getWidth())/2,a=(this.getHeight()-s)/2+(this.getRenderHeight()-this.getHeight())/2,h=this.bufferCtx.roundRect(o,a,i,s,5);if(h.fill(),h.stroke(),e&&(this.bufferCtx.font="15px Verdana",this.bufferCtx.fillStyle="#000000",n.hasAttr("name")&&this.bufferCtx.fillText(n.getAttr("name"),o+55,a+15),n.hasAttr("lifespan")&&this.bufferCtx.fillText(n.getAttr("lifespan"),o+55,a+35),n.hasAttr("spouseName"))){var u=null,c=null;if(this.bufferCtx.lineWidth=1,n.hasAttr("gender")){var r=n.getAttr("gender");"Male"===r?(this.bufferCtx.fillStyle="#FFD1DC",this.bufferCtx.strokeStyle="#FFA3B9"):"Female"===r&&(this.bufferCtx.fillStyle="#8DEEEE",this.bufferCtx.strokeStyle="#2EE0E0")}n.getAttr("spouseCount")>1?(u=this.bufferCtx.roundRect(o+73,a+41,.9*this.getWidth()-75,20,5),u.fill(),u.stroke(),c=this.bufferCtx.roundRect(o+55,a+38,.9*this.getWidth()-75,20,5),c.fill(),c.stroke(),this.bufferCtx.fillStyle="#000000",this.bufferCtx.fillText(n.getAttr("spouseCount"),o+227,a+55),this.bufferCtx.fillText(n.getAttr("spouseName"),o+60,a+53)):(u=this.bufferCtx.roundRect(o+55,a+41,.9*this.getWidth()-57,20,5),u.fill(),u.stroke(),this.bufferCtx.fillStyle="#000000",this.bufferCtx.fillText(n.getAttr("spouseName"),o+60,a+55))}this.dataChanged=!1,t=!0}return this.sizeChanged=!1,this.dataChanged=!1,this.refreshed=this.refreshed||t,t=this.refreshed},t.prototype.render=function(t){t.drawImage(this.buffer,this.tx-this.width/2,this.ty-this.height/2)},t.prototype.update=function(t){var e=t.box,n=e.getNode();n.hasAttr("name")&&this.data.name!=n.getAttr("name")?(this.data=t,this.data.name=n.getAttr("name"),this.dataChanged=!0):n.hasAttr("gender")&&this.data.gender!=n.getAttr("gender")&&(this.data=t,this.data.gender=n.getAttr("gender"),this.dataChanged=!0)},t.prototype.getRenderHeight=function(){return 80},t.prototype.getRenderWidth=function(){return 280},t.prototype.getHeight=function(){return 70},t.prototype.getWidth=function(){return 270},t.prototype.getType=function(){return"spouseNameBox"},t.prototype.getNewElement=function(){return new t},t}(),CanvasCompactSimpleNameBox=function(){function t(){this.buffer=document.createElement("canvas"),this.bufferCtx=this.buffer.getContext("2d"),this.dataChanged=!0,this.sizeChanged=!0,this.refreshed=!0,this.unscaledWidth=this.getRenderWidth(),this.unscaledHeight=this.getRenderHeight(),this.width=this.unscaledWidth,this.height=this.unscaledHeight,this.xscale=1,this.yscale=1,this.tx=0,this.ty=0,this.data={}}return t.prototype.setScale=function(t,e){var n=t*this.unscaledWidth,r=e*this.unscaledHeight;n!==this.width?this.sizeChanged=!0:r!==this.height&&(this.sizeChanged=!0),this.width=n,this.height=r,this.xscale=t,this.yscale=e},t.prototype.setRotation=function(t){},t.prototype.setTranslation=function(t,e){this.tx=t,this.ty=e},t.prototype.refresh=function(){var t=!1;if(this.sizeChanged&&(this.buffer.width=this.width,this.buffer.height=this.height,this.bufferCtx.setTransform(this.xscale,0,0,this.yscale,0,0),this.dataChanged=!0,t=!0),this.dataChanged){if(this.bufferCtx.clearRect(0,0,this.buffer.width,this.buffer.height),this.bufferCtx.lineWidth=2,this.bufferCtx.fillStyle="#CFCFC4",this.bufferCtx.strokeStyle="#bcbcae",this.data.hasOwnProperty("gender")){var e=this.data.gender;"Male"===e?(this.bufferCtx.fillStyle="#8DEEEE",this.bufferCtx.strokeStyle="#2EE0E0"):"Female"===e&&(this.bufferCtx.fillStyle="#FFD1DC",this.bufferCtx.strokeStyle="#FFA3B9")}var n=.9*this.getWidth(),r=.9*this.getHeight(),i=(this.getWidth()-n)/2+(this.getRenderWidth()-this.getWidth())/2,s=(this.getHeight()-r)/2+(this.getRenderHeight()-this.getHeight())/2,o=this.bufferCtx.roundRect(i,s,n,r,5);o.fill(),o.stroke(),this.bufferCtx.font="15px Verdana",this.bufferCtx.fillStyle="#000000",this.data.hasOwnProperty("fullname")&&this.data.fullname&&this.bufferCtx.fillText(this.data.fullname,i+5,s+15),this.dataChanged=!1,t=!0}return this.sizeChanged=!1,this.dataChanged=!1,this.refreshed=this.refreshed||t,t=this.refreshed},t.prototype.render=function(t){t.drawImage(this.buffer,this.tx-this.width/2,this.ty-this.height/2)},t.prototype.update=function(t){var e=t.box,n=e.getNode();n.hasAttr("name")&&this.data.name!=n.getAttr("name")?(this.data=t,this.data.name=n.getAttr("name"),this.dataChanged=!0):n.hasAttr("gender")&&this.data.gender!=n.getAttr("gender")&&(this.data=t,this.data.gender=n.getAttr("gender"),this.dataChanged=!0)},t.prototype.getRenderHeight=function(){return 26},t.prototype.getRenderWidth=function(){return 204},t.prototype.getHeight=function(){return 22},t.prototype.getWidth=function(){return 200},t.prototype.getType=function(){return"compactSimpleNameBox"},t.prototype.getNewElement=function(){return new t},t}(),NubElement=function(){function t(){this.lastBox=null}return t.prototype.make=function(t,e,n,r){this.lastBox=t.copy();var i=document.createElementNS("http://www.w3.org/2000/svg","g");e.appendChild(i);var s=document.createElementNS("http://www.w3.org/2000/svg","circle");i.appendChild(s),s.setAttribute("r","7"),s.setAttribute("fill","blue");var o=t.getNode(),a=o.getAttr("birthdate"),h=o.getAttr("deathdate"),u=StringUtils.calculateDeathAge(a,h);u?u>15?s.setAttribute("fill","#a0e496"):s.setAttribute("fill","#FF7878"):s.setAttribute("fill","#FFC200"),t.hasAttr("reflect")&&s.setAttribute("fill","#9cd3d3"),this.g=i,this.define(t,e,n,r)},t.prototype.define=function(t,e,n,r){t.copyContents(this.lastBox),this.move(t,e,n,r)},t.prototype.move=function(t,e,n,r){t.copyContents(this.lastBox),this.g.setAttribute("transform","translate("+(t.getX()-t.getWidth()/2)+","+t.getY()+")")},t.prototype.remove=function(t){this.lastBox=null,t.removeChild(this.g),this.g=null},t.prototype.getLastBox=function(){return this.lastBox},t.prototype.getRawElement=function(){return this.g},t}(),BElement=function(){function t(){this.lastBox=null}return t.prototype.make=function(t,e,n,r){this.lastBox=t.copy(),this.g=BoxStyleFactory.getNewBoxStyle(t.getType()).render(t,e,r),this.define(t,e,n,r)},t.prototype.define=function(t,e,n,r){t.copyContents(this.lastBox),this.move(t,e,n,r)},t.prototype.move=function(t,e,n,r){t.copyContents(this.lastBox),BoxStyleFactory.getNewBoxStyle(t.getType()).move(t,this.g,e,r)},t.prototype.remove=function(t){this.lastBox=null,t.removeChild(this.g),this.g=null},t.prototype.getLastBox=function(){return this.lastBox},t.prototype.getRawElement=function(){return this.g},t}(),SVGManager=function(){function t(t){this.graphicObject=new GraphicObject,this.refreshTriggered=!1,this.reflect=!1,this.requestIds=[];var e=document.getElementById(t);this.svgRoot=document.createElementNS("http://www.w3.org/2000/svg","g"),e.appendChild(this.svgRoot),this.linePath=document.createElementNS("http://www.w3.org/2000/svg","path"),this.svgRoot.appendChild(this.linePath),this.highlightPath=document.createElementNS("http://www.w3.org/2000/svg","path"),this.svgRoot.appendChild(this.highlightPath),this.boxContainer=document.createElementNS("http://www.w3.org/2000/svg","g"),this.svgRoot.appendChild(this.boxContainer),this.generationContainer=document.createElementNS("http://www.w3.org/2000/svg","g"),this.svgRoot.appendChild(this.generationContainer),this.elementManager=new ElementManager(this.boxContainer,this.graphicObject),this.nubManager=new NubManager(this.boxContainer,this.graphicObject),this.generationManager=new GenerationMarkerManager(this.generationContainer,this.graphicObject);this.boundingRect=null,this.elements={},this.scale=1,this.translationX=0,this.translationY=0,this.rotation=0,this.boundingRect=e.getBoundingClientRect(),this.width=this.boundingRect.right-this.boundingRect.left,this.height=this.boundingRect.bottom-this.boundingRect.top}return t.prototype.refresh=function(t){return this.lastBoxes=t,this.drawHighlight(t),this.drawLine2(t),this.drawBoxes(t),this.drawGenerationMarkers(t),this.lastBoxes=t,this.graphicObject},t.prototype.getGraphicObject=function(){return this.graphicObject},t.prototype.drawGenerationMarkers=function(t){if(!t)return void this.generationManager.clearUnusedElement();this.generationManager.setReflect(this.reflect);var e=t.getRoot(),n=[];n.push({id:e,generation:0});for(var r=t.getId(e),i=(r.getNode(),{});n.length>0;){var s=n.shift(),o=t.getId(s.id),a=o.getNode(),h=a.getBranchIds();i.hasOwnProperty(s.generation)||(i[s.generation]=new Point(o.getX(),o.getY()));for(var u=0;u<h.length;u++){var c=t.getId(h[u]);c&&n.push({id:h[u],generation:s.generation+1})}}for(var l in i)if(i.hasOwnProperty(l)){var s=i[l];this.generationManager.requestElement(l,s)}this.generationManager.clearUnusedElement()},t.prototype.drawBoxes=function(t){if(!t)return this.elementManager.clearUnusedElement(),void this.nubManager.clearUnusedElement();var e=t.getRoot(),n=[],r=this.viewToWorld(new Point(0,0)),i=this.viewToWorld(new Point(this.width,this.height));this.elementManager.setReflect(this.reflect),this.elementManager.setBounds(r.getX(),r.getY(),i.getX(),i.getY()),this.nubManager.setReflect(this.reflect),this.nubManager.setBounds(r.getX(),r.getY(),i.getX(),i.getY()),this.requestIds=[];var n=[];n.push(e);var s=t.getId(e),o=s.getNode();for(this.elementManager.inBounds(s)&&o.hasAttr("extendRootId")?this.requestExtendRootId=o.getAttr("extendRootId"):this.requestExtendRootId=null;n.length>0;){var a=t.getId(n.shift()),h=a.getNode(),u=h.getBranchIds();if(!h.hasAttr("isSpaceFillerNode")){if(a.hasAttr("spouseIds"))for(var c=a.getAttr("spouseIds"),l=0;l<c.length;l++){var d=t.getId(c[l]);d&&this.elementManager.requestElement(d)}(h.hasAttr("isDummyNode")||h.hasAttr("hightlight"))&&this.elementManager.inBounds(a)&&this.requestIds.push(a.getNode().getId()),this.elementManager.requestElement(a),h.hasAttr("isDummyNode")||0===h.getBranchIds().length&&this.nubManager.requestElement(a);for(var l=0;l<u.length;l++){var p=t.getId(u[l]);p&&n.push(u[l])}}}this.elementManager.clearUnusedElement(),this.nubManager.clearUnusedElement();var g=this.viewToWorld(new Point(this.width/2,this.height/2));this.requestIds.sort(function(e,n){var r=t.getId(e),i=t.getId(n),s=0,o=0;return r.hasAttr("highlight")||(s=(g.getX()-r.getX())*(g.getX()-r.getX())+(g.getY()-r.getY())*(g.getY()-r.getY())),i.hasAttr("highlight")||(o=(g.getX()-i.getX())*(g.getX()-i.getX())+(g.getY()-i.getY())*(g.getY()-i.getY())),s-o});var f=[];this.reflect&&(f.push("scale(-1,1)"),f.push("translate("+-this.width+",0)")),f.push("scale("+1/this.scale+")"),this.svgRoot.setAttribute("transform",f.join(","))},t.prototype.toCenterPoint=function(t){return t},t.prototype.drawSpouseLines=function(t,e){var n="",r=t.getNode(),i=[];if(t.hasAttr("spouseIds")){var s=t.getAttr("spouseIds"),o=r.getAttr("spouses");if(s.length!==o.length)throw"Spouse ids and spouse objs are not the same length...";for(var a=0;a<s.length;a++){var h=e.getId(s[a]);h&&i.push({box:h,obj:o[a]})}}if(i.length<=1)return n;for(var u=i[0].box,c=i[1].box,l=i[i.length-1].box,d=i[i.length-2].box,p=u.getX()+u.getWidth()/2,g=t.getX()+t.getWidth()/2,f=Math.min((p+g)/2,g-10),m=t.getY(),y=f,v=5,b=Math.min(c.getY()-u.getY(),m-u.getY(),v),w=y,A=u.getY()+b,P=1;P<i.length-1;P++){var x=i[P].box;n+="M "+x.getX()+" "+x.getY()+" ",n+="L "+y+" "+x.getY()+" "}var C=v,I=Math.min(l.getY()-d.getY(),l.getY()-m,C),S=y,T=l.getY()-I;n+="M "+u.getX()+" "+u.getY()+" ",n+="L "+(y-v)+" "+u.getY()+" ",u.getY()>A?(n+="L "+y+" "+u.getY()+" ",n+="M "+w+" "+A+" "):n+="A "+v+" "+b+" 0 0 1 "+w+" "+A+" ",n+="L "+S+" "+T+" ",n+=l.getY()<T?"M "+S+" "+l.getY()+" ":"A "+C+" "+I+" 0 0 1 "+(S-C)+" "+(T+I)+" ",n+="L "+l.getX()+" "+l.getY()+" ";for(var a=0;a<i.length;a++){var N=i[a];if(0!==N.obj.childIds.length)n+=this.drawChildLines(N.box,e,N.obj.uniqueChildIds,t.getX(),N.box.getY());else{var h=N.box;n+="M "+h.getX()+" "+h.getY()+" ",n+="L "+(t.getX()-t.getWidth()/2)+" "+h.getY()+" ",this.nubManager.requestElement(h)}}return n},t.prototype.drawChildLines=function(t,e,n,r,i){var s="";if(0===n.length)s+="M "+r+" "+i+" ",s+="L "+(r-t.getWidth()/2)+" "+t.getY()+" ";else if(1==n.length){var o=this.toCenterPoint(e.getId(n[0]));if(!o)return s;s+="M "+r+" "+i+" ",s+="L "+o.getX()+" "+o.getY()+" "}else{var o=this.toCenterPoint(e.getId(n[0])),a=this.toCenterPoint(e.getId(n[1])),h=this.toCenterPoint(e.getId(n[n.length-1])),u=this.toCenterPoint(e.getId(n[n.length-2]));if(!(o&&a&&h&&u))return s;var c=(o.getX()+r)/2,l=5,d=Math.min(a.getY()-o.getY(),i-o.getY(),l),p=c,g=o.getY()+d;s+="M "+r+" "+i+" ",s+="L "+c+" "+i+" ";for(var f=1;f<n.length-1;f++){var m=this.toCenterPoint(e.getId(n[f]));s+="M "+m.getX()+" "+m.getY()+" ",s+="L "+c+" "+m.getY()+" "}var y=l,v=Math.min(h.getY()-u.getY(),h.getY()-i,y),b=c,w=h.getY()-v;s+="M "+o.getX()+" "+o.getY()+" ",s+="L "+(c-l)+" "+o.getY()+" ",s+="A "+l+" "+d+" 0 0 1 "+p+" "+g+" ",s+="L "+b+" "+w+" ",s+="A "+y+" "+v+" 0 0 1 "+(b-y)+" "+(w+v)+" ",s+="L "+h.getX()+" "+h.getY()+" "}return s},t.prototype.drawLine2=function(t){if(!t)return void this.linePath.removeAttribute("d");var e="",n=t.getRoot(),r=[];for(r.push(n);r.length>0;){var i=t.getId(r.shift()),s=i.getNode(),o=s.getBranchIds(),s=i.getNode();if(!s.hasAttr("isSpaceFillerNode")){var a=(i.getX(),i.getY(),this.drawSpouseLines(i,t));if(e+=a,!a){for(var h=[],u=0;u<o.length;u++){var c=t.getId(o[u]);c&&h.push(o[u])}o=h,e+=this.drawChildLines(i,t,o,i.getX(),i.getY())}for(var u=0;u<o.length;u++){var c=t.getId(o[u]);c&&r.push(o[u])}}}this.linePath.setAttribute("stroke","black"),this.linePath.setAttribute("fill","none"),this.linePath.setAttribute("d",e)},t.prototype.drawSpouseLinesHightlight=function(t,e,n){var r="",i=t.getNode(),s=[],o=[],a=!1,h=!1,u=!1;if(t.hasAttr("spouseIds")){var c=t.getAttr("spouseIds"),l=i.getAttr("spouses");if(c.length!==l.length)throw"Spouse ids and spouse objs are not the same length...";for(var d=0;d<c.length;d++){var p=e.getId(c[d]);if(p){if(o.push(c[d]),n.indexOf(c[d])<=-1)continue;0===d&&(a=!0),d===c.length-1&&(h=!0),s.push({box:p,obj:l[d]})}}}if(s.length>0){var g=this.toCenterPoint(e.getId(o[0])),f=this.toCenterPoint(e.getId(o[1])),m=this.toCenterPoint(e.getId(o[o.length-1])),y=this.toCenterPoint(e.getId(o[o.length-2])),v=g.getX()+g.getWidth()/2,b=t.getX()+t.getWidth()/2,w=Math.min((v+b)/2,b-10),A=t.getY(),P=w,x=5,C=Math.min(f.getY()-g.getY(),A-g.getY(),x),I=P,S=g.getY()+C,T=x,N=Math.min(m.getY()-y.getY(),m.getY()-A,T),M=P,R=m.getY()-N,d=0,$=s.length;for(a?(d++,r+="M "+g.getX()+" "+g.getY()+" ",r+="L "+(P-x)+" "+g.getY()+" ",g.getY()>S?(r+="L "+P+" "+g.getY()+" ",r+="M "+I+" "+S+" "):r+="A "+x+" "+C+" 0 0 1 "+I+" "+S+" "):A<s[0].box.getY()?(r+="M "+w+" "+A+" ",r+="L "+P+" "+A+" ",u=!0):(d++,r+="M "+g.getX()+" "+s[0].box.getY()+" ",r+="L "+P+" "+s[0].box.getY()+" "),h?(r+="L "+M+" "+R+" ",r+=m.getY()<R?"M "+M+" "+m.getY()+" ":"A "+T+" "+N+" 0 0 1 "+(M-T)+" "+(R+N)+" ",r+="L "+m.getX()+" "+m.getY()+" ",$--):A>s[s.length-1].box.getY()?(r+="L "+P+" "+A+" ",r+="L "+w+" "+A+" ",u=!0):(r+="L "+P+" "+s[s.length-1].box.getY()+" ",r+="L "+g.getX()+" "+s[s.length-1].box.getY()+" ",$--),u||(r+="M "+w+" "+A+" ",r+="L "+P+" "+A+" ");$>d;d++)r+="M "+g.getX()+" "+s[d].box.getY()+" ",r+="L "+P+" "+s[d].box.getY()+" "}for(var d=0;d<s.length;d++){var D=s[d];0!==D.obj.childIds.length&&(r+=this.drawChildLinesHighlight(D.box,e,D.obj.uniqueChildIds,t.getX(),D.box.getY(),t))}return r},t.prototype.getSpousesIdsToHighlight=function(t,e){for(var n=t.getNode(),r=n.getBranchIds(),i={},s=0;s<r.length;s++){var o=e.getId(r[s]);o&&o.hasAttr("highlight")&&o.getAttr("highlight").hasOwnProperty(n.getAttr("downloadId"))&&(i[r[s]]=!0)}var a=[];if(t.hasAttr("spouseIds")){var h=t.getAttr("spouseIds"),u=n.getAttr("spouses");if(h.length!==u.length)throw"Spouse ids and spouse objs are not the same length...";for(var s=0;s<h.length;s++){var c=e.getId(h[s]);if(c)for(var l=u[s].uniqueChildIds,d=0;d<l.length;d++){var p=l[d];if(i.hasOwnProperty(p)){a.push(h[s]);break}}}}return a},t.prototype.drawChildLinesHighlight=function(t,e,n,r,i,s){var o="";if(s.hasAttr("highlight")){var a=s.getNode();if(n.length<1);else if(1==n.length){var h=e.getId(n[0]);if(h.hasAttr("highlight")){var u=h.getAttr("highlight");if(u.hasOwnProperty(a.getAttr("downloadId"))){o+="M "+r+" "+i+" ";var c=this.toCenterPoint(e.getId(n[0]));o+="L "+c.getX()+" "+c.getY()+" "}}}else{for(var c=this.toCenterPoint(e.getId(n[0])),l=this.toCenterPoint(e.getId(n[1])),d=this.toCenterPoint(e.getId(n[n.length-1])),p=this.toCenterPoint(e.getId(n[n.length-2])),g=(c.getX()+r)/2,f=!1,m=!1,y=[],v=0;v<n.length;v++){var b=e.getId(n[v]);if(b.hasAttr("highlight")&&b.getAttr("highlight").hasOwnProperty(a.getAttr("downloadId"))){0===v&&(f=!0),v===n.length-1&&(m=!0);var w=this.toCenterPoint(b);y.push(w.getY())}}if(y.length>0){var A=0,P=y.length,x=!1;if(f){var C=5,I=Math.min(l.getY()-c.getY(),i-c.getY(),C),S=g,T=c.getY()+I;o+="M "+c.getX()+" "+c.getY()+" ",o+="L "+(g-C)+" "+c.getY()+" ",o+="A "+C+" "+I+" 0 0 1 "+S+" "+T+" ",A++}else i<y[0]?(o+="M "+r+" "+i+" ",o+="L "+g+" "+i+" ",x=!0):(o+="M "+c.getX()+" "+y[0]+" ",o+="L "+g+" "+y[0]+" ",A++);if(m){var N=5,M=Math.min(d.getY()-p.getY(),d.getY()-i,N),R=g,$=d.getY()-M;o+="L "+R+" "+$+" ",o+="A "+N+" "+M+" 0 0 1 "+(R-N)+" "+($+M)+" ",o+="L "+d.getX()+" "+d.getY()+" ",P--}else i>y[y.length-1]?(o+="L "+g+" "+i+" ",o+="L "+r+" "+i+" ",x=!0):(o+="L "+g+" "+y[y.length-1]+" ",o+="L "+c.getX()+" "+y[y.length-1]+" ",P--);for(x||(o+="M "+r+" "+i+" ",o+="L "+g+" "+i+" ");P>A;A++)o+="M "+c.getX()+" "+y[A]+" ",o+="L "+g+" "+y[A]+" "}}}return o},t.prototype.drawHighlight=function(t){if(!t)return void this.highlightPath.removeAttribute("d");var e="",n=t.getRoot(),r=[];for(r.push(n);r.length>0;){for(var i=t.getId(r.shift()),s=i.getNode(),o=s.getBranchIds(),a=i.getX(),h=i.getY(),u=[],c=0;c<o.length;c++){var l=t.getId(o[c]);l&&u.push(o[c])}o=u;var d=this.drawSpouseLinesHightlight(i,t,this.getSpousesIdsToHighlight(i,t));e+=d?d:this.drawChildLinesHighlight(i,t,o,a,h,i);for(var c=0;c<o.length;c++){var l=t.getId(o[c]);l&&r.push(o[c])}}this.highlightPath.setAttribute("fill","none"),this.highlightPath.setAttribute("stroke","red"),this.highlightPath.setAttribute("stroke-width","5"),this.highlightPath.setAttribute("d",e)},t.prototype.getRequestIds=function(){return this.requestIds},t.prototype.getRequestExtendRootId=function(){return this.requestExtendRootId},t.prototype.setTranslation=function(t,e){this.refresh(this.lastBoxes)},t.prototype.setScale=function(t){this.scale=t,this.scaledWidth=this.width*this.scale,this.scaledHeight=this.height*this.scale},t.prototype.setSize=function(t,e){this.width=t,this.height=e,this.scaledWidth=this.width*this.scale,this.scaledHeight=this.height*this.scale,this.boundingRect=this.svgRoot.getBoundingClientRect(),this.refresh(this.lastBoxes)},t.prototype.setReflection=function(t){this.reflect=t},t.prototype.viewToWorld=function(t){return t=this.scalePt(t,this.scale),t=this.rotatePt(t,-this.rotation)},t.prototype.worldToView=function(t){return t=this.scalePt(t,1/this.scale),t=this.rotatePt(t,this.rotation)},t.prototype.translate=function(t,e,n){return new Point(t.getX()+e,t.getY()+n)},t.prototype.rotatePt=function(t,e){var n=Math.sin(e),r=Math.cos(e);return new Point(r*t.getX()-n*t.getY(),n*t.getX()+r*t.getY())},t.prototype.scalePt=function(t,e){return new Point(t.getX()*e,t.getY()*e)},t.prototype.rotate=function(t){this.rotation+=t,this.rotation%=2*Math.PI,this.refresh(this.lastBoxes)},t.prototype.clean=function(){},t}(),NubManager=function(){function t(t,e){this.elementMap={},this.currentMap={},this.newElementMap={},this.elementCount=0,this.elementContainer=t,this.bounds={x:0,y:0,w:0,h:0},this.graphicObject=e,this.reflect=!1,this.lastElement=null}return t.prototype.setReflect=function(t){this.reflect=t},t.prototype.requestElement=function(t){var e=t.getNode().getId();this.inBounds(t)&&(this.reflect&&t.setAttr("reflect",this.reflect),this.needsMake(t)?this.make(t):(this.needsDefine(t)?this.define(t):this.move(t),this.currentMap[e]=this.elementMap[e],delete this.elementMap[e]))},t.prototype.clearUnusedElement=function(){for(var t in this.elementMap)this.elementMap.hasOwnProperty(t)&&this.removeElement(this.elementMap[t].getLastBox());this.elementMap=this.currentMap,this.currentMap={}},t.prototype.setBounds=function(t,e,n,r){this.bounds={x:t,y:e,w:n,h:r}},t.prototype.needsMake=function(t){return this.elementMap.hasOwnProperty(t.getNode().getId())?!1:!0},t.prototype.needsDefine=function(t){var e=this.elementMap[t.getNode().getId()],n=e.getLastBox();return t.getType()!==n.getType()?!0:t.getNode()!==n.getNode()?!0:!1},t.prototype.getNewElement=function(){return new NubElement},t.prototype.make=function(t){var e=this.getNewElement();e.make(t,this.elementContainer,this.graphicObject,this.lastElement),this.lastElement=e.getRawElement(),this.currentMap[t.getNode().getId()]=e},t.prototype.define=function(t){this.removeElement(t);var e=this.getNewElement();e.make(t,this.elementContainer,this.graphicObject,this.lastElement),this.lastElement=e.getRawElement(),this.elementMap[t.getNode().getId()]=e},t.prototype.move=function(t){var e=this.elementMap[t.getNode().getId()];e.move(t,this.elementContainer,this.graphicObject,this.lastElement),this.lastElement=e.getRawElement()},t.prototype.removeElement=function(t){var e=this.elementMap[t.getNode().getId()];e.remove(this.elementContainer),delete this.elementMap[t.getNode().getId()],this.lastElement=null},t.prototype.inBounds=function(t){var e=!0,n=this.bounds,r=Math.min(n.x,n.w),i=Math.max(n.x,n.w),s=Math.min(n.y,n.h),o=Math.max(n.y,n.h);return t.getX()-t.getWidth()/2>i&&(e=!1),t.getX()+t.getWidth()/2<r&&(e=!1),t.getY()-t.getHeight()/2>o&&(e=!1),t.getY()+t.getHeight()/2<s&&(e=!1),e},t}(),ElementManager=function(){function t(t,e){this.elementMap={},this.currentMap={},this.newElementMap={},this.elementCount=0,this.elementContainer=t,this.bounds={x:0,y:0,w:0,h:0},this.graphicObject=e,this.reflect=!1,
this.lastElement=null}return t.prototype.setReflect=function(t){this.reflect=t},t.prototype.requestElement=function(t){if(!t.hasAttr("hidden")||!t.getAttr("hidden")){var e=t.getNode();if(!e.hasAttr("isSpaceFillerNode")){var n=t.getNode().getId();this.inBounds(t)&&(this.reflect&&t.setAttr("reflect",this.reflect),this.needsMake(t)?this.make(t):(this.needsDefine(t)?this.define(t):this.move(t),this.currentMap[n]=this.elementMap[n],delete this.elementMap[n]))}}},t.prototype.clearUnusedElement=function(){for(var t in this.elementMap)this.elementMap.hasOwnProperty(t)&&this.removeElement(this.elementMap[t].getLastBox());this.elementMap=this.currentMap,this.currentMap={}},t.prototype.setBounds=function(t,e,n,r){this.bounds={x:t,y:e,w:n,h:r}},t.prototype.needsMake=function(t){return this.elementMap.hasOwnProperty(t.getNode().getId())?!1:!0},t.prototype.needsDefine=function(t){var e=this.elementMap[t.getNode().getId()],n=e.getLastBox();if(t.getType()!==n.getType())return!0;var r=n.getNode(),i=t.getNode();return r.hasAttr("isDummyNode")!==i.hasAttr("isDummyNode")?!0:!1},t.prototype.getNewElement=function(){return new BElement},t.prototype.make=function(t){var e=this.getNewElement();e.make(t,this.elementContainer,this.graphicObject,this.lastElement),this.lastElement=e.getRawElement(),this.currentMap[t.getNode().getId()]=e},t.prototype.define=function(t){this.removeElement(t);var e=this.getNewElement();e.make(t,this.elementContainer,this.graphicObject,this.lastElement),this.lastElement=e.getRawElement(),this.elementMap[t.getNode().getId()]=e},t.prototype.move=function(t){var e=this.elementMap[t.getNode().getId()];e.move(t,this.elementContainer,this.graphicObject,this.lastElement),this.lastElement=e.getRawElement()},t.prototype.removeElement=function(t){var e=this.elementMap[t.getNode().getId()];e.remove(this.elementContainer),delete this.elementMap[t.getNode().getId()],this.lastElement=null},t.prototype.inBounds=function(t){var e=!0,n=this.bounds,r=Math.min(n.x,n.w),i=Math.max(n.x,n.w),s=Math.min(n.y,n.h),o=Math.max(n.y,n.h);return t.getX()-t.getWidth()/2>i&&(e=!1),t.getX()+t.getWidth()/2<r&&(e=!1),t.getY()-t.getHeight()/2>o&&(e=!1),t.getY()+t.getHeight()/2<s&&(e=!1),e},t}(),BoxStyleFactory=function(){function t(){}return t.init=function(){if(!t.initialized){var e=[];e.push(new SimpleNameBox),e.push(new CompactSimpleNameBox),e.push(new CompactSimpleNameBoxForSpouse),e.push(new HorizontalNameLifeBox),e.push(new SpouseNameBox),e.push(new SpouseNameBoxForSpouse),t.boxes={};for(var n=0;n<e.length;n++){var r=e[n];t.boxes[r.getType()]=r,0===n&&(t["default"]=r.getType())}t.initialized=!0}},t.getWidth=function(e){return t.init(),this.getStoredElement(e).getWidth()},t.getHeight=function(e){return t.init(),this.getStoredElement(e).getHeight()},t.getNewBoxStyle=function(e){return t.init(),this.getStoredElement(e)},t.getStoredElement=function(e){return t.boxes.hasOwnProperty(e)?t.boxes[e]:t.boxes[this["default"]]},t.initialized=!1,t["default"]="",t}(),ShapeLibrary=function(){function t(){}return t.makeLoadingRight=function(){var t=document.createElementNS("http://www.w3.org/2000/svg","g");t.setAttribute("fill","black");var e=document.createElementNS("http://www.w3.org/2000/svg","image");e.setAttribute("height","35"),e.setAttribute("width","65"),e.setAttributeNS("http://www.w3.org/1999/xlink","href","images/loadingRight.svg"),t.appendChild(e);var n=document.createElementNS("http://www.w3.org/2000/svg","text"),r=document.createTextNode("Loading");return n.appendChild(r),n.setAttribute("x","8"),n.setAttribute("y","21"),t.appendChild(n),t},t._createSubCircle=function(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttribute("cx","16"),n.setAttribute("cy","3"),n.setAttribute("r","0"),t.length>0&&n.setAttribute("transform",t);var r=document.createElementNS("http://www.w3.org/2000/svg","animate");return r.setAttribute("attributeName","r"),r.setAttribute("values","0;3;0;0"),r.setAttribute("dur","1s"),r.setAttribute("repeatCount","indefinite"),r.setAttribute("begin",e),r.setAttribute("keySplines","0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8"),r.setAttribute("calcMode","spline"),n.appendChild(r),n},t}(),GenerationMarkerManager=function(){function t(t,e){this.elementMap={},this.currentMap={},this.newElementMap={},this.elementCount=0,this.elementContainer=t,this.bounds={x:0,y:0,w:0,h:0},this.graphicObject=e,this.reflect=!1,this.lastElement=null}return t.prototype.setReflect=function(t){this.reflect=t},t.prototype.requestElement=function(t,e){this.elementMap.hasOwnProperty(t)?this.move(t,e):this.make(t,e),this.currentMap[t]=this.elementMap[t],delete this.elementMap[t]},t.prototype.make=function(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg","g");this.elementContainer.appendChild(n);var r=document.createElementNS("http://www.w3.org/2000/svg","rect");n.appendChild(r);var i=document.createElementNS("http://www.w3.org/2000/svg","text");n.appendChild(i);var s=document.createTextNode(String(Number(t)+1));i.appendChild(s),i.setAttribute("font-size","20px"),i.setAttribute("fill","black");var o=i.getBoundingClientRect(),a=o.width+10;StringUtils.centerElement(i,0,a),r.setAttribute("transform","translate(0,-18)"),r.setAttribute("width",String(a)),r.setAttribute("height",String(22)),r.setAttribute("stroke-width","1"),r.setAttribute("fill","#CFCFC4"),r.setAttribute("stroke","#bcbcae"),r.setAttribute("rx","5"),r.setAttribute("ry","5"),this.elementMap[t]=n,this.move(t,e)},t.prototype.move=function(t,e){var n=this.elementMap[t],r=[];r.push("translate("+e.getX()+", 22)"),this.reflect&&r.push("scale(-1,1)"),n.setAttribute("transform",r.join(","))},t.prototype.clearUnusedElement=function(){for(var t in this.elementMap)this.elementMap.hasOwnProperty(t)&&this.elementContainer.removeChild(this.elementMap[t]);this.elementMap=this.currentMap,this.currentMap={}},t}(),SpouseNameBoxForSpouse=function(){function t(){}return t.prototype.render=function(t,e,n){var r=document.createElementNS("http://www.w3.org/2000/svg","g");n?DOMUtils.insertAfter(r,n):e&&e.appendChild(r);var i=document.createElementNS("http://www.w3.org/2000/svg","rect");r.appendChild(i),i.setAttribute("width",String(.9*this.getWidth())),i.setAttribute("height",String(.9*this.getHeight())),isNaN(t.getY())&&console.log(t),this.move(t,r,e,n),i.setAttribute("rx","5"),i.setAttribute("ry","5"),i.setAttribute("stroke-width","3"),i.setAttribute("fill","#CFCFC4"),i.setAttribute("stroke","#bcbcae");var s=t.getNode();if(s.hasAttr("isDummyNode")){i.setAttribute("fill","#CFCFC4");var o=ShapeLibrary.makeLoadingRight();return o.setAttribute("transform","translate(30,15)"),r.appendChild(o),r}var a=document.createElementNS("http://www.w3.org/2000/svg","text");if(r.appendChild(a),s.hasAttr("name")){var h=t.getNode().getAttr("name"),u=document.createTextNode(h);a.appendChild(u),StringUtils.placeTextWithEllipsis(a,h,.83*this.getWidth()),a.setAttribute("x","5"),a.setAttribute("y","15")}var c=document.createElementNS("http://www.w3.org/2000/svg","text");if(r.appendChild(c),s.hasAttr("lifespan")){var u=document.createTextNode(t.getNode().getAttr("lifespan"));c.appendChild(u),c.setAttribute("x","5"),c.setAttribute("y","35")}var l="none";if(s.hasAttr("gender")&&(l=s.getAttr("gender")),"Male"===l?(i.setAttribute("stroke","#a2f1f1"),i.setAttribute("fill","#c5f6f6")):"Female"===l?(i.setAttribute("stroke","#ffc7d4"),i.setAttribute("fill","#ffebef")):(i.setAttribute("stroke","#d3d3ca"),i.setAttribute("fill","#dfdfd8")),s.hasAttr("personPromise")){var d=document.createElementNS("http://www.w3.org/2000/svg","text");r.appendChild(d);var p=document.createTextNode("Loading...");d.appendChild(p),d.setAttribute("x","112"),d.setAttribute("y","58"),s.getAttr("personPromise")().then(function(t){var e=t.getSpouses();if(r.removeChild(d),e.length>1){var n=document.createElementNS("http://www.w3.org/2000/svg","rect");n.setAttribute("width",String(90)),n.setAttribute("height",String(20)),n.setAttribute("rx","5"),n.setAttribute("ry","5"),n.setAttribute("x","106"),n.setAttribute("y","41"),r.appendChild(n);var i="none",o="Spouses";s.hasAttr("gender")&&(i=s.getAttr("gender")),"Male"==i?(o="Wives",n.setAttribute("fill","#ffebef"),n.setAttribute("stroke","#ffc7d4")):"Female"==i?(o="Husbands",n.setAttribute("fill","#c5f6f6"),n.setAttribute("stroke","#a2f1f1")):(n.setAttribute("fill","#dfdfd8"),n.setAttribute("stroke","#d3d3ca"));var a=document.createElementNS("http://www.w3.org/2000/svg","text");r.appendChild(a);var h=document.createTextNode(String(e.length)+" "+o);a.appendChild(h),a.setAttribute("x","112"),a.setAttribute("y","58"),StringUtils.centerElement(a,106,90)}})}if(s.hasAttr("spouseName")){var g=null,f=null;if(s.getAttr("spouseCount")>1){g=document.createElementNS("http://www.w3.org/2000/svg","rect"),g.setAttribute("width",String(.9*this.getWidth()-75)),g.setAttribute("height",String(20)),g.setAttribute("rx","5"),g.setAttribute("ry","5"),g.setAttribute("x","23"),g.setAttribute("y","41"),g.setAttribute("stroke-width","1"),g.setAttribute("stroke","black"),r.appendChild(g);var f=null;f=document.createElementNS("http://www.w3.org/2000/svg","rect"),f.setAttribute("width",String(.9*this.getWidth()-75)),f.setAttribute("height",String(20)),f.setAttribute("rx","5"),f.setAttribute("ry","5"),f.setAttribute("x","5"),f.setAttribute("y","38"),f.setAttribute("stroke-width","1"),f.setAttribute("stroke","black"),r.appendChild(f);var a=document.createElementNS("http://www.w3.org/2000/svg","text");r.appendChild(a);var u=document.createTextNode(String(s.getAttr("spouseCount")));a.appendChild(u),a.setAttribute("x","177"),a.setAttribute("y","58");var a=document.createElementNS("http://www.w3.org/2000/svg","text");r.appendChild(a);var m=t.getNode().getAttr("spouseName"),u=document.createTextNode(m);a.appendChild(u),StringUtils.placeTextWithEllipsis(a,m,.83*this.getWidth()-75),a.setAttribute("x","10"),a.setAttribute("y","53")}else{g=document.createElementNS("http://www.w3.org/2000/svg","rect"),g.setAttribute("width",String(.9*this.getWidth()-55)),g.setAttribute("height",String(20)),g.setAttribute("rx","5"),g.setAttribute("ry","5"),g.setAttribute("x","3"),g.setAttribute("y","41"),g.setAttribute("stroke-width","1"),g.setAttribute("stroke","black"),r.appendChild(g);var a=document.createElementNS("http://www.w3.org/2000/svg","text");r.appendChild(a);var m=t.getNode().getAttr("spouseName"),u=document.createTextNode(m);a.appendChild(u),StringUtils.placeTextWithEllipsis(a,m,.83*this.getWidth()-55),a.setAttribute("x","10"),a.setAttribute("y","58")}var l="none";s.hasAttr("gender")&&(l=s.getAttr("gender"),"Male"==l?(g.setAttribute("fill","#FFD1DC"),g.setAttribute("stroke","#ffa3b9"),f&&(f.setAttribute("fill","#FFD1DC"),f.setAttribute("stroke","#ffa3b9"))):"Female"==l?(g.setAttribute("fill","#8DEEEE"),g.setAttribute("stroke","#2ee0e0"),f&&(f.setAttribute("fill","#8DEEEE"),f.setAttribute("stroke","#2ee0e0"))):(g.setAttribute("fill","#CFCFC4"),g.setAttribute("stroke","#bcbcae"),f&&(f.setAttribute("fill","#CFCFC4"),f.setAttribute("stroke","#bcbcae"))))}return r},t.prototype.move=function(t,e,n,r){r?DOMUtils.insertAfter(e,r):n&&n.appendChild(e);var i=.9*t.getWidth(),s=.9*t.getHeight(),o=.9*this.getWidth(),a=.9*this.getHeight(),h=[];h.push("translate("+(t.getX()-i/2)+", "+(t.getY()-s/2)+")"),t.hasAttr("reflect")&&(h.push("scale(-1,1)"),h.push("translate("+-i+",0)")),(i!==o||s!==a)&&h.push("scale("+i/o+","+s/a+")"),e.setAttribute("transform",h.join(","))},t.prototype.getType=function(){return"spouseNameBoxForSpouse"},t.prototype.getHeight=function(){return 70},t.prototype.getWidth=function(){return 220},t}(),SpouseNameBox=function(){function t(){}return t.prototype.render=function(t,e,n){var r=document.createElementNS("http://www.w3.org/2000/svg","g"),i=t.getNode();n?DOMUtils.insertAfter(r,n):e&&e.appendChild(r);var s=document.createElementNS("http://www.w3.org/2000/svg","rect");if(r.appendChild(s),s.setAttribute("width",String(.9*this.getWidth())),s.setAttribute("height",String(.9*this.getHeight())),isNaN(t.getY())&&console.log(t),this.move(t,r,e,n),s.setAttribute("rx","5"),s.setAttribute("ry","5"),s.setAttribute("stroke-width","3"),s.setAttribute("fill","#CFCFC4"),s.setAttribute("stroke","#bcbcae"),i.hasAttr("isDummyNode")){s.setAttribute("fill","#CFCFC4");var o=ShapeLibrary.makeLoadingRight();return o.setAttribute("transform","translate(30,15)"),r.appendChild(o),r}var a=document.createElementNS("http://www.w3.org/2000/svg","text");if(r.appendChild(a),i.hasAttr("name")){var h=t.getNode().getAttr("name"),u=document.createTextNode(h);a.appendChild(u),StringUtils.placeTextWithEllipsis(a,h,.83*this.getWidth()-55),a.setAttribute("x","55"),a.setAttribute("y","15")}var c=document.createElementNS("http://www.w3.org/2000/svg","text");if(r.appendChild(c),i.hasAttr("lifespan")){var u=document.createTextNode(t.getNode().getAttr("lifespan"));c.appendChild(u),c.setAttribute("x","55"),c.setAttribute("y","35")}var l="none";if(i.hasAttr("gender")&&(l=i.getAttr("gender")),"Male"===l?(s.setAttribute("fill","#8DEEEE"),s.setAttribute("stroke","#2ee0e0")):"Female"===l?(s.setAttribute("fill","#FFD1DC"),s.setAttribute("stroke","#ffa3b9")):(s.setAttribute("fill","#CFCFC4"),s.setAttribute("stroke","#bcbcae")),i.hasAttr("profilePicturePromise")){var d=document.createElementNS("http://www.w3.org/2000/svg","image");d.setAttribute("height","50"),d.setAttribute("width","50"),d.setAttributeNS("http://www.w3.org/1999/xlink","href","images/loading.svg"),d.setAttribute("x","3"),d.setAttribute("y","6"),r.appendChild(d),i.getAttr("profilePicturePromise").then(function(t){function e(){r.removeChild(d),n.removeEventListener("load",e)}if(!t)return void r.removeChild(d);var n=document.createElementNS("http://www.w3.org/2000/svg","image");n.setAttribute("height","50"),n.setAttribute("width","50"),n.setAttribute("x","3"),n.setAttribute("y","6"),n.addEventListener("load",e),n.setAttributeNS("http://www.w3.org/1999/xlink","href",t),r.appendChild(n)},function(){r.removeChild(d)})}if(t.hasAttr("reflect")){if(i.getAttr("spouseCount")>1){var p=document.createElementNS("http://www.w3.org/2000/svg","rect");p.setAttribute("width",String(90)),p.setAttribute("height",String(20)),p.setAttribute("rx","5"),p.setAttribute("ry","5"),p.setAttribute("x","151"),p.setAttribute("y","41"),r.appendChild(p);var l="none",g="Spouses";i.hasAttr("gender")&&(l=i.getAttr("gender")),"Male"==l?(g="Wives",p.setAttribute("fill","#ffebef"),p.setAttribute("stroke","#ffc7d4")):"Female"==l?(g="Husbands",p.setAttribute("fill","#c5f6f6"),p.setAttribute("stroke","#a2f1f1")):(p.setAttribute("fill","#dfdfd8"),p.setAttribute("stroke","#d3d3ca"));var a=document.createElementNS("http://www.w3.org/2000/svg","text");r.appendChild(a);var u=document.createTextNode(String(i.getAttr("spouseCount"))+" "+g);a.appendChild(u),a.setAttribute("x","157"),a.setAttribute("y","58"),StringUtils.centerElement(a,151,90)}}else if(i.hasAttr("spouseName")){var f=null,m=null;if(i.getAttr("spouseCount")>1){f=document.createElementNS("http://www.w3.org/2000/svg","rect"),f.setAttribute("width",String(.9*this.getWidth()-75)),f.setAttribute("height",String(20)),f.setAttribute("rx","5"),f.setAttribute("ry","5"),f.setAttribute("x","73"),f.setAttribute("y","41"),f.setAttribute("stroke-width","1"),f.setAttribute("stroke","black"),r.appendChild(f);var m=null;m=document.createElementNS("http://www.w3.org/2000/svg","rect"),m.setAttribute("width",String(.9*this.getWidth()-75)),m.setAttribute("height",String(20)),m.setAttribute("rx","5"),m.setAttribute("ry","5"),m.setAttribute("x","55"),m.setAttribute("y","38"),m.setAttribute("stroke-width","1"),m.setAttribute("stroke","black"),r.appendChild(m);var a=document.createElementNS("http://www.w3.org/2000/svg","text");r.appendChild(a);var u=document.createTextNode(String(i.getAttr("spouseCount")));a.appendChild(u),a.setAttribute("x","227"),a.setAttribute("y","58");var a=document.createElementNS("http://www.w3.org/2000/svg","text");r.appendChild(a);var y=t.getNode().getAttr("spouseName"),u=document.createTextNode(y);a.appendChild(u),StringUtils.placeTextWithEllipsis(a,y,.83*this.getWidth()-75),a.setAttribute("x","60"),a.setAttribute("y","53")}else{f=document.createElementNS("http://www.w3.org/2000/svg","rect"),f.setAttribute("width",String(.9*this.getWidth()-55)),f.setAttribute("height",String(20)),f.setAttribute("rx","5"),f.setAttribute("ry","5"),f.setAttribute("x","53"),f.setAttribute("y","41"),f.setAttribute("stroke-width","1"),f.setAttribute("stroke","black"),r.appendChild(f);var a=document.createElementNS("http://www.w3.org/2000/svg","text");r.appendChild(a);var y=t.getNode().getAttr("spouseName"),u=document.createTextNode(y);a.appendChild(u),StringUtils.placeTextWithEllipsis(a,y,.83*this.getWidth()-55),a.setAttribute("x","60"),a.setAttribute("y","58")}var l="none";i.hasAttr("gender")&&(l=i.getAttr("gender")),"Male"==l?(f.setAttribute("fill","#ffebef"),f.setAttribute("stroke","#ffc7d4"),m&&(m.setAttribute("fill","#ffebef"),m.setAttribute("stroke","#ffc7d4"))):"Female"==l?(f.setAttribute("fill","#c5f6f6"),f.setAttribute("stroke","#a2f1f1"),m&&(m.setAttribute("fill","#c5f6f6"),m.setAttribute("stroke","#a2f1f1"))):(f.setAttribute("fill","#dfdfd8"),f.setAttribute("stroke","#d3d3ca"),m&&(m.setAttribute("fill","#dfdfd8"),m.setAttribute("stroke","#d3d3ca")))}return r},t.prototype.move=function(t,e,n,r){t.getNode();r?DOMUtils.insertAfter(e,r):n&&n.appendChild(e);var i=.9*t.getWidth(),s=.9*t.getHeight(),o=.9*this.getWidth(),a=.9*this.getHeight(),h=[];h.push("translate("+(t.getX()-i/2)+", "+(t.getY()-s/2)+")"),t.hasAttr("reflect")&&(h.push("scale(-1,1)"),h.push("translate("+-i+",0)")),(i!==o||s!==a)&&h.push("scale("+i/o+","+s/a+")"),e.setAttribute("transform",h.join(","))},t.prototype.getType=function(){return"spouseNameBox"},t.prototype.getHeight=function(){return 70},t.prototype.getWidth=function(){return 270},t.count=0,t}(),CompactSimpleNameBoxForSpouse=function(){function t(){}return t.prototype.render=function(t,e,n){function r(t,e,n){if(t.textContent=e,t.getSubStringLength(0,e.length)>=n){for(var r=e.length-1;r>0;r-=1)if(t.getSubStringLength(0,r)<=n)return void(t.textContent=e.substring(0,r)+"...");t.textContent="..."}}var i=document.createElementNS("http://www.w3.org/2000/svg","g");n?DOMUtils.insertAfter(i,n):e&&e.appendChild(i);var s=document.createElementNS("http://www.w3.org/2000/svg","rect");i.appendChild(s),s.setAttribute("width",String(.9*this.getWidth())),s.setAttribute("height",String(.9*this.getHeight())),isNaN(t.getY())&&console.log(t),this.move(t,i,e,n),s.setAttribute("rx","5"),s.setAttribute("ry","5");var o=document.createElementNS("http://www.w3.org/2000/svg","text");i.appendChild(o);var a=t.getNode();if(a.hasAttr("name")){var h=t.getNode().getAttr("name"),u=document.createTextNode(h);o.appendChild(u),r(o,h,.83*this.getWidth()),o.setAttribute("x","5"),o.setAttribute("y","15")}var c="none";return a.hasAttr("gender")&&(c=a.getAttr("gender")),s.setAttribute("stroke-width","2"),"Male"===c?(s.setAttribute("stroke","#a2f1f1"),s.setAttribute("fill","#c5f6f6")):"Female"===c?(s.setAttribute("stroke","#ffc7d4"),s.setAttribute("fill","#ffebef")):(s.setAttribute("stroke","#d3d3ca"),s.setAttribute("fill","#dfdfd8")),i},t.prototype.move=function(t,e,n,r){r?DOMUtils.insertAfter(e,r):n&&n.appendChild(e);var i=.9*t.getWidth(),s=.9*t.getHeight(),o=.9*this.getWidth(),a=.9*this.getHeight(),h=[];h.push("translate("+(t.getX()-i/2)+", "+(t.getY()-s/2)+")"),t.hasAttr("reflect")&&(h.push("scale(-1,1)"),h.push("translate("+-i+",0)")),(i!==o||s!==a)&&h.push("scale("+i/o+","+s/a+")"),e.setAttribute("transform",h.join(","))},t.prototype.getType=function(){return"compactSimpleNameBoxForSpouse"},t.prototype.getHeight=function(){return 22},t.prototype.getWidth=function(){return 150},t}(),SimpleNameBox=function(){function t(){}return t.prototype.render=function(t,e,n){var r=document.createElementNS("http://www.w3.org/2000/svg","g");n?e.insertBefore(r,n):e&&e.appendChild(r);var i=document.createElementNS("http://www.w3.org/2000/svg","rect");r.appendChild(i),i.setAttribute("width",String(.9*this.getWidth())),i.setAttribute("height",String(.9*this.getHeight())),isNaN(t.getY())&&console.log(t),this.move(t,r,e,n),i.setAttribute("rx","5"),i.setAttribute("ry","5"),i.setAttribute("stroke-width","1"),i.setAttribute("stroke","black");var s=t.getNode();if(s.hasAttr("isDummyNode")){i.setAttribute("fill","#CFCFC4");var o=ShapeLibrary.makeLoadingRight();return o.setAttribute("transform","translate(30,15)"),r.appendChild(o),r}var a=document.createElementNS("http://www.w3.org/2000/svg","text");if(r.appendChild(a),s.hasAttr("name")){var h=document.createTextNode(t.getNode().getAttr("name"));a.appendChild(h),a.setAttribute("x","55"),a.setAttribute("y","15")}var u=document.createElementNS("http://www.w3.org/2000/svg","text");if(r.appendChild(u),s.hasAttr("lifespan")){var h=document.createTextNode(t.getNode().getAttr("lifespan"));u.appendChild(h),u.setAttribute("x","55"),u.setAttribute("y","35")}var c=document.createElementNS("http://www.w3.org/2000/svg","text");r.appendChild(c);var h=document.createTextNode(s.getId());c.appendChild(h),c.setAttribute("x","55"),c.setAttribute("y","55");var l="none";if(s.hasAttr("gender")&&(l=s.getAttr("gender")),"Male"===l?i.setAttribute("fill","#8DEEEE"):"Female"===l?i.setAttribute("fill","#FFD1DC"):i.setAttribute("fill","#CFCFC4"),s.hasAttr("profilePicturePromise")){var d=document.createElementNS("http://www.w3.org/2000/svg","image");d.setAttribute("height","50"),d.setAttribute("width","50"),d.setAttributeNS("http://www.w3.org/1999/xlink","href","images/loading.svg"),d.setAttribute("x","3"),d.setAttribute("y","6"),r.appendChild(d),s.getAttr("profilePicturePromise").then(function(t){function e(){r.removeChild(d),n.removeEventListener("load",e)}if(!t)return void r.removeChild(d);var n=document.createElementNS("http://www.w3.org/2000/svg","image");n.setAttribute("height","50"),n.setAttribute("width","50"),n.setAttribute("x","3"),n.setAttribute("y","6"),n.addEventListener("load",e),n.setAttributeNS("http://www.w3.org/1999/xlink","href",t),r.appendChild(n)},function(){r.removeChild(d)})}return r},t.prototype.move=function(t,e,n,r){r&&n.insertBefore(e,r);var i=.9*t.getWidth(),s=.9*t.getHeight(),o=.9*this.getWidth(),a=.9*this.getHeight(),h=[];h.push("translate("+(t.getX()-i/2)+", "+(t.getY()-s/2)+")"),t.hasAttr("reflect")&&(h.push("scale(-1,1)"),h.push("translate("+-i+",0)")),(i!==o||s!==a)&&h.push("scale("+i/o+","+s/a+")"),e.setAttribute("transform",h.join(","))},t.prototype.getType=function(){return"simpleNameBox"},t.prototype.getHeight=function(){return 70},t.prototype.getWidth=function(){return 270},t}(),HorizontalNameLifeBox=function(){function t(){}return t.prototype.render=function(t,e,n){var r=document.createElementNS("http://www.w3.org/2000/svg","g");n?e.insertBefore(r,n):e&&e.appendChild(r);var i=document.createElementNS("http://www.w3.org/2000/svg","rect");r.appendChild(i),i.setAttribute("width",String(.9*this.getWidth())),i.setAttribute("height",String(.9*this.getHeight())),isNaN(t.getY())&&console.log(t),this.move(t,r,e,n),i.setAttribute("rx","5"),i.setAttribute("ry","5"),i.setAttribute("stroke-width","1"),i.setAttribute("stroke","black");var s=document.createElementNS("http://www.w3.org/2000/svg","text");r.appendChild(s);var o=t.getNode();if(o.hasAttr("name")){var a=document.createTextNode(t.getNode().getAttr("name"));s.appendChild(a),s.setAttribute("x","5"),s.setAttribute("y","15")}var h=document.createElementNS("http://www.w3.org/2000/svg","text");if(r.appendChild(h),o.hasAttr("lifespan")){var a=document.createTextNode(t.getNode().getAttr("lifespan"));h.appendChild(a),h.setAttribute("x","205"),h.setAttribute("y","15")}var u="none";return o.hasAttr("gender")&&(u=o.getAttr("gender")),"Male"===u?i.setAttribute("fill","#8DEEEE"):"Female"===u?i.setAttribute("fill","#FFD1DC"):i.setAttribute("fill","#CFCFC4"),r},t.prototype.move=function(t,e,n,r){r&&n.insertBefore(e,r);var i=.9*t.getWidth(),s=.9*t.getHeight(),o=.9*this.getWidth(),a=.9*this.getHeight(),h=[];h.push("translate("+(t.getX()-i/2)+", "+(t.getY()-s/2)+")"),t.hasAttr("reflect")&&(h.push("scale(-1,1)"),h.push("translate("+-i+",0)")),(i!==o||s!==a)&&h.push("scale("+i/o+","+s/a+")"),e.setAttribute("transform",h.join(","))},t.prototype.getType=function(){return"horizontalNameLifeBox"},t.prototype.getHeight=function(){return 20},t.prototype.getWidth=function(){return 400},t}(),CompactSimpleNameBox=function(){function t(){}return t.prototype.render=function(t,e,n){function r(t,e,n){if(t.textContent=e,t.getSubStringLength(0,e.length)>=n){for(var r=e.length-1;r>0;r-=1)if(t.getSubStringLength(0,r)<=n)return void(t.textContent=e.substring(0,r)+"...");t.textContent="..."}}var i=document.createElementNS("http://www.w3.org/2000/svg","g");n?DOMUtils.insertAfter(i,n):e&&e.appendChild(i);var s=document.createElementNS("http://www.w3.org/2000/svg","rect");i.appendChild(s),s.setAttribute("width",String(.9*this.getWidth())),s.setAttribute("height",String(.9*this.getHeight())),isNaN(t.getY())&&console.log(t),this.move(t,i,e,n),s.setAttribute("rx","5"),s.setAttribute("ry","5");var o=document.createElementNS("http://www.w3.org/2000/svg","text");i.appendChild(o);var a=t.getNode();if(a.hasAttr("name")){var h=t.getNode().getAttr("name"),u=document.createTextNode(h);o.appendChild(u),r(o,h,.83*this.getWidth()),o.setAttribute("x","5"),o.setAttribute("y","15")}var c="none";return a.hasAttr("gender")&&(c=a.getAttr("gender")),s.setAttribute("stroke-width","2"),"Male"===c?(s.setAttribute("stroke","#2EE0E0"),s.setAttribute("fill","#8DEEEE")):"Female"===c?(s.setAttribute("stroke","#FFA3B9"),s.setAttribute("fill","#FFD1DC")):(s.setAttribute("stroke","#bcbcae"),s.setAttribute("fill","#CFCFC4")),i},t.prototype.move=function(t,e,n,r){r?DOMUtils.insertAfter(e,r):n&&n.appendChild(e);var i=.9*t.getWidth(),s=.9*t.getHeight(),o=.9*this.getWidth(),a=.9*this.getHeight(),h=[];h.push("translate("+(t.getX()-i/2)+", "+(t.getY()-s/2)+")"),t.hasAttr("reflect")&&(h.push("scale(-1,1)"),h.push("translate("+-i+",0)")),(i!==o||s!==a)&&h.push("scale("+i/o+","+s/a+")"),e.setAttribute("transform",h.join(","))},t.prototype.getType=function(){return"compactSimpleNameBox"},t.prototype.getHeight=function(){return 22},t.prototype.getWidth=function(){return 200},t}(),DOMUtils=function(){function t(){}return t.insertAfter=function(t,e){e.parentNode.insertBefore(t,e.nextSibling)},t}(),Point=function(){function t(t,e){this.x=t,this.y=e}return t.prototype.setX=function(t){this.x=t},t.prototype.getX=function(){return this.x},t.prototype.setY=function(t){this.y=t},t.prototype.getY=function(){return this.y},t.prototype.getCopy=function(){return new t(this.x,this.y)},t.distanceSqr=function(t,e){var n=t.getX()-e.getX(),r=t.getY()-e.getY();return n*n+r*r},t}(),StringUtils=function(){function t(){}return t.calculateDeathAge=function(e,n){var r=new Date(e),i=new Date(n);if(!t.isDate(r)||!t.isDate(i))return null;var s=t.getAge(r,i);return isNaN(s)?null:0>s?0:s},t.isDate=function(t){return"Invalid Date"===t||isNaN(t)?!1:!0},t.getAge=function(t,e){var n=e.getFullYear()-t.getFullYear(),r=e.getMonth()-t.getMonth();return(0>r||0===r&&e.getDate()<t.getDate())&&n--,n},t.placeTextWithEllipsis=function(t,e,n){if(e&&(t.textContent=e,t.getSubStringLength(0,e.length)>=n)){for(var r=e.length-1;r>0;r-=1)if(t.getSubStringLength(0,r)<=n)return void(t.textContent=e.substring(0,r)+"...");t.textContent="..."}},t.centerElement=function(t,e,n){var r=t.getBBox(),i=n-r.width;t.setAttribute("x",e+i/2)},t.getURLString=function(){var t=[];t.push(document.location.protocol),t.push("//"),t.push(document.location.hostname),"80"!==location.port&&(t.push(":"),t.push(location.port));var e=document.location.pathname,n=e.split("/");return"index.html"===n[n.length-1]&&(n.pop(),e=n.join("/")),t.push(e),(0===e.length||"/"!==e.charAt(e.length-1))&&t.push("/"),t.join("")},t}();