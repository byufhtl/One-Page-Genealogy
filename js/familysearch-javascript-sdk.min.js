!function(b){if("object"==typeof exports&&"undefined"!=typeof module){module.exports=b()}else{if("function"==typeof define&&define.amd){define([],b)}else{var a;"undefined"!=typeof window?a=window:"undefined"!=typeof global?a=global:"undefined"!=typeof self&&(a=self),a.FamilySearch=b()}}}(function(){var d,b,a;return(function c(f,k,h){function g(q,n){if(!k[q]){if(!f[q]){var m=typeof require=="function"&&require;if(!n&&m){return m(q,!0)}if(e){return e(q,!0)}var p=new Error("Cannot find module '"+q+"'");throw p.code="MODULE_NOT_FOUND",p}var i=k[q]={exports:{}};f[q][0].call(i.exports,function(l){var o=f[q][1][l];return g(o?o:l)},i,i.exports,c,f,k,h)}return k[q].exports}var e=typeof require=="function"&&require;for(var j=0;j<h.length;j++){g(h[j])}return g})({1:[function(h,f,j){var k=h("./globals"),p=h("./utils"),n=h("./angularjs-wrappers"),q=h("./jquery-wrappers"),i=h("./nodejs-wrappers"),o=h("./helpers"),g=h("./plumbing");var l=0;var e=f.exports=function(s){var r=this;r.settings=p.extend(r.settings,k);r.settings.instanceId=++l;r.helpers=new o(r);r.plumbing=new g(r);s=s||{};if(!s.client_id&&!s.app_key){throw"client_id must be set"}r.settings.clientId=s.client_id||s.app_key;if(!s.environment){throw"environment must be set"}r.settings.environment=s.environment;if(!s.http_function&&!window.jQuery){throw"http must be set; e.g., jQuery.ajax"}var v=s.http_function||window.jQuery.ajax;if(v.defaults){r.settings.httpWrapper=n.httpWrapper(v,r)}else{if(v.cookie){r.settings.httpWrapper=i.httpWrapper(v,r)}else{r.settings.httpWrapper=q.httpWrapper(v,r)}}if(!s.deferred_function&&!window.jQuery){throw"deferred_function must be set; e.g., jQuery.Deferred"}var u=s.deferred_function||window.jQuery.Deferred;var w=u();w.resolve();if(p.isFunction(w.promise)){r.settings.deferredWrapper=q.deferredWrapper(u)}else{if(p.isFunction(u.nfcall)){r.settings.deferredWrapper=i.deferredWrapper(u)}else{r.settings.deferredWrapper=n.deferredWrapper(u)}}var t=s.timeout_function;if(t){r.settings.setTimeout=function(y,x){return t(y,x)};r.settings.clearTimeout=function(x){t.cancel(x)}}else{r.settings.setTimeout=function(y,x){return setTimeout(y,x)};r.settings.clearTimeout=function(x){clearTimeout(x)}}if(!s.redirect_uri&&!s.auth_callback){throw"redirect_uri must be set"}r.settings.redirectUri=s.redirect_uri||s.auth_callback;r.settings.autoSignin=s.auto_signin;r.settings.autoExpire=s.auto_expire;r.settings.expireCallback=s.expire_callback;if(s.save_access_token){r.settings.saveAccessToken=true;r.helpers.readAccessToken()}if(s.access_token){r.settings.accessToken=s.access_token}r.settings.debug=s.debug;r.settings.discoveryPromise=r.plumbing.get(r.settings.discoveryUrl);r.settings.discoveryPromise.then(function(x){r.settings.discoveryResource=x})};e.BaseClass=function(r,s){if(p.isObject(s)){p.extend(this,s)}this.$client=r;this.$helpers=r.helpers;this.$plumbing=r.plumbing};h("./modules/authorities");h("./modules/authentication");h("./modules/changeHistory");h("./modules/discussions");h("./modules/memories");h("./modules/notes");h("./modules/parentsAndChildren");h("./modules/pedigree");h("./modules/persons");h("./modules/redirect");h("./modules/searchAndMatch");h("./modules/sourceBox");h("./modules/sources");h("./modules/spouses");h("./modules/users");h("./classes/agent");h("./classes/attribution");h("./classes/change");h("./classes/childAndParents");h("./classes/collection");h("./classes/comment");h("./classes/couple");h("./classes/date");h("./classes/discussion");h("./classes/discussionRef");h("./classes/fact");h("./classes/memoryArtifactRef");h("./classes/memoryPersona");h("./classes/memoryPersonaRef");h("./classes/memory");h("./classes/name");h("./classes/note");h("./classes/person");h("./classes/place");h("./classes/searchResult");h("./classes/sourceDescription");h("./classes/sourceRef");h("./classes/user");m("plumbing","del");m("plumbing","get");m("plumbing","getTotalProcessingTime");m("plumbing","getUrl");m("plumbing","http");m("plumbing","post");m("plumbing","put");m("plumbing","setTotalProcessingTime");function m(r,s){e.prototype[s]=function(){return this[r][s].apply(this[r],arguments)}}},{"./angularjs-wrappers":2,"./classes/agent":3,"./classes/attribution":4,"./classes/change":5,"./classes/childAndParents":6,"./classes/collection":7,"./classes/comment":8,"./classes/couple":9,"./classes/date":10,"./classes/discussion":11,"./classes/discussionRef":12,"./classes/fact":13,"./classes/memory":14,"./classes/memoryArtifactRef":15,"./classes/memoryPersona":16,"./classes/memoryPersonaRef":17,"./classes/name":18,"./classes/note":19,"./classes/person":20,"./classes/place":21,"./classes/searchResult":22,"./classes/sourceDescription":23,"./classes/sourceRef":24,"./classes/user":25,"./globals":26,"./helpers":27,"./jquery-wrappers":28,"./modules/authentication":29,"./modules/authorities":30,"./modules/changeHistory":31,"./modules/discussions":32,"./modules/memories":33,"./modules/notes":34,"./modules/parentsAndChildren":35,"./modules/pedigree":36,"./modules/persons":37,"./modules/redirect":38,"./modules/searchAndMatch":39,"./modules/sourceBox":40,"./modules/sources":41,"./modules/spouses":42,"./modules/users":43,"./nodejs-wrappers":44,"./plumbing":45,"./utils":47}],2:[function(g,h,f){var e=g("./utils"),f={};f.httpWrapper=function(j,i){return function(k,m,p,s,l){var q=e.extend({method:k,url:m,responseType:"json",data:s,transformRequest:function(v){return v}},l);q.headers=e.extend({},p,l.headers);if(q.headers["Content-Type"]==="multipart/form-data"){q.headers["Content-Type"]=void 0}var u=j(q);var t=i.settings.deferredWrapper();var o=t.promise;var r=null;var n=null;u.then(function(v){r=v.status;n=v.headers;t.resolve(v.data)},function(v){r=v.status;n=v.headers;t.reject(v)});o.getStatusCode=function(){return r};o.getResponseHeader=function(v){return n(v)};o.getAllResponseHeaders=function(){return n()};o.getRequest=function(){return q};return o}};f.deferredWrapper=function(i){return function(){var j=i();return{promise:j.promise,resolve:j.resolve,reject:j.reject}}};h.exports=f},{"./utils":47}],3:[function(i,j,h){var g=i("./../FamilySearch"),f=i("./../utils"),k=f.maybe;var e=g.Agent=function(l,m){g.BaseClass.call(this,l,m)};g.prototype.createAgent=function(l){return new e(this,l)};e.prototype={constructor:e,$getName:function(){return k(k(this.names)[0]).value},$getAccountName:function(){return k(k(this.accounts)[0]).accountName},$getEmail:function(){var l=k(k(this.emails)[0]).resource;return l?l.replace(/^mailto:/,""):l},$getPhoneNumber:function(){return k(k(this.phones)[0]).resource},$getAddress:function(){return k(k(this.addresses)[0]).value}}},{"./../FamilySearch":1,"./../utils":47}],4:[function(h,i,g){var f=h("./../FamilySearch"),e=h("./../utils"),k=e.maybe;var j=f.Attribution=function(l,m){f.BaseClass.call(this,l,m);if(e.isString(m)){this.changeMessage=m}};f.prototype.createAttribution=function(l){return new j(this,l)};j.prototype={constructor:j,$getAgentId:function(){return k(this.contributor).resourceId},$getAgentUrl:function(){return this.$client.helpers.removeAccessToken(k(this.contributor).resource)},$getAgent:function(){return this.$client.getAgent(this.$getAgentUrl()||this.$getAgentId())}}},{"./../FamilySearch":1,"./../utils":47}],5:[function(h,i,g){var f=h("./../FamilySearch"),e=h("./../utils"),j=e.maybe;var k=f.Change=function(l,m){f.BaseClass.call(this,l,m)};f.prototype.createChange=function(l){return new k(this,l)};k.prototype={constructor:k,$getAgentName:function(){return j(j(this.contributors)[0]).name},$getChangeReason:function(){return j(j(this.changeInfo)[0]).reason},$getAgentUrl:function(){return this.$helpers.removeAccessToken(j(j(this.links).agent).href)},$getAgent:function(){return this.$client.getAgent(this.$getAgentUrl())},$restore:function(l){return this.$client.changeHistory.restoreChange(this.id,l)}}},{"./../FamilySearch":1,"./../utils":47}],6:[function(i,j,g){var f=i("../FamilySearch"),l=i("../relationshipHelpers"),e=i("../utils"),k=e.maybe;var h=f.ChildAndParents=function(m,n){f.BaseClass.call(this,m,n);if(n){if(n.$father){this.$setFather(n.$father);delete this.$father}if(n.$mother){this.$setMother(n.$mother);delete this.$mother}if(n.$child){this.$setChild(n.$child);delete this.$child}if(n.fatherFacts){this.$setFatherFacts(n.fatherFacts)}if(n.motherFacts){this.$setMotherFacts(n.motherFacts)}}};f.prototype.createChildAndParents=function(m){return new h(this,m)};h.prototype={constructor:h,$getChildAndParentsUrl:function(){return this.$helpers.removeAccessToken(k(k(this.links).relationship).href)},$getFatherFacts:function(){return this.fatherFacts||[]},$getMotherFacts:function(){return this.motherFacts||[]},$getFatherId:function(){return k(this.father).resourceId},$getFatherUrl:function(){return this.$helpers.removeAccessToken(k(this.father).resource)},$getFather:function(){return this.$client.getPerson(this.$getFatherUrl()||this.$getFatherId())},$getMotherId:function(){return k(this.mother).resourceId},$getMotherUrl:function(){return this.$helpers.removeAccessToken(k(this.mother).resource)},$getMother:function(){return this.$client.getPerson(this.$getMotherUrl()||this.$getMotherId())},$getChildId:function(){return k(this.child).resourceId},$getChildUrl:function(){return this.$helpers.removeAccessToken(k(this.child).resource)},$getChild:function(){return this.$client.getPerson(this.$getChildUrl()||this.$getChildId())},$getNotes:function(){return this.$client.getChildAndParentsNotes(this.$helpers.removeAccessToken(k(k(this.links).notes).href))},$getSourceRefs:function(){return this.$client.getChildAndParentsSourceRefs(this.id)},$getSources:function(){return this.$client.getChildAndParentsSourcesQuery(this.id)},$getChanges:function(){return this.$client.getChildAndParentsChanges(this.$helpers.removeAccessToken(k(this.links["change-history"]).href))},$setFather:function(m){l.setMember.call(this,"father",m);this.$fatherChanged=true;return this},$setMother:function(m){l.setMember.call(this,"mother",m);this.$motherChanged=true;return this},$setChild:function(m){l.setMember.call(this,"child",m);return this},$deleteFather:function(m){l.deleteMember.call(this,"father",m);return this},$deleteMother:function(m){l.deleteMember.call(this,"mother",m);return this},$setFatherFacts:function(n,m){l.setFacts.call(this,"fatherFacts",n,m);return this},$addFatherFact:function(m){l.addFact.call(this,"fatherFacts",m);return this},$deleteFatherFact:function(n,m){l.deleteFact.call(this,"fatherFacts",n,m);return this},$setMotherFacts:function(n,m){l.setFacts.call(this,"motherFacts",n,m);return this},$addMotherFact:function(m){l.addFact.call(this,"motherFacts",m);return this},$deleteMotherFact:function(n,m){l.deleteFact.call(this,"motherFacts",n,m);return this},$save:function(o,p,m){var n=this.$client.createChildAndParents();var s=false;var q=this.id;var t=this;if(!this.id||this.$fatherChanged){n.father=this.father;s=true}if(!this.id||this.$motherChanged){n.mother=this.mother;s=true}if(!this.id){n.child=this.child;s=true}if(o){n.attribution=t.$client.createAttribution(o)}e.forEach(["fatherFacts","motherFacts"],function(v){e.forEach(t[v],function(w){if(!q||!w.id||w.$changed){l.addFact.call(n,v,w);s=true}})});var r=[];if(s){r.push(t.$helpers.chainHttpPromises(q?t.$plumbing.getUrl("child-and-parents-relationship-template",null,{caprid:q}):t.$plumbing.getUrl("relationships"),function(v){e.forEach(["father","mother","child"],function(w){if(n[w]&&!n[w].resource&&n[w].resourceId){n[w].resource=n[w].resourceId}});return t.$plumbing.post(v,{childAndParentsRelationships:[n]},{"Content-Type":"application/x-fs-v1+json"},m,t.$helpers.getResponseEntityId)}))}e.forEach(["father","mother"],function(w){if(t.id&&t.$deletedMembers&&t.$deletedMembers.hasOwnProperty(w)&&!t[w]){var v=t.$deletedMembers[w]||o;r.push(t.$helpers.chainHttpPromises(t.$plumbing.getUrl("child-and-parents-relationship-parent-template",null,{caprid:q,role:w}),function(x){var y={"Content-Type":"application/x-fs-v1+json"};if(v){y["X-Reason"]=v}return t.$plumbing.del(x,y,m)}))}});if(q&&t.$deletedFacts){e.forEach(t.$deletedFacts,function(w,v){w=w||o;var x={"Content-Type":"application/x-fs-v1+json"};if(w){x["X-Reason"]=w}r.push(t.$plumbing.del(v,x,m))})}var u=t.$helpers.promiseAll(r).then(function(v){var w=q?q:v[0];t.$helpers.extendHttpPromise(u,r[0]);if(p){return t.$client.getChildAndParents(w,{},m).then(function(x){e.deletePropertiesPartial(t,e.appFieldRejector);e.extend(t,x.getRelationship());return w})}else{return w}});return u},$delete:function(m,n){return this.$client.deleteChildAndParents(this.$getChildAndParentsUrl()||this.id,m,n)}}},{"../FamilySearch":1,"../relationshipHelpers":46,"../utils":47}],7:[function(h,i,g){var f=h("./../FamilySearch"),e=h("./../utils"),k=e.maybe;var j=f.Collection=function(l,m){f.BaseClass.call(this,l,m);if(m&&m.attribution){this.attribution=l.createAttribution(m.attribution)}};f.prototype.createCollection=function(l){return new j(this,l)};j.prototype={constructor:j,$getCollectionUrl:function(){return this.$helpers.removeAccessToken(k(k(this.links).self).href)},$getSourceDescriptions:function(l){return this.$client.getCollectionSourceDescriptions(this.$helpers.removeAccessToken(this.links["source-descriptions"].href),l)},$save:function(m,n){var l=this;var p=l.$helpers.chainHttpPromises(l.id?l.$plumbing.getUrl("user-collection-template",null,{udcid:l.id}):l.$plumbing.getUrl("user-collections"),function(q){return l.$plumbing.post(q,{collections:[l]},{},n,function(r,s){return l.id||s.getResponseHeader("X-ENTITY-ID")})});var o=p.then(function(q){l.$helpers.extendHttpPromise(o,p);if(m){return l.$client.getCollection(q,{},n).then(function(r){e.deletePropertiesPartial(l,e.appFieldRejector);e.extend(l,r.getCollection());return q})}else{return q}});return o},$delete:function(l){return this.$client.deleteCollection(this.$getCollectionUrl()||this.id,l)}}},{"./../FamilySearch":1,"./../utils":47}],8:[function(h,i,g){var f=h("./../FamilySearch"),e=h("./../utils"),j=e.maybe;var k=f.Comment=function(l,m){f.BaseClass.call(this,l,m)};f.prototype.createComment=function(l){return new k(this,l)};k.prototype={constructor:k,$getCommentUrl:function(){return this.$helpers.removeAccessToken(j(j(this.links).comment).href)},$getAgentId:function(){return j(this.contributor).resourceId},$getAgentUrl:function(){return this.$helpers.removeAccessToken(j(this.contributor).resource)},$getAgent:function(){return this.$client.getAgent(this.$getAgentUrl()||this.$getAgentId())},$save:function(m,o){var l=this;var n=this.$memoryId?"memory-comments-template":"discussion-comments-template";return l.$helpers.chainHttpPromises(l.$plumbing.getUrl(n,null,{did:l.$discussionId,mid:l.$memoryId}),function(p){var q={discussions:[{comments:[l]}]};return l.$plumbing.post(p,q,{"Content-Type":"application/x-fs-v1+json"},o,function(r,s){if(!l.id){l.id=s.getResponseHeader("X-ENTITY-ID")}if(!l.$getCommentUrl()){l.links={comment:{href:s.getResponseHeader("Location")}}}return l.id})})},$delete:function(l,m){if(this.$discussionId){return this.$client.deleteDiscussionComment(this.$getCommentUrl()||this.$discussionId,this.id,l,m)}else{return this.$client.deleteMemoryComment(this.$getCommentUrl()||this.$memoryId,this.id,l,m)}}}},{"./../FamilySearch":1,"./../utils":47}],9:[function(i,j,h){var f=i("../FamilySearch"),l=i("../relationshipHelpers"),e=i("../utils"),k=e.maybe;var g=f.Couple=function(m,n){f.BaseClass.call(this,m,n);if(n){if(n.$husband){this.$setHusband(n.$husband)}if(n.$wife){this.$setWife(n.$wife)}if(n.facts){this.$setFacts(n.facts)}}};f.prototype.createCouple=function(m){return new g(this,m)};g.prototype={constructor:g,$getCoupleUrl:function(){return this.$helpers.removeAccessToken(k(k(this.links).relationship).href)},$getFacts:function(){return this.facts||[]},$getMarriageFact:function(){return e.find(this.facts,{type:"http://gedcomx.org/Marriage"})},$getHusbandId:function(){return k(this.person1).resourceId},$getHusbandUrl:function(){return this.$helpers.removeAccessToken(k(this.person1).resource)},$getHusband:function(){return this.$client.getPerson(this.$getHusbandUrl()||this.$getHusbandId())},$getWifeId:function(){return k(this.person2).resourceId},$getWifeUrl:function(){return this.$helpers.removeAccessToken(k(this.person2).resource)},$getWife:function(){return this.$client.getPerson(this.$getWifeUrl()||this.$getWifeId())},$getSpouseId:function(m){if(k(this.person1).resourceId===m){return k(this.person2).resourceId}else{return k(this.person1).resourceId}},$getSpouseUrl:function(m){if(k(this.person1).resourceId===m){return this.$helpers.removeAccessToken(k(this.person2).resource)}else{return this.$helpers.removeAccessToken(k(this.person1).resource)}},$getSpouse:function(m){return this.$client.getPerson(this.$getSpouseUrl(m)||this.$getSpouseId(m))},$getNotes:function(){return this.$client.getCoupleNotes(this.$helpers.removeAccessToken(k(k(this.links).notes).href))},$getSourceRefs:function(){return this.$client.getCoupleSourceRefs(this.id)},$getSources:function(){return this.$client.getCoupleSourcesQuery(this.id)},$getChanges:function(){return this.$client.getCoupleChanges(this.$helpers.removeAccessToken(k(this.links["change-history"]).href))},$setHusband:function(m){l.setMember.call(this,"person1",m);this.$husbandChanged=true;return this},$setWife:function(m){l.setMember.call(this,"person2",m);this.$wifeChanged=true;return this},$setFacts:function(n,m){l.setFacts.call(this,"facts",n,m);return this},$addFact:function(m){l.addFact.call(this,"facts",m);return this},$deleteFact:function(n,m){l.deleteFact.call(this,"facts",n,m);return this},$save:function(q,r,m){var o=this.$client.createCouple();var t=false;var n=this.id;var u=this;if(!this.id||this.$husbandChanged||this.$wifeChanged){o.person1=this.person1;o.person2=this.person2;t=true}if(q){o.attribution=u.$client.createAttribution(q)}e.forEach(this.facts,function(w){if(!n||!w.id||w.$changed){l.addFact.call(o,"facts",w);t=true}});var s=[];if(t){if(!n){o.type="http://gedcomx.org/Couple"}s.push(u.$helpers.chainHttpPromises(n?u.$plumbing.getUrl("couple-relationship-template",null,{crid:n}):u.$plumbing.getUrl("relationships"),function(w){e.forEach(["person1","person2"],function(x){if(o[x]&&!o[x].resource&&o[x].resourceId){o[x].resource=o[x].resourceId}});return u.$plumbing.post(w,{relationships:[o]},{},m,u.$helpers.getResponseEntityId)}))}if(n&&this.$deletedFacts){e.forEach(this.$deletedFacts,function(x,w){x=x||q;s.push(u.$plumbing.del(w,x?{"X-Reason":x}:{},m))})}var p=this;var v=u.$helpers.promiseAll(s).then(function(w){var x=n?n:w[0];u.$helpers.extendHttpPromise(v,s[0]);if(r){return u.$client.getCouple(x,{},m).then(function(y){e.deletePropertiesPartial(p,e.appFieldRejector);e.extend(p,y.getRelationship());return x})}else{return x}});return v},$delete:function(m,n){return this.$client.deleteCouple(this.$getCoupleUrl()||this.id,m,n)}}},{"../FamilySearch":1,"../relationshipHelpers":46,"../utils":47}],10:[function(g,h,f){var e=g("./../FamilySearch");var i=function(n,l){var m="",t="",s="",p="",q,k="+";var r=0;if(n[r]==="about"){if(!l){m="A"}r++}else{if(n[r]==="before"){if(!l){m="A/"}r++}else{if(n[r]==="after"){if(!l){m="A";t="/"}r++}}}if(n[r].length<=2){s=(n[r].length===1?"0":"")+n[r];r++}var o=["january","february","march","april","may","june","july","august","september","october","november","december"].indexOf(n[r])+1;if(o>0){p=(o<10?"0":"")+o.toString();r++}q=n[r];r++;if(r<n.length&&n[r]==="bc"){k="-"}return m+k+q+(p?"-":"")+p+(s?"-":"")+s+t};var j=e.Date=function(k,l){e.BaseClass.call(this,k,l)};e.prototype.createDate=function(k){return new j(this,k)};j.prototype={constructor:j,$getFormalDate:function(){var l="";if(this.normalized){var k=this.normalized.trim().toLowerCase().split(" ");var m=k.indexOf("/");if(m>=0){k=k.slice(0,m)}if(k[0]==="from"){m=k.indexOf("to");l=i(k.slice(1,m),true)+"/"+i(k.slice(m+1),true)}else{l=i(k,false)}}return l}}},{"./../FamilySearch":1}],11:[function(h,i,g){var f=h("./../FamilySearch"),e=h("./../utils"),j=e.maybe;var k=f.Discussion=function(l,m){f.BaseClass.call(this,l,m)};f.prototype.createDiscussion=function(l){return new k(this,l)};k.prototype={constructor:k,$getDiscussionUrl:function(){return this.$helpers.removeAccessToken(j(j(this.links).discussion).href)},$getCommentsUrl:function(){return this.$helpers.removeAccessToken(j(j(this.links).comments).href)},$getComments:function(){return this.$client.getDiscussionComments(this.$getCommentsUrl())},$getAgentId:function(){return j(this.contributor).resourceId},$getAgentUrl:function(){return this.$helpers.removeAccessToken(j(this.contributor).resource)},$getAgent:function(){return this.$client.getAgent(this.$getAgentUrl()||this.$getAgentId())},$save:function(m,n,o){var l=this;var q=l.$helpers.chainHttpPromises(l.id?l.$plumbing.getUrl("discussion-template",null,{did:l.id}):l.$plumbing.getUrl("discussions"),function(r){return l.$plumbing.post(r,{discussions:[l]},{"Content-Type":"application/x-fs-v1+json"},o,function(s,t){return l.id||t.getResponseHeader("X-ENTITY-ID")})});var p=q.then(function(r){l.$helpers.extendHttpPromise(p,q);if(n){return l.$client.getDiscussion(r,{},o).then(function(s){e.deletePropertiesPartial(l,e.appFieldRejector);e.extend(l,s.getDiscussion());return r})}else{return r}});return p},$delete:function(l,m){return this.$client.deleteDiscussion(this.$getDiscussionUrl()||this.id,l,m)}}},{"./../FamilySearch":1,"./../utils":47}],12:[function(h,i,g){var f=h("./../FamilySearch"),e=h("./../utils"),j=e.maybe;var k=f.DiscussionRef=function(l,m){f.BaseClass.call(this,l,m);if(m&&m.discussion){this.$setDiscussion(m.discussion)}};f.prototype.createDiscussionRef=function(l){return new k(this,l)};k.prototype={constructor:k,$getDiscussionRefUrl:function(){return this.$helpers.removeAccessToken(j(j(this.links)["discussion-reference"]).href)},$getDiscussionUrl:function(){return this.$helpers.removeAccessToken(this.resource)},$getDiscussion:function(){return this.$client.getDiscussion(this.$getDiscussionUrl()||this.resourceId)},$setDiscussion:function(l){if(l instanceof f.Discussion){this.resource=l.$getDiscussionUrl();this.resourceId=l.id}else{if(this.$helpers.isAbsoluteUrl(l)){this.resource=this.$helpers.removeAccessToken(l)}else{this.resourceId=l}}return this},$save:function(m,n){var l=this;return l.$helpers.chainHttpPromises(l.$plumbing.getUrl("person-discussion-references-template",null,{pid:l.$personId}),function(o){if(!l.resource&&l.resourceId){l.resource=l.resourceId}var p={persons:[{id:l.$personId,"discussion-references":[{resource:l.resource}]}]};if(m){p.persons[0].attribution=l.$client.createAttribution(m)}var q={"Content-Type":"application/x-fs-v1+json"};return l.$plumbing.post(o,p,q,n,function(r,s){if(!l.$getDiscussionRefUrl()){l.links={"discussion-reference":{href:s.getResponseHeader("Location"),title:"Discussion Reference"}}}return l.$getDiscussionRefUrl()})})},$delete:function(l,m){return this.$client.deleteDiscussionRef(this.$getDiscussionRefUrl()||this.$personId,this.id,l,m)}}},{"./../FamilySearch":1,"./../utils":47}],13:[function(i,j,h){var g=i("./../FamilySearch"),f=i("./../utils"),k=f.maybe;var e=g.Fact=function(l,m){g.BaseClass.call(this,l,m);if(m){if(m.$date){this.$setDate(m.$date);delete this.$date}if(m.$formalDate){this.$setFormalDate(m.$formalDate);delete this.$formalDate}if(m.$place){this.$setPlace(m.$place);delete this.$place}if(m.$normalizedPlace){this.$setNormalizedPlace(m.$normalizedPlace);delete this.$normalizedPlace}if(m.$changeMessage){this.$setChangeMessage(m.$changeMessage);delete this.$changeMessage}if(m.attribution&&!(m.attribution instanceof g.Attribution)){this.attribution=l.createAttribution(m.attribution)}}};g.prototype.createFact=function(l){return new e(this,l)};e.prototype={constructor:e,$getDate:function(){return k(this.date).original},$getNormalizedDate:function(){return k(k(k(this.date).normalized)[0]).value},$getFormalDate:function(){return k(this.date).formal},$getPlace:function(){return k(this.place).original},$getNormalizedPlace:function(){return k(k(k(this.place).normalized)[0]).value},$getNormalizedPlaceId:function(){var l=k(this.place).description;return(l&&l.charAt(0)==="#")?l.substr(1):""},$isCustomNonEvent:function(){if(!!this.qualifiers){var l=f.find(this.qualifiers,{name:"http://familysearch.org/v1/Event"});return !!l&&l.value==="false"}return false},$setType:function(l){this.$changed=true;this.type=l;return this},$setCustomNonEvent:function(l){var m;if(l){if(!this.qualifiers){this.qualifiers=[]}m=f.findIndex(this.qualifiers,{name:"http://familysearch.org/v1/Event"});if(m<0){m=this.qualifiers.push({name:"http://familysearch.org/v1/Event"})-1}this.qualifiers[m].value="false"}else{if(!!this.qualifiers){m=f.findIndex(this.qualifiers,{name:"http://familysearch.org/v1/Event"});if(m>=0){this.qualifiers.splice(m,1)}if(this.qualifiers.length===0){delete this.qualifiers}}}this.$changed=true;return this},$setDate:function(m){this.$changed=true;var l;if(f.isString(m)){l=m}else{if(m instanceof g.Date){l=m.original;this.$setFormalDate(m.$getFormalDate());this.$setNormalizedDate(m.normalized)}else{if(f.isObject(m)){l=m.$original;this.$setFormalDate(m.$formal);this.$setNormalizedDate(m.$normalized)}}}if(!!l){if(!this.date){this.date={}}this.date.original=l}else{delete this.date}return this},$setFormalDate:function(l){this.$changed=true;if(!!l){if(!this.date){this.date={}}this.date.formal=l}else{if(this.date){delete this.date.formal}}return this},$setNormalizedDate:function(l){this.$changed=true;if(!!l){if(!this.date){this.date={}}this.date.normalized=[{value:l}]}else{if(this.date){delete this.date.normalized}}return this},$setPlace:function(l){this.$changed=true;var m;if(f.isString(l)||l==null){m=l}else{if(l instanceof g.Place){m=l.original;this.$setNormalizedPlace(l.$getNormalizedPlace())}else{if(f.isObject(l)){m=l.$original;this.$setNormalizedPlace(l.$normalized)}}}if(!!m){if(!this.place){this.place={}}this.place.original=m}else{delete this.place}return this},$setNormalizedPlace:function(l){this.$changed=true;if(!!l){if(!this.place){this.place={}}this.place.normalized=[{value:l}]}else{if(this.place){delete this.place.normalized}}return this},$setChangeMessage:function(l){this.attribution=this.$client.createAttribution(l);return this}}},{"./../FamilySearch":1,"./../utils":47}],14:[function(h,i,g){var f=h("./../FamilySearch"),e=h("./../utils"),j=e.maybe;var k=f.Memory=function(l,m){f.BaseClass.call(this,l,m)};f.prototype.createMemory=function(l){return new k(this,l)};k.prototype={constructor:k,$getTitle:function(){return j(j(this.titles)[0]).value},$getDescription:function(){return j(j(this.description)[0]).value},$getIconUrl:function(){return this.$helpers.appendAccessToken(j(j(this.links)["image-icon"]).href)},$getThumbnailUrl:function(){return this.$helpers.appendAccessToken(j(j(this.links)["image-thumbnail"]).href)},$getImageUrl:function(){return this.$helpers.appendAccessToken(j(j(this.links)["image"]).href)},$getMemoryArtifactUrl:function(){return this.$helpers.appendAccessToken(this.$helpers.removeAccessToken(this.about))},$getMemoryUrl:function(){return this.$helpers.removeAccessToken(j(j(this.links)["description"]).href)},$getArtifactFilename:function(){return j(j(this.artifactMetadata)[0]).filename},$getArtifactType:function(){return j(j(this.artifactMetadata)[0]).artifactType},$getArtifactHeight:function(){return j(j(this.artifactMetadata)[0]).height},$getArtifactWidth:function(){return j(j(this.artifactMetadata)[0]).width},$getCommentsUrl:function(){return this.$helpers.removeAccessToken(j(j(this.links).comments).href)},$getComments:function(){return this.$client.getMemoryComments(this.$getCommentsUrl()||this.id)},$setTitle:function(l){this.titles=[{value:l}];return this},$setDescription:function(l){this.description=[{value:l}];return this},$setArtifactFilename:function(l){if(!e.isArray(this.artifactMetadata)||!this.artifactMetadata.length){this.artifactMetadata=[{}]}this.artifactMetadata[0].filename=l;return this},$save:function(m,n,o){var l=this;var q=l.$helpers.chainHttpPromises(l.id?l.$plumbing.getUrl("memory-template",null,{mid:l.id}):l.$plumbing.getUrl("memories"),function(r){if(l.id){return l.$plumbing.post(r,{sourceDescriptions:[l]},{},o,function(){return l.id})}else{var s={};if(l.$getTitle()){s.title=l.$getTitle()}if(l.$getDescription()){s.description=l.$getDescription()}if(l.$getArtifactFilename()){s.filename=l.$getArtifactFilename()}return l.$plumbing.post(l.$helpers.appendQueryParameters(r,s),l.$data,{"Content-Type":e.isString(l.$data)?"text/plain":"multipart/form-data"},o,l.$helpers.getResponseEntityId)}});var p=q.then(function(r){l.$helpers.extendHttpPromise(p,q);if(n){return l.$client.getMemory(r,{},o).then(function(s){e.deletePropertiesPartial(l,e.appFieldRejector);e.extend(l,s.getMemory());return r})}else{return r}});return p},$delete:function(l,m){return this.$client.deleteMemory(this.$getMemoryUrl()||this.id,l,m)}}},{"./../FamilySearch":1,"./../utils":47}],15:[function(i,j,g){var f=i("./../FamilySearch"),e=i("./../utils"),k=e.maybe;var h=f.MemoryArtifactRef=function(l,m){f.BaseClass.call(this,l,m)};f.prototype.createMemoryArtifactRef=function(l){return new h(this,l)};h.prototype={constructor:h,$getQualifierName:function(){return k(k(this.qualifiers)[0]).name},$getQualifierValue:function(){return k(k(this.qualifiers)[0]).value},$setQualifierName:function(l){if(!e.isArray(this.qualifiers)||!this.qualifiers.length){this.qualifiers=[{}]}this.qualifiers[0].name=l;return this},$setQualifierValue:function(l){if(!e.isArray(this.qualifiers)||!this.qualifiers.length){this.qualifiers=[{}]}this.qualifiers[0].value=l;return this}}},{"./../FamilySearch":1,"./../utils":47}],16:[function(h,i,g){var f=h("./../FamilySearch"),e=h("./../utils"),j=e.maybe;var k=f.MemoryPersona=function(l,m){f.BaseClass.call(this,l,m)};f.prototype.createMemoryPersona=function(l){return new k(this,l)};k.prototype={constructor:k,$getMemoryPersonaUrl:function(){return this.$helpers.removeAccessToken(j(j(this.links).persona).href)},$getMemoryArtifactRef:function(){return j(this.media)[0]},$getName:function(){return j(this.names)[0]},$getDisplayName:function(){return j(this.display).name},$getMemoryUrl:function(){return this.$helpers.removeAccessToken(j(this.$getMemoryArtifactRef()).description)},$getMemory:function(){return this.$client.getMemory(this.$getMemoryUrl()||this.$memoryId)},$setName:function(l){if(!(l instanceof f.Name)){l=this.$client.createName(l)}this.names=[l];return this},$setMemoryArtifactRef:function(l){this.media=[l];return this},$save:function(m,n,o){var l=this;var q=l.$helpers.chainHttpPromises(l.$plumbing.getUrl((l.id?"memory-persona-template":"memory-personas-template"),null,{mid:l.$memoryId,pid:l.id}),function(r){if(!l.$getMemoryArtifactRef()){var s=l.$helpers.getUrlFromDiscoveryResource(l.$client.settings.discoveryResource,"memory-template",{mid:l.$memoryId});l.$setMemoryArtifactRef(l.$client.createMemoryArtifactRef({description:s}))}return l.$plumbing.post(r,{persons:[l]},{},o,function(t,u){return l.$getMemoryPersonaUrl()||l.$helpers.removeAccessToken(u.getResponseHeader("Location"))})});var p=q.then(function(r){l.$helpers.extendHttpPromise(p,q);if(n){return l.$client.getMemoryPersona(r,null,{},o).then(function(s){e.deletePropertiesPartial(l,e.appFieldRejector);e.extend(l,s.getMemoryPersona());return r})}else{return r}});return p},$delete:function(l,m){return this.$client.deleteMemoryPersona(this.$getMemoryPersonaUrl()||this.$memoryId,this.id,l,m)}}},{"./../FamilySearch":1,"./../utils":47}],17:[function(i,j,g){var f=i("./../FamilySearch"),e=i("./../utils"),k=e.maybe;var h=f.MemoryPersonaRef=function(l,m){f.BaseClass.call(this,l,m);if(m&&m.$memoryPersona){this.$setMemoryPersona(m.$memoryPersona)}};f.prototype.createMemoryPersonaRef=function(l){return new h(this,l)};h.prototype={constructor:h,$getMemoryPersonaRefUrl:function(){return this.$helpers.removeAccessToken(k(k(this.links)["evidence-reference"]).href)},$getMemoryPersonaUrl:function(){return this.$helpers.removeAccessToken(this.resource)},$getMemoryPersona:function(){return this.$client.getMemoryPersona(this.$getMemoryPersonaUrl())},$getMemoryUrl:function(){return this.$helpers.removeAccessToken(k(k(this.links).memory).href)},$getMemory:function(){return this.$client.getMemory(this.$getMemoryUrl())},$setMemoryPersona:function(l){if(l instanceof f.MemoryPersona){l=l.$getMemoryPersonaUrl()}this.resource=this.$helpers.removeAccessToken(l);return this},$save:function(m,n){var l=this;return l.$helpers.chainHttpPromises(l.$plumbing.getUrl("person-memory-persona-references-template",null,{pid:l.$personId}),function(o){return l.$plumbing.post(o,{persons:[{evidence:[l]}]},{},n,function(p,q){if(!l.id){l.id=q.getResponseHeader("X-ENTITY-ID")}if(!l.$getMemoryPersonaRefUrl()){l.links={"evidence-reference":{href:q.getResponseHeader("Location")}}}return l.$getMemoryPersonaRefUrl()})})},$delete:function(l,m){return this.$client.deleteMemoryPersonaRef(this.$getMemoryPersonaRefUrl()||this.$personId,this.id,l,m)}}},{"./../FamilySearch":1,"./../utils":47}],18:[function(i,j,h){var g=i("./../FamilySearch"),f=i("./../utils"),l=f.maybe;var e=g.Name=function(m,n){g.BaseClass.call(this,m,n);if(n){if(f.isString(n)){this.$setFullText(n)}else{if(n.type){this.$setType(n.type)}if(n.$givenName){this.$setGivenName(n.$givenName);delete this.$givenName}if(n.$surname){this.$setSurname(n.$surname);delete this.$surname}if(n.$prefix){this.$setPrefix(n.$prefix);delete this.$prefix}if(n.$suffix){this.$setSuffix(n.$suffix);delete this.$suffix}if(n.$fullText){this.$setFullText(n.$fullText);delete this.$fullText}this.$setPreferred(!!n.preferred);if(n.$changeMessage){this.$setChangeMessage(n.$changeMessage);delete this.$changeMessage}if(n.attribution&&!(n.attribution instanceof g.Attribution)){this.attribution=m.createAttribution(n.attribution)}}}};g.prototype.createName=function(m){return new e(this,m)};function k(m,n){var o=n||0;if(!f.isArray(m.nameForms)){m.nameForms=[]}while(o>=m.nameForms.length){m.nameForms.push({})}return m.nameForms[o]}e.prototype={constructor:e,$getNameFormsCount:function(){return this.nameForms?this.nameForms.length:0},$getNameForm:function(m){return l(this.nameForms)[m||0]},$getFullText:function(m){return l(this.$getNameForm(m)).fullText},$getLang:function(m){return l(this.$getNameForm(m)).lang},$getNamePart:function(n,m){return l(f.find(l(this.$getNameForm(m)).parts,{type:n})).value},$getGivenName:function(m){return this.$getNamePart("http://gedcomx.org/Given",m)},$getSurname:function(m){return this.$getNamePart("http://gedcomx.org/Surname",m)},$getPrefix:function(m){return this.$getNamePart("http://gedcomx.org/Prefix",m)},$getSuffix:function(m){return this.$getNamePart("http://gedcomx.org/Suffix",m)},$setType:function(m){this.$changed=true;if(!!m){this.type=m}else{delete this.type}return this},$setPreferred:function(m){this.$changed=true;this.preferred=m;return this},$setFullText:function(n,m){this.$changed=true;var o=k(this,m);if(!!n){o.fullText=n}else{delete o.fullText}return this},$setNamePart:function(n,p,o){this.$changed=true;var q=k(this,o);if(!f.isArray(q.parts)){q.parts=[]}var m=f.find(q.parts,{type:p});if(!!n){if(!m){m={type:p};q.parts.push(m)}m.value=n}else{if(!!m){q.parts.splice(q.parts.indexOf(m),1)}}return this},$setGivenName:function(m,n){return this.$setNamePart(m,"http://gedcomx.org/Given",n)},$setSurname:function(n,m){return this.$setNamePart(n,"http://gedcomx.org/Surname",m)},$setPrefix:function(n,m){return this.$setNamePart(n,"http://gedcomx.org/Prefix",m)},$setSuffix:function(n,m){return this.$setNamePart(n,"http://gedcomx.org/Suffix",m)},$setChangeMessage:function(m){this.attribution=this.$client.createAttribution(m);return this}}},{"./../FamilySearch":1,"./../utils":47}],19:[function(i,j,h){var f=i("./../FamilySearch"),e=i("./../utils"),k=e.maybe;var g=f.Note=function(l,m){f.BaseClass.call(this,l,m);if(this.attribution&&!(this.attribution instanceof f.Attribution)){this.attribution=l.createAttribution(this.attribution)}};f.prototype.createNote=function(l){return new g(this,l)};g.prototype={constructor:g,$getNoteUrl:function(){return this.$helpers.removeAccessToken(k(k(this.links).note).href)},$save:function(o,p,l){var s=this;var r,q;var n={};if(s.$personId){r=s.id?"person-note-template":"person-notes-template";q="persons"}else{if(s.$coupleId){r=s.id?"couple-relationship-note-template":"couple-relationship-notes-template";q="relationships"}else{if(s.$childAndParentsId){r=s.id?"child-and-parents-relationship-note-template":"child-and-parents-relationship-notes-template";q="childAndParentsRelationships";n["Content-Type"]="application/x-fs-v1+json"}}}var t=s.$helpers.chainHttpPromises(s.$plumbing.getUrl(r,null,{pid:s.$personId,crid:s.$coupleId,caprid:s.$childAndParentsId,nid:s.id}),function(u){var v={};v[q]=[{notes:[s]}];if(o){v[q][0].attribution=s.$client.createAttribution(o)}return s.$plumbing.post(u,v,n,l,function(w,x){return{id:s.id||x.getResponseHeader("X-ENTITY-ID"),location:s.$getNoteUrl()||s.$helpers.removeAccessToken(x.getResponseHeader("Location"))}})});var m=t.then(function(u){s.$helpers.extendHttpPromise(m,t);if(p){return s.$client.getPersonNote(u.location,null,{},l).then(function(v){e.deletePropertiesPartial(s,e.appFieldRejector);e.extend(s,v.getNote());return u.id})}else{return u.id}});return m},$delete:function(l,m){if(this.$personId){return this.$client.deletePersonNote(this.$getNoteUrl()||this.$personId,this.id,l,m)}else{if(this.$coupleId){return this.$client.deleteCoupleNote(this.$getNoteUrl()||this.$coupleId,this.id,l,m)}else{return this.$client.deleteChildAndParentsNote(this.$getNoteUrl()||this.$childAndParentsId,this.id,l,m)}}}}},{"./../FamilySearch":1,"./../utils":47}],20:[function(j,k,i){var f=j("../FamilySearch"),e=j("../utils"),l=e.maybe;var h=f.Person=function(m,n){f.BaseClass.call(this,m,n);if(n){if(n.$gender){this.$setGender(n.$gender);delete this.$gender}if(n.names){this.$setNames(n.names)}if(n.facts){this.$setFacts(n.facts)}if(n.attribution&&!(n.attribution instanceof f.Attribution)){this.attribution=m.createAttribution(n.attribution)}}};f.prototype.createPerson=function(m){return new h(this,m)};function g(m){return m?" "+m:""}h.prototype={constructor:h,$getFacts:function(m){return(m?e.filter(this.facts,{type:m}):this.facts)||[]},$getFact:function(m){return e.find(this.facts,{type:m})},$getBirth:function(){return this.$getFact("http://gedcomx.org/Birth")},$getBirthDate:function(){var m=this.$getBirth();return m?m.$getDate():""},$getBirthPlace:function(){var m=this.$getBirth();return m?m.$getPlace():""},$getChristening:function(){return this.$getFact("http://gedcomx.org/Christening")},$getChristeningDate:function(){var m=this.$getChristening();return m?m.$getDate():""},$getChristeningPlace:function(){var m=this.$getChristening();return m?m.$getPlace():""},$getDeath:function(){return this.$getFact("http://gedcomx.org/Death")},$getDeathDate:function(){var m=this.$getDeath();return m?m.$getDate():""},$getDeathPlace:function(){var m=this.$getDeath();return m?m.$getPlace():""},$getBurial:function(){return this.$getFact("http://gedcomx.org/Burial")},$getBurialDate:function(){var m=this.$getBurial();return m?m.$getDate():""},$getBurialPlace:function(){var m=this.$getBurial();return m?m.$getPlace():""},$getDisplayBirthDate:function(){return l(this.display).birthDate},$getDisplayBirthPlace:function(){return l(this.display).birthPlace},$getDisplayDeathDate:function(){return l(this.display).deathDate},$getDisplayDeathPlace:function(){return l(this.display).deathPlace},$getDisplayGender:function(){return l(this.display).gender},$getDisplayLifeSpan:function(){return l(this.display).lifespan},$getDisplayName:function(){return l(this.display).name},$getNames:function(m){return(m?e.filter(this.names,{type:m}):this.names)||[]},$getPreferredName:function(){return e.findOrFirst(this.names,{preferred:true})},$getGivenName:function(){var m=this.$getPreferredName();if(m){m=m.$getGivenName()}return m},$getSurname:function(){var m=this.$getPreferredName();if(m){m=m.$getSurname()}return m},$getPersistentIdentifier:function(){return l(l(this.identifiers)["http://gedcomx.org/Persistent"])[0]},$getPersonUrl:function(){return this.$helpers.removeAccessToken(l(l(this.links).person).href)},$getChanges:function(m){return this.$client.getPersonChanges(this.$helpers.removeAccessToken(this.links["change-history"].href),m)},$getDiscussionRefs:function(){return this.$client.getPersonDiscussionRefs(this.$helpers.removeAccessToken(this.links["discussion-references"].href))},$getMemoryPersonaRefs:function(){return this.$client.getMemoryPersonaRefs(this.$helpers.removeAccessToken(this.links["evidence-references"].href))},$getNotes:function(){return this.$client.getPersonNotes(this.$helpers.removeAccessToken(this.links.notes.href))},$getSourceRefs:function(){return this.$client.getPersonSourceRefs(this.id)},$getSources:function(){return this.$client.getPersonSourcesQuery(this.id)},$getSpouses:function(){return this.$client.getSpouses(this.id)},$getParents:function(){return this.$client.getParents(this.id)},$getChildren:function(){return this.$client.getChildren(this.id)},$getMatches:function(){return this.$client.getPersonMatches(this.id)},$getAncestry:function(m){return this.$client.getAncestry(this.id,m)},$getDescendancy:function(m){return this.$client.getDescendancy(this.id,m)},$getPersonPortraitUrl:function(m){return this.$client.getPersonPortraitUrl(this.id,m)},$setNames:function(m,n){if(e.isArray(this.names)){e.forEach(this.names,function(o){this.$deleteName(o,n)},this)}this.names=[];e.forEach(m,function(o){this.$addName(o)},this);return this},$addName:function(m){if(!e.isArray(this.names)){this.names=[]}if(!(m instanceof f.Name)){m=this.$client.createName(m)}this.names.push(m);return this},$deleteName:function(n,m){if(!(n instanceof f.Name)){n=e.find(this.names,{id:n})}var o=e.indexOf(this.names,n);if(o>=0){if(!this.$deletedConclusions){this.$deletedConclusions={}}this.$deletedConclusions[n.id]=m;this.names.splice(o,1)}return this},$setFacts:function(m,n){if(e.isArray(this.facts)){e.forEach(this.facts,function(o){this.$deleteFact(o,n)},this)}this.facts=[];e.forEach(m,function(o){this.$addFact(o)},this);return this},$addFact:function(m){if(!e.isArray(this.facts)){this.facts=[]}if(!(m instanceof f.Fact)){m=this.$client.createFact(m)}this.facts.push(m);return this},$deleteFact:function(n,m){if(!(n instanceof f.Fact)){n=e.find(this.facts,{id:n})}var o=e.indexOf(this.facts,n);if(o>=0){if(!this.$deletedConclusions){this.$deletedConclusions={}}this.$deletedConclusions[n.id]=m;this.facts.splice(o,1)}return this},$setGender:function(n,m){if(!this.gender){this.gender={}}this.gender.$changed=true;this.gender.type=n;if(m){this.gender.attribution=this.$client.createAttribution(m)}return this},$save:function(p,q,m){var n=this.$client.createPerson();var s=false;if(this.id){n.id=this.id}if(!this.id){if(!this.gender){this.$setGender("http://gedcomx.org/Unknown")}if(!e.isArray(this.names)||this.names.length===0){this.$addName({$fullText:"Unknown",$givenName:"Unknown"})}if(!e.find(this.names,{preferred:true})){this.names[0].$setPreferred(true)}if(this.names.length===1&&!this.names[0].type){this.names[0].$setType("http://gedcomx.org/BirthName")}if(e.isUndefined(this.living)){this.living=false}}if(p){n.attribution=this.$client.createAttribution(p)}if(!this.id){n.living=this.living}if(this.gender&&(!this.gender.id||this.gender.$changed)){n.gender=this.gender;s=true}e.forEach(this.names,function(v){if(!v.id||v.$changed){if(!v.$getFullText()){v.$setFullText((g(v.$getPrefix())+g(v.$getGivenName())+g(v.$getSurname())+g(v.$getSuffix())).trim())}n.$addName(v);s=true}});e.forEach(this.facts,function(v){if(!v.id||v.$changed){n.$addFact(v);s=true}});var r=[],t=this;if(s){r.push(t.$helpers.chainHttpPromises(n.id?t.$plumbing.getUrl("person-template",null,{pid:n.id}):t.$plumbing.getUrl("persons"),function(v){return t.$plumbing.post(v,{persons:[n]},{},m,t.$helpers.getResponseEntityId)}))}if(this.id&&this.$deletedConclusions){e.forEach(this.$deletedConclusions,function(w,v){w=w||p;r.push(t.$helpers.chainHttpPromises(t.$plumbing.getUrl("person-conclusion-template",null,{pid:n.id,cid:v}),function(x){return t.$plumbing.del(x,w?{"X-Reason":w}:{},m)}))})}var o=this;var u=t.$helpers.promiseAll(r).then(function(v){var w=n.id?n.id:v[0];t.$helpers.extendHttpPromise(u,r[0]);if(q){return t.$client.getPerson(w,{},m).then(function(x){e.deletePropertiesPartial(o,e.appFieldRejector);e.extend(o,x.getPerson());return w})}else{return w}});return u},$delete:function(m,n){return this.$client.deletePerson(this.$getPersonUrl()||this.id,m,n)}}},{"../FamilySearch":1,"../utils":47}],21:[function(g,h,f){var e=g("./../FamilySearch");var i=e.Place=function(j,k){e.BaseClass.call(this,j,k)};e.prototype.createPlace=function(j){return new i(this,j)};i.prototype={constructor:i,$getNormalizedPlace:function(){return this.normalized?this.normalized[0]:undefined}}},{"./../FamilySearch":1}],22:[function(i,j,h){var g=i("./../FamilySearch"),f=i("./../utils"),k=f.maybe;var e=g.SearchResult=function(l,m){g.BaseClass.call(this,l,m);f.forEach(k(k(k(m).content).gedcomx).persons,function(o,n,p){p[n]=l.createPerson(o)})};g.prototype.createSearchResult=function(l){return new e(this,l)};e.prototype={constructor:e,$getPerson:function(l){return f.find(k(k(this.content).gedcomx).persons,{id:l})},$getPrimaryPerson:function(){return this.$getPerson(this.id)},$getFullPrimaryPerson:function(){return this.$client.getPerson(this.id)},$getFatherIds:function(){var m=this.id,l=this;return f.uniq(f.map(f.filter(k(k(this.content).gedcomx).relationships,function(n){return n.type==="http://gedcomx.org/ParentChild"&&n.person2.resourceId===m&&n.person1&&k(l.$getPerson(n.person1.resourceId).gender).type==="http://gedcomx.org/Male"}),function(n){return n.person1.resourceId}))},$getFathers:function(){return f.map(this.$getFatherIds(),this.$getPerson,this)},$getMotherIds:function(){var m=this.id,l=this;return f.uniq(f.map(f.filter(k(k(this.content).gedcomx).relationships,function(n){return n.type==="http://gedcomx.org/ParentChild"&&n.person2.resourceId===m&&n.person1&&k(l.$getPerson(n.person1.resourceId).gender).type!=="http://gedcomx.org/Male"}),function(n){return n.person1.resourceId}))},$getMothers:function(){return f.map(this.$getMotherIds(),this.$getPerson,this)},$getSpouseIds:function(){var l=this.id;return f.uniq(f.map(f.filter(k(k(this.content).gedcomx).relationships,function(m){return m.type==="http://gedcomx.org/Couple"&&(m.person1.resourceId===l||m.person2.resourceId===l)}),function(m){return m.person1.resourceId===l?m.person2.resourceId:m.person1.resourceId}))},$getSpouses:function(){return f.map(this.$getSpouseIds(),this.$getPerson,this)},$getChildIds:function(){var l=this.id;return f.uniq(f.map(f.filter(k(k(this.content).gedcomx).relationships,function(m){return m.type==="http://gedcomx.org/ParentChild"&&m.person1.resourceId===l&&m.person2}),function(m){return m.person2.resourceId}))},$getChildren:function(){return f.map(this.$getChildIds(),this.$getPerson,this)}}},{"./../FamilySearch":1,"./../utils":47}],23:[function(i,j,h){var g=i("./../FamilySearch"),f=i("./../utils"),k=f.maybe;var e=g.SourceDescription=function(l,m){g.BaseClass.call(this,l,m);if(m){if(m.$citation){this.$setCitation(m.$citation)}if(m.$title){this.$setTitle(m.$title)}if(m.$text){this.$setText(m.$text)}if(m.attribution&&!(m.attribution instanceof g.Attribution)){this.attribution=l.createAttribution(m.attribution)}}};g.prototype.createSourceDescription=function(l){return new e(this,l)};e.prototype={constructor:e,$getCitation:function(){return k(k(this.citations)[0]).value},$getTitle:function(){return k(k(this.titles)[0]).value},$getText:function(){return k(k(this.notes)[0]).text},$getSourceDescriptionUrl:function(){return this.$helpers.removeAccessToken(k(k(this.links).description).href)},$getSourceRefsQuery:function(){return this.$client.getSourceRefsQuery(this.id)},$setCitation:function(l){this.citations=[{value:l}];return this},$setTitle:function(l){this.titles=[{value:l}];return this},$setText:function(l){this.notes=[{text:l}];return this},$save:function(m,n,o){var l=this;if(m){l.attribution=l.$client.createAttribution(m)}var q=l.$helpers.chainHttpPromises(l.id?l.$plumbing.getUrl("source-description-template",null,{sdid:l.id}):l.$plumbing.getUrl("source-descriptions"),function(r){return l.$plumbing.post(r,{sourceDescriptions:[l]},{},o,function(s,t){return l.id||t.getResponseHeader("X-ENTITY-ID")})});var p=q.then(function(r){l.$helpers.extendHttpPromise(p,q);if(n){return l.$client.getSourceDescription(r,{},o).then(function(s){f.deletePropertiesPartial(l,f.appFieldRejector);f.extend(l,s.getSourceDescription());return r})}else{return r}});return p},$delete:function(l,m){return this.$client.deleteSourceDescription(this.id,l,m)}}},{"./../FamilySearch":1,"./../utils":47}],24:[function(h,i,g){var f=h("./../FamilySearch"),e=h("./../utils"),j=e.maybe;var k=f.SourceRef=function(l,m){f.BaseClass.call(this,l,m);if(m){this.$personId=m.$personId;this.$coupleId=m.$coupleId;this.$childAndParentsId=m.$childAndParentsId;if(m.$sourceDescription){this.$setSourceDescription(m.$sourceDescription)}if(m.$tags){this.$setTags(m.$tags)}if(m.attribution&&!(m.attribution instanceof f.Attribution)){this.attribution=l.createAttribution(m.attribution)}}};f.prototype.createSourceRef=function(l){return new k(this,l)};k.prototype={constructor:k,$getSourceRefUrl:function(){return this.$helpers.removeAccessToken(j(j(this.links)["source-reference"]).href)},$getSourceDescriptionUrl:function(){return this.$helpers.removeAccessToken(this.description)},$getSourceDescription:function(){return this.$client.getSourceDescription(this.$getSourceDescriptionUrl())},$getTags:function(){return e.map(this.tags,function(l){return l.resource})},$setSourceDescription:function(l){if(l instanceof f.SourceDescription){this.$sourceDescriptionId=l.id;this.description=l.$getSourceDescriptionUrl()}else{if(this.$helpers.isAbsoluteUrl(l)){delete this.$sourceDescriptionId;this.description=this.$sourceDescriptionUrl}else{this.$sourceDescriptionId=l;delete this.description}}return this},$setTags:function(l){this.tags=e.map(l,function(m){return{resource:m}});return this},$addTag:function(l){if(!e.isArray(this.tags)){this.tags=[]}this.tags.push({resource:l});return this},$removeTag:function(l){l=e.find(this.tags,{resource:l});if(l){this.tags.splice(e.indexOf(this.tags,l),1)}return this},$save:function(n,p){var l=this;if(n){l.attribution=l.$client.createAttribution(n)}var o,m;var q={};if(l.$personId){o="person-source-references-template";m="persons"}else{if(l.$coupleId){o="couple-relationship-source-references-template";m="relationships"}else{if(l.$childAndParentsId){o="child-and-parents-relationship-source-references-template";o="child-and-parents-relationship-source-references-template";m="childAndParentsRelationships";q["Content-Type"]="application/x-fs-v1+json"}}}return l.$helpers.chainHttpPromises(l.$plumbing.getUrl(o,null,{pid:l.$personId,crid:l.$coupleId,caprid:l.$childAndParentsId,srid:l.id}),function(r){if(!l.description&&!!l.$sourceDescriptionId){l.description=l.$helpers.getUrlFromDiscoveryResource(l.$client.settings.discoveryResource,"source-description-template",{sdid:l.$sourceDescriptionId})}l.description=l.$helpers.removeAccessToken(l.description);var s={};s[m]=[{sources:[l]}];return l.$plumbing.post(r,s,q,p,function(t,u){if(!l.id){l.id=u.getResponseHeader("X-ENTITY-ID")}if(!l.$getSourceRefUrl()){l.links={"source-reference":{href:l.$helpers.removeAccessToken(u.getResponseHeader("Location"))}}}return l.id})})},$delete:function(l,m){if(this.$personId){return this.$client.deletePersonSourceRef(this.$getSourceRefUrl()||this.$personID,this.id,l,m)}else{if(this.$coupleId){return this.$client.deleteCoupleSourceRef(this.$getSourceRefUrl()||this.$coupleId,this.id,l,m)}else{return this.$client.deleteChildAndParentsSourceRef(this.$getSourceRefUrl()||this.$childAndParentsId,this.id,l,m)}}}}},{"./../FamilySearch":1,"./../utils":47}],25:[function(g,h,f){var e=g("../FamilySearch");var i=e.User=function(j,k){e.BaseClass.call(this,j,k)};e.prototype.createUser=function(j){return new i(this,j)};i.prototype={constructor:i}},{"../FamilySearch":1}],26:[function(f,g,e){g.exports={clientId:null,environment:null,httpWrapper:null,deferredWrapper:null,setTimeout:null,clearTimeout:null,redirectUri:null,autoSignin:false,autoExpire:false,accessToken:null,saveAccessToken:false,logging:false,accessTokenCookie:"FS_ACCESS_TOKEN",authCodePollDelay:50,defaultThrottleRetryAfter:500,maxHttpRequestRetries:2,maxAccessTokenInactivityTime:3540000,maxAccessTokenCreationTime:86340000,apiServer:{sandbox:"https://sandbox.familysearch.org",staging:"https://stage.familysearch.org",beta:"https://beta.familysearch.org",production:"https://familysearch.org"},oauthServer:{sandbox:"https://sandbox.familysearch.org/cis-web/oauth2/v3",staging:"https://identbeta.familysearch.org/cis-web/oauth2/v3",beta:"https://identbeta.familysearch.org/cis-web/oauth2/v3",production:"https://ident.familysearch.org/cis-web/oauth2/v3"},authoritiesServer:{sandbox:"https://sandbox.familysearch.org",staging:"https://stage.familysearch.org",beta:"https://apibeta.familysearch.org",production:"https://api.familysearch.org"},discoveryUrl:"/.well-known/app-meta"}},{}],27:[function(g,i,f){var e=g("./utils"),j=e.forEach;var h=function(k){this.settings=k.settings;this.accessTokenInactiveTimer=null;this.accessTokenCreationTimer=null};h.prototype.getAbsoluteUrl=function(l,k){if(!this.isAbsoluteUrl(k)){return l+(k.charAt(0)!=="/"?"/":"")+k}else{return k}};h.prototype.isOAuthServerUrl=function(k){return k.indexOf(this.settings.oauthServer[this.settings.environment])===0};h.prototype.getAPIServerUrl=function(k){return this.getAbsoluteUrl(this.settings.apiServer[this.settings.environment],k)};h.prototype.getAuthoritiesServerUrl=function(k){return this.getAbsoluteUrl(this.settings.authoritiesServer[this.settings.environment],k)};h.prototype.appendAccessToken=function(k){if(k){var l=this.decodeQueryString(k);k=this.removeQueryString(k);l.access_token=this.settings.accessToken;k=this.appendQueryParameters(k,l)}return k};h.prototype.log=function(){if(this.settings.debug){console.log.apply(null,arguments)}};h.prototype.nextTick=function(k){this.settings.setTimeout(function(){k()},0)};h.prototype.refPromise=function(l){if(l&&e.isFunction(l.then)){return l}var k=this;return{then:function(n){var m=k.settings.deferredWrapper();k.nextTick(function(){m.resolve(n(l))});return m.promise}}};h.prototype.promiseAll=function(n){var o=this.settings.deferredWrapper(),k=0,m=e.isArray(n)?[]:{},l=this;j(n,function(q,p){k++;l.refPromise(q).then(function(r){if(m.hasOwnProperty(p)){return}m[p]=r;if(!(--k)){o.resolve(m)}},function(){if(m.hasOwnProperty(p)){return}o.reject.apply(o,arguments)})});if(k===0){o.resolve(m)}return o.promise};h.prototype.setTimer=function(l,k,m){if(m){this.settings.clearTimeout(m)}return this.settings.setTimeout(function(){l()},k)};h.prototype.setAccessTokenInactiveTimer=function(k){this.accessTokenInactiveTimer=this.setTimer(this.settings.eraseAccessToken,k,this.accessTokenInactiveTimer)};h.prototype.setAccessTokenCreationTimer=function(k){this.accessTokenCreationTimer=this.setTimer(this.settings.eraseAccessToken,k,this.accessTokenCreationTimer)};h.prototype.clearAccessTokenTimers=function(){this.settings.clearTimeout(this.accessTokenInactiveTimer);this.accessTokenInactiveTimer=null;this.settings.clearTimeout(this.accessTokenCreationTimer);this.accessTokenCreationTimer=null};h.prototype.getAccessTokenCookieName=function(){return this.settings.accessTokenCookie+"_"+this.settings.instanceId};h.prototype.readAccessToken=function(){if(typeof window==="undefined"){return}var m=(new Date()).getTime(),l=this;var o=this.readCookie(this.getAccessTokenCookieName());if(o){var p=o.split("|",3);if(p.length===3){var k=m-parseInt(p[0],10);var n=m-parseInt(p[1],10);if(k<this.settings.maxAccessTokenInactivityTime&&n<this.settings.maxAccessTokenCreationTime){this.settings.accessToken=p[2];if(this.settings.autoExpire){l.setAccessTokenInactiveTimer(this.settings.maxAccessTokenInactivityTime-k);l.setAccessTokenCreationTimer(this.settings.maxAccessTokenCreationTime-n)}}}}};h.prototype.setAccessToken=function(l){this.settings.accessToken=l;if(typeof window==="undefined"){return}if(this.settings.autoExpire){this.setAccessTokenInactiveTimer(this.settings.maxAccessTokenInactivityTime);this.setAccessTokenCreationTimer(this.settings.maxAccessTokenCreationTime)}if(this.settings.saveAccessToken){var k=(new Date()).getTime();var m=k+"|"+k+"|"+l;this.createCookie(this.getAccessTokenCookieName(),m,0)}};h.prototype.refreshAccessToken=function(){var k=(new Date()).getTime();if(this.settings.autoExpire){this.setAccessTokenInactiveTimer(this.settings.maxAccessTokenInactivityTime)}if(this.settings.saveAccessToken){var l=this.readCookie(this.getAccessTokenCookieName());if(l){var m=l.split("|",3);if(m.length===3){l=k+"|"+m[1]+"|"+m[2];this.createCookie(this.getAccessTokenCookieName(),l,0)}}}};h.prototype.eraseAccessToken=function(k){this.settings.accessToken=null;if(typeof window==="undefined"){return}if(this.settings.autoExpire){this.clearAccessTokenTimers()}if(this.settings.saveAccessToken){this.eraseCookie(this.getAccessTokenCookieName())}if(!!this.settings.expireCallback&&!k){this.settings.expireCallback()}};h.prototype.extendHttpPromise=function(k,l){return e.wrapFunctions(k,l,["getResponseHeader","getAllResponseHeaders","getStatusCode","getRequest"])};h.prototype.chainHttpPromises=function(){var l=arguments[0];var m={};var k=this;j(Array.prototype.slice.call(arguments,1),function(n){l=l.then(function(){var o=n.apply(null,arguments);if(o&&o.then){k.extendHttpPromise(m,o)}return o})});k.extendHttpPromise(l,m);return l};h.prototype.getLastUrlSegment=function(k){if(k){k=k.replace(/^.*\//,"").replace(/\?.*$/,"")}return k};h.prototype.getResponseEntityId=function(k,l){return l.getResponseHeader("X-ENTITY-ID")};h.prototype.getResponseLocation=function(k,l){return this.removeAccessToken(l.getResponseHeader("Location"))};h.prototype.isAbsoluteUrl=function(k){return(/^https?:\/\//).test(k)};h.prototype.isAuthoritiesServerUrl=function(k){return k.indexOf("/authorities/v1/")!==-1};h.prototype.encodeQueryString=function(l){var k=[];j(l,function(n,m){m=encodeURIComponent(m);var o;if(e.isArray(n)){o=e.map(n,function(p){return m+"="+encodeURIComponent(p)}).join("&")}else{if(n!=null){o=m+"="+encodeURIComponent(n)}else{o=m}}k.push(o)});return k.join("&")};h.prototype.appendQueryParameters=function(k,l){var m=this.encodeQueryString(l);if(m.length===0){return k}return k+(k.indexOf("?")>=0?"&":"?")+m};h.prototype.decodeQueryString=function(l){var m={};if(l){var n=l.indexOf("?");if(n!==-1){var k=l.substring(n+1).split("&");j(k,function(p){var r=p.split("=",2);if(r&&r[0]){var o=decodeURIComponent(r[0]);var q=(r[1]!=null?decodeURIComponent(r[1]):r[1]);if(m[o]!=null&&!e.isArray(m[o])){m[o]=[m[o]]}if(m[o]!=null){m[o].push(q)}else{m[o]=q}}})}}return m};h.prototype.removeQueryString=function(k){if(k){var l=k.indexOf("?");if(l!==-1){k=k.substring(0,l)}}return k};h.prototype.removeAccessToken=function(k){if(k){var l=this.decodeQueryString(k);k=this.removeQueryString(k);delete l.access_token;k=this.appendQueryParameters(k,l)}return k};h.prototype.populateUriTemplate=function(o,q){var m=o.split(/[{}]/);var l=false;for(var n=0,k=m.length;n<k;n++){if(n%2===1){var p=q[m[n]];m[n]=l?encodeURIComponent(p):encodeURI(p)}else{if(m[n].indexOf("?")!==-1){l=true}}}return m.join("")};h.prototype.getUrlFromDiscoveryResource=function(o,l,p){var k="";var n=o.links[l];if(n.href){k=this.removeAccessToken(n.href)}else{if(n.template){var m=n.template.replace(/{\?[^}]*}/,"");k=this.populateUriTemplate(m,p||{})}}return k};h.prototype.attributionNeeded=function(k){return !!(!k.attribution||!k.attribution.changeMessage||k.attribution.contributor)};h.prototype.createCookie=function(m,o,p){var k="";var n=document.location.protocol==="https"&&document.location.hostname!=="localhost";if(p){var l=new Date();l.setTime(l.getTime()+(p*86400));k="; expires="+l.toUTCString()}document.cookie=m+"="+o+k+"; path=/"+(n?"; secure":"")};h.prototype.readCookie=function(l){var n=l+"=";var k=document.cookie.split(";");for(var m=0;m<k.length;m++){var o=k[m];while(o.charAt(0)===" "){o=o.substring(1,o.length)}if(o.indexOf(n)===0){return o.substring(n.length,o.length)}}return null};h.prototype.eraseCookie=function(k){this.createCookie(k,"",-1)};i.exports=h},{"./utils":47}],28:[function(g,h,f){var e=g("./utils"),f={};f.httpWrapper=function(j,i){return function(k,m,n,q,l){l=e.extend({url:m,type:k,dataType:"json",data:q,processData:false},l);l.headers=e.extend({},n,l.headers);if(l.headers["Content-Type"]==="multipart/form-data"){l.contentType=false;delete l.headers["Content-Type"]}var s=j(l);var r=i.settings.deferredWrapper();var o=r.promise;var p=null;s.then(function(u,v,t){p=t.status;r.resolve(u)},function(t,v,u){p=t.status;if(p>=200&&p<=299&&!t.responseText){r.resolve(null)}else{r.reject(t,v,u)}});e.wrapFunctions(o,s,["getResponseHeader","getAllResponseHeaders"]);o.getStatusCode=function(){return p};o.getRequest=function(){return l};return o}};f.deferredWrapper=function(i){return function(){var j=i();return{promise:j.promise(),resolve:j.resolve,reject:j.reject}}};h.exports=f},{"./utils":47}],29:[function(h,i,g){var f=h("./../FamilySearch"),e=h("./../utils");f.prototype.getAuthCode=function(){var j=this,k=j.settings;if(typeof window==="undefined"){var l=k.deferredWrapper();l.reject();return l.promise}else{return j.plumbing.getUrl("http://oauth.net/core/2.0/endpoint/authorize").then(function(n){var m=j.openPopup(n,{response_type:"code",client_id:k.clientId,redirect_uri:k.redirectUri});return j._pollForAuthCode(m)})}};f.prototype.handleAccessTokenResponse=function(l,j){var k=this;l.then(function(n){var m=n.access_token;if(m){k.helpers.setAccessToken(m);j.resolve(m)}else{j.reject(n.error)}},function(){j.reject.apply(j,arguments)})};f.prototype.getAccessToken=function(l){var k=this,m=k.settings,j=m.deferredWrapper(),o=k.plumbing,n=k.helpers;if(m.accessToken){n.nextTick(function(){j.resolve(m.accessToken)})}else{var p;if(l){p=n.refPromise(l)}else{p=k.getAuthCode()}p.then(function(q){o.getUrl("http://oauth.net/core/2.0/endpoint/token").then(function(r){var s=o.post(r,{grant_type:"authorization_code",code:q,client_id:m.clientId},{"Content-Type":"application/x-www-form-urlencoded"});k.handleAccessTokenResponse(s,j)})},function(){j.reject.apply(j,arguments)})}return j.promise};f.prototype.getAccessTokenForMobile=function(o,l){var k=this,j=k.settings.deferredWrapper(),n=k.plumbing,m=k.helpers;if(k.settings.accessToken){m.nextTick(function(){j.resolve(k.settings.accessToken)})}else{n.getUrl("http://oauth.net/core/2.0/endpoint/token").then(function(p){var q=n.post(p,{grant_type:"password",client_id:k.settings.clientId,username:o,password:l},{"Content-Type":"application/x-www-form-urlencoded"});k.handleAccessTokenResponse(q,j)})}return j.promise};f.prototype.hasAccessToken=function(){return !!this.settings.accessToken};f.prototype.invalidateAccessToken=function(){var j=this;j.helpers.eraseAccessToken(true);return j.helpers.chainHttpPromises(j.plumbing.getUrl("http://oauth.net/core/2.0/endpoint/token"),function(k){return j.plumbing.del(k)})};f.prototype.openPopup=function(j,p){var o=e.isUndefined(window.screenX)?window.screenLeft:window.screenX,m=e.isUndefined(window.screenY)?window.screenTop:window.screenY,t=e.isUndefined(window.outerWidth)?document.documentElement.clientWidth:window.outerWidth,r=e.isUndefined(window.outerHeight)?(document.documentElement.clientHeight-22):window.outerHeight,k=p.width||780,s=p.height||500,n=parseInt(o+((t-k)/2),10),q=parseInt(m+((r-s)/2.5),10),l="width="+k+",height="+s+",left="+n+",top="+q;return window.open(this.helpers.appendQueryParameters(j,p),"",l)};f.prototype.getCode=function(j,l){var k=this.helpers.decodeQueryString(j);if(k.code){l.resolve(k.code)}else{l.reject(k.error)}};f.prototype._pollForAuthCode=function(j){var l=this,m=l.settings.deferredWrapper();if(j){var k=setInterval(function(){try{if(j.location.hostname===window.location.hostname){l.getCode(j.location.href,m);clearInterval(k);j.close()}}catch(n){}},l.settings.authCodePollDelay);window.FamilySearchOauthReceiver=function(n){l.getCode(n,m);clearInterval(k)}}else{m.reject("Popup blocked")}return m.promise}},{"./../FamilySearch":1,"./../utils":47}],30:[function(h,i,g){var f=h("./../FamilySearch"),e=h("./../utils");f.prototype.getDate=function(k,l){var j=this,m={date:k,dataFormat:"application/json"};return j.plumbing.get(j.helpers.getAuthoritiesServerUrl("/authorities/v1/date"),m,{Accept:"application/json"},l,e.compose(e.objectExtender({getDate:function(){return e.maybe(e.maybe(this.dates).date)[0]}}),function(n){e.forEach(n.dates.date,function(p,o,q){q[o]=j.createDate(p)});return n}))};f.prototype.getPlaceSearch=function(j,l){var k=this,m={place:j,view:"simple",dataFormat:"application/json"};return k.plumbing.get(k.helpers.getAuthoritiesServerUrl("/authorities/v1/place"),m,{Accept:"application/json"},l,e.compose(e.objectExtender({getPlaces:function(){return e.maybe(this.places).place}}),function(n){e.forEach(n.places.place,function(o,p,q){q[p]=k.createPlace(o)});return n}))}},{"./../FamilySearch":1,"./../utils":47}],31:[function(h,i,g){var f=h("./../FamilySearch"),e=h("./../utils");f.prototype._changeHistoryResponseMapper=function(){var j=this;return e.compose(e.objectExtender({getChanges:function(){return this.entries||[]}}),function(k){for(var l=0;l<k.entries.length;l++){k.entries[l]=j.createChange(k.entries[l])}return k})};f.prototype.getPersonChanges=function(k,m,l){var j=this;return j.helpers.chainHttpPromises(j.plumbing.getUrl("person-changes-template",k,{pid:k}),function(n){return j.plumbing.get(n,m,{Accept:"application/x-gedcomx-atom+json"},l,j._changeHistoryResponseMapper())})};f.prototype.getChildAndParentsChanges=function(j,m,l){var k=this;return k.helpers.chainHttpPromises(k.plumbing.getUrl("child-and-parents-relationship-changes-template",j,{caprid:j}),function(n){return k.plumbing.get(n,m,{Accept:"application/x-gedcomx-atom+json"},l,k._changeHistoryResponseMapper())})};f.prototype.getCoupleChanges=function(k,m,l){var j=this;return j.helpers.chainHttpPromises(j.plumbing.getUrl("couple-relationship-changes-template",k,{crid:k}),function(n){return j.plumbing.get(n,m,{Accept:"application/x-gedcomx-atom+json"},l,j._changeHistoryResponseMapper())})};f.prototype.restoreChange=function(j,l){var k=this;return k.helpers.chainHttpPromises(k.plumbing.getUrl("change-restore-template",j,{chid:j}),function(m){return k.plumbing.post(m,null,{"Content-Type":void 0},l,function(){return j})})}},{"./../FamilySearch":1,"./../utils":47}],32:[function(h,i,g){var f=h("./../FamilySearch"),e=h("./../utils"),j=e.maybe;f.prototype.getDiscussion=function(m,n,l){var k=this;return k.helpers.chainHttpPromises(k.plumbing.getUrl("discussion-template",m,{did:m}),function(o){return k.plumbing.get(o,n,{Accept:"application/x-fs-v1+json"},l,e.compose(e.objectExtender({getDiscussion:function(){return j(j(this).discussions)[0]}}),function(p){for(var q=0;q<p.discussions.length;q++){p.discussions[q]=k.createDiscussion(p.discussions[q])}return p}))})};f.prototype.getMultiDiscussion=function(l,o,n){var k=this,m={};e.forEach(l,function(r){var q,p;if(r instanceof f.DiscussionRef){p=r.$getDiscussionUrl();q=r.resourceId}else{p=r;q=r}m[q]=k.getDiscussion(p,o,n)});return k.helpers.promiseAll(m)};f.prototype.getPersonDiscussionRefs=function(l,n,m){var k=this;return k.helpers.chainHttpPromises(k.plumbing.getUrl("person-discussion-references-template",l,{pid:l}),function(o){return k.plumbing.get(o,n,{Accept:"application/x-fs-v1+json"},m,e.compose(e.objectExtender({getDiscussionRefs:function(){return j(j(j(this).persons)[0])["discussion-references"]||[]}}),function(q){if(q&&q.persons&&q.persons[0]&&e.isArray(q.persons[0]["discussion-references"])){var p=q.persons[0]["discussion-references"];for(var r=0;r<p.length;r++){p[r]=k.createDiscussionRef(p[r])}}return q},e.objectExtender(function(p){return{$personId:j(j(j(p).persons)[0]).id}},function(p){return j(j(j(p).persons)[0])["discussion-references"]})))})};f.prototype._commentsResponseMapper=function(){var k=this;return e.compose(e.objectExtender({getComments:function(){return j(j(j(this).discussions)[0]).comments||[]}}),function(l){if(l&&l.discussions&&l.discussions[0]&&e.isArray(l.discussions[0].comments)){var n=l.discussions[0].comments;for(var m=0;m<n.length;m++){n[m]=k.createComment(n[m])}}return l})};f.prototype.getDiscussionComments=function(m,n,l){var k=this;return k.helpers.chainHttpPromises(k.plumbing.getUrl("discussion-comments-template",m,{did:m}),function(o){return k.plumbing.get(o,n,{Accept:"application/x-fs-v1+json"},l,e.compose(k._commentsResponseMapper(),e.objectExtender(function(p){return{$discussionId:j(j(j(p).discussions)[0]).id}},function(p){return j(j(j(p).discussions)[0])["comments"]})))})};f.prototype.deleteDiscussion=function(n,l,m){var k=this;return k.helpers.chainHttpPromises(k.plumbing.getUrl("discussion-template",n,{did:n}),function(o){return k.plumbing.del(o,{"Content-Type":"application/x-fs-v1+json"},m,function(){return n})})};f.prototype.deleteDiscussionRef=function(m,l,n,o){var k=this;return k.helpers.chainHttpPromises(k.plumbing.getUrl("person-discussion-reference-template",m,{pid:m,drid:l}),function(p){var q={"Content-Type":"application/x-fs-v1+json"};if(n){q["X-Reason"]=n}return k.plumbing.del(p,q,o,function(){return m})})};f.prototype.deleteDiscussionComment=function(o,l,m,n){var k=this;return k.helpers.chainHttpPromises(k.plumbing.getUrl("discussion-comment-template",o,{did:o,cmid:l}),function(p){return k.plumbing.del(p,{"Content-Type":"application/x-fs-v1+json"},n,function(){return o})})};f.prototype.deleteMemoryComment=function(m,l,n,o){var k=this;return k.helpers.chainHttpPromises(k.plumbing.getUrl("memory-comment-template",m,{mid:m,cmid:l}),function(p){return k.plumbing.del(p,{},o,function(){return m})})}},{"./../FamilySearch":1,"./../utils":47}],33:[function(h,i,g){var f=h("./../FamilySearch"),e=h("./../utils"),j=e.maybe;f.prototype._memoriesResponseMapper=function(){var k=this;return function(l){if(l&&e.isArray(l.sourceDescriptions)){for(var m=0;m<l.sourceDescriptions.length;m++){if(l.sourceDescriptions[m].attribution){l.sourceDescriptions[m].attribution=k.createAttribution(l.sourceDescriptions[m].attribution)}l.sourceDescriptions[m]=k.createMemory(l.sourceDescriptions[m])}}return l}};f.prototype.getPersonMemoriesQuery=function(l,n,m){var k=this;return k.helpers.chainHttpPromises(k.plumbing.getUrl("person-memories-query",l,{pid:l}),function(o){return k.plumbing.get(o,n,{},m,e.compose(e.objectExtender({getMemories:function(){return this.sourceDescriptions||[]}}),k._memoriesResponseMapper()))})};f.prototype.getUserMemoriesQuery=function(l,n,m){var k=this;return k.helpers.chainHttpPromises(k.plumbing.getUrl("user-memories-query",l,{cisUserId:l}),function(o){return k.plumbing.get(o,n,{},m,e.compose(e.objectExtender({getMemories:function(){return this.sourceDescriptions||[]}}),k._memoriesResponseMapper()))})};f.prototype.getMemory=function(l,n,m){var k=this;return k.helpers.chainHttpPromises(k.plumbing.getUrl("memory-template",l,{mid:l}),function(o){return k.plumbing.get(o,n,{},m,e.compose(e.objectExtender({getMemory:function(){return j(this.sourceDescriptions)[0]}}),k._memoriesResponseMapper()))})};f.prototype.getMemoryComments=function(l,n,m){var k=this;return k.helpers.chainHttpPromises(k.plumbing.getUrl("memory-comments-template",l,{mid:l}),function(o){return k.plumbing.get(o,n,{Accept:"application/x-fs-v1+json"},m,e.compose(k._commentsResponseMapper(),e.objectExtender(function(p){return{$memoryId:j(j(j(p).sourceDescriptions)[0]).id}},function(p){return j(j(j(p).discussions)[0])["comments"]})))})};f.prototype._memoryPersonasMapper=function(){var k=this;return e.compose(function(l){if(l&&e.isArray(l.persons)){for(var m=0;m<l.persons.length;m++){l.persons[m]=k.createMemoryPersona(l.persons[m])}}return l},function(l){if(l&&e.isArray(l.persons)){for(var n=0;n<l.persons.length;n++){if(e.isArray(l.persons[n].names)){for(var m=0;m<l.persons[n].names.length;m++){l.persons[n].names[m]=k.createName(l.persons[n].names[m])}}}}return l},function(l){if(l&&e.isArray(l.persons)){for(var m=0;m<l.persons.length;m++){if(l.persons[m].media){l.persons[m].media=k.createMemoryArtifactRef(l.persons[m].media)}}}return l},e.objectExtender(function(l){return{$memoryId:j(j(l.sourceDescriptions)[0]).id}},function(l){return j(l).persons}))};f.prototype.getMemoryPersonas=function(l,n,m){var k=this;return k.helpers.chainHttpPromises(k.plumbing.getUrl("memory-personas-template",l,{mid:l}),function(o){return k.plumbing.get(o,n,{},m,e.compose(e.objectExtender({getMemoryPersonas:function(){return this&&this.persons?this.persons:[]}}),k._memoryPersonasMapper()))})};f.prototype.getMemoryPersona=function(l,m,o,n){var k=this;return k.helpers.chainHttpPromises(k.plumbing.getUrl("memory-persona-template",l,{mid:l,pid:m}),function(p){return k.plumbing.get(p,o,{},n,e.compose(e.objectExtender({getMemoryPersona:function(){return j(this.persons)[0]}}),k._memoryPersonasMapper()))})};f.prototype.getMemoryPersonaRefs=function(l,n,m){var k=this;return k.helpers.chainHttpPromises(k.plumbing.getUrl("person-memory-persona-references-template",l,{pid:l}),function(o){return k.plumbing.get(o,n,{},m,e.compose(e.objectExtender({getMemoryPersonaRefs:function(){return j(j(this.persons)[0]).evidence||[]}}),function(p){try{if(p&&e.isArray(p.persons)&&p.persons[0]){var q=p.persons[0];if(q.evidence&&e.isArray(q.evidence)){for(var r=0;r<q.evidence.length;r++){q.evidence[r]=k.createMemoryPersonaRef(q.evidence[r])}}}}catch(s){console.error(s.stack)}return p},e.objectExtender(function(p){return{$personId:j(j(j(p).persons)[0]).id}},function(p){return j(j(j(p).persons)[0]).evidence})))})};f.prototype.getPersonPortraitUrl=function(l,n,m){var k=this;return k.plumbing.getUrl("person-portrait-template",l,{pid:l}).then(function(o){if(n&&n.followRedirect){n=e.extend({},n);delete n.followRedirect;var p=k.plumbing.get(o,n,{"X-Expect-Override":"200-ok"},m);return p.then(function(){return p.getStatusCode()===204?"":k.helpers.appendAccessToken(p.getResponseHeader("Location"))})}else{return k.helpers.appendAccessToken(o)}})};f.prototype.deleteMemory=function(l,m,n){var k=this;return k.helpers.chainHttpPromises(k.plumbing.getUrl("memory-template",l,{mid:l}),function(o){return k.plumbing.del(o,{},n,function(){return l})})};f.prototype.deleteMemoryPersona=function(l,n,m,o){var k=this;return k.helpers.chainHttpPromises(k.plumbing.getUrl("memory-persona-template",l,{mid:l,pid:n}),function(p){return k.plumbing.del(p,{},o,function(){return l})})};f.prototype.deleteMemoryPersonaRef=function(l,n,m,o){var k=this;return k.helpers.chainHttpPromises(k.plumbing.getUrl("person-memory-persona-reference-template",l,{pid:l,erid:n}),function(p){return k.plumbing.del(p,{},o,function(){return l})})}},{"./../FamilySearch":1,"./../utils":47}],34:[function(h,i,g){var f=h("./../FamilySearch"),e=h("./../utils"),k=e.maybe;function j(l){if(l){if(l.persons){return l.persons}else{if(l.childAndParentsRelationships){return l.childAndParentsRelationships}else{if(l.relationships){return l.relationships}}}}return{}}f.prototype._getNote=function(m,o,n){var l=this;return l.plumbing.get(m,o,{Accept:"application/x-fs-v1+json"},n,e.compose(e.objectExtender({getNote:function(){return k(k(j(this)[0]).notes)[0]}}),function(p){var q=k(j(p)[0]).notes;e.forEach(q,function(s,r){q[r]=l.createNote(s)});return p},e.objectExtender(function(q){var r=q.persons?"$personId":(q.childAndParentsRelationships?"$childAndParentsId":"$coupleId");var p={};p[r]=k(j(q)[0]).id;return p},function(p){return k(j(p)[0]).notes})))};f.prototype._getMultiNote=function(r,n,q,o,p){var l=this,m={};if(e.isArray(r)){e.forEach(r,function(s){m[s]=p.call(l,s,null,q,o)})}else{e.forEach(n,function(s){m[s]=p.call(l,r,s,q,o)})}return m};f.prototype.getPersonNote=function(m,p,o,n){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("person-note-template",m,{pid:m,nid:p}),function(q){return l._getNote(q,o,n)})};f.prototype.getMultiPersonNote=function(l,n,p,o){var m=this._getMultiNote(l,n,p,o,this.getPersonNote);return this.helpers.promiseAll(m)};f.prototype.getCoupleNote=function(m,p,o,n){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("couple-relationship-note-template",m,{crid:m,nid:p}),function(q){return l._getNote(q,o,n)})};f.prototype.getMultiCoupleNote=function(n,m,p,o){var l=this._getMultiNote(n,m,p,o,this.getCoupleNote);return this.helpers.promiseAll(l)};f.prototype.getChildAndParentsNote=function(l,p,o,n){var m=this;return m.helpers.chainHttpPromises(m.plumbing.getUrl("child-and-parents-relationship-note-template",l,{caprid:l,nid:p}),function(q){return m._getNote(q,o,n)})};f.prototype.getMultiChildAndParentsNote=function(l,n,p,o){var m=this._getMultiNote(l,n,p,o,this.getChildAndParentsNote);return this.helpers.promiseAll(m)};f.prototype.getPersonNotes=function(m,o,n){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("person-notes-template",m,{pid:m}),function(p){return l.plumbing.get(p,o,{},n,e.compose(e.objectExtender({getNotes:function(){return k(k(k(this).persons)[0]).notes||[]}}),function(q){var r=k(k(k(q).persons)[0]).notes;e.forEach(r,function(t,s){r[s]=l.createNote(t)});return q},e.objectExtender(function(q){return{$personId:k(k(k(q).persons)[0]).id}},function(q){return k(k(k(q).persons)[0]).notes})))})};f.prototype.getCoupleNotes=function(m,o,n){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("couple-relationship-notes-template",m,{crid:m}),function(p){return l.plumbing.get(p,o,{},n,e.compose(e.objectExtender({getNotes:function(){return k(k(this.relationships)[0]).notes||[]}}),function(q){var r=k(k(k(q).relationships)[0]).notes;e.forEach(r,function(t,s){r[s]=l.createNote(t)});return q},e.objectExtender(function(q){return{$coupleId:k(k(k(q).relationships)[0]).id}},function(q){return k(k(k(q).relationships)[0]).notes})))})};f.prototype.getChildAndParentsNotes=function(l,o,n){var m=this;return m.helpers.chainHttpPromises(m.plumbing.getUrl("child-and-parents-relationship-notes-template",l,{caprid:l}),function(p){return m.plumbing.get(p,o,{Accept:"application/x-fs-v1+json"},n,e.compose(e.objectExtender({getNotes:function(){return k(k(this.childAndParentsRelationships)[0]).notes||[]}}),function(q){var r=k(k(k(q).childAndParentsRelationships)[0]).notes;e.forEach(r,function(t,s){r[s]=m.createNote(t)});return q},e.objectExtender(function(q){return{$childAndParentsId:k(k(k(q).childAndParentsRelationships)[0]).id}},function(q){return k(k(k(q).childAndParentsRelationships)[0]).notes})))})};f.prototype.deletePersonNote=function(m,p,n,o){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("person-note-template",m,{pid:m,nid:p}),function(q){var r={"Content-Type":"application/x-fs-v1+json"};if(n){r["X-Reason"]=n}return l.plumbing.del(q,r,o,function(){return m})})};f.prototype.deleteCoupleNote=function(n,p,m,o){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("couple-relationship-note-template",n,{crid:n,nid:p}),function(q){var r={};if(m){r["X-Reason"]=m}return l.plumbing.del(q,r,o,function(){return n})})};f.prototype.deleteChildAndParentsNote=function(l,p,n,o){var m=this;return m.helpers.chainHttpPromises(m.plumbing.getUrl("child-and-parents-relationship-note-template",l,{caprid:l,nid:p}),function(q){var r={"Content-Type":"application/x-fs-v1+json"};if(n){r["X-Reason"]=n}return m.plumbing.del(q,r,o,function(){return l})})}},{"./../FamilySearch":1,"./../utils":47}],35:[function(h,i,g){var f=h("../FamilySearch"),e=h("../utils"),k=e.maybe;var j={getRelationship:function(){return k(this.childAndParentsRelationships)[0]},getPerson:function(l){return e.find(this.persons,{id:l})}};f.prototype.getChildAndParents=function(l,o,n){var m=this;return m.helpers.chainHttpPromises(m.plumbing.getUrl("child-and-parents-relationship-template",l,{caprid:l}),function(p){return m.plumbing.get(p,o,{Accept:"application/x-fs-v1+json"},n,e.compose(e.objectExtender(j),function(q){e.forEach(q.persons,function(s,r,t){t[r]=m.createPerson(s)});e.forEach(q.childAndParentsRelationships,function(r,s,t){t[s]=m.createChildAndParents(r)});return q}))})};f.prototype.deleteChildAndParents=function(l,n,o){var m=this;return m.helpers.chainHttpPromises(m.plumbing.getUrl("child-and-parents-relationship-template",l,{caprid:l}),function(p){var q={"Content-Type":"application/x-fs-v1+json"};if(n){q["X-Reason"]=n}return m.plumbing.del(p,q,o,function(){return l})})}},{"../FamilySearch":1,"../utils":47}],36:[function(h,i,g){var f=h("./../FamilySearch"),e=h("./../utils"),j=e.maybe;function k(m){return{getPersons:function(){return this.persons},exists:function(n){return !!j(e.find(this.persons,l(m,n))).id},getPerson:function(n){return e.find(this.persons,l(m,n))}}}function l(n,m){return function(o){return o.display[n]==m}}f.prototype.getAncestry=function(n,p,o){var m=this;return m.helpers.chainHttpPromises(m.plumbing.getUrl("ancestry-query"),function(q){return m.plumbing.get(q,e.extend({person:n},p),{},o,e.compose(e.objectExtender(k("ascendancyNumber")),!!p&&!!p.descendants?e.objectExtender({getDescendant:function(r){return e.find(this.persons,l("descendancyNumber",r))},existsDescendant:function(r){return !!j(e.find(this.persons,l("descendancyNumber",r))).id}}):null,function(r){e.forEach(r.persons,function(t,s,u){u[s]=m.createPerson(t)});return r},e.objectExtender({$getAscendancyNumber:function(){return this.display.ascendancyNumber}},function(r){return j(r).persons}),!!p&&!!p.descendants?e.objectExtender({$getDescendancyNumber:function(){return this.display.descendancyNumber}},function(r){return j(r).persons}):null))})};f.prototype.getDescendancy=function(n,p,o){var m=this;return m.helpers.chainHttpPromises(m.plumbing.getUrl("descendancy-query"),function(q){return m.plumbing.get(q,e.extend({person:n},p),{},o,e.compose(e.objectExtender(k("descendancyNumber")),function(r){e.forEach(r.persons,function(t,s,u){u[s]=m.createPerson(t)});return r},e.objectExtender({$getDescendancyNumber:function(){return this.display.descendancyNumber}},function(r){return j(r).persons})))})}},{"./../FamilySearch":1,"./../utils":47}],37:[function(h,i,g){var f=h("../FamilySearch"),e=h("../utils"),k=e.maybe;var j={getPerson:function(l){return e.find(this.persons,{id:l})},getPrimaryPerson:function(){return this.getPerson(this.getPrimaryId())},getParentRelationships:function(){var l=this.getPrimaryId();return e.filter(this.childAndParentsRelationships,function(m){return k(m.child).resourceId===l})},getSpouseRelationships:function(){return e.filter(this.relationships,function(l){return l.type==="http://gedcomx.org/Couple"})},getSpouseRelationship:function(m){var l=this.getPrimaryId();return e.find(this.relationships,function(n){return n.type==="http://gedcomx.org/Couple"&&(l===n.$getHusbandId()?n.$getWifeId():n.$getHusbandId())===m})},getChildRelationships:function(){var l=this.getPrimaryId();return e.filter(this.childAndParentsRelationships,function(m){return k(m.father).resourceId===l||k(m.mother).resourceId===l})},getChildRelationshipsOf:function(m){var l=this.getPrimaryId();return e.filter(this.childAndParentsRelationships,function(n){return(k(n.father).resourceId===l||k(n.mother).resourceId===l)&&(k(n.father).resourceId==m||k(n.mother).resourceId==m)})},getFatherIds:function(){return e.uniq(e.map(e.filter(this.getParentRelationships(),function(l){return !!l.$getFatherId()}),function(l){return l.$getFatherId()},this))},getFathers:function(){return e.map(this.getFatherIds(),this.getPerson,this)},getMotherIds:function(){return e.uniq(e.map(e.filter(this.getParentRelationships(),function(l){return !!l.$getMotherId()}),function(l){return l.$getMotherId()},this))},getMothers:function(){return e.map(this.getMotherIds(),this.getPerson,this)},getSpouseIds:function(){return e.uniq(e.map(e.filter(this.getSpouseRelationships(),function(l){return l.$getHusbandId()&&l.$getWifeId()}),function(l){return this.getPrimaryId()===l.$getHusbandId()?l.$getWifeId():l.$getHusbandId()},this))},getSpouses:function(){return e.map(this.getSpouseIds(),this.getPerson,this)},getChildIds:function(){return e.uniq(e.map(this.getChildRelationships(),function(l){return l.$getChildId()},this))},getChildren:function(){return e.map(this.getChildIds(),this.getPerson,this)},getChildIdsOf:function(l){return e.uniq(e.map(this.getChildRelationshipsOf(l),function(m){return m.$getChildId()},this))},getChildrenOf:function(l){return e.map(this.getChildIdsOf(l),this.getPerson,this)}};f.prototype.getPerson=function(m,o,n){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("person-template",m,{pid:m}),function(p){return l.plumbing.get(p,o,{},n,e.compose(e.objectExtender({getPerson:function(){return this.persons[0]}}),function(q){e.forEach(q.persons,function(s,r,t){t[r]=l.createPerson(s)});return q},function(q,r){q.persons[0].$isReadOnly=function(){var s=r.getResponseHeader("Allow");return !!s&&s.indexOf("POST")<0};return q}))})};f.prototype.getMultiPerson=function(p,o,n){var m={},l=this;e.forEach(p,function(q){m[q]=l.getPerson(q,o,n)});return l.helpers.promiseAll(m)};f.prototype._personsAndRelationshipsMapper=function(){var l=this;return e.compose(e.objectExtender({getCoupleRelationships:function(){return e.filter(k(this).relationships,{type:"http://gedcomx.org/Couple"})||[]},getChildAndParentsRelationships:function(){return k(this).childAndParentsRelationships||[]},getPerson:function(m){return e.find(this.persons,{id:m})}}),function(m){e.forEach(m.persons,function(o,n,p){p[n]=l.createPerson(o)});e.forEach(m.relationships,function(n,o,p){p[o]=l.createCouple(n)});e.forEach(m.childAndParentsRelationships,function(n,o,p){p[o]=l.createChildAndParents(n)});return m})};f.prototype.getPersonWithRelationships=function(m,o,n){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("person-with-relationships-query"),function(p){return l.plumbing.get(p,e.extend({person:m},o),{},n,e.compose(e.objectExtender({getPrimaryId:function(){return m}}),l._personsAndRelationshipsMapper(),e.objectExtender(j),function(q,r){q.persons[0].$isReadOnly=function(){var s=r.getResponseHeader("Allow");return !!s&&s.indexOf("POST")<0};return q}))})};f.prototype.getSpouses=function(m,o,n){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("spouses-template",m,{pid:m}),function(p){return l.plumbing.get(p,o,{},n,l._personsAndRelationshipsMapper())})};f.prototype.getParents=function(m,o,n){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("parents-template",m,{pid:m}),function(p){return l.plumbing.get(p,o,{},n,l._personsAndRelationshipsMapper())})};f.prototype.getChildren=function(m,o,n){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("children-template",m,{pid:m}),function(p){return l.plumbing.get(p,o,{},n,l._personsAndRelationshipsMapper())})};f.prototype.deletePerson=function(m,n,o){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("person-template",m,{pid:m}),function(p){return l.plumbing.del(p,n?{"X-Reason":n}:{},o,function(){return m})})};f.prototype.getPreferredSpouse=function(m,o,n){var l=this;return l.helpers.chainHttpPromises(l.getCurrentUser(),function(p){var q=p.getUser().treeUserId;return l.plumbing.getUrl("preferred-spouse-relationship-template",null,{uid:q,pid:m})},function(p){var q=l.plumbing.get(p+".json",o,{"X-Expect-Override":"200-ok"},n);return q.then(function(){if(q.getStatusCode()===200){var r=q.getResponseHeader("Location");if(r.indexOf("child-and-parents-relationships")>=0){return null}else{return l.helpers.getLastUrlSegment(r)}}return void 0})})};f.prototype.setPreferredSpouse=function(n,p,q){var l,o=[],m=this;if(p===null){o.push(m.getChildren(n),function(r){var s=e.find(r.getChildAndParentsRelationships(),function(t){return !t.$getFatherId()||!t.$getMotherId()});return m.plumbing.getUrl("child-and-parents-relationship-template",null,{caprid:s.id})})}else{o.push(m.plumbing.getUrl("couple-relationship-template",p,{crid:p}))}o.push(function(r){l=r;return m.getCurrentUser()},function(r){var s=r.getUser().treeUserId;return m.plumbing.getUrl("preferred-spouse-relationship-template",null,{uid:s,pid:n})},function(r){return m.plumbing.put(r,null,{Location:l},q,function(){return n})});return m.helpers.chainHttpPromises.apply(m.helpers,o)};f.prototype.deletePreferredSpouse=function(m,n){var l=this;return l.helpers.chainHttpPromises(l.getCurrentUser(),function(o){var p=o.getUser().treeUserId;return l.plumbing.getUrl("preferred-spouse-relationship-template",null,{uid:p,pid:m})},function(o){return l.plumbing.del(o,{},n,function(){return m})})};f.prototype.getPreferredParents=function(m,o,n){var l=this;return l.helpers.chainHttpPromises(l.getCurrentUser(),function(p){var q=p.getUser().treeUserId;return l.plumbing.getUrl("preferred-parent-relationship-template",null,{uid:q,pid:m})},function(p){var q=l.plumbing.get(p+".json",o,{Accept:"application/x-fs-v1+json","X-Expect-Override":"200-ok"},n);return q.then(function(){return q.getStatusCode()===200?l.helpers.getLastUrlSegment(q.getResponseHeader("Location")):void 0})})};f.prototype.setPreferredParents=function(n,l,o){var p,m=this;return m.helpers.chainHttpPromises(m.plumbing.getUrl("child-and-parents-relationship-template",l,{caprid:l}),function(q){p=q;return m.getCurrentUser()},function(q){var r=q.getUser().treeUserId;return m.plumbing.getUrl("preferred-parent-relationship-template",null,{uid:r,pid:n})},function(q){return m.plumbing.put(q,null,{Location:p},o,function(){return n})})};f.prototype.deletePreferredParents=function(m,n){var l=this;return l.helpers.chainHttpPromises(l.getCurrentUser(),function(o){var p=o.getUser().treeUserId;return l.plumbing.getUrl("preferred-parent-relationship-template",null,{uid:p,pid:m})},function(o){return l.plumbing.del(o,{},n,function(){return m})})}},{"../FamilySearch":1,"../utils":47}],38:[function(g,h,f){var e=g("./../FamilySearch");e.prototype.getRedirectUrl=function(i){return this.helpers.appendAccessToken(this.helpers.appendQueryParameters(this.helpers.getAPIServerUrl("/platform/redirect"),i))}},{"./../FamilySearch":1}],39:[function(i,h,k){var f=i("./../FamilySearch"),m=i("./../utils");var g={start:true,count:true,context:true};function e(n){n=n.replace(/[:"]/g,"").trim();return n.indexOf(" ")>=0?'"'+n+'"':n}function j(n){return m.map(m.filter(m.keys(n),function(o){return !g[o]}),function(o){return o+":"+e(n[o])}).join(" ")}var l={getSearchResults:function(){return this.entries||[]},getResultsCount:function(){return this.results||0},getIndex:function(){return this.index||0}};f.prototype._getSearchMatchResponseMapper=function(){var n=this;return m.compose(m.objectExtender(l),function(o){m.forEach(o.entries,function(q,p,r){r[p]=n.createSearchResult(q)});return o})};f.prototype.getPersonSearch=function(p,o){var n=this;return n.helpers.chainHttpPromises(n.plumbing.getUrl("person-search"),function(q){return n.plumbing.get(q,m.removeEmptyProperties({q:j(p),start:p.start,count:p.count,context:p.context}),{Accept:"application/x-gedcomx-atom+json"},o,m.compose(n._getSearchMatchResponseMapper(),function(r,s){r.getContext=function(){return s.getResponseHeader("X-FS-Page-Context")};return r}))})};f.prototype.getPersonMatches=function(o,q,p){var n=this;return n.helpers.chainHttpPromises(n.plumbing.getUrl("person-matches-template",o,{pid:o}),function(r){return n.plumbing.get(r,q,{Accept:"application/x-gedcomx-atom+json"},p,n._getSearchMatchResponseMapper())})};f.prototype.getPersonMatchesQuery=function(p,o){var n=this;return n.helpers.chainHttpPromises(n.plumbing.getUrl("person-matches-query"),function(q){return n.plumbing.get(q,m.removeEmptyProperties({q:j(p),start:p.start,count:p.count}),{Accept:"application/x-gedcomx-atom+json"},o,n._getSearchMatchResponseMapper())})}},{"./../FamilySearch":1,"./../utils":47}],40:[function(h,i,g){var f=h("./../FamilySearch"),e=h("./../utils"),j=e.maybe;f.prototype.getCollectionsForUser=function(l,n,m){var k=this;return k.helpers.chainHttpPromises(k.plumbing.getUrl("user-collections-for-user-template",l,{uid:l}),function(o){return k.plumbing.get(o,{},{Accept:"application/x-fs-v1+json"},m,e.compose(e.objectExtender({getCollections:function(){return this.collections||[]}}),function(p){e.forEach(p.collections,function(s,q,r){r[q]=k.createCollection(s)});return p}))})};f.prototype.getCollection=function(l,n,m){var k=this;return k.helpers.chainHttpPromises(k.plumbing.getUrl("user-collection-template",l,{udcid:l}),function(o){return k.plumbing.get(o,n,{Accept:"application/x-fs-v1+json"},m,e.compose(e.objectExtender({getCollection:function(){return j(this.collections)[0]}}),function(p){e.forEach(p.collections,function(s,q,r){r[q]=k.createCollection(s)});return p}))})};f.prototype.getCollectionSourceDescriptions=function(l,n,m){var k=this;return k.helpers.chainHttpPromises(k.plumbing.getUrl("user-collection-source-descriptions-template",l,{udcid:l}),function(o){return k.plumbing.get(o,n,{Accept:"application/x-fs-v1+json"},m,e.compose(e.objectExtender({getSourceDescriptions:function(){return this.sourceDescriptions||[]}}),function(p){e.forEach(p.sourceDescriptions,function(r,q,s){s[q]=k.createSourceDescription(r)});return p}))})};f.prototype.getCollectionSourceDescriptionsForUser=function(l,n,m){var k=this;return k.helpers.chainHttpPromises(k.plumbing.getUrl("user-collections-source-descriptions-for-user-template",l,{uid:l}),function(o){return k.plumbing.get(o,n,{Accept:"application/x-fs-v1+json"},m,e.compose(e.objectExtender({getSourceDescriptions:function(){return this.sourceDescriptions||[]}}),function(p){e.forEach(p.sourceDescriptions,function(r,q,s){s[q]=k.createSourceDescription(r)});return p}))})};f.prototype.moveSourceDescriptionsToCollection=function(l,n,m){var k=this;return k.helpers.chainHttpPromises(k.plumbing.getUrl("user-collection-source-descriptions-template",l,{udcid:l}),function(o){var p=e.map(n,function(q){return{id:(q instanceof f.SourceDescription)?q.id:q}});return k.plumbing.post(o,{sourceDescriptions:p},{},m,function(){return l})})};f.prototype.removeSourceDescriptionsFromCollections=function(m,l){var k=this;return k.helpers.chainHttpPromises(k.getCurrentUser(),function(n){var o=n.getUser().treeUserId;return k.plumbing.getUrl("user-collections-source-descriptions-for-user-template",null,{uid:o})},function(n){var o=e.map(m,function(p){return(p instanceof f.SourceDescription)?p.id:p});return k.plumbing.del(k.helpers.appendQueryParameters(n,{id:o}),{},l,function(){return m})})};f.prototype.deleteCollection=function(l,m){var k=this;return k.helpers.chainHttpPromises(k.plumbing.getUrl("user-collection-template",l,{udcid:l}),function(n){return k.plumbing.del(n,{},m,function(){return l})})}},{"./../FamilySearch":1,"./../utils":47}],41:[function(h,i,g){var f=h("./../FamilySearch"),e=h("./../utils"),j=e.maybe;f.prototype.getSourceDescription=function(l,n,m){if(l instanceof f.SourceRef){l=l.$getSourceDescriptionUrl()||l.$sourceDescriptionId}var k=this;return k.helpers.chainHttpPromises(k.plumbing.getUrl("source-description-template",l,{sdid:l}),function(o){return k.plumbing.get(o,n,{},m,e.compose(e.objectExtender({getSourceDescription:function(){return j(this.sourceDescriptions)[0]}}),function(p){var r=j(j(p).sourceDescriptions);for(var q=0;q<r.length;q++){r[q]=k.createSourceDescription(r[q])}return p}))})};f.prototype.getMultiSourceDescription=function(o,n,m){var l={},k=this;e.forEach(o,function(p){var r,q;if(p instanceof f.SourceRef){r=p.$sourceDescriptionId||p.$getSourceDescriptionUrl();q=p.$getSourceDescriptionUrl()||p.$sourceDescriptionId}else{r=p;q=p}l[r]=k.getSourceDescription(q,n,m)});return k.helpers.promiseAll(l)};f.prototype.getSourceRefsQuery=function(l,n,m){var k=this;return k.helpers.chainHttpPromises(k.plumbing.getUrl("source-references-query"),function(o){o=k.helpers.appendQueryParameters(o,{source:l});return k.plumbing.get(o,n,{Accept:"application/x-fs-v1+json"},m,e.compose(e.objectExtender({getPersonSourceRefs:function(){return e.flatMap(j(this.persons),function(p){return p.sources})}}),e.objectExtender({getCoupleSourceRefs:function(){return e.flatMap(j(this.relationships),function(p){return p.sources})}}),e.objectExtender({getChildAndParentsSourceRefs:function(){return e.flatMap(j(this.childAndParentsRelationships),function(p){return p.sources})}}),function(p){e.forEach(["persons","relationships","childAndParentsRelationships"],function(q){j(p)[q]=e.map(j(p)[q],function(r){r.sources=e.map(r.sources,function(s){return k.createSourceRef(s)});return r})});return p},e.objectExtender(function(p,r){var q=e.find(j(p).persons,function(s){return !!e.find(j(s).sources,{id:r.id})});return{$personId:q.id,$sourceDescriptionId:l}},function(p){return e.flatMap(j(p).persons,function(q){return q.sources})}),e.objectExtender(function(p,r){var q=e.find(j(p).relationships,function(s){return !!e.find(j(s).sources,{id:r.id})});return{$coupleId:q.id,$sourceDescriptionId:l}},function(p){return e.flatMap(j(p).relationships,function(q){return q.sources})}),e.objectExtender(function(p,q){var r=e.find(j(p).childAndParentsRelationships,function(s){return !!e.find(j(s).sources,{id:q.id})});return{$childAndParentsId:r.id,$sourceDescriptionId:l}},function(p){return e.flatMap(j(p).childAndParentsRelationships,function(q){return q.sources})})))})};f.prototype._getSourcesResponseMapper=function(l,n,k){var m=this;return e.compose(e.objectExtender(e.removeEmptyProperties({getSourceRefs:function(){return j(j(this[l])[0]).sources||[]},getSourceDescriptions:k?function(){return this.sourceDescriptions||[]}:null,getSourceDescription:k?function(o){return e.find(this.sourceDescriptions,{id:o})}:null})),function(o){e.forEach(j(j(j(o)[l])[0]).sources,function(q,p,r){r[p]=m.createSourceRef(q)});return o},e.objectExtender(function(r,p){var o;if(m.helpers.isAbsoluteUrl(p.description)){o={$sourceDescriptionId:m.helpers.getLastUrlSegment(p.description)}}else{var q=p.description.charAt(0)==="#"?p.description.substr(1):p.description;o={$sourceDescriptionId:q,description:m.helpers.getUrlFromDiscoveryResource(m.settings.discoveryResource,"source-description-template",{sdid:q})}}o[n]=j(j(j(r)[l])[0]).id;return o},function(o){return j(j(j(o)[l])[0]).sources}),k?function(o){e.forEach(o.sourceDescriptions,function(q,p,r){r[p]=m.createSourceDescription(q)});return o}:null)};f.prototype.getPersonSourceRefs=function(l,n,m){var k=this;return k.helpers.chainHttpPromises(k.plumbing.getUrl("person-source-references-template",l,{pid:l}),function(o){return k.plumbing.get(o,n,{},m,k._getSourcesResponseMapper("persons","$personId",false))})};f.prototype.getPersonSourcesQuery=function(l,n,m){var k=this;return k.helpers.chainHttpPromises(k.plumbing.getUrl("person-sources-query-template",l,{pid:l}),function(o){return k.plumbing.get(o,n,{},m,k._getSourcesResponseMapper("persons","$personId",true))})};f.prototype.getCoupleSourceRefs=function(l,n,m){var k=this;return k.helpers.chainHttpPromises(k.plumbing.getUrl("couple-relationship-source-references-template",l,{crid:l}),function(o){return k.plumbing.get(o,n,{},m,k._getSourcesResponseMapper("relationships","$coupleId",false))})};f.prototype.getCoupleSourcesQuery=function(l,n,m){var k=this;return k.helpers.chainHttpPromises(k.plumbing.getUrl("couple-relationship-sources-query-template",l,{crid:l}),function(o){return k.plumbing.get(o,n,{},m,k._getSourcesResponseMapper("relationships","$coupleId",true))})};f.prototype.getChildAndParentsSourceRefs=function(k,n,m){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("child-and-parents-relationship-source-references-template",k,{caprid:k}),function(o){return l.plumbing.get(o,n,{Accept:"application/x-fs-v1+json"},m,l._getSourcesResponseMapper("childAndParentsRelationships","$childAndParentsId",false))})};f.prototype.getChildAndParentsSourcesQuery=function(k,n,m){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("child-and-parents-relationship-sources-template",k,{caprid:k}),function(o){return l.plumbing.get(o,n,{Accept:"application/x-fs-v1+json"},m,l._getSourcesResponseMapper("childAndParentsRelationships","$childAndParentsId",true))})};f.prototype.deleteSourceDescription=function(l,m,n){var k=this;var o=k.getSourceRefsQuery(l,{},n).then(function(p){var q=e.union(e.map(p.getPersonSourceRefs(),function(r){return k.deletePersonSourceRef(r.$getSourceRefUrl(),null,m,n)}),e.map(p.getCoupleSourceRefs(),function(r){return k.deleteCoupleSourceRef(r.$getSourceRefUrl(),null,m,n)}),e.map(p.getChildAndParentsSourceRefs(),function(r){return k.deleteChildAndParentsSourceRef(r.$getSourceRefUrl(),null,m,n)}));return k.helpers.promiseAll(q).then(function(){var r=k.helpers.chainHttpPromises(k.plumbing.getUrl("source-description-template",null,{sdid:l}),function(s){return k.plumbing.del(s,m?{"X-Reason":m}:{},n,function(){return l})});k.helpers.extendHttpPromise(o,r);return r})});return o};f.prototype.deletePersonSourceRef=function(m,k,n,o){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("person-source-reference-template",m,{pid:m,srid:k}),function(p){return l.plumbing.del(p,n?{"X-Reason":n}:{},o,function(){return m})})};f.prototype.deleteCoupleSourceRef=function(n,k,m,o){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("couple-relationship-source-reference-template",n,{crid:n,srid:k}),function(p){return l.plumbing.del(p,m?{"X-Reason":m}:{},o,function(){return n})})};f.prototype.deleteChildAndParentsSourceRef=function(k,l,n,o){var m=this;return m.helpers.chainHttpPromises(m.plumbing.getUrl("child-and-parents-relationship-source-reference-template",k,{caprid:k,srid:l}),function(p){var q={"Content-Type":"application/x-fs-v1+json"};if(n){q["X-Reason"]=n}return m.plumbing.del(p,q,o,function(){return k})})}},{"./../FamilySearch":1,"./../utils":47}],42:[function(h,j,g){var f=h("../FamilySearch"),e=h("../utils"),k=e.maybe;var i={getRelationship:function(){return k(this.relationships)[0]},getPerson:function(l){return e.find(this.persons,{id:l})}};f.prototype.getCouple=function(m,o,n){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("couple-relationship-template",m,{crid:m}),function(p){return l.plumbing.get(p,o,{},n,e.compose(e.objectExtender(i),function(q){e.forEach(q.persons,function(s,r,t){t[r]=l.createPerson(s)});e.forEach(q.relationships,function(r,s,t){t[s]=l.createCouple(r)});return q}))})};f.prototype.deleteCouple=function(n,m,o){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("couple-relationship-template",n,{crid:n}),function(p){return l.plumbing.del(p,m?{"X-Reason":m}:{},o,function(){return n})})}},{"../FamilySearch":1,"../utils":47}],43:[function(h,i,g){var f=h("./../FamilySearch"),e=h("./../utils"),j=e.maybe;f.prototype.getCurrentUser=function(m,l){var k=this;return k.helpers.chainHttpPromises(k.plumbing.getUrl("current-user"),function(n){return k.plumbing.get(n,m,{},l,e.compose(e.objectExtender({getUser:function(){return j(this.users)[0]}}),function(o){e.forEach(o.users,function(p,q,r){r[q]=k.createUser(p)});return o}))})};f.prototype.getAgent=function(m,n,l){var k=this;return k.helpers.chainHttpPromises(k.plumbing.getUrl("agent-template",m,{uid:m}),function(o){return k.plumbing.get(o,n,{},l,e.compose(e.objectExtender({getAgent:function(){return j(this.agents)[0]}}),function(p){e.forEach(p.agents,function(r,q,s){s[q]=k.createAgent(r)});return p}))})};f.prototype.getMultiAgent=function(k,o,n){var l=this,m={};e.forEach(k,function(p){m[p]=l.getAgent(p,o,n)});return l.helpers.promiseAll(m)}},{"./../FamilySearch":1,"./../utils":47}],44:[function(g,h,f){var e=g("./utils"),f={};f.httpWrapper=function(j,i){return function(k,m,o,q,l){l=e.extend({url:m,method:k,json:true,body:q},l);l.headers=e.extend({},o,l.headers);if(l.headers["Content-Type"]==="multipart/form-data"){l.formData=l.body;delete l.body;delete l.headers["Content-Type"];delete l.json}var s=i.settings.deferredWrapper();var p=s.promise;var r=null;var n={};j(l,function(v,u,t){if(u){if(u.headers){n=u.headers}r=u.statusCode}if(v){s.reject(v)}else{s.resolve(t)}});p.getStatusCode=function(){return r};p.getResponseHeader=function(t){return n[t]};p.getAllResponseHeaders=function(){return n};p.getRequest=function(){return l};return p}};f.deferredWrapper=function(i){return function(){var j=i();return{promise:j.promise,resolve:j.resolve,reject:j.reject}}};h.exports=f},{"./utils":47}],45:[function(h,i,g){var f=h("./utils");var j=function(k){this.client=k;this.helpers=k.helpers;this.settings=k.settings;this.totalProcessingTime=0};j.prototype.getTotalProcessingTime=function(){return this.totalProcessingTime};j.prototype.setTotalProcessingTime=function(k){this.totalProcessingTime=k};j.prototype.getUrl=function(l,m,n){var k=this;return this.settings.discoveryPromise.then(function(p){var o="";if(k.helpers.isAbsoluteUrl(m)){o=m}else{o=k.helpers.getUrlFromDiscoveryResource(p,l,n)}return o})};j.prototype.get=function(k,o,n,l,m){return this.http("GET",this.helpers.appendQueryParameters(k,o),f.extend({Accept:"application/x-gedcomx-v1+json"},n),null,l,m)};j.prototype.post=function(k,m,o,l,n){return this.http("POST",k,f.extend({"Content-Type":"application/x-gedcomx-v1+json"},o),m,l,n)};j.prototype.put=function(k,m,o,l,n){return this.http("PUT",k,f.extend({"Content-Type":"application/x-gedcomx-v1+json"},o),m,l,n)};j.prototype.del=function(k,n,l,m){return this.http("DELETE",k,f.extend({"Content-Type":"application/x-gedcomx-v1+json"},n),null,l,m)};function e(n){var r="";var k,s,o,l,p,q,m;for(k in n){if(n.hasOwnProperty(k)){s=n[k];if(s instanceof Array){for(m=0;m<s.length;++m){p=s[m];o=k+"["+m+"]";q={};q[o]=p;r+=e(q)+"&"}}else{if(s instanceof Object){for(l in s){if(s.hasOwnProperty(l)){p=s[l];o=k+"["+l+"]";q={};q[o]=p;r+=e(q)+"&"}}}else{if(s!==undefined&&s!==null){r+=encodeURIComponent(k)+"="+encodeURIComponent(s)+"&"}}}}}return r.length?r.substr(0,r.length-1):r}j.prototype.transformData=function(k,l){if(k&&f.isObject(k)&&String(k)!=="[object FormData]"){k=f.clonePartial(k,function(m){return(!(f.isString(m)&&(m.charAt(0)==="$"||m.charAt(0)==="_")))});if(l==="application/x-www-form-urlencoded"){return e(k)}else{if(l&&l.indexOf("json")!==-1){return JSON.stringify(k)}}}return k};j.prototype.http=function(k,m,o,q,l,t,s){var r=this.settings.deferredWrapper();var n=r.promise;var v=this;var u=this.helpers.getAPIServerUrl(m);o=o||{};var p;if(!this.settings.accessToken&&this.settings.autoSignin&&!this.helpers.isOAuthServerUrl(u)&&m!==this.settings.discoveryUrl){p=this.settings.getAccessToken()}else{p=this.helpers.refPromise(this.settings.accessToken)}p.then(function(){var x=v.helpers.isAuthoritiesServerUrl(u)?"sessionId":"access_token";if(v.settings.accessToken&&u.indexOf(x+"=")===-1){var w={};w[x]=v.settings.accessToken;u=v.helpers.appendQueryParameters(u,w)}if(s==null){s=v.settings.maxHttpRequestRetries}var y=v.settings.httpWrapper(k,u,o,v.transformData(q,o["Content-Type"]),l||{});v.helpers.extendHttpPromise(n,y);y.then(function(z){if(k==="GET"&&y.getStatusCode()===204){z={}}v.helpers.refreshAccessToken();var A=y.getResponseHeader("X-PROCESSING-TIME");if(A){v.totalProcessingTime+=parseInt(A,10)}if(t){z=t(z,y)}r.resolve(z)},function(){var B=y.getStatusCode();v.helpers.log("http failure",B,s,y.getAllResponseHeaders());if(B===401){v.helpers.eraseAccessToken()}if((k==="GET"&&B>=500&&s>0)||B===429){var A=y.getResponseHeader("Retry-After");var z=A?parseInt(A,10):v.settings.defaultThrottleRetryAfter;v.settings.setTimeout(function(){y=v.http(k,m,o,q,l,t,s-1);v.helpers.extendHttpPromise(n,y);y.then(function(C){r.resolve(C)},function(){r.reject.apply(r,arguments)})},z)}else{r.reject.apply(r,arguments)}})},function(){r.reject.apply(r,arguments)});return n};i.exports=j},{"./utils":47}],46:[function(h,i,g){var f=h("./FamilySearch"),e=h("./utils"),j=e.maybe,g={};g.setMember=function(l,k){if(!this[l]){this[l]={}}if(k instanceof f.Person){this[l].resource=k.$getPersonUrl();delete this[l].resourceId}else{if(this.$helpers.isAbsoluteUrl(k)){this[l].resource=k;delete this[l].resourceId}else{if(e.isString(k)){this[l].resourceId=k;delete this[l].resource}else{this[l]=k}}}};g.deleteMember=function(l,k){if(!this.$deletedMembers){this.$deletedMembers={}}this.$deletedMembers[l]=k;delete this[l]};g.setFacts=function(m,k,l){if(e.isArray(this[m])){e.forEach(this[m],function(n){g.deleteFact.call(this,m,n,l)},this)}this[m]=[];e.forEach(k,function(n){g.addFact.call(this,m,n)},this)};g.addFact=function(l,k){if(!e.isArray(this[l])){this[l]=[]}if(!(k instanceof f.Fact)){k=this.$client.createFact(k)}this[l].push(k)};g.deleteFact=function(o,m,l){if(!(m instanceof f.Fact)){m=e.find(this[o],{id:m})}var n=e.indexOf(this[o],m);if(n>=0){var k=this.$helpers.removeAccessToken(j(j(j(m).links).conclusion).href);if(k){if(!this.$deletedFacts){this.$deletedFacts={}}this.$deletedFacts[k]=l}this[o].splice(n,1)}};i.exports=g},{"./FamilySearch":1,"./utils":47}],47:[function(f,g,e){var e=g.exports;if(!Object.create){Object.create=(function(){function j(){}return function(k){if(arguments.length!==1){throw new Error("Object.create implementation only accepts one parameter.")}j.prototype=k;return new j()}})()}if(typeof Object.getPrototypeOf!=="function"){Object.getPrototypeOf=(typeof"".__proto__==="object")?function(j){return j.__proto__}:function(j){return j.constructor.prototype}}e.isArray=function(j){return Array.isArray?Array.isArray(j):Object.prototype.toString.call(j)=="[object Array]"};e.isString=function(j){return Object.prototype.toString.call(j)=="[object String]"};e.isFunction=function(j){return(typeof/./!=="function")?(typeof j==="function"):Object.prototype.toString.call(j)=="[object Function]"};e.isObject=function(j){return j===Object(j)};e.isUndefined=function(j){return j===void 0};var h=e.forEach=function(o,m,l){if(o==null){return}if(Array.prototype.forEach&&o.forEach===Array.prototype.forEach){o.forEach(m,l)}else{if(o.length===+o.length){for(var k=0,n=o.length;k<n;k++){if(m.call(l,o[k],k,o)==={}){return}}}else{for(var j in o){if(o.hasOwnProperty(j)){if(m.call(l,o[j],j,o)==={}){return}}}}}};e.removeEmptyProperties=function(j){h(j,function(l,k){if(l==null||l===""){delete j[k]}});return j};e.keys=Object.keys||function(l){if(l!==Object(l)){throw new TypeError("Invalid object")}var k=[];for(var j in l){if(l.hasOwnProperty(j)){k.push(j)}}return k};function i(k,l){for(var j in k){if(k.hasOwnProperty(j)&&l[j]!==k[j]){return false}}return true}e.filter=function(k,m,n){var j=[];var l=e.isFunction(m);h(k,function(o){if(l?m.call(n,o):i(m,o)){j.push(o)}});return j};e.map=function(k,m,l){var j=[];h(k,function(p,n,o){j.push(m.call(l,p,n,o))});return j};e.contains=function(l,k){if(l==null){return false}if(l.indexOf&&l.indexOf===Array.prototype.indexOf){return l.indexOf(k)!==-1}var j=false;h(l,function(m){if(m===k){j=true}});return j};e.indexOf=function(k,m){if(Array.prototype.indexOf===k.indexOf){return k.indexOf(m)}for(var l=0,j=k.length;l<j;l++){if(k[l]===m){return l}}return -1};e.uniq=function(j){var k=[];h(j,function(l){if(!e.contains(k,l)){k.push(l)}});return k};e.find=function(l,n,p){var k;var m=e.isFunction(n);if(l){for(var o=0,j=l.length;o<j;o++){var q=l[o];if(m?n.call(p,q):i(n,q)){k=q;break}}}return k};e.findIndex=function(l,n,p){var k=-1;var m=e.isFunction(n);if(l){for(var o=0,j=l.length;o<j;o++){var q=l[o];if(m?n.call(p,q):i(n,q)){k=o;break}}}return k};e.compose=function(){var j=arguments;return function(){var k=arguments;for(var l=j.length-1;l>=0;l--){if(!!j[l]){k=[j[l].apply(this,k)]}}return k[0]}};e.flatten=function(k){var j=[];h(k,function(l){if(e.isArray(l)){Array.prototype.push.apply(j,l)}});return j};e.flatMap=e.compose(e.flatten,e.map);e.union=function(){return e.uniq(e.flatten(arguments))};e.findOrFirst=function(k,l){if(!e.isUndefined(k)){var j=e.find(k,l);return e.isUndefined(j)?k[0]:j}return void 0};e.extend=function(j){j=j||{};h(Array.prototype.slice.call(arguments,1),function(k){if(k){h(k,function(m,l){j[l]=m})}});return j};e.partialRight=function(k){var j=Array.prototype.slice.call(arguments,1);return function(){return k.apply(this,Array.prototype.slice.call(arguments).concat(j))}};e.partial=function(k){var j=Array.prototype.slice.call(arguments,1);return function(){return k.apply(this,j.concat(Array.prototype.slice.call(arguments)))}};e.maybe=function(j){return j!=null?j:{}};e.clonePartial=function(n,m){var o;if(null==n||"object"!==typeof(n)){return n}if(n instanceof Date){o=new Date();o.setTime(n.getTime());return o}if(n instanceof Array){o=[];for(var l=0,k=n.length;l<k;l++){if(!m||m(l)){o.push(e.clonePartial(n[l],m))}}return o}if(n instanceof Object){o=Object.create(Object.getPrototypeOf(n));for(var j in n){if(n.hasOwnProperty(j)&&(!m||m(j))){o[j]=e.clonePartial(n[j],m)}}return o}throw new Error("Unable to copy obj")};e.objectExtender=function(k,j){return function(l){if(l){if(j){h(j(l),function(m){e.extend(m,e.isFunction(k)?k(l,m):k)})}else{e.extend(l,e.isFunction(k)?k(l,l):k)}}return l}};e.appFieldRejector=function(j){return !(e.isString(j)&&j.charAt(0)==="_")};e.deletePropertiesPartial=function(l,k){for(var j in l){if(l.hasOwnProperty(j)&&(!k||k(j))){delete l[j]}}};e.wrapFunctions=function(j,l,k){h(k,function(m){j[m]=function(){return l[m].apply(l,arguments)}});return j}},{}]},{},[1])(1)});